{"QUICK_START":{"slug":"QUICK_START","filePath":"QUICK_START.md","title":"QUICK_START","links":["guides/DEPLOYMENT","CI_CD_SETUP","QUICK_START","guides/DEVELOPMENT","guides/ARCHITECTURE","guides/API","reference/PHILOSOPHY","CLAUDE"],"tags":[],"content":"üöÄ Darshi - Quick Start Guide\n\nGet Darshi up and running locally in 15 minutes!\n\nLive Site: darshi.app | API: api.darshi.app\n\nüìã Prerequisites\nBefore starting, ensure you have:\n\nPython 3.11+ installed\nNode.js 20+ installed\nPostgreSQL 15+ with PostGIS extension\nRedis 7+ (or use Docker for both)\nGit installed\nDocker &amp; Docker Compose (recommended for quick setup)\n\n\n‚ö° Fast Setup with Docker (Recommended)\n# 1. Clone and navigate\ngit clone github.com/Sarthak-Sidhant/darshi.git\ncd darshi\n \n# 2. Start PostgreSQL and Redis\ndocker compose up -d postgres redis\n \n# 3. Backend setup\npython3 -m venv venv\nsource venv/bin/activate  # Linux/Mac\npip install -r requirements.txt\n \n# 4. Configure environment (edit this file!)\ncp .env.example .env\nnano .env  # Add your Gemini API key, Cloudflare R2 credentials\n \n# 5. Run backend\nuvicorn app.main:app --reload --host 0.0.0.0 --port 8080\n \n# 6. Frontend setup (new terminal)\ncd frontend\nnpm install\ncp .env.example .env  # Optional: customize API URL\nnpm run dev\n‚úÖ Done! Open http://localhost:5173\n\nüìù Detailed Setup\nStep 1: Database Setup (3 minutes)\nOption A: Docker (Recommended)\n# Start PostgreSQL with PostGIS and Redis\ndocker compose up -d postgres redis\n \n# Verify containers are running\ndocker ps\n \n# Check logs\ndocker logs darshi-postgres\ndocker logs darshi-redis\nDefault credentials (configured in docker-compose.yml):\n\nPostgreSQL: postgres:postgres@localhost:5432/darshi\nRedis: redis://localhost:6379\n\nOption B: Manual Installation\nPostgreSQL with PostGIS:\n# Ubuntu/Debian\nsudo apt update\nsudo apt install postgresql-15 postgresql-15-postgis-3\n \n# Start service\nsudo systemctl start postgresql\nsudo systemctl enable postgresql\n \n# Create database\nsudo -u postgres psql\nCREATE DATABASE darshi;\n\\c darshi\nCREATE EXTENSION postgis;\nCREATE USER darshi_user WITH PASSWORD &#039;your_password&#039;;\nGRANT ALL PRIVILEGES ON DATABASE darshi TO darshi_user;\n\\q\nRedis:\n# Ubuntu/Debian\nsudo apt install redis-server\n \n# Start service\nsudo systemctl start redis-server\nsudo systemctl enable redis-server\n \n# Test connection\nredis-cli ping  # Should return PONG\n\nStep 2: Backend Setup (5 minutes)\n2.1 Create Virtual Environment\ncd /path/to/darshi\npython3 -m venv venv\nsource venv/bin/activate  # Linux/Mac\n# venv\\Scripts\\activate    # Windows\n2.2 Install Dependencies\npip install -r requirements.txt\nThis installs:\n\nFastAPI (web framework)\nSQLAlchemy + asyncpg (PostgreSQL ORM)\nRedis client\nCloudflare R2 SDK\nGemini AI SDK\nAuthentication libraries (JWT, bcrypt)\nAnd more‚Ä¶\n\n2.3 Configure Backend Environment\ncp .env.example .env\nnano .env  # or use your favorite editor\nEssential variables:\n# Database\nDATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/darshi\n \n# Redis\nREDIS_URL=redis://localhost:6379/0\n \n# Cloudflare R2 (S3-compatible storage)\nR2_ACCOUNT_ID=your-cloudflare-account-id\nR2_ACCESS_KEY_ID=your-r2-access-key\nR2_SECRET_ACCESS_KEY=your-r2-secret-key\nR2_BUCKET_NAME=darshi-reports\nR2_PUBLIC_URL=your-bucket.r2.cloudflarestorage.com\n \n# Gemini AI\nGEMINI_API_KEY=your-gemini-api-key-from-google-ai-studio\n \n# JWT Secret (generate with: python3 -c &quot;import secrets; print(secrets.token_urlsafe(64))&quot;)\nSECRET_KEY=your-generated-secret-key\n \n# OAuth (optional)\nGOOGLE_CLIENT_ID=your-google-client-id\nGOOGLE_CLIENT_SECRET=your-google-client-secret\nGITHUB_CLIENT_ID=your-github-client-id\nGITHUB_CLIENT_SECRET=your-github-client-secret\nFACEBOOK_CLIENT_ID=your-facebook-client-id\nFACEBOOK_CLIENT_SECRET=your-facebook-client-secret\n \n# App Config\nENVIRONMENT=development\nFRONTEND_URL=http://localhost:5173\nCORS_ORIGINS=http://localhost:5173,http://localhost:8080\n2.4 Get Gemini API Key\n\nGo to Google AI Studio\nClick Create API Key\nCopy the key and add to .env\n\n2.5 Set Up Cloudflare R2 (Image Storage)\n\nGo to Cloudflare Dashboard\nNavigate to R2 Object Storage\nCreate a bucket: darshi-reports\nCreate API token:\n\nGo to Manage R2 API Tokens\nClick Create API Token\nSet permissions: Object Read &amp; Write\nCopy Access Key ID and Secret Access Key\n\n\nAdd credentials to .env\n\n2.6 Initialize Database\n# Run migrations (creates all tables)\nalembic upgrade head\n \n# Or use the init script\npython scripts/init_db.py\nThis creates tables:\n\nusers - User accounts\nreports - Civic grievance reports\ncomments - Report comments\nupvotes - User upvotes on reports\nadmin_logs - Audit trail for admin actions\n\n\nStep 3: Frontend Setup (3 minutes)\n3.1 Install Dependencies\ncd frontend\nnpm install\nThis installs:\n\nSvelteKit 5 with Runes API\nTypeScript\nLeaflet (maps)\nAnd more‚Ä¶\n\n3.2 Configure Frontend Environment (Optional)\ncp .env.example .env\nnano .env\nOptional variables (defaults work for local development):\n# Backend API URL (default: http://localhost:8080)\nVITE_API_URL=http://localhost:8080\n\nStep 4: Run the Application (1 minute)\nOpen two terminal windows:\nTerminal 1: Backend\ncd /path/to/darshi\nsource venv/bin/activate\nuvicorn app.main:app --reload --host 0.0.0.0 --port 8080\n‚úÖ Backend running at: http://localhost:8080\n‚úÖ API Docs at: http://localhost:8080/docs\nTerminal 2: Frontend\ncd /path/to/darshi/frontend\nnpm run dev\n‚úÖ Frontend running at: http://localhost:5173\n\nüß™ Test Your Setup\n1. Check Health Endpoint\ncurl http://localhost:8080/health\nExpected response:\n{\n  &quot;status&quot;: &quot;healthy&quot;,\n  &quot;service&quot;: &quot;Darshi Backend&quot;,\n  &quot;database&quot;: &quot;connected&quot;,\n  &quot;redis&quot;: &quot;connected&quot;\n}\n2. Open API Documentation\nGo to http://localhost:8080/docs\nYou should see:\n\nInteractive Swagger UI\nAll 62+ API endpoints\nTry out authentication, reports, admin endpoints\n\n3. Open Frontend\nGo to http://localhost:5173\nYou should see:\n\nLanding page with navigation\nSign In button (unified auth page)\nRecent reports list\nMap preview\n\n4. Create Test Account\n\nClick Sign In\nSwitch to Create Account tab\nChoose any registration method:\n\nEmail + password\nGoogle/GitHub/Facebook OAuth\n\n\nFill in username and email\nYou‚Äôre in! üéâ\n\n5. Submit Test Report\n\nClick Submit Report in navigation\nFill in details:\n\nTitle: ‚ÄúTest pothole‚Äù\nDescription: ‚ÄúTesting the platform‚Äù\nCategory: Pothole\nUpload an image\n\n\nClick Current Location to auto-fill GPS\nSubmit report\nWait for AI verification (~5-10 seconds)\nReport appears on homepage!\n\n\nüîê OAuth Setup (Optional)\nTo enable Google, GitHub, and Facebook login:\nGoogle OAuth\n\nGo to Google Cloud Console\nCreate a project or select existing\nNavigate to APIs &amp; Services ‚Üí Credentials\nClick Create Credentials ‚Üí OAuth 2.0 Client ID\nApplication type: Web application\nAuthorized redirect URIs:\n\nhttp://localhost:8080/api/v1/oauth/google/callback\napi.darshi.app/api/v1/oauth/google/callback\n\n\nCopy Client ID and Client Secret to .env\n\nGitHub OAuth\n\nGo to GitHub Settings\nClick New OAuth App\nApplication name: Darshi\nHomepage URL: http://localhost:5173\nAuthorization callback URL: http://localhost:8080/api/v1/oauth/github/callback\nCopy Client ID and Client Secret to .env\n\nFacebook OAuth\n\nGo to Facebook Developers\nCreate an app ‚Üí Consumer type\nAdd Facebook Login product\nSettings ‚Üí Valid OAuth Redirect URIs:\n\nhttp://localhost:8080/api/v1/oauth/facebook/callback\n\n\nCopy App ID and App Secret to .env\n\n\nüéØ Next Steps\nEssential Configuration\n\n\nCreate Admin User:\npython scripts/create_admin.py\n# Follow prompts to create super_admin or moderator\n\n\nTest All Features:\n\nSubmit a report with images\nView on map\nAdd comments\nUpvote reports\nTest admin panel at /admin\n\n\n\nRun Tests:\n# Backend tests\npytest -v\npytest --cov=app\n \n# Frontend tests\ncd frontend\nnpm run test\nnpm run check  # Type checking\n\n\nProduction Readiness\nBefore deploying to production:\n\n\nSecurity:\n\nChange SECRET_KEY to strong random value\nUpdate CORS_ORIGINS to your domain only\nEnable rate limiting (already configured)\nUse strong PostgreSQL password\nReview DEPLOYMENT.md\n\n\n\nOAuth:\n\nUpdate OAuth callback URLs to production domain\nAdd production redirect URIs to providers\n\n\n\nDatabase:\n\nSet up automated backups (see DEPLOYMENT.md)\nConfigure connection pooling\nAdd monitoring\n\n\n\nCI/CD:\n\nSee CI_CD_SETUP.md for GitHub Actions workflow\nConfigure secrets in GitHub repository\nTest auto-deployment\n\n\n\n\nüêõ Common Issues\nBackend won‚Äôt start\n‚ÄúConnection refused to PostgreSQL‚Äù:\n# Check PostgreSQL is running\ndocker ps | grep postgres\n# Or if installed manually:\nsudo systemctl status postgresql\n \n# Test connection\npsql postgresql://postgres:postgres@localhost:5432/darshi\n‚ÄúConnection refused to Redis‚Äù:\n# Check Redis is running\ndocker ps | grep redis\n# Or if installed manually:\nsudo systemctl status redis-server\n \n# Test connection\nredis-cli ping  # Should return PONG\n‚ÄúPort 8080 already in use‚Äù:\n# Find and kill process using port 8080\nlsof -ti:8080 | xargs kill -9\n \n# Or use different port\nuvicorn app.main:app --reload --port 8000\nFrontend won‚Äôt start\n‚ÄúModule not found‚Äù:\n# Clear node_modules and reinstall\ncd frontend\nrm -rf node_modules package-lock.json\nnpm install\n‚ÄúVITE_API_URL not defined‚Äù:\n\nDefault is http://localhost:8080, no .env needed\nOnly create frontend/.env if you need custom API URL\n\nDatabase connection fails\n‚ÄúRole ‚Äòpostgres‚Äô does not exist‚Äù:\n# If using Docker, check connection string matches docker-compose.yml\n# Default: postgresql://postgres:postgres@localhost:5432/darshi\n‚ÄúDatabase ‚Äòdarshi‚Äô does not exist‚Äù:\n# Create database\ndocker exec -it darshi-postgres psql -U postgres -c &quot;CREATE DATABASE darshi;&quot;\n \n# Or if installed manually:\nsudo -u postgres createdb darshi\n‚ÄúExtension ‚Äòpostgis‚Äô not available‚Äù:\n# Install PostGIS extension\ndocker exec -it darshi-postgres psql -U postgres -d darshi -c &quot;CREATE EXTENSION postgis;&quot;\nImage uploads fail\n‚ÄúCloudflare R2 access denied‚Äù:\n\nVerify R2 credentials in .env\nCheck bucket name matches\nEnsure API token has read/write permissions\n\n‚ÄúFile too large‚Äù:\n\nMax file size: 10MB per image\nMax 5 images per report\nBackend will return 413 error\n\n\nüìö Documentation Index\n\n\nGetting Started:\n\nQuick Start - This guide\nDevelopment Guide - Developer workflow\nCD Setup - Auto-deployment\n\n\n\nDeployment:\n\nDeployment Guide - Production hosting on Azure VPS\nArchitecture Guide - System design\n\n\n\nAPI:\n\nAPI Reference - Complete API documentation (62 endpoints)\nInteractive docs: http://localhost:8080/docs\n\n\n\nReference:\n\nPhilosophy - Development principles\nCLAUDE.md - AI assistant context\n\n\n\n\nüÜò Getting Help\nIf you‚Äôre stuck:\n\n\nCheck logs:\n# Backend logs (in terminal running uvicorn)\n# Watch for errors in red\n \n# Docker logs\ndocker logs darshi-postgres --tail 50\ndocker logs darshi-redis --tail 50\n \n# Frontend (in browser console)\nF12 ‚Üí Console tab\n\n\nVerify environment:\n# Backend\nsource venv/bin/activate\npython -c &quot;import sys; print(sys.version)&quot;  # Should be 3.11+\npython -c &quot;import fastapi; print(fastapi.__version__)&quot;\n \n# Frontend\nnode --version  # Should be 20+\nnpm --version\n\n\nCheck running services:\n# Health check\ncurl http://localhost:8080/health\n \n# Database connection\npsql postgresql://postgres:postgres@localhost:5432/darshi -c &quot;SELECT version();&quot;\n \n# Redis connection\nredis-cli ping\n\n\nReview documentation:\n\nCheck DEVELOPMENT.md for patterns\nSee PHILOSOPHY.md for conventions\nReview API.md for endpoint details\n\n\n\n\n‚úÖ Success Checklist\nYou‚Äôre ready to develop when:\n\n PostgreSQL and Redis are running\n Backend health check returns OK\n Frontend loads at localhost:5173\n Can register a new user\n Can login with test credentials\n Can submit a test report with image\n Image uploads to Cloudflare R2\n Report appears on homepage\n Can view report details\n Can add comments and upvote\n Admin panel accessible (if admin user created)\n\n\nCongratulations! Darshi is running locally. üéâ\nNext: Try submitting your first civic report, explore the map, or set up the admin panel!"},"about":{"slug":"about","filePath":"about.md","title":"About Darshi","links":["README","03-development/Development-Guide","QUICK_START","01-architecture/Architecture-Overview","05-features/Features-Overview","reference/PHILOSOPHY"],"tags":["about","overview","mission","platform"],"content":"About Darshi\n\nDarshi (‡§¶‡§∞‡•ç‡§∂‡•Ä) - Sanskrit for ‚Äúone who sees‚Äù or ‚Äúobserver‚Äù\n\nDarshi is a civic accountability platform that empowers citizens to report, track, and resolve civic issues in their communities. Using AI-powered verification and geospatial analytics, Darshi helps hold local authorities accountable while building a comprehensive database of civic infrastructure problems.\n‚Üê Documentation Hub\n\nThe Problem We‚Äôre Solving\nBroken Civic Infrastructure\n\nPotholes damage vehicles and cause accidents\nBroken streetlights compromise public safety\nOverflowing garbage bins create health hazards\nPoor drainage leads to flooding during monsoons\nDamaged roads disrupt daily commutes\n\nLack of Accountability\n\nCitizens don‚Äôt know where or how to report issues\nReports get lost in bureaucratic processes\nNo transparency on whether issues are being addressed\nDuplicate reports waste administrative resources\nNo data-driven approach to prioritize critical problems\n\nLimited Public Awareness\n\nCommunities don‚Äôt know about problems in their area\nNo way to see patterns or hotspots of civic neglect\nCitizens can‚Äôt collectively voice concerns\nAuthorities lack data to allocate resources effectively\n\n\nOur Solution\n1. Easy Reporting\nCitizens can report civic issues in seconds:\n\nüì± Take a photo of the problem\nüìç Location is automatically captured via GPS\n‚úçÔ∏è Add a short title and description\nüöÄ Submit anonymously or with an account\n\nNo bureaucracy. No complicated forms. Just snap and submit.\n2. AI-Powered Verification\nGoogle Gemini AI automatically analyzes every submission:\n\nüîç Verifies the image contains a legitimate civic issue\nüè∑Ô∏è Classifies the problem (pothole, garbage, streetlight, etc.)\n‚ö†Ô∏è Assigns severity level (1-10 scale)\n‚ùå Rejects spam, irrelevant, or inappropriate content\n\nThis prevents false reports and reduces manual moderation work.\n3. Duplicate Detection\nSmart algorithms prevent redundant reports:\n\nüñºÔ∏è Perceptual image hashing (dHash) detects visually similar photos\nüó∫Ô∏è Geospatial proximity checks (within ~55 meters)\nüîó Links duplicate reports to existing ones\nüìä Shows community support through upvotes\n\nCitizens see if someone already reported the issue before submitting.\n4. Community Engagement\nCitizens can interact with reports:\n\nüëç Upvote reports to show community support\nüí¨ Comment to provide additional context or updates\nüì¢ Share reports to raise awareness\nüîî Get notified when status changes\n\nMore upvotes = more visibility = more pressure on authorities.\n5. Real-Time Tracking\nTransparent lifecycle for every report:\n\n‚è≥ Pending Verification - AI is analyzing the submission\n‚úÖ Verified - Confirmed as a legitimate civic issue\nüîß In Progress - Authorities are addressing it\n‚úîÔ∏è Resolved - Issue has been fixed\n‚ùå Rejected - Not a valid civic issue\nüö© Flagged - Requires manual review\n\nCitizens can track progress and hold authorities accountable.\n6. Hotspot Analytics\nBigQuery-powered insights identify patterns:\n\nüî• Hotspot Alerts - Areas with 3+ critical issues in 24 hours\nüìä Category Trends - Which problems are most common\nüìà Time-Series Analysis - How quickly issues get resolved\nüó∫Ô∏è Geographic Clustering - Regions that need attention\n\nData-driven decision making for resource allocation.\n\nHow It Works\nFor Citizens\n1. Open Darshi ‚Üí Tap &quot;Submit Report&quot;\n2. Take photo of civic issue\n3. Add title (e.g., &quot;Large pothole on Main Street&quot;)\n4. Add description (optional but recommended)\n5. Location is auto-captured via GPS\n6. Submit ‚Üí AI analyzes within seconds\n7. Get notified when status changes\n8. Track progress on the report page\n\nAnonymous submissions allowed - No account required to report issues (10 reports/hour limit).\nRegistered users get 5x higher limits (50 reports/hour) and can track their submissions.\nFor Authorities\n1. Admin logs in to dashboard\n2. Views all reports by status, category, or location\n3. Sees hotspot alerts for critical areas\n4. Updates report status (In Progress, Resolved)\n5. Adds admin notes for transparency\n6. Citizens get notified automatically\n\nAudit trail preserved - Every status change is logged with timestamps and admin identity.\nFor the Community\n1. Browse feed to see nearby issues\n2. Upvote reports you&#039;ve also noticed\n3. Comment with additional details\n4. Share reports on social media\n5. Monitor hotspot alerts\n6. Celebrate when issues get resolved\n\nCollective voice amplified - Multiple citizens reporting the same issue creates pressure for action.\n\nTechnology Stack\nBackend (Python + FastAPI)\n\nFastAPI - High-performance async web framework\nGoogle Cloud Firestore - NoSQL database for reports, users, comments\nGoogle Cloud Storage - Image hosting with automatic optimization\nGoogle Gemini AI - Image analysis and classification\nBigQuery - Analytics and hotspot detection\nJWT Authentication - Secure token-based auth\n\nFrontend (TypeScript + SvelteKit)\n\nSvelteKit 5 - Modern reactive framework with Runes\nLeaflet - Interactive maps with India boundaries\nNative CSS - Ultra-lightweight, no frameworks\nTypeScript - Type-safe development\nProgressive Web App - Works offline, installable\n\nInfrastructure\n\nFirebase Hosting - Frontend deployment\nGoogle Cloud Run - Serverless backend (auto-scaling)\nCloud Build - CI/CD pipeline\nCloud Logging - Centralized logging\n\nDesigned for scale - Handles thousands of reports with geospatial indexing and caching.\n\nKey Features\nü§ñ AI Verification\n\nAutomatic classification - AI categorizes issues (pothole, garbage, etc.)\nSeverity assessment - 1-10 scale based on visual analysis\nSpam filtering - Rejects invalid submissions automatically\nConfidence scoring - AI provides explanation for decisions\n\nüó∫Ô∏è Geospatial Features\n\nGPS auto-capture - Location detected automatically\nGeohash indexing - Fast proximity queries (precision 9 ‚âà 4.77m √ó 4.77m)\nAddress search - Search by street name or landmark\nMap view - See all reports on an interactive map\nCluster visualization - Identify problem areas at a glance\n\nüîí Security &amp; Privacy\n\nInput sanitization - All user input is sanitized to prevent XSS\nRate limiting - 10 reports/hour (anonymous), 50/hour (authenticated)\nJWT authentication - Secure token-based sessions\nCORS protection - Environment-specific origin policies\nAdmin audit logs - Every admin action is tracked\n\nüìä Analytics &amp; Insights\n\nHotspot detection - Areas with clusters of severe issues\nCategory breakdown - Which problems are most prevalent\nStatus tracking - Resolution rates and timelines\nUser statistics - Top contributors and community engagement\n\nüì± Mobile-First Design\n\nResponsive layout - Works on phones, tablets, desktops\nTouch-friendly UI - Large buttons, swipe gestures\nOffline support - Progressive Web App functionality\nImage optimization - WebP + JPEG fallback for compatibility\nFast loading - Critical CSS, lazy loading, code splitting\n\n‚ôø Accessibility\n\nWCAG 2.1 compliant - Semantic HTML, ARIA labels\nKeyboard navigation - Full site usable without mouse\nScreen reader support - Proper heading structure and labels\nHigh contrast - Readable text on all backgrounds\nFocus indicators - Clear visual feedback\n\n\nThe Vision\nShort Term (2025)\n\n‚úÖ Launch MVP with core reporting features\n‚úÖ Deploy in pilot cities across India\nüéØ Onboard 1,000+ active users\nüéØ Track 10,000+ civic issues\nüéØ Measure resolution rates and timelines\n\nMedium Term (2026)\n\nüéØ Expand to 50+ cities nationwide\nüéØ Partner with municipal corporations for direct integration\nüéØ Add SMS/WhatsApp notifications for status updates\nüéØ Implement email digests for hotspot alerts\nüéØ Build public API for third-party integrations\n\nLong Term (2027+)\n\nüéØ Scale to 100+ cities across India\nüéØ Predictive analytics (forecast where issues will occur)\nüéØ Budget transparency (show how tax money is allocated)\nüéØ Citizen satisfaction surveys post-resolution\nüéØ Replicate model in other developing countries\n\nThe ultimate goal: Make civic infrastructure accountability the norm, not the exception.\n\nImpact Metrics\nWhat Success Looks Like\n\nFor Citizens: Faster issue resolution (target: &lt;7 days for critical issues)\nFor Authorities: Data-driven resource allocation and reduced duplicate reports\nFor Communities: Increased awareness and collective pressure for action\nFor Society: Improved civic infrastructure and quality of life\n\nMeasuring Impact\n\nüìà Number of reports submitted\n‚úÖ Percentage of reports resolved\n‚è±Ô∏è Average time to resolution\nüî• Reduction in hotspot areas\nüìä Citizen satisfaction ratings\nüí¨ Community engagement (upvotes, comments, shares)\n\n\nOpen Source &amp; Transparency\nWhy Open Source?\n\nTransparency - Code is auditable by anyone\nTrust - No hidden algorithms or data manipulation\nCollaboration - Community contributions improve the platform\nReplicability - Other communities can deploy their own instances\n\nContributing\nDarshi welcomes contributions! See our Development Guide to get started.\nWays to contribute:\n\nüêõ Report bugs or suggest features\nüíª Submit pull requests\nüìù Improve documentation\nüåê Translate UI to regional languages\nüé® Design improvements\n\n\nPrivacy &amp; Data Policy\nWhat We Collect\n\nReport data: Photos, location, title, description, timestamp\nUser data (optional): Email/phone for account creation, username\nInteraction data: Upvotes, comments (linked to user accounts)\nAnalytics: Usage patterns, error logs (anonymized)\n\nWhat We Don‚Äôt Collect\n\n‚ùå Personal identifiable information (unless you create an account)\n‚ùå Device fingerprinting or tracking across sites\n‚ùå Browsing history or third-party data\n‚ùå Biometric or sensitive personal data\n\nData Retention\n\nActive reports: Retained indefinitely for transparency\nResolved reports: Archived after 2 years\nUser accounts: Deletable at any time\nLogs: 90-day retention for troubleshooting\n\nData Security\n\nüîí All data encrypted in transit (HTTPS)\nüîí Database access restricted to authenticated services\nüîí Regular security audits and penetration testing\nüîí No third-party data sharing (except Google Cloud infrastructure)\n\n\nFrequently Asked Questions\nCan I report anonymously?\nYes! You don‚Äôt need an account to submit reports. However, registered users get 5x higher rate limits (50 vs 10 reports/hour).\nHow does AI verification work?\nGoogle Gemini AI analyzes the image to determine if it contains a civic issue, classifies the category (pothole, garbage, etc.), and assigns a severity score. The AI rejects spam, irrelevant content, or inappropriate images automatically.\nWhat if my report is rejected?\nIf the AI rejects your report, you‚Äôll see a reason (e.g., ‚ÄúNo civic issue detected in image‚Äù). You can edit and resubmit with a clearer photo.\nHow long until issues get resolved?\nResolution time depends on the severity and local authorities‚Äô response. Darshi tracks average resolution times and displays them publicly to encourage accountability.\nCan I delete my report?\nYes, you can delete reports you submitted (if you‚Äôre logged in and own them). However, reports in ‚ÄúVerified‚Äù, ‚ÄúIn Progress‚Äù, or ‚ÄúResolved‚Äù status cannot be deleted by users (contact admin if needed).\nIs Darshi affiliated with the government?\nNo. Darshi is an independent civic tech platform. We aim to work with authorities, not replace them.\nHow do I become an admin/moderator?\nContact the platform administrators. Admins are vetted and given special access to update report statuses and manage content.\nCan I export data for research?\nYes, we plan to provide public APIs and data exports for academic research and civic analysis (with privacy safeguards).\n\nContact &amp; Support\nFor general inquiries:\n\nüìß Email: contact@darshi.app\nüåê Website: darshi.app\n\nFor technical support:\n\nüìö Documentation: darshi.app/docs\nüêõ GitHub Issues: github.com/YOUR_USERNAME/darshi/issues\n\nFor partnerships:\n\nü§ù Municipal corporations interested in integration\nüèõÔ∏è NGOs working on civic governance\nüéì Academic researchers studying civic tech\n\n\nCredits\nBuilt by: Sidhant Sarthak\nTechnologies: Google Cloud Platform, SvelteKit, FastAPI, Gemini AI\nInspired by: SeeClickFix, FixMyStreet, and civic tech movements worldwide\nSpecial thanks to:\n\nOpen-source communities for tools and libraries\nEarly testers and feedback providers\nCitizens who believe in accountable governance\n\n\nLearn More\n\nQuick Start Guide - Get up and running in 15 minutes\nArchitecture Overview - Deep dive into system design\nFeatures Overview - Explore all features\nDevelopment Philosophy - Our approach to building robust software\n\n\nReady to make a difference? Submit your first report ‚Üí\n\nLast Updated: 2025-12-21\nVersion: 1.0.0"},"guides/API":{"slug":"guides/API","filePath":"guides/API.md","title":"API","links":[],"tags":[],"content":"Darshi API Documentation\nAPI Version: v1 | Base URL: /api/v1\n\nTable of Contents\n\nReports API\nGeospatial API\nAuthentication API\nOAuth API\nFirebase Authentication\nNotifications API\nUsers API\nAdmin API\nRate Limiting\nError Handling\nAuthentication Schemes\n\n\nReports API\nPOST /api/v1/report\nCreate a new report with images and location data\n\nAuthentication: Optional (JWT Bearer token)\nRate Limit: 10 reports/hour (anonymous) | 50 reports/hour (authenticated)\nResponse Code: 201 Created\n\nRequest (multipart/form-data)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFieldTypeRequiredDescriptionfilesList[UploadFile]Yes1-5 image files (max 10MB each) - JPEG, PNG, WebPlocationstringYesHuman-readable location or coordinates (e.g., ‚Äò28.7041,77.1025‚Äô or ‚ÄòDelhi‚Äô)titlestringYesReport title (max 200 characters)descriptionstringNoDetailed description (max 1000 characters)usernamestringNoAnonymous username (auto-generated if not provided)\nResponse\n{\n  &quot;report_id&quot;: &quot;string&quot;,\n  &quot;status&quot;: &quot;PENDING_VERIFICATION&quot;\n}\nNotes\n\nBackground task processes AI verification asynchronously\nDuplicate detection using dHash (perceptual hashing)\nImages optimized to WebP and JPEG formats\nGeohashing for proximity queries (~4.9km grid)\nReverse geocoding for human-readable addresses\nDynamic rate limiting: 5x more for authenticated users\n\n\nGET /api/v1/report/{report_id}\nGet a single report by ID\n\nAuthentication: None\nRate Limit: 200/hour\nResponse Code: 200 OK\nCache: Public, 60s client + 120s CDN\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringUnique report identifier\nResponse\n{\n  &quot;report_id&quot;: &quot;string&quot;,\n  &quot;username&quot;: &quot;string&quot;,\n  &quot;title&quot;: &quot;string&quot;,\n  &quot;description&quot;: &quot;string&quot;,\n  &quot;location&quot;: &quot;string&quot;,\n  &quot;latitude&quot;: &quot;float&quot;,\n  &quot;longitude&quot;: &quot;float&quot;,\n  &quot;status&quot;: &quot;string&quot;,\n  &quot;category&quot;: &quot;string&quot;,\n  &quot;severity&quot;: &quot;int&quot;,\n  &quot;image_data&quot;: [{&quot;webp_url&quot;: &quot;string&quot;, &quot;jpeg_url&quot;: &quot;string&quot;}],\n  &quot;upvote_count&quot;: &quot;int&quot;,\n  &quot;created_at&quot;: &quot;string&quot;\n}\n\nGET /api/v1/reports\nList reports with pagination and geohash filtering\n\nAuthentication: None\nRate Limit: 200/hour\nResponse Code: 200 OK\nCache: Public, 30s client + 60s CDN\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDefaultDescriptionstart_after_idstring-Pagination cursorgeohashstring-Filter by geohash prefix (precision 5)limitinteger10Number of reports to return\nResponse\n[\n  { /* report object */ },\n  { /* report object */ }\n]\n\nPOST /api/v1/report/{report_id}/upvote\nUpvote a report (idempotent per user)\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport to upvote\nResponse\n{\n  &quot;upvote_count&quot;: &quot;int&quot;,\n  &quot;user_upvoted&quot;: &quot;boolean&quot;\n}\nNotes\n\nUsername extracted from JWT token (prevents IDOR attacks)\nSends milestone notifications at 10, 50, 100, 500, 1000 upvotes\nIn-app and browser push notifications\n\n\nPOST /api/v1/report/{report_id}/comment\nAdd a comment to a report\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 50/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport to comment on\nRequest (form-data)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFieldTypeRequiredDescriptiontextstringYesComment text (1-500 characters)\nResponse\n{\n  &quot;id&quot;: &quot;string&quot;,\n  &quot;username&quot;: &quot;string&quot;,\n  &quot;text&quot;: &quot;string&quot;,\n  &quot;created_at&quot;: &quot;string&quot;\n}\nNotes\n\nUsername extracted from JWT token\nNotification sent to report author (if different from commenter)\nText is sanitized before storage\n\n\nGET /api/v1/report/{report_id}/comments\nGet all comments for a report\n\nAuthentication: None\nRate Limit: 200/hour\nResponse Code: 200 OK\n\nResponse\n[\n  { /* comment object */ }\n]\n\nPUT /api/v1/report/{report_id}\nEdit a report (title and description only)\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 50/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport to edit\nRequest (form-data)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFieldTypeDescriptiontitlestringUpdated title (optional)descriptionstringUpdated description (optional)\nResponse\n{\n  &quot;message&quot;: &quot;Report updated successfully&quot;,\n  &quot;report_id&quot;: &quot;string&quot;\n}\nNotes\n\nOnly report owner can edit\nCannot edit RESOLVED, REJECTED, DUPLICATE, or IN_PROGRESS reports\nTimeline event added for audit trail\n\n\nDELETE /api/v1/report/{report_id}\nDelete a report\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 50/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport to delete\nResponse\n{\n  &quot;message&quot;: &quot;Report deleted successfully&quot;\n}\nNotes\n\nOnly report owner can delete\nCannot delete VERIFIED, RESOLVED, IN_PROGRESS, or DUPLICATE reports\n\n\nGET /api/v1/report/{report_id}/nearby-landmarks\nGet nearby landmarks for a report\n\nAuthentication: None\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport ID\nResponse\n{\n  &quot;landmarks&quot;: [\n    {\n      &quot;name&quot;: &quot;string&quot;,\n      &quot;type&quot;: &quot;string&quot;,\n      &quot;distance_m&quot;: &quot;int&quot;,\n      &quot;distance_text&quot;: &quot;string&quot;\n    }\n  ]\n}\nNotes\n\nReturns up to 5 landmarks within 500m radius\nDistance formatted as ‚ÄúXm away‚Äù or ‚ÄúX.Xkm away‚Äù\n\n\nGeospatial API\nGET /api/v1/geocode\nConvert address to coordinates (forward geocoding)\n\nAuthentication: None\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeRequiredDescriptionqstringYesAddress query (limited to India)\nResponse\n{\n  &quot;latitude&quot;: &quot;float&quot;,\n  &quot;longitude&quot;: &quot;float&quot;,\n  &quot;address&quot;: &quot;string&quot;\n}\nNotes\n\nUses Nominatim API, limited to India\nCircuit breaker: 3 failures / 60s recovery\n\n\nGET /api/v1/reverse-geocode\nConvert coordinates to human-readable address\n\nAuthentication: None\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeRequiredDescriptionlatfloatYesLatitudelngfloatYesLongitude\nResponse\n{\n  &quot;address&quot;: &quot;string&quot;\n}\n\nGET /api/v1/alerts\nGet hotspot alerts from BigQuery\n\nAuthentication: None\nRate Limit: 100/hour\nResponse Code: 200 OK\nCache: 5 minutes (server-side)\n\nQuery Parameters\nNone\nResponse\n[\n  {\n    &quot;location&quot;: &quot;string&quot;,\n    &quot;severity&quot;: &quot;int&quot;,\n    &quot;count&quot;: &quot;int&quot;,\n    &quot;timestamp&quot;: &quot;string&quot;\n  }\n]\nNotes\n\nIdentifies areas with 3+ severe issues (severity &gt; 7) in 24 hours\nQueries BigQuery analytics table\n\n\nAuthentication API\nPOST /api/v1/auth/register\nRegister a new user\n\nAuthentication: None\nRate Limit: 5/hour (prevents mass account creation)\nResponse Code: 201 Created\n\nRequest (application/json)\n{\n  &quot;username&quot;: &quot;string (required)&quot;,\n  &quot;email&quot;: &quot;string (optional, required if phone not provided)&quot;,\n  &quot;phone&quot;: &quot;string (optional, required if email not provided)&quot;,\n  &quot;password&quot;: &quot;string (optional for phone-only users)&quot;,\n  &quot;full_name&quot;: &quot;string (optional)&quot;,\n  &quot;lat&quot;: &quot;float (optional)&quot;,\n  &quot;lng&quot;: &quot;float (optional)&quot;,\n  &quot;location_address&quot;: &quot;string (optional)&quot;,\n  &quot;role&quot;: &quot;string (default: citizen)&quot;\n}\nResponse\n{\n  &quot;username&quot;: &quot;string&quot;,\n  &quot;email&quot;: &quot;string&quot;,\n  &quot;phone&quot;: &quot;string&quot;,\n  &quot;full_name&quot;: &quot;string&quot;,\n  &quot;role&quot;: &quot;string&quot;,\n  &quot;email_verified&quot;: &quot;boolean&quot;,\n  &quot;phone_verified&quot;: &quot;boolean&quot;,\n  &quot;created_at&quot;: &quot;string&quot;\n}\nNotes\n\nUsername is required and must be unique\nAt least one of email or phone required\nPassword optional for phone-only users (use OTP)\nVerification email sent if EMAIL_ENABLED and email provided\nGeneric error returned if credentials exist (prevents user enumeration)\n\n\nPOST /api/v1/auth/token\nLogin with username/email/phone and password\n\nAuthentication: None\nRate Limit: 10/hour (brute-force protection)\nResponse Code: 200 OK\n\nRequest (application/x-www-form-urlencoded)\nusername=&lt;username|email|phone&gt;&amp;password=&lt;password&gt;\n\nResponse\n{\n  &quot;access_token&quot;: &quot;string (JWT)&quot;,\n  &quot;token_type&quot;: &quot;bearer&quot;\n}\nNotes\n\nUsername field accepts username, email, or phone number\nJWT token includes user_type=&#039;citizen&#039;\nToken expiration: 30 days\nBrute-force protection via rate limiting\n\n\nGET /api/v1/auth/me\nGet current authenticated user information\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: Default\nResponse Code: 200 OK\n\nResponse\n{\n  &quot;username&quot;: &quot;string&quot;,\n  &quot;email&quot;: &quot;string&quot;,\n  &quot;phone&quot;: &quot;string&quot;,\n  &quot;full_name&quot;: &quot;string&quot;,\n  &quot;role&quot;: &quot;string&quot;,\n  &quot;email_verified&quot;: &quot;boolean&quot;,\n  &quot;phone_verified&quot;: &quot;boolean&quot;\n}\n\nPOST /api/v1/auth/send-email-verification\nSend or resend email verification link\n\nAuthentication: None\nRate Limit: 3/hour\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;email&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;If the email exists, a verification link has been sent&quot;\n}\nNotes\n\nGeneric response to prevent email enumeration\nReturns success even if email doesn‚Äôt exist\n\n\nPOST /api/v1/auth/verify-email\nVerify email using token from email link\n\nAuthentication: None\nRate Limit: 10/hour\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;token&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;Email verified successfully&quot;,\n  &quot;email&quot;: &quot;string&quot;\n}\n\nPOST /api/v1/auth/send-phone-verification\nSend phone verification code (OTP)\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 5/hour\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;phone&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;Verification code sent successfully&quot;\n}\n\nPOST /api/v1/auth/verify-phone\nVerify phone using OTP code\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 10/hour\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;phone&quot;: &quot;string&quot;,\n  &quot;code&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;Phone verified successfully&quot;\n}\n\nPOST /api/v1/auth/forgot-password\nRequest password reset link\n\nAuthentication: None\nRate Limit: 3/hour\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;email&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;If the email exists, a password reset link has been sent&quot;\n}\nNotes\n\nAlways returns success to prevent email enumeration\nLinks are time-limited\n\n\nPOST /api/v1/auth/reset-password\nReset password using token from email link\n\nAuthentication: None\nRate Limit: 5/hour\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;token&quot;: &quot;string&quot;,\n  &quot;new_password&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;Password reset successfully&quot;\n}\n\nPUT /api/v1/auth/change-password\nChange password for authenticated user\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 10/hour\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;old_password&quot;: &quot;string&quot;,\n  &quot;new_password&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;Password changed successfully&quot;\n}\nNotes\n\nNot available for OAuth users\nRequires correct old password for security\n\n\nOAuth API\nGET /api/v1/auth/google/login\nRedirect to Google OAuth login page\n\nAuthentication: None\nResponse Code: 302 Redirect\nRedirect URL: accounts.google.com/o/oauth2/v2/auth\n\nNotes\n\nGenerates state parameter for CSRF protection\nRequires GOOGLE_CLIENT_ID configuration\n\n\nGET /api/v1/auth/google/callback\nHandle Google OAuth callback\n\nAuthentication: None\nResponse Code: 302 Redirect\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeRequiredDescriptioncodestringYesAuthorization code from GooglestatestringYesState parameter (CSRF validation)errorstringNoError code if failed\nRedirect Response\n{FRONTEND_URL}/auth/callback?token={jwt_token}&amp;is_new={boolean}\n\nNotes\n\nValidates state parameter to prevent CSRF\nCreates new user if OAuth ID not found\nLinks OAuth to existing email-based user if found\nReturns JWT token via redirect\n\n\nGET /api/v1/auth/github/login\nRedirect to GitHub OAuth login page\n\nAuthentication: None\nResponse Code: 302 Redirect\nRedirect URL: github.com/login/oauth/authorize\n\n\nGET /api/v1/auth/github/callback\nHandle GitHub OAuth callback\n\nAuthentication: None\nResponse Code: 302 Redirect\n\nQuery Parameters\nSame as Google callback\nRedirect Response\n{FRONTEND_URL}/auth/callback?token={jwt_token}&amp;is_new={boolean}\n\n\nGET /api/v1/auth/facebook/login\nRedirect to Facebook OAuth login page\n\nAuthentication: None\nResponse Code: 302 Redirect\nRedirect URL: www.facebook.com/v18.0/dialog/oauth\n\n\nGET /api/v1/auth/facebook/callback\nHandle Facebook OAuth callback\n\nAuthentication: None\nResponse Code: 302 Redirect\n\nQuery Parameters\nSame as Google callback\nRedirect Response\n{FRONTEND_URL}/auth/callback?token={jwt_token}&amp;is_new={boolean}\n\n\nFirebase Authentication\nPOST /api/v1/auth/firebase/verify\nVerify Firebase ID token and create/login user\n\nAuthentication: None (Firebase ID token in body)\nRate Limit: None\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;id_token&quot;: &quot;string&quot;,\n  &quot;username&quot;: &quot;string (optional, for new users)&quot;\n}\nResponse (Existing User)\n{\n  &quot;access_token&quot;: &quot;string (JWT)&quot;,\n  &quot;token_type&quot;: &quot;bearer&quot;,\n  &quot;is_new_user&quot;: false\n}\nResponse (New User)\n{\n  &quot;access_token&quot;: &quot;&quot;,\n  &quot;token_type&quot;: &quot;bearer&quot;,\n  &quot;is_new_user&quot;: true,\n  &quot;user_info&quot;: {\n    &quot;email&quot;: &quot;string&quot;,\n    &quot;phone&quot;: &quot;string&quot;,\n    &quot;full_name&quot;: &quot;string&quot;,\n    &quot;profile_picture&quot;: &quot;string&quot;,\n    &quot;oauth_provider&quot;: &quot;string&quot;,\n    &quot;oauth_id&quot;: &quot;string&quot;\n  }\n}\nNotes\n\nFor new users, access_token is empty and user_info is returned\nFor existing users, access_token is populated\nAutomatically links OAuth provider if not already linked\nSupports multiple sign-in providers (Google, GitHub, Facebook, phone, Firebase)\n\n\nPOST /api/v1/auth/firebase/complete-registration\nComplete OAuth registration with username and location\n\nAuthentication: None (Firebase ID token in body)\nRate Limit: None\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;id_token&quot;: &quot;string&quot;,\n  &quot;username&quot;: &quot;string&quot;,\n  &quot;lat&quot;: &quot;float&quot;,\n  &quot;lng&quot;: &quot;float&quot;,\n  &quot;location_address&quot;: &quot;string (optional)&quot;\n}\nResponse\n{\n  &quot;access_token&quot;: &quot;string (JWT)&quot;,\n  &quot;token_type&quot;: &quot;bearer&quot;,\n  &quot;is_new_user&quot;: false\n}\n\nGET /api/v1/auth/check-username/{username}\nCheck if a username is available\n\nAuthentication: None\nRate Limit: None\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionusernamestringUsername to check\nResponse\n{\n  &quot;available&quot;: &quot;boolean&quot;,\n  &quot;username&quot;: &quot;string&quot;\n}\n\nPOST /api/v1/auth/phone/send-otp\nSend OTP for phone authentication\n\nAuthentication: None\nRate Limit: None\nResponse Code: 200 OK\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeRequiredDescriptionphonestringYesPhone number\nResponse\n{\n  &quot;message&quot;: &quot;Please use Firebase client SDK to send OTP&quot;,\n  &quot;phone&quot;: &quot;string&quot;\n}\nNotes\n\nPlaceholder endpoint for API consistency\nOTP handling done client-side by Firebase SDK\n\n\nNotifications API\nGET /api/v1/notifications\nGet notifications for current user\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 30/minute\nResponse Code: 200 OK\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDefaultDescriptionunread_onlybooleanfalseFilter to unread onlylimitinteger50Max 100\nResponse\n{\n  &quot;notifications&quot;: [\n    {\n      &quot;id&quot;: &quot;string&quot;,\n      &quot;title&quot;: &quot;string&quot;,\n      &quot;message&quot;: &quot;string&quot;,\n      &quot;read&quot;: &quot;boolean&quot;,\n      &quot;created_at&quot;: &quot;string&quot;\n    }\n  ],\n  &quot;unread_count&quot;: &quot;int&quot;\n}\nNotes\n\nOrdered by creation time (newest first)\nIncludes unread count in response\n\n\nPUT /api/v1/notifications/{notification_id}/read\nMark a single notification as read\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 100/minute\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionnotification_idstringNotification ID\nResponse\n{\n  &quot;success&quot;: &quot;boolean&quot;\n}\n\nPUT /api/v1/notifications/read-all\nMark all notifications as read\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 20/minute\nResponse Code: 200 OK\n\nResponse\n{\n  &quot;marked_read&quot;: &quot;integer&quot;\n}\n\nDELETE /api/v1/notifications/{notification_id}\nDelete a notification\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 50/minute\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionnotification_idstringNotification ID\nResponse\n{\n  &quot;success&quot;: &quot;boolean&quot;\n}\n\nPOST /api/v1/notifications/push/subscribe\nSave browser push notification subscription\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 10/minute\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;endpoint&quot;: &quot;string&quot;,\n  &quot;keys&quot;: {\n    &quot;p256dh&quot;: &quot;string&quot;,\n    &quot;auth&quot;: &quot;string&quot;\n  },\n  &quot;user_agent&quot;: &quot;string (optional)&quot;\n}\nResponse\n{\n  &quot;subscription_id&quot;: &quot;string&quot;,\n  &quot;message&quot;: &quot;Push notifications enabled&quot;\n}\nNotes\n\nAllows receiving notifications even when app is closed\n\n\nDELETE /api/v1/notifications/push/unsubscribe\nRemove browser push notification subscription\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: 10/minute\nResponse Code: 200 OK\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeRequiredDescriptionendpointstringYesPush subscription endpoint URL\nResponse\n{\n  &quot;success&quot;: &quot;boolean&quot;,\n  &quot;message&quot;: &quot;Push notifications disabled&quot;\n}\n\nUsers API\nGET /api/v1/users/me/profile\nGet current user‚Äôs complete profile\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: Default\nResponse Code: 200 OK\n\nResponse\n{\n  &quot;username&quot;: &quot;string&quot;,\n  &quot;email&quot;: &quot;string&quot;,\n  &quot;full_name&quot;: &quot;string&quot;,\n  &quot;phone&quot;: &quot;string&quot;,\n  &quot;lat&quot;: &quot;float&quot;,\n  &quot;lng&quot;: &quot;float&quot;,\n  &quot;location_address&quot;: &quot;string&quot;,\n  &quot;profile_picture&quot;: &quot;string&quot;,\n  &quot;role&quot;: &quot;string&quot;,\n  &quot;email_verified&quot;: &quot;boolean&quot;,\n  &quot;phone_verified&quot;: &quot;boolean&quot;,\n  &quot;reports_count&quot;: &quot;int&quot;,\n  &quot;upvotes_received&quot;: &quot;int&quot;,\n  &quot;created_at&quot;: &quot;string&quot;\n}\n\nPUT /api/v1/users/me/profile\nUpdate user profile\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: Default\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;full_name&quot;: &quot;string (optional)&quot;,\n  &quot;phone&quot;: &quot;string (optional)&quot;,\n  &quot;lat&quot;: &quot;float (optional)&quot;,\n  &quot;lng&quot;: &quot;float (optional)&quot;,\n  &quot;location_address&quot;: &quot;string (optional)&quot;,\n  &quot;profile_picture&quot;: &quot;string (optional, URL)&quot;\n}\nResponse\n{\n  &quot;username&quot;: &quot;string&quot;,\n  &quot;email&quot;: &quot;string&quot;,\n  /* ... profile fields ... */\n}\nNotes\n\nChanging phone requires re-verification\n\n\nPOST /api/v1/users/me/profile-picture\nUpload profile picture to cloud storage\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: Default\nResponse Code: 200 OK\n\nRequest (multipart/form-data)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFieldTypeRequiredDescriptionfileUploadFileYesImage file\nResponse\n{\n  &quot;url&quot;: &quot;string&quot;,\n  &quot;message&quot;: &quot;Profile picture uploaded successfully&quot;\n}\n\nPUT /api/v1/users/me/settings\nUpdate user preferences/settings\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: Default\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;notification_enabled&quot;: &quot;boolean (optional)&quot;,\n  &quot;location_tracking_enabled&quot;: &quot;boolean (optional)&quot;,\n  &quot;public_profile&quot;: &quot;boolean (optional)&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;Settings updated successfully&quot;\n}\n\nGET /api/v1/users/me/reports\nGet all reports submitted by current user\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: Default\nResponse Code: 200 OK\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDefaultDescriptionlimitinteger50Max reports to return\nResponse\n{\n  &quot;reports&quot;: [\n    { /* report object */ }\n  ],\n  &quot;total&quot;: &quot;int&quot;\n}\n\nGET /api/v1/users/me/stats\nGet user statistics\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: Default\nResponse Code: 200 OK\n\nResponse\n{\n  &quot;total_reports&quot;: &quot;int&quot;,\n  &quot;verified_reports&quot;: &quot;int&quot;,\n  &quot;resolved_reports&quot;: &quot;int&quot;,\n  &quot;pending_reports&quot;: &quot;int&quot;,\n  &quot;total_upvotes&quot;: &quot;int&quot;,\n  &quot;email_verified&quot;: &quot;boolean&quot;,\n  &quot;phone_verified&quot;: &quot;boolean&quot;,\n  &quot;member_since&quot;: &quot;string&quot;\n}\n\nDELETE /api/v1/users/me/account\nDelete user account and all associated data\n\nAuthentication: Required (JWT Bearer token)\nRate Limit: Default\nResponse Code: 200 OK\n\nResponse\n{\n  &quot;message&quot;: &quot;Account deleted successfully&quot;\n}\nNotes\n\nWARNING: This action is irreversible\nDeletes all user‚Äôs reports and account data\n\n\nAdmin API\nPOST /api/v1/admin/login\nAdmin login endpoint\n\nAuthentication: None\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nRequest (application/json)\n{\n  &quot;email&quot;: &quot;string&quot;,\n  &quot;password&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;token&quot;: &quot;string (JWT with user_type=admin)&quot;,\n  &quot;admin&quot;: {\n    &quot;email&quot;: &quot;string&quot;,\n    &quot;role&quot;: &quot;string&quot;\n  }\n}\nNotes\n\nAuthenticates from separate ‚Äòadmins‚Äô collection\nJWT includes user_type=&#039;admin&#039; for authorization checks\nRate limiting prevents brute force attacks\n\n\nPUT /api/v1/admin/report/{report_id}/status\nUpdate report status (admin only)\n\nAuthentication: Required (JWT Bearer token with user_type=‚Äòadmin‚Äô)\nRate Limit: 500/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport ID\nRequest (application/json)\n{\n  &quot;status&quot;: &quot;string (RESOLVED, REJECTED, IN_PROGRESS, etc.)&quot;,\n  &quot;note&quot;: &quot;string (optional)&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;string&quot;,\n  &quot;updated_by&quot;: &quot;string (admin email)&quot;\n}\nNotes\n\nSends notification to report author\nAdds timeline event for audit trail\nLogs action in audit log\n\n\nGET /api/v1/admin/admins\nList all admin users\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 500/hour\nResponse Code: 200 OK\nAuthorization: super_admin only\n\nResponse\n{\n  &quot;admins&quot;: [\n    {\n      &quot;email&quot;: &quot;string&quot;,\n      &quot;role&quot;: &quot;string&quot;,\n      &quot;is_active&quot;: &quot;boolean&quot;\n    }\n  ]\n}\n\nGET /api/v1/admin/analytics/dashboard\nGet comprehensive admin dashboard analytics\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 500/hour\nResponse Code: 200 OK\n\nResponse\n{\n  &quot;summary&quot;: {\n    &quot;total_reports&quot;: &quot;int&quot;,\n    &quot;average_severity&quot;: &quot;float&quot;,\n    &quot;status_distribution&quot;: { /* ... */ },\n    &quot;category_distribution&quot;: { /* ... */ }\n  },\n  &quot;top_categories&quot;: [\n    {\n      &quot;category&quot;: &quot;string&quot;,\n      &quot;count&quot;: &quot;int&quot;\n    }\n  ],\n  &quot;recent_admin_actions&quot;: [ /* audit logs */ ],\n  &quot;generated_at&quot;: &quot;string&quot;\n}\n\nGET /api/v1/admin/analytics/audit-logs\nGet audit logs with optional filtering\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 500/hour\nResponse Code: 200 OK\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionuser_idstringFilter by userresource_typestringFilter by resource typeresource_idstringFilter by resource IDactionstringFilter by actionlimitintegerMax results (default 100)\nResponse\n{\n  &quot;logs&quot;: [ /* audit log objects */ ],\n  &quot;count&quot;: &quot;int&quot;,\n  &quot;filters&quot;: { /* applied filters */ }\n}\n\nGET /api/v1/admin/analytics/user-activity/{user_id}\nGet activity history for a specific user\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionuser_idstringUser ID\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDefaultDescriptionlimitinteger50Max activities\nResponse\n{\n  &quot;user_id&quot;: &quot;string&quot;,\n  &quot;activity&quot;: [ /* audit logs */ ],\n  &quot;count&quot;: &quot;int&quot;\n}\n\nGET /api/v1/admin/analytics/report-history/{report_id}\nGet complete audit history for a report\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport ID\nResponse\n{\n  &quot;report_id&quot;: &quot;string&quot;,\n  &quot;current_status&quot;: &quot;string&quot;,\n  &quot;timeline&quot;: [ /* timeline events */ ],\n  &quot;audit_logs&quot;: [ /* audit logs */ ],\n  &quot;created_at&quot;: &quot;string&quot;\n}\n\nDELETE /api/v1/admin/report/{report_id}\nDelete a report (admin only)\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport to delete\nResponse\n{\n  &quot;message&quot;: &quot;string&quot;,\n  &quot;deleted_by&quot;: &quot;string (admin email)&quot;\n}\nNotes\n\nCan delete reports in any status\nLogs deletion in audit trail\n\n\nPUT /api/v1/admin/report/{report_id}/category\nUpdate report category (admin only)\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 500/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport ID\nRequest (application/json)\n{\n  &quot;category&quot;: &quot;string&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;string&quot;,\n  &quot;updated_by&quot;: &quot;string&quot;\n}\n\nDELETE /api/v1/admin/report/{report_id}/comment/{comment_id}\nDelete a comment from a report (admin only)\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionreport_idstringReport IDcomment_idstringComment ID\nResponse\n{\n  &quot;message&quot;: &quot;string&quot;,\n  &quot;deleted_by&quot;: &quot;string&quot;\n}\n\nPOST /api/v1/admin/create-admin\nCreate a new admin user (super_admin only)\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 10/hour\nResponse Code: 200 OK\nAuthorization: super_admin only\n\nRequest (application/json)\n{\n  &quot;email&quot;: &quot;string&quot;,\n  &quot;password&quot;: &quot;string&quot;,\n  &quot;role&quot;: &quot;string (default: moderator)&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;string&quot;,\n  &quot;admin&quot;: { /* admin object */ }\n}\nNotes\n\nOnly super_admin can create new admins\nLogs creation in audit trail\n\n\nGET /api/v1/admin/reports\nGet reports for admin view\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 100/hour\nResponse Code: 200 OK\n\nQuery Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDefaultDescriptionstart_after_idstring-Pagination cursorstatusstring-Filter by statuslimitinteger20Max 100\nResponse\n[\n  { /* report object */ }\n]\nNotes\n\nIncludes REJECTED and FLAGGED status reports\n\n\nPUT /api/v1/admin/manage/{admin_email}/status\nActivate or deactivate an admin account (super_admin only)\n\nAuthentication: Required (JWT Bearer with user_type=‚Äòadmin‚Äô)\nRate Limit: 50/hour\nResponse Code: 200 OK\nAuthorization: super_admin only\n\nPath Parameters\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nParameterTypeDescriptionadmin_emailstringAdmin email\nRequest (application/json)\n{\n  &quot;is_active&quot;: &quot;boolean&quot;\n}\nResponse\n{\n  &quot;message&quot;: &quot;string&quot;\n}\nNotes\n\nCannot deactivate yourself\nLogs status change in audit trail\n\n\nAuthentication Schemes\nJWT Bearer Token\n\nType: HTTP Bearer\nScheme: Bearer\nLocation: Authorization header\nFormat: Authorization: Bearer {token}\nToken Type: JWT\nExpiration: 30 days\nToken Types:\n\nuser_type=&#039;citizen&#039; for user tokens\nuser_type=&#039;admin&#039; for admin tokens\n\n\nSecurity: Admin tokens cannot be used for citizen endpoints and vice versa\n\n\nRate Limiting\nDynamic Limits\n\nReport Creation:\n\nAuthenticated: 50 reports/hour\nAnonymous: 10 reports/hour\nAuthenticated users get 5x more quota\n\n\n\nStandard Rate Limits\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nEndpoint TypeLimitPublic read endpoints100-200/hourWrite endpoints50-100/hourAuth endpoints3-10/hourAdmin endpoints10-500/hourNotification endpoints10-100/minute\nRate Limit Implementation\n\nUses slowapi library\nBased on IP address for anonymous users\nBased on SHA-256 hash of auth token for authenticated users\n\n\nError Handling\nError Response Format\n{\n  &quot;detail&quot;: &quot;Error message&quot;\n}\nCommon HTTP Status Codes\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nStatusMeaning200OK - Request successful201Created - Resource created302Redirect - OAuth callback redirect400Bad Request - Invalid input401Unauthorized - Missing/invalid JWT token403Forbidden - Insufficient permissions404Not Found - Resource doesn‚Äôt exist429Rate Limit Exceeded - Too many requests500Internal Server Error501Not Implemented - Service not configured\n\nCaching Strategy\nCached Endpoints\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nEndpointClient CacheCDN CacheTTLGET /report/{report_id}60s120s2 minutesGET /reports30s60s1.5 minutesGET /alerts300s300s5 minutes\nCache Headers\nCache-Control: public, max-age={client_seconds}, s-maxage={cdn_seconds}\n\n\nEndpoints Summary\nTotal Endpoints: 62\n\nReports: 8 endpoints\nGeospatial: 3 endpoints\nAuthentication: 10 endpoints\nOAuth: 6 endpoints\nFirebase: 4 endpoints\nNotifications: 6 endpoints\nUsers: 7 endpoints\nAdmin: 12 endpoints\n\n\nImportant Security Notes\n\nCSRF Protection: All OAuth endpoints use state parameter validation\nIDOR Prevention: Username/email extracted from JWT token, not user input\nUser Enumeration: Generic error messages on login/registration failures\nBrute Force: Rate limiting on auth endpoints (3-10/hour)\nAdmin Access: Separate user_type claim distinguishes citizen vs admin tokens\nInput Validation: All inputs sanitized via sanitize_form_data()\nPII: Passwords and tokens never logged\nPhone Verification: Phone changes require re-verification\nPassword Security: bcrypt hashing with salt\nEmail Verification: Verification tokens are time-limited\n\n"},"guides/ARCHITECTURE":{"slug":"guides/ARCHITECTURE","filePath":"guides/ARCHITECTURE.md","title":"ARCHITECTURE","links":[],"tags":[],"content":"Architecture Overview - Darshi Platform\nThis document provides a comprehensive overview of the Darshi platform‚Äôs architecture, design decisions, data models, and system components.\nTable of Contents\n\nSystem Architecture\nTechnology Stack\nData Models\nBackend Architecture\nFrontend Architecture\nInfrastructure &amp; Deployment\nSecurity Architecture\nPerformance &amp; Scalability\nData Flow\nDesign Decisions\n\n\nSystem Architecture\nHigh-Level Overview\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                         CLIENT LAYER                          ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Web Browser  ‚îÇ    Mobile     ‚îÇ    PWA       ‚îÇ   Admin UI    ‚îÇ\n‚îÇ  (Desktop)    ‚îÇ   (Chrome)    ‚îÇ  (Offline)   ‚îÇ  (Dashboard)  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n         ‚îÇ                 ‚îÇ              ‚îÇ              ‚îÇ\n         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                    HTTPS (TLS 1.3)\n                           ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ              CLOUDFLARE PAGES (Frontend CDN)                 ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ              SvelteKit 5 Frontend (SSG)                ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - TypeScript, Runes API, Vite                        ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Service Worker (Push Notifications)                ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Leaflet Maps, i18n (English/Hindi)                 ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Dark Mode (Uber Black Theme)                       ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                    REST API (JSON)\n                           ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ              CLOUDFLARE PROXY (api.darshi.app)               ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                    HTTPS (Nginx Reverse Proxy)\n                           ‚îÇ\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                AZURE VPS (20.193.150.79)                     ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ                 NGINX (Reverse Proxy)                  ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - SSL Termination (Let&#039;s Encrypt)                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Rate Limiting                                       ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - GZip Compression                                    ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îÇ                           ‚îÇ                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n‚îÇ  ‚îÇ         FastAPI Backend (Docker Container)            ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  Port: 8080                                           ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                        ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  ‚îÇ   Routers   ‚îÇ  ‚îÇ   Services   ‚îÇ  ‚îÇ  Middleware ‚îÇ ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  ‚îÇ  (API Layer)‚îÇ‚Üí ‚îÇ (Logic Layer)‚îÇ  ‚îÇ  (Security) ‚îÇ ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ                                                        ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  Features:                                            ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - JWT Authentication (30-day expiry)                 ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - OAuth Integration (Google, GitHub, Facebook)       ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Rate Limiting (Redis-backed)                       ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Circuit Breakers (Gemini AI, Nominatim)           ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Structured Logging                                 ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Error Handling (32 exception types)               ‚îÇ  ‚îÇ\n‚îÇ  ‚îÇ  - Prometheus Metrics                                 ‚îÇ  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n‚îÇ                           ‚îÇ                                  ‚îÇ\n‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                ‚îÇ\n‚îÇ         ‚îÇ                 ‚îÇ                 ‚îÇ                ‚îÇ\n‚îÇ         ‚ñº                 ‚ñº                 ‚ñº                ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ\n‚îÇ  ‚îÇ PostgreSQL   ‚îÇ  ‚îÇ    Redis     ‚îÇ  ‚îÇ  Prometheus  ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ    15 +      ‚îÇ  ‚îÇ      7       ‚îÇ  ‚îÇ   (Metrics)  ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ   PostGIS    ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ - Caching    ‚îÇ  ‚îÇ - Health     ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ - Reports    ‚îÇ  ‚îÇ - Rate       ‚îÇ  ‚îÇ - Performance‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ - Users      ‚îÇ  ‚îÇ   Limiting   ‚îÇ  ‚îÇ - Business   ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ - Comments   ‚îÇ  ‚îÇ - Sessions   ‚îÇ  ‚îÇ   Metrics    ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ - Upvotes    ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ - Admin Logs ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ  ‚îÇ              ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ Docker Vol.  ‚îÇ  ‚îÇ Docker Vol.  ‚îÇ  ‚îÇ Docker Vol.  ‚îÇ      ‚îÇ\n‚îÇ  ‚îÇ (Persistent) ‚îÇ  ‚îÇ (AOF Persist)‚îÇ  ‚îÇ (7d Retain)  ‚îÇ      ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n         ‚îÇ                                      ‚îÇ\n         ‚îÇ (External Services)                  ‚îÇ\n         ‚ñº                                      ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  CLOUDFLARE R2   ‚îÇ                   ‚îÇ  EXTERNAL APIs   ‚îÇ\n‚îÇ  (Image Storage) ‚îÇ                   ‚îÇ                  ‚îÇ\n‚îÇ                  ‚îÇ                   ‚îÇ - Gemini 2.5     ‚îÇ\n‚îÇ - WebP/JPEG      ‚îÇ                   ‚îÇ   Flash (AI)     ‚îÇ\n‚îÇ   Optimized      ‚îÇ                   ‚îÇ - Nominatim      ‚îÇ\n‚îÇ - S3-Compatible  ‚îÇ                   ‚îÇ   (Geocoding)    ‚îÇ\n‚îÇ - CDN Enabled    ‚îÇ                   ‚îÇ - Overpass       ‚îÇ\n‚îÇ - dHash Index    ‚îÇ                   ‚îÇ   (Landmarks)    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nArchitecture Layers\n1. Presentation Layer (Frontend)\n\nSvelteKit 5 with Runes API (state, derived, effect, props)\nStatic Site Generation (SSG) on Cloudflare Pages\nProgressive Web App (PWA) capabilities\nService Worker for offline support and push notifications\nResponsive design (mobile-first)\nDark mode support (Uber Black theme)\nBilingual i18n (English and Hindi)\n\n2. API Gateway Layer (Nginx + FastAPI)\n\nNginx reverse proxy with SSL termination\nFastAPI application with async support (Python 3.11)\nJWT authentication and authorization\nOAuth 2.0 integration (Google, GitHub, Facebook)\nRate limiting (tiered: anonymous 3/hr, registered 10/hr, admin unlimited)\nRequest validation and sanitization\nSecurity headers (CSP, HSTS, X-Frame-Options)\n\n3. Business Logic Layer (Services)\n\nModular service architecture (service functions, no classes)\nCircuit breakers for external APIs (Gemini, Nominatim)\nRetry logic with exponential backoff\nCaching strategies (Redis with in-memory fallback)\nBackground task processing (async tasks)\nImage optimization (WebP conversion)\nPerceptual hashing (dHash) for duplicate detection\n\n4. Data Layer\n\nPostgreSQL 15 with PostGIS (relational database with geospatial extensions)\nRedis 7 with AOF persistence (caching and rate limiting)\nCloudflare R2 (S3-compatible object storage for images)\nDocker volumes for data persistence\n\n5. External Integration Layer\n\nGoogle Gemini 2.5 Flash (AI image analysis and verification)\nNominatim (geocoding with India filter)\nOverpass API (nearby landmarks)\nOAuth providers (Google, GitHub, Facebook)\n\n\nTechnology Stack\nBackend Technologies\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nComponentTechnologyVersionPurposeWeb FrameworkFastAPI0.115+High-performance async API frameworkLanguagePython3.11+Backend programming languageASGI ServerUvicornlatestProduction ASGI serverDatabasePostgreSQL15+Relational databaseGIS ExtensionPostGIS3.4+Geospatial queriesORMSQLAlchemy2.0+Database ORM with async supportDB Driverasyncpg0.29+Async PostgreSQL driverMigrationsAlembic1.13+Database migrationsCacheRedis7.0+In-memory caching and rate limitingStorageCloudflare R2-S3-compatible object storageAIGemini 2.5 Flash-Image analysis and verificationAuthJWT + OAuth 2.0-Stateless authenticationValidationPydantic2.0+Request/response validationHTTP Clienthttpx0.27+Async HTTP clientImage ProcessingPillow10.0+Image optimization (WebP)Hashingimagehash4.3+Perceptual hashing (dHash)Geocodingpygeohash1.5+Geohash encoding/decodingPush Notificationspywebpush1.14+Browser push (VAPID)MonitoringPrometheus-Metrics and monitoringTestingpytest8.0+Test framework\nFrontend Technologies\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nComponentTechnologyVersionPurposeFrameworkSvelteKit5.45+Modern web framework with RunesLanguageTypeScript5.9+Type-safe developmentBuild ToolVite7.2+Fast build and HMRMapsLeaflet.js1.9+Interactive mapsStateSvelte Storesbuilt-inGlobal state managementHTTPFetch APInativeAPI communicationStylingNative CSS-Lightweight, no frameworksIconsLucide Svelte0.562+Icon libraryi18nCustom store-English/Hindi translationsTestingVitest3.0+Unit testingHostingCloudflare Pages-Global CDN with edge optimization\nInfrastructure\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nServiceProviderPurposeComputeAzure VPSSelf-hosted VM (16GB RAM, 4 vCPU)DatabasePostgreSQL (Docker)Relational database with PostGISCacheRedis (Docker)In-memory cache with AOFProxyNginxReverse proxy with SSLContainersDocker + ComposeContainer orchestrationStorageCloudflare R2S3-compatible object storageCI/CDGitHub ActionsAutomated testing and deploymentHostingCloudflare PagesFrontend static site hostingSSLLet‚Äôs EncryptFree SSL certificatesMonitoringPrometheusMetrics and health checksAuto-RestartsystemdContainer auto-start on boot\n\nData Models\nPostgreSQL Tables\n1. users Table\nCREATE TABLE users (\n    id SERIAL PRIMARY KEY,\n    username VARCHAR(50) UNIQUE NOT NULL,\n    email VARCHAR(255),\n    phone VARCHAR(20),\n    password_hash VARCHAR(255),\n    role VARCHAR(20) DEFAULT &#039;citizen&#039;,  -- citizen, moderator, super_admin\n    is_active BOOLEAN DEFAULT TRUE,\n    is_verified BOOLEAN DEFAULT FALSE,\n    oauth_provider VARCHAR(50),          -- google, github, facebook\n    oauth_id VARCHAR(255),\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    CONSTRAINT unique_oauth UNIQUE(oauth_provider, oauth_id)\n);\n \nCREATE INDEX idx_users_username ON users(username);\nCREATE INDEX idx_users_email ON users(email);\nCREATE INDEX idx_users_oauth ON users(oauth_provider, oauth_id);\nFields:\n\nid - Auto-incrementing primary key\nusername - Unique username (case-sensitive)\nemail - Optional email (not unique, multiple accounts can use same email)\nphone - Optional phone number (E.164 format)\npassword_hash - Bcrypt hash (null for OAuth users)\nrole - User role: citizen, moderator, super_admin\nis_active - Account active status\nis_verified - Email verification status\noauth_provider - OAuth provider name\noauth_id - OAuth provider user ID\ncreated_at - Account creation timestamp\nupdated_at - Last update timestamp\n\n2. reports Table\nCREATE TABLE reports (\n    id SERIAL PRIMARY KEY,\n    report_id UUID UNIQUE NOT NULL DEFAULT gen_random_uuid(),\n    user_id INTEGER REFERENCES users(id) ON DELETE SET NULL,\n    username VARCHAR(50) NOT NULL,\n    title VARCHAR(200) NOT NULL,\n    description TEXT NOT NULL,\n    location VARCHAR(255) NOT NULL,\n    latitude DOUBLE PRECISION NOT NULL,\n    longitude DOUBLE PRECISION NOT NULL,\n    geom GEOGRAPHY(POINT, 4326),         -- PostGIS geography column\n    address TEXT,\n    city VARCHAR(100),\n    state VARCHAR(100),\n    country VARCHAR(100) DEFAULT &#039;India&#039;,\n    geohash VARCHAR(10),                  -- Geohash precision 7 (~153m grid)\n    nearby_landmarks TEXT[],\n    status VARCHAR(30) DEFAULT &#039;PENDING_VERIFICATION&#039;,\n    category VARCHAR(50),                 -- AI-classified category\n    severity INTEGER,                     -- AI-assessed severity (1-10)\n    ai_description TEXT,                  -- AI-generated description\n    ai_rejection_reason TEXT,             -- Reason if REJECTED\n    image_urls TEXT[] NOT NULL,           -- Original R2 URLs\n    image_data JSONB,                     -- WebP/JPEG optimized URLs\n    image_hash VARCHAR(64),               -- SHA256 for exact duplicates\n    dhash VARCHAR(16),                    -- Perceptual hash (dHash)\n    duplicate_of INTEGER REFERENCES reports(id) ON DELETE SET NULL,\n    upvote_count INTEGER DEFAULT 0,\n    comment_count INTEGER DEFAULT 0,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    verified_at TIMESTAMP,\n    resolved_at TIMESTAMP,\n    timeline JSONB DEFAULT &#039;[]&#039;::jsonb,   -- Audit trail\n    CONSTRAINT valid_coords CHECK (latitude BETWEEN -90 AND 90\n                                    AND longitude BETWEEN -180 AND 180),\n    CONSTRAINT valid_severity CHECK (severity BETWEEN 1 AND 10)\n);\n \n-- Indexes\nCREATE INDEX idx_reports_report_id ON reports(report_id);\nCREATE INDEX idx_reports_user_id ON reports(user_id);\nCREATE INDEX idx_reports_username ON reports(username);\nCREATE INDEX idx_reports_status ON reports(status);\nCREATE INDEX idx_reports_created_at ON reports(created_at DESC);\nCREATE INDEX idx_reports_geohash ON reports(geohash);\nCREATE INDEX idx_reports_status_created ON reports(status, created_at DESC);\nCREATE INDEX idx_reports_dhash ON reports(dhash) WHERE dhash IS NOT NULL;\n \n-- PostGIS spatial index\nCREATE INDEX idx_reports_geom ON reports USING GIST(geom);\nReport Status Enum:\n\nPENDING_VERIFICATION - Awaiting AI verification\nVERIFIED - AI verified as valid civic issue\nREJECTED - AI rejected (not a civic issue)\nDUPLICATE - Duplicate of existing report\nIN_PROGRESS - Admin marked as being worked on\nRESOLVED - Admin marked as resolved\nFLAGGED - System error during processing\n\nKey Fields:\n\nreport_id - UUID for public identification\ngeom - PostGIS geography point for spatial queries\ngeohash - Geohash for proximity queries (precision 7 = ~153m √ó 153m grid)\nimage_data - JSONB with WebP and JPEG URLs\ntimeline - JSONB array of state change events\ndhash - Perceptual hash for duplicate detection\nduplicate_of - Foreign key to original report if duplicate\n\n3. comments Table\nCREATE TABLE comments (\n    id SERIAL PRIMARY KEY,\n    report_id INTEGER NOT NULL REFERENCES reports(id) ON DELETE CASCADE,\n    user_id INTEGER REFERENCES users(id) ON DELETE SET NULL,\n    username VARCHAR(50) NOT NULL,\n    text TEXT NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    edited_at TIMESTAMP,\n    CONSTRAINT comment_length CHECK (LENGTH(text) &lt;= 500)\n);\n \nCREATE INDEX idx_comments_report_id ON comments(report_id, created_at DESC);\nCREATE INDEX idx_comments_user_id ON comments(user_id);\n4. upvotes Table\nCREATE TABLE upvotes (\n    id SERIAL PRIMARY KEY,\n    report_id INTEGER NOT NULL REFERENCES reports(id) ON DELETE CASCADE,\n    user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    username VARCHAR(50) NOT NULL,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    CONSTRAINT unique_upvote UNIQUE(report_id, user_id)\n);\n \nCREATE INDEX idx_upvotes_report_id ON upvotes(report_id);\nCREATE INDEX idx_upvotes_user_id ON upvotes(user_id);\n5. admin_logs Table\nCREATE TABLE admin_logs (\n    id SERIAL PRIMARY KEY,\n    admin_username VARCHAR(50) NOT NULL,\n    action VARCHAR(100) NOT NULL,\n    resource_type VARCHAR(50),            -- report, user, etc.\n    resource_id INTEGER,\n    details JSONB,\n    ip_address INET,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n \nCREATE INDEX idx_admin_logs_admin ON admin_logs(admin_username, created_at DESC);\nCREATE INDEX idx_admin_logs_resource ON admin_logs(resource_type, resource_id);\nCREATE INDEX idx_admin_logs_created_at ON admin_logs(created_at DESC);\n\nBackend Architecture\nProject Structure\napp/\n‚îú‚îÄ‚îÄ main.py                    # FastAPI application, middleware, CORS, exception handlers\n‚îú‚îÄ‚îÄ core/                      # Shared utilities and infrastructure\n‚îÇ   ‚îú‚îÄ‚îÄ config.py             # Environment variables, settings (Pydantic)\n‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py         # 32 custom exception types\n‚îÇ   ‚îú‚îÄ‚îÄ error_handling.py     # Circuit breakers, retry decorators, error context\n‚îÇ   ‚îú‚îÄ‚îÄ security.py           # JWT, bcrypt, rate limiting, input sanitization\n‚îÇ   ‚îú‚îÄ‚îÄ validation.py         # Input validators (coords, files, strings)\n‚îÇ   ‚îú‚îÄ‚îÄ logging_config.py     # Structured logging\n‚îÇ   ‚îú‚îÄ‚îÄ redis_client.py       # Redis connection management\n‚îÇ   ‚îú‚îÄ‚îÄ cache.py              # Caching layer with Redis fallback\n‚îÇ   ‚îî‚îÄ‚îÄ http_client.py        # Shared httpx client with retry logic\n‚îú‚îÄ‚îÄ db/                        # Database layer\n‚îÇ   ‚îú‚îÄ‚îÄ session.py            # SQLAlchemy session management\n‚îÇ   ‚îú‚îÄ‚îÄ models.py             # SQLAlchemy ORM models\n‚îÇ   ‚îî‚îÄ‚îÄ migrations/           # Alembic migrations\n‚îú‚îÄ‚îÄ routers/                   # API endpoints (route handlers)\n‚îÇ   ‚îú‚îÄ‚îÄ reports.py            # Report CRUD, upvotes, comments (18 endpoints)\n‚îÇ   ‚îú‚îÄ‚îÄ admin.py              # Admin dashboard, analytics, audit logs (12 endpoints)\n‚îÇ   ‚îú‚îÄ‚îÄ auth.py               # Username/password authentication (5 endpoints)\n‚îÇ   ‚îú‚îÄ‚îÄ oauth.py              # OAuth providers (Google, GitHub, Facebook) (9 endpoints)\n‚îÇ   ‚îú‚îÄ‚îÄ users.py              # User management (8 endpoints)\n‚îÇ   ‚îî‚îÄ‚îÄ notifications.py      # Push notification subscriptions (4 endpoints)\n‚îú‚îÄ‚îÄ services/                  # Business logic layer\n‚îÇ   ‚îú‚îÄ‚îÄ db_service.py         # PostgreSQL operations (reports, users, comments)\n‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py         # Gemini image analysis with circuit breaker\n‚îÇ   ‚îú‚îÄ‚îÄ storage_service.py    # Cloudflare R2 uploads (WebP/JPEG optimization)\n‚îÇ   ‚îú‚îÄ‚îÄ geo_service.py        # Geocoding, geohashing, proximity queries\n‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py       # JWT tokens, password hashing\n‚îÇ   ‚îú‚îÄ‚îÄ admin_service.py      # Admin operations\n‚îÇ   ‚îú‚îÄ‚îÄ notification_service.py # Push notifications (WebPush)\n‚îÇ   ‚îú‚îÄ‚îÄ image_service.py      # Image hashing (dHash), duplicate detection\n‚îÇ   ‚îî‚îÄ‚îÄ oauth_service.py      # OAuth provider integration\n‚îú‚îÄ‚îÄ models/                    # Pydantic schemas for request/response\n‚îÇ   ‚îú‚îÄ‚îÄ report.py             # Report schemas\n‚îÇ   ‚îú‚îÄ‚îÄ user.py               # User schemas\n‚îÇ   ‚îú‚îÄ‚îÄ comment.py            # Comment schemas\n‚îÇ   ‚îî‚îÄ‚îÄ admin.py              # Admin schemas\n‚îî‚îÄ‚îÄ middleware/                # Custom middleware\n    ‚îî‚îÄ‚îÄ performance.py         # Performance monitoring with Prometheus\n\nService Layer Design\nAll services are module-level functions (not classes) for simplicity:\n# services/db_service.py\nfrom app.core.error_handling import retry_database_operation, ErrorContext\nfrom app.core.exceptions import DatabaseError\nfrom sqlalchemy.ext.asyncio import AsyncSession\n \n@retry_database_operation\nasync def create_report(db: AsyncSession, data: dict) -&gt; int:\n    &quot;&quot;&quot;Create a new report in PostgreSQL.&quot;&quot;&quot;\n    with ErrorContext(&quot;database&quot;, &quot;create_report&quot;):\n        try:\n            stmt = insert(Report).values(**data).returning(Report.id)\n            result = await db.execute(stmt)\n            await db.commit()\n            report_id = result.scalar()\n            logger.info(f&quot;Report created: {report_id}&quot;)\n            return report_id\n        except SQLAlchemyError as e:\n            await db.rollback()\n            raise DatabaseError(\n                message=&quot;Failed to create report&quot;,\n                details=str(e),\n                context={&quot;operation&quot;: &quot;create&quot;}\n            )\nError Handling Architecture (3-Layer Defense)\nLayer 1: Prevention\n\nInput validation at router layer (core/validation.py)\nType checking (Pydantic models)\nSanitization (sanitize_form_data())\n\nLayer 2: Recovery\n\nRetry decorators: @retry_database_operation, @retry_ai_operation, @retry_storage_operation\nCircuit breakers: Gemini (5 failures/120s), Nominatim (3 failures/60s)\nGraceful degradation (continue with partial data)\n\nLayer 3: Communication\n\nStructured error responses with request IDs\nUser-friendly messages via toast notifications\nDetailed logging with context (exc_info=True)\n\nCustom Exceptions\n# core/exceptions.py\nclass DarshiBaseException(Exception):\n    &quot;&quot;&quot;Base exception with structured error info.&quot;&quot;&quot;\n    def __init__(self, message: str, details: str = None, context: dict = None):\n        self.message = message\n        self.details = details\n        self.context = context or {}\n        super().__init__(message)\n \n    def to_dict(self):\n        return {\n            &quot;error&quot;: {\n                &quot;code&quot;: self.__class__.__name__,\n                &quot;message&quot;: self.message,\n                &quot;details&quot;: self.details,\n                &quot;context&quot;: self.context,\n                &quot;timestamp&quot;: datetime.utcnow().isoformat(),\n                &quot;request_id&quot;: g.get(&quot;request_id&quot;)\n            }\n        }\n \nclass DatabaseError(DarshiBaseException): pass\nclass StorageError(DarshiBaseException): pass\nclass AIServiceError(DarshiBaseException): pass\nclass GeocodingError(DarshiBaseException): pass\nclass ValidationError(DarshiBaseException): pass\nclass AuthenticationError(DarshiBaseException): pass\n# ... 26 more exception types\n\nFrontend Architecture\nProject Structure\nfrontend/\n‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îú‚îÄ‚îÄ routes/                           # SvelteKit pages (file-based routing)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ +page.svelte                 # Home - reports list, hotspot alerts\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ +layout.svelte               # App layout with navigation\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ submit/+page.svelte          # Submit report form (GPS, geocoding)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report/[id]/+page.svelte     # Report detail (comments, timeline)\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signin/+page.svelte          # Unified auth (signin/register + OAuth)\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin/+page.svelte           # Admin dashboard\n‚îÇ   ‚îî‚îÄ‚îÄ lib/                              # Shared frontend code\n‚îÇ       ‚îú‚îÄ‚îÄ api.ts                        # API client with error handling\n‚îÇ       ‚îú‚îÄ‚îÄ validation.ts                 # Form validation utilities\n‚îÇ       ‚îú‚îÄ‚îÄ stores/\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts                   # User authentication store\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ theme.ts                  # Dark mode store (Uber Black)\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ i18n.ts                   # English/Hindi translation store\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ toast.ts                  # Toast notification store\n‚îÇ       ‚îî‚îÄ‚îÄ components/                   # Reusable UI components\n‚îÇ           ‚îú‚îÄ‚îÄ Toast.svelte              # Toast notifications\n‚îÇ           ‚îú‚îÄ‚îÄ LoadingButton.svelte      # Buttons with loading states\n‚îÇ           ‚îú‚îÄ‚îÄ LoadingSpinner.svelte     # Loading indicators\n‚îÇ           ‚îî‚îÄ‚îÄ Header.svelte             # Navigation header\n‚îú‚îÄ‚îÄ static/                               # Static assets (images, icons)\n‚îú‚îÄ‚îÄ svelte.config.js                      # SvelteKit configuration\n‚îú‚îÄ‚îÄ vite.config.ts                        # Vite configuration\n‚îî‚îÄ‚îÄ tsconfig.json                         # TypeScript configuration\n\nSvelteKit 5 Runes API\nAll components use the new Runes API for reactivity:\n&lt;script lang=&quot;ts&quot;&gt;\n  import { toast } from &#039;$lib/stores/toast&#039;;\n  import LoadingButton from &#039;$lib/components/LoadingButton.svelte&#039;;\n \n  // State with $state rune\n  let loading = $state(false);\n  let formData = $state({ title: &#039;&#039;, description: &#039;&#039; });\n  let errors = $state&lt;Record&lt;string, string[]&gt;&gt;({});\n \n  // Derived value with $derived rune\n  let isValid = $derived(\n    formData.title.length &gt; 0 &amp;&amp; formData.description.length &gt; 0\n  );\n \n  // Side effect with $effect rune\n  $effect(() =&gt; {\n    console.log(&#039;Form data changed:&#039;, formData);\n  });\n \n  async function handleSubmit() {\n    loading = true;\n    try {\n      await api.post(&#039;/api/v1/report&#039;, formData);\n      toast.show(&#039;Report created successfully!&#039;, &#039;success&#039;);\n    } catch (error) {\n      toast.show(getErrorMessage(error), &#039;error&#039;);\n    } finally {\n      loading = false;\n    }\n  }\n&lt;/script&gt;\n \n&lt;form onsubmit={handleSubmit}&gt;\n  &lt;input bind:value={formData.title} /&gt;\n  &lt;textarea bind:value={formData.description} /&gt;\n  &lt;LoadingButton loading={loading} disabled={!isValid}&gt;Submit&lt;/LoadingButton&gt;\n&lt;/form&gt;\nState Management\nGlobal Stores (using Svelte stores):\n// lib/stores/auth.ts\nimport { writable } from &#039;svelte/store&#039;;\n \nexport const user = writable&lt;User | null&gt;(null);\nexport const isAuthenticated = writable(false);\n \n// lib/stores/theme.ts\nexport const isDark = writable(true);  // Default to dark mode\n \n// lib/stores/i18n.ts\nexport const currentLang = writable&lt;&#039;en&#039; | &#039;hi&#039;&gt;(&#039;en&#039;);\nexport const t = derived(currentLang, ($lang) =&gt; translations[$lang]);\nDark Mode Implementation\n/* app.css */\n:root {\n  --bg-primary: #ffffff;\n  --text-primary: #000000;\n}\n \n[data-theme=&quot;dark&quot;] {\n  --bg-primary: #000000 !important;  /* Pure black for Uber Black theme */\n  --text-primary: #ffffff;\n  --bg-secondary: #121212;\n  --border-color: #2a2a2a;\n}\n\nInfrastructure &amp; Deployment\nAzure VPS Setup\nSpecifications:\n\nProvider: Microsoft Azure\nIP: 20.193.150.79\nOS: Ubuntu 22.04 LTS\nCPU: 4 vCPU\nRAM: 16 GB\nStorage: 100 GB SSD\nNetwork: Public IP with Cloudflare proxy\n\nDirectory Structure:\n/opt/darshi/                  # Application directory\n‚îú‚îÄ‚îÄ docker-compose.azure.yml  # Docker Compose configuration\n‚îú‚îÄ‚îÄ .env                      # Environment variables\n‚îú‚îÄ‚îÄ ssl/                      # Let&#039;s Encrypt certificates\n‚îú‚îÄ‚îÄ logs/                     # Application logs\n‚îî‚îÄ‚îÄ (git repository)\n\nDocker Compose Architecture\n# docker-compose.azure.yml\nversion: &#039;3.8&#039;\n \nservices:\n  backend:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: darshi-backend\n    ports:\n      - &quot;8080:8080&quot;\n    environment:\n      - DATABASE_URL=postgresql+asyncpg://postgres:${POSTGRES_PASSWORD}@postgres:5432/darshi\n      - REDIS_URL=redis://redis:6379/0\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_started\n    restart: unless-stopped\n    healthcheck:\n      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:8080/health&quot;]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n \n  postgres:\n    image: postgis/postgis:15-3.4\n    container_name: darshi-postgres\n    environment:\n      - POSTGRES_DB=darshi\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - &quot;5432:5432&quot;\n    restart: unless-stopped\n    healthcheck:\n      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U postgres&quot;]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n \n  redis:\n    image: redis:7-alpine\n    container_name: darshi-redis\n    command: redis-server --appendonly yes --appendfsync everysec\n    volumes:\n      - redis_data:/data\n    ports:\n      - &quot;6379:6379&quot;\n    restart: unless-stopped\n \n  prometheus:\n    image: prom/prometheus:latest\n    container_name: darshi-prometheus\n    volumes:\n      - ./prometheus.yml:/etc/prometheus/prometheus.yml\n      - prometheus_data:/prometheus\n    command:\n      - &#039;--config.file=/etc/prometheus/prometheus.yml&#039;\n      - &#039;--storage.tsdb.retention.time=7d&#039;\n    ports:\n      - &quot;9090:9090&quot;\n    restart: unless-stopped\n \nvolumes:\n  postgres_data:\n    driver: local\n  redis_data:\n    driver: local\n  prometheus_data:\n    driver: local\nData Persistence:\n\nAll Docker volumes survive container restarts and VPS reboots\nRedis uses AOF (Append-Only File) for persistence\nPostgreSQL data stored in named volume\nPrometheus retains 7 days of metrics\n\nNginx Configuration\n# /etc/nginx/sites-available/darshi\nserver {\n    listen 80;\n    server_name api.darshi.app;\n    return 301 https://$server_name$request_uri;\n}\n \nserver {\n    listen 443 ssl http2;\n    server_name api.darshi.app;\n \n    ssl_certificate /opt/darshi/ssl/fullchain.pem;\n    ssl_certificate_key /opt/darshi/ssl/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n \n    gzip on;\n    gzip_types application/json text/plain;\n \n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\nCI/CD Pipeline\nGitHub Actions Workflow (.github/workflows/deploy.yml):\n\n\nTest Stage:\n\nRun pytest on backend\nRun svelte-check on frontend\nBuild frontend to verify compilation\n\n\n\nDeploy Stage:\n\nSSH into Azure VPS\nPull latest code from GitHub\nRebuild Docker containers\nWait for health checks\nClean up old Docker images\n\n\n\nVerification Stage:\n\nCheck container status\nVerify backend health endpoint\nVerify frontend files exist\n\n\n\nAuto-Restart on Boot:\n\nsystemd service: darshi-deploy.service\nAutomatically starts Docker containers on VPS reboot\nGraceful shutdown on system stop\nRestart on failure\n\nDeployment Flow:\nDeveloper pushes to main\n    ‚Üì\nGitHub Actions triggered\n    ‚Üì\nTests run (pytest, svelte-check)\n    ‚Üì\nIf tests pass ‚Üí Deploy stage\n    ‚Üì\nSSH into VPS\n    ‚Üì\ngit pull origin main\n    ‚Üì\ndocker compose down\n    ‚Üì\ndocker compose up -d --build\n    ‚Üì\nHealth checks\n    ‚Üì\nCleanup old images\n    ‚Üì\n‚úÖ Deployment complete\n\n\nSecurity Architecture\nAuthentication &amp; Authorization\nJWT Token Structure:\n{\n  &quot;sub&quot;: &quot;username&quot;,\n  &quot;user_id&quot;: 123,\n  &quot;role&quot;: &quot;citizen&quot;,\n  &quot;exp&quot;: 1735209600,\n  &quot;iat&quot;: 1732531200\n}\nToken Types:\n\nUser tokens: 30-day expiry\nAdmin tokens: 1-hour expiry\n\nOAuth 2.0 Flow:\n1. User clicks &quot;Sign in with Google&quot;\n   ‚Üì\n2. Redirect to /api/v1/oauth/google/login\n   ‚Üì\n3. Backend redirects to Google OAuth consent screen\n   ‚Üì\n4. User authorizes app\n   ‚Üì\n5. Google redirects to /api/v1/oauth/google/callback\n   ‚Üì\n6. Backend exchanges code for access token\n   ‚Üì\n7. Fetch user profile from Google\n   ‚Üì\n8. Create or update user in database\n   ‚Üì\n9. Generate JWT token\n   ‚Üì\n10. Redirect to frontend with token in URL\n    ‚Üì\n11. Frontend stores token in localStorage\n    ‚Üì\n12. User is logged in\n\nSecurity Measures\n\n\nInput Sanitization:\n\nsanitize_form_data() at router layer\nHTML entity encoding\nSQL injection prevention via ORM\n\n\n\nRate Limiting:\n\nAnonymous: 3 requests/hour for report submission\nRegistered: 10 requests/hour for report submission\nAdmin: Unlimited\nStored in Redis with sliding window\n\n\n\nCORS Configuration:\nCORS_ORIGINS = [\n    &quot;darshi.app&quot;,\n    &quot;http://localhost:5173&quot;  # Development only\n]\n\n\nSecurity Headers:\nX-Content-Type-Options: nosniff\nX-Frame-Options: DENY\nContent-Security-Policy: default-src &#039;self&#039;; ...\nStrict-Transport-Security: max-age=31536000\n\n\n\nPassword Hashing:\n\nbcrypt with 12 rounds\nNo plaintext passwords stored\n\n\n\nFile Validation:\n\nMax 10MB per image\nMax 5 images per report\nAllowed types: JPEG, PNG, WebP\nMIME type verification\n\n\n\n\nPerformance &amp; Scalability\nCaching Strategy\nRedis Cache Layers:\n\nReport list cache (5 minutes TTL)\nIndividual report cache (15 minutes TTL)\nGeocoding results cache (24 hours TTL)\nAI verification results cache (permanent)\n\nIn-Memory Fallback:\n\nIf Redis unavailable, falls back to in-memory dict cache\nLimited to 1000 entries (LRU eviction)\n\nDatabase Optimization\nIndexes:\n\nComposite indexes on (status, created_at)\nSpatial indexes on geom column (PostGIS GIST)\nCovering indexes for common queries\n\nQuery Optimization:\n\nAsync queries with asyncpg (non-blocking)\nPagination with LIMIT/OFFSET\nEager loading for relationships\nConnection pooling (min: 5, max: 20)\n\nGeospatial Queries:\n-- Find reports within 5km radius\nSELECT *\nFROM reports\nWHERE ST_DWithin(\n    geom,\n    ST_SetSRID(ST_MakePoint(longitude, latitude), 4326)::geography,\n    5000  -- 5km in meters\n)\nAND status = &#039;VERIFIED&#039;\nORDER BY created_at DESC\nLIMIT 50;\nImage Optimization\nUpload Flow:\n1. User uploads image (JPEG/PNG)\n   ‚Üì\n2. Backend validates (size, type, dimensions)\n   ‚Üì\n3. Convert to WebP (85% quality) ‚Üí 30% smaller\n   ‚Üì\n4. Also keep JPEG version for compatibility\n   ‚Üì\n5. Upload both to Cloudflare R2\n   ‚Üì\n6. Store URLs in database\n   ‚Üì\n7. Calculate dHash for duplicate detection\n\nWebP Conversion:\nfrom PIL import Image\n \ndef optimize_image(image_path: str) -&gt; tuple[bytes, bytes]:\n    &quot;&quot;&quot;Convert image to WebP and JPEG formats.&quot;&quot;&quot;\n    with Image.open(image_path) as img:\n        # Convert to RGB if needed\n        if img.mode in (&#039;RGBA&#039;, &#039;P&#039;):\n            img = img.convert(&#039;RGB&#039;)\n \n        # Resize if too large\n        if img.width &gt; 1920:\n            ratio = 1920 / img.width\n            new_height = int(img.height * ratio)\n            img = img.resize((1920, new_height), Image.LANCZOS)\n \n        # WebP (85% quality)\n        webp_buffer = io.BytesIO()\n        img.save(webp_buffer, format=&#039;WEBP&#039;, quality=85)\n \n        # JPEG (90% quality)\n        jpeg_buffer = io.BytesIO()\n        img.save(jpeg_buffer, format=&#039;JPEG&#039;, quality=90)\n \n        return webp_buffer.getvalue(), jpeg_buffer.getvalue()\nCircuit Breakers\nGemini AI Circuit Breaker:\n\nThreshold: 5 failures within 120 seconds\nHalf-open state: Allow 1 test request after 60 seconds\nIf test succeeds ‚Üí Reset to closed\nIf test fails ‚Üí Back to open state\n\nNominatim Circuit Breaker:\n\nThreshold: 3 failures within 60 seconds\nHalf-open state: Allow 1 test request after 30 seconds\nFallback: Continue without geocoding\n\n\nData Flow\nReport Submission Flow\n1. User fills form on /submit page\n   ‚Üì\n2. Frontend validates inputs\n   ‚Üì\n3. POST /api/v1/report with FormData\n   ‚Üì\n4. Backend validates auth token (JWT)\n   ‚Üì\n5. Check rate limit (Redis)\n   ‚Üì\n6. Validate inputs (coords, file size, etc.)\n   ‚Üì\n7. Upload images to Cloudflare R2\n   ‚Üì\n8. Calculate image hash (SHA256 + dHash)\n   ‚Üì\n9. Create report in PostgreSQL (status: PENDING_VERIFICATION)\n   ‚Üì\n10. Queue background AI verification task\n    ‚Üì\n11. Return report_id to frontend\n    ‚Üì\n12. Background task: Download image from R2\n    ‚Üì\n13. Analyze with Gemini 2.5 Flash\n    ‚Üì\n14. Extract: is_valid, category, severity, description\n    ‚Üì\n15. Check for duplicates (perceptual hash + geohash)\n    ‚Üì\n16. Update report status: VERIFIED / REJECTED / DUPLICATE\n    ‚Üì\n17. Add event to timeline\n    ‚Üì\n18. Clear cache for report list\n    ‚Üì\n19. ‚úÖ Report visible on homepage\n\nAuthentication Flow\nUsername/Password:\n1. POST /api/v1/auth/login\n   ‚Üì\n2. Verify username exists\n   ‚Üì\n3. Compare password hash (bcrypt)\n   ‚Üì\n4. Generate JWT token (30-day expiry)\n   ‚Üì\n5. Return token to frontend\n   ‚Üì\n6. Frontend stores in localStorage\n   ‚Üì\n7. Include in Authorization header for all requests\n\nOAuth:\n1. GET /api/v1/oauth/google/login\n   ‚Üì\n2. Redirect to Google OAuth consent screen\n   ‚Üì\n3. User authorizes\n   ‚Üì\n4. Google redirects to /api/v1/oauth/google/callback?code=xxx\n   ‚Üì\n5. Exchange code for access token\n   ‚Üì\n6. Fetch user profile from Google API\n   ‚Üì\n7. Check if user exists (by oauth_id)\n   ‚Üì\n8. If not, create new user\n   ‚Üì\n9. Generate JWT token\n   ‚Üì\n10. Redirect to frontend with token\n    ‚Üì\n11. Frontend extracts token from URL\n    ‚Üì\n12. User is logged in\n\n\nDesign Decisions\nWhy PostgreSQL over Firestore?\nReasons for Migration:\n\nRelational Data Model: Reports, users, comments, upvotes have clear relationships\nACID Transactions: Need for atomic updates (upvote count, comment count)\nGeospatial Queries: PostGIS provides powerful spatial functions\nCost Predictability: Fixed VPS cost vs. Firestore usage-based pricing\nBetter Tooling: pgAdmin, pg_dump, familiar SQL ecosystem\nMigrations: Alembic provides version-controlled schema changes\n\nTrade-offs:\n\nLost: Auto-scaling (Cloud Run scaled to zero when idle)\nGained: Full control, better performance, predictable costs\n\nWhy Cloudflare R2 over Google Cloud Storage?\n\nNo Egress Fees: GCS charges for bandwidth, R2 does not\nS3 Compatibility: Standard boto3 API\nGlobal CDN: Images served from edge locations\nCost: ~70% cheaper than GCS\n\nWhy Docker Compose over Kubernetes?\n\nSimplicity: Single VPS, no need for orchestration complexity\nResource Efficiency: Kubernetes overhead not justified for small scale\nEasy Management: Docker Compose is simpler to debug and maintain\nSufficient for Scale: Current traffic fits well on single 16GB VPS\n\nWhy SvelteKit 5 over React/Next.js\n\nPerformance: Svelte compiles to vanilla JS (no virtual DOM)\nBundle Size: Svelte apps are ~30-40% smaller than React equivalents\nDeveloper Experience: Less boilerplate, more intuitive reactivity\nRunes API: Modern reactivity primitives (state, derived, $effect)\nSSR/SSG: Built-in support for server-side rendering\n\nWhy Module-Level Functions over Classes?\nBackend Services:\n\nSimpler to test (no state)\nNo constructor complexity\nNo self parameter noise\nEasier to mock in tests\nFollows functional programming principles\n\nExample:\n# ‚úÖ Function-based (preferred)\nasync def create_report(db: AsyncSession, data: dict) -&gt; int:\n    # Implementation\n    pass\n \n# ‚ùå Class-based (avoided)\nclass ReportService:\n    def __init__(self, db: AsyncSession):\n        self.db = db\n \n    async def create_report(self, data: dict) -&gt; int:\n        # Implementation\n        pass\nWhy Redis for Rate Limiting?\n\nAtomic Operations: INCR and EXPIRE are atomic\nSliding Window: Can implement complex rate limit algorithms\nFast: In-memory, sub-millisecond latency\nPersistence: AOF ensures rate limit state survives restarts\nShared State: Multiple backend instances can share rate limit counters\n\n\nMonitoring &amp; Observability\nPrometheus Metrics\nCustom Metrics:\nfrom prometheus_client import Counter, Histogram\n \n# Request counters\nhttp_requests_total = Counter(\n    &#039;http_requests_total&#039;,\n    &#039;Total HTTP requests&#039;,\n    [&#039;method&#039;, &#039;endpoint&#039;, &#039;status&#039;]\n)\n \n# Response time histogram\nhttp_request_duration_seconds = Histogram(\n    &#039;http_request_duration_seconds&#039;,\n    &#039;HTTP request latency&#039;,\n    [&#039;method&#039;, &#039;endpoint&#039;]\n)\n \n# Business metrics\nreports_created_total = Counter(&#039;reports_created_total&#039;, &#039;Total reports created&#039;)\nreports_verified_total = Counter(&#039;reports_verified_total&#039;, &#039;Reports verified by AI&#039;)\nreports_rejected_total = Counter(&#039;reports_rejected_total&#039;, &#039;Reports rejected by AI&#039;)\nHealth Checks:\n@app.get(&quot;/health&quot;)\nasync def health_check():\n    return {\n        &quot;status&quot;: &quot;healthy&quot;,\n        &quot;service&quot;: &quot;Darshi Backend&quot;,\n        &quot;database&quot;: await check_postgres(),\n        &quot;redis&quot;: await check_redis(),\n        &quot;timestamp&quot;: datetime.utcnow().isoformat()\n    }\nLogging Strategy\nLog Levels:\n\nDEBUG: Internal operations (queries, geohash encoding)\nINFO: User-facing operations (report created, user login)\nWARNING: Validation failures, recoverable errors\nERROR: Actual failures (database errors, API failures)\nCRITICAL: System initialization failures\n\nStructured Logging:\nlogger.info(\n    &quot;Report created&quot;,\n    extra={\n        &quot;report_id&quot;: report_id,\n        &quot;username&quot;: username,\n        &quot;category&quot;: category,\n        &quot;severity&quot;: severity\n    }\n)\n\nDocumentation Last Updated: December 27, 2025\nCodebase Version: 2.0.0 (Azure Migration Complete)\nInfrastructure: Azure VPS + Cloudflare + PostgreSQL + Docker"},"guides/DEPLOYMENT":{"slug":"guides/DEPLOYMENT","filePath":"guides/DEPLOYMENT.md","title":"DEPLOYMENT","links":[],"tags":[],"content":"Deployment Guide - Darshi Platform\nThis comprehensive guide covers deploying the Darshi platform to production on Azure VPS with Docker Compose, PostgreSQL, Redis, and Cloudflare services.\nTable of Contents\n\nPrerequisites\nInfrastructure Overview\nAzure VPS Setup\nDatabase Setup (PostgreSQL + PostGIS)\nCaching Setup (Redis)\nStorage Setup (Cloudflare R2)\nBackend Deployment\nFrontend Deployment (Cloudflare Pages)\nCI/CD Setup (GitHub Actions)\nSSL &amp; Domain Configuration\nMonitoring &amp; Logging\nBackup &amp; Recovery\nTroubleshooting\n\n\nPrerequisites\nRequired Accounts &amp; Tools\n\n\nAzure Account\n\nActive Azure subscription\nAccess to Azure Portal\nBudget: ~$50-70/month for 16GB VPS\n\n\n\nCloudflare Account\n\nDomain registered (or transferred to Cloudflare)\nR2 Storage enabled\nPages access\n\n\n\nGitHub Account\n\nRepository for code\nGitHub Actions enabled\n\n\n\nLocal Development Tools\n\nSSH client: For VPS access\nDocker: Install guide\nPython 3.11+: For backend development\nNode.js 20+: For frontend development\nGit: For version control\n\n\n\nAPI Keys &amp; Credentials\n\nGemini API Key: Get from Google AI Studio\nOAuth Credentials: Google, GitHub, Facebook (optional)\n\n\n\nCost Estimates (Monthly)\nBased on moderate usage (1000 reports/month):\n\nAzure VPS (16GB RAM, 4 vCPU): ~$50-70\nCloudflare R2 Storage: ~$0-5 (first 10GB free)\nCloudflare Pages: Free (unlimited requests)\nDomain (if purchasing): ~$10-15/year\nGemini API: Free tier (15 requests/min)\n\nTotal: ~$50-75/month for production workload\n\nInfrastructure Overview\nArchitecture Diagram\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ         CLOUDFLARE (DNS + CDN + Proxy)           ‚îÇ\n‚îÇ      darshi.app ‚îÇ api.darshi.app                 ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n          ‚îÇ                  ‚îÇ\n          ‚ñº                  ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ CLOUDFLARE PAGES ‚îÇ  ‚îÇ   CLOUDFLARE PROXY           ‚îÇ\n‚îÇ   (Frontend)     ‚îÇ  ‚îÇ   api.darshi.app             ‚îÇ\n‚îÇ                  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n‚îÇ  - SvelteKit SSG ‚îÇ             ‚îÇ\n‚îÇ  - Global CDN    ‚îÇ             ‚ñº\n‚îÇ  - Auto SSL      ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ  AZURE VPS (20.193.150.79)   ‚îÇ\n                      ‚îÇ  Ubuntu 22.04, 16GB, 4 vCPU  ‚îÇ\n                      ‚îÇ                              ‚îÇ\n                      ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n                      ‚îÇ  ‚îÇ   NGINX (Port 443)     ‚îÇ  ‚îÇ\n                      ‚îÇ  ‚îÇ   - SSL Termination    ‚îÇ  ‚îÇ\n                      ‚îÇ  ‚îÇ   - Reverse Proxy      ‚îÇ  ‚îÇ\n                      ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n                      ‚îÇ             ‚îÇ                ‚îÇ\n                      ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ\n                      ‚îÇ  ‚îÇ FastAPI (Port 8080)    ‚îÇ  ‚îÇ\n                      ‚îÇ  ‚îÇ Docker Container       ‚îÇ  ‚îÇ\n                      ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ\n                      ‚îÇ           ‚îÇ    ‚îÇ      ‚îÇ      ‚îÇ\n                      ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îê  ‚îå‚ñº‚îÄ‚îÄ‚îê  ‚îå‚ñº‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n                      ‚îÇ  ‚îÇPostgres‚îÇ  ‚îÇRedis‚îÇ ‚îÇProm‚îÇ ‚îÇ\n                      ‚îÇ  ‚îÇPostGIS ‚îÇ  ‚îÇAOF  ‚îÇ ‚îÇetheus‚îÇ\n                      ‚îÇ  ‚îÇVolume  ‚îÇ  ‚îÇVol. ‚îÇ ‚îÇVol.‚îÇ ‚îÇ\n                      ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                    ‚îÇ\n                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                      ‚ñº                             ‚ñº\n         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n         ‚îÇ   CLOUDFLARE R2      ‚îÇ      ‚îÇ  EXTERNAL APIs   ‚îÇ\n         ‚îÇ   (Image Storage)    ‚îÇ      ‚îÇ                  ‚îÇ\n         ‚îÇ   - S3-Compatible    ‚îÇ      ‚îÇ  - Gemini AI     ‚îÇ\n         ‚îÇ   - Global CDN       ‚îÇ      ‚îÇ  - Nominatim     ‚îÇ\n         ‚îÇ   - No Egress Fees   ‚îÇ      ‚îÇ  - Overpass      ‚îÇ\n         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nComponents\n\n\nFrontend (Cloudflare Pages)\n\nStatic site generated with SvelteKit\nGlobal CDN distribution\nAutomatic HTTPS\nZero config deployment\n\n\n\nBackend (Azure VPS + Docker)\n\nFastAPI application\nPostgreSQL 15 with PostGIS\nRedis 7 with AOF persistence\nPrometheus for metrics\nNginx reverse proxy\n\n\n\nStorage (Cloudflare R2)\n\nS3-compatible object storage\nImage hosting with CDN\nNo egress fees\n\n\n\nCI/CD (GitHub Actions)\n\nAutomated testing\nZero-downtime deployments\nContainer health checks\n\n\n\n\nAzure VPS Setup\nStep 1: Create Azure VM\n\n\nGo to Azure Portal\n\n\nClick Create a resource ‚Üí Virtual Machine\n\n\nConfigure:\n\nResource Group: Create new darshi-prod\nVM Name: darshi-vps\nRegion: Choose closest to target users (e.g., Southeast Asia)\nImage: Ubuntu Server 22.04 LTS\nSize: Standard_D4s_v3 (4 vCPU, 16GB RAM)\nAuthentication: SSH public key (generate if needed)\nInbound Ports: SSH (22), HTTP (80), HTTPS (443)\n\n\n\nClick Review + Create ‚Üí Create\n\n\nWait for deployment (2-3 minutes)\n\n\nNote down the Public IP address (e.g., 20.193.150.79)\n\n\nStep 2: Initial Server Configuration\n# SSH into VPS\nssh azureuser@20.193.150.79\n \n# Update system\nsudo apt update &amp;&amp; sudo apt upgrade -y\n \n# Install essential packages\nsudo apt install -y git curl wget htop ufw\n \n# Set up firewall\nsudo ufw allow 22/tcp  # SSH\nsudo ufw allow 80/tcp  # HTTP\nsudo ufw allow 443/tcp # HTTPS\nsudo ufw enable\nsudo ufw status\n \n# Set timezone\nsudo timedatectl set-timezone Asia/Kolkata\nStep 3: Install Docker\n# Install Docker\ncurl -fsSL get.docker.com -o get-docker.sh\nsudo sh get-docker.sh\nsudo usermod -aG docker $USER\nnewgrp docker\n \n# Install Docker Compose\nsudo curl -L &quot;github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose\nsudo chmod +x /usr/local/bin/docker-compose\n \n# Verify installation\ndocker --version\ndocker-compose --version\nStep 4: Create Application Directory\n# Create user for application\nsudo useradd -m -s /bin/bash darshi\nsudo usermod -aG docker darshi\n \n# Create application directory\nsudo mkdir -p /opt/darshi\nsudo chown darshi:darshi /opt/darshi\n \n# Switch to darshi user\nsudo su - darshi\ncd /opt/darshi\n\nDatabase Setup (PostgreSQL + PostGIS)\nStep 1: Configure PostgreSQL in Docker Compose\nCreate docker-compose.azure.yml:\nversion: &#039;3.8&#039;\n \nservices:\n  postgres:\n    image: postgis/postgis:15-3.4\n    container_name: darshi-postgres\n    environment:\n      - POSTGRES_DB=darshi\n      - POSTGRES_USER=postgres\n      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - &quot;5432:5432&quot;\n    restart: unless-stopped\n    healthcheck:\n      test: [&quot;CMD-SHELL&quot;, &quot;pg_isready -U postgres&quot;]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n \nvolumes:\n  postgres_data:\n    driver: local\nStep 2: Start PostgreSQL\n# Set PostgreSQL password\nexport POSTGRES_PASSWORD=$(openssl rand -base64 32)\necho &quot;POSTGRES_PASSWORD=$POSTGRES_PASSWORD&quot; &gt;&gt; .env\n \n# Start PostgreSQL\ndocker-compose -f docker-compose.azure.yml up -d postgres\n \n# Verify PostgreSQL is running\ndocker logs darshi-postgres\ndocker exec darshi-postgres psql -U postgres -c &quot;SELECT version();&quot;\nStep 3: Create Database Schema\n# Clone repository\ngit clone github.com/Sarthak-Sidhant/darshi.git .\ngit checkout main\n \n# Install Python dependencies (for Alembic)\npython3 -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\n \n# Run migrations\nalembic upgrade head\n \n# Verify tables created\ndocker exec darshi-postgres psql -U postgres -d darshi -c &quot;\\dt&quot;\nExpected Output:\n           List of relations\n Schema |    Name     | Type  |  Owner\n--------+-------------+-------+----------\n public | admin_logs  | table | postgres\n public | comments    | table | postgres\n public | reports     | table | postgres\n public | upvotes     | table | postgres\n public | users       | table | postgres\n\n\nCaching Setup (Redis)\nStep 1: Add Redis to Docker Compose\nUpdate docker-compose.azure.yml:\nservices:\n  redis:\n    image: redis:7-alpine\n    container_name: darshi-redis\n    command: redis-server --appendonly yes --appendfsync everysec\n    volumes:\n      - redis_data:/data\n    ports:\n      - &quot;6379:6379&quot;\n    restart: unless-stopped\n \nvolumes:\n  redis_data:\n    driver: local\nStep 2: Start Redis\n# Start Redis\ndocker-compose -f docker-compose.azure.yml up -d redis\n \n# Verify Redis is running\ndocker logs darshi-redis\ndocker exec darshi-redis redis-cli ping\n# Should return: PONG\n \n# Test persistence\ndocker exec darshi-redis redis-cli SET test &quot;value&quot;\ndocker exec darshi-redis redis-cli GET test\n# Should return: &quot;value&quot;\n\nStorage Setup (Cloudflare R2)\nStep 1: Create R2 Bucket\n\nGo to Cloudflare Dashboard\nNavigate to R2 Object Storage\nClick Create bucket\nBucket name: darshi-reports\nLocation: Automatic (global CDN)\nClick Create bucket\n\nStep 2: Generate R2 API Credentials\n\nGo to R2 ‚Üí Manage R2 API Tokens\nClick Create API Token\nToken name: darshi-backend\nPermissions: Object Read &amp; Write\nClick Create API Token\nCopy the following:\n\nAccess Key ID\nSecret Access Key\nEndpoint URL (e.g., https://&lt;account-id&gt;.r2.cloudflarestorage.com)\n\n\n\nStep 3: Configure R2 in Environment\nAdd to .env:\n# Cloudflare R2\nR2_ACCOUNT_ID=your-account-id\nR2_ACCESS_KEY_ID=your-access-key-id\nR2_SECRET_ACCESS_KEY=your-secret-access-key\nR2_BUCKET_NAME=darshi-reports\nR2_PUBLIC_URL=darshi-reports.your-account.r2.cloudflarestorage.com\nStep 4: Enable Public Access (Optional)\nTo serve images publicly:\n\nGo to bucket ‚Üí Settings\nEnable Public access\nOr configure Custom domain (e.g., cdn.darshi.app)\n\n\nBackend Deployment\nStep 1: Create Environment File\nCreate .env in /opt/darshi:\n# Database\nDATABASE_URL=postgresql+asyncpg://postgres:${POSTGRES_PASSWORD}@postgres:5432/darshi\n \n# Redis\nREDIS_URL=redis://redis:6379/0\n \n# Cloudflare R2\nR2_ACCOUNT_ID=your-account-id\nR2_ACCESS_KEY_ID=your-access-key-id\nR2_SECRET_ACCESS_KEY=your-secret-access-key\nR2_BUCKET_NAME=darshi-reports\nR2_PUBLIC_URL=darshi-reports.your-account.r2.cloudflarestorage.com\n \n# Gemini AI\nGEMINI_API_KEY=your-gemini-api-key\n \n# JWT Secret (generate with: openssl rand -base64 64)\nSECRET_KEY=your-generated-secret-key\n \n# OAuth (Optional)\nGOOGLE_CLIENT_ID=your-google-client-id\nGOOGLE_CLIENT_SECRET=your-google-client-secret\nGITHUB_CLIENT_ID=your-github-client-id\nGITHUB_CLIENT_SECRET=your-github-client-secret\nFACEBOOK_CLIENT_ID=your-facebook-client-id\nFACEBOOK_CLIENT_SECRET=your-facebook-client-secret\n \n# App Config\nENVIRONMENT=production\nFRONTEND_URL=darshi.app\nCORS_ORIGINS=darshi.app\nLOG_LEVEL=INFO\nStep 2: Create Dockerfile\nCreate Dockerfile in /opt/darshi:\nFROM python:3.11-slim\n \nWORKDIR /app\n \n# Install system dependencies\nRUN apt-get update &amp;&amp; apt-get install -y \\\n    gcc \\\n    g++ \\\n    curl \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n \n# Copy requirements\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\n \n# Copy application code\nCOPY app/ ./app/\n \n# Expose port\nEXPOSE 8080\n \n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \\\n    CMD curl -f http://localhost:8080/health || exit 1\n \n# Run application\nCMD [&quot;uvicorn&quot;, &quot;app.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8080&quot;, &quot;--workers&quot;, &quot;2&quot;]\nStep 3: Update Docker Compose\nAdd backend service to docker-compose.azure.yml:\nservices:\n  backend:\n    build:\n      context: .\n      dockerfile: Dockerfile\n    container_name: darshi-backend\n    ports:\n      - &quot;8080:8080&quot;\n    env_file:\n      - .env\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_started\n    restart: unless-stopped\n    healthcheck:\n      test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost:8080/health&quot;]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n \n  prometheus:\n    image: prom/prometheus:latest\n    container_name: darshi-prometheus\n    volumes:\n      - ./prometheus.yml:/etc/prometheus/prometheus.yml\n      - prometheus_data:/prometheus\n    command:\n      - &#039;--config.file=/etc/prometheus/prometheus.yml&#039;\n      - &#039;--storage.tsdb.retention.time=7d&#039;\n    ports:\n      - &quot;9090:9090&quot;\n    restart: unless-stopped\n \nvolumes:\n  prometheus_data:\n    driver: local\nStep 4: Create Prometheus Config\nCreate prometheus.yml:\nglobal:\n  scrape_interval: 15s\n \nscrape_configs:\n  - job_name: &#039;darshi-backend&#039;\n    static_configs:\n      - targets: [&#039;backend:8080&#039;]\nStep 5: Build and Start Backend\n# Build and start all services\ndocker-compose -f docker-compose.azure.yml up -d --build\n \n# Check logs\ndocker logs darshi-backend -f\n \n# Verify health check\ncurl http://localhost:8080/health\nExpected Response:\n{\n  &quot;status&quot;: &quot;healthy&quot;,\n  &quot;service&quot;: &quot;Darshi Backend&quot;,\n  &quot;database&quot;: &quot;connected&quot;,\n  &quot;redis&quot;: &quot;connected&quot;,\n  &quot;timestamp&quot;: &quot;2025-12-27T10:30:00Z&quot;\n}\n\nFrontend Deployment (Cloudflare Pages)\nStep 1: Prepare Frontend\n# On local machine\ncd frontend\n \n# Install dependencies\nnpm install\n \n# Build for production\nnpm run build\n \n# Preview build\nnpm run preview\nStep 2: Deploy to Cloudflare Pages\nOption A: Automatic (GitHub Integration)\n\nGo to Cloudflare Pages\nClick Create a project ‚Üí Connect to Git\nSelect repository: Sarthak-Sidhant/darshi\nConfigure build:\n\nBuild command: cd frontend &amp;&amp; npm run build\nBuild output directory: frontend/build\nRoot directory: /\n\n\nEnvironment variables:\n\nVITE_API_URL: api.darshi.app\n\n\nClick Save and Deploy\n\nOption B: Manual\n# Install Wrangler CLI\nnpm install -g wrangler\n \n# Login to Cloudflare\nwrangler login\n \n# Deploy to Pages\nwrangler pages deploy frontend/build --project-name=darshi\nStep 3: Configure Custom Domain\n\nGo to Pages project ‚Üí Custom domains\nClick Set up a custom domain\nEnter: darshi.app\nCloudflare will auto-configure DNS\nWait for SSL certificate (2-5 minutes)\n\n\nCI/CD Setup (GitHub Actions)\nStep 1: Add GitHub Secrets\nGo to repository ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions\nAdd these secrets:\n\nVPS_SSH_KEY: Private SSH key for VPS access\nVPS_HOST: 20.193.150.79\nVPS_USER: darshi\n\nStep 2: Generate SSH Key for GitHub Actions\n# On VPS\nssh-keygen -t ed25519 -C &quot;github-actions@darshi&quot; -f ~/.ssh/github-actions\ncat ~/.ssh/github-actions.pub &gt;&gt; ~/.ssh/authorized_keys\ncat ~/.ssh/github-actions  # Copy private key to GitHub secrets\nStep 3: Create GitHub Actions Workflow\nCreate .github/workflows/deploy.yml:\nname: Deploy to Azure VPS\n \non:\n  push:\n    branches:\n      - main\n  workflow_dispatch:\n \njobs:\n  test:\n    name: Run Tests\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n \n      - name: Set up Python 3.11\n        uses: actions/setup-python@v5\n        with:\n          python-version: &#039;3.11&#039;\n          cache: &#039;pip&#039;\n \n      - name: Install backend dependencies\n        run: pip install -r requirements.txt\n \n      - name: Run backend tests\n        run: pytest tests/ -v --tb=short --maxfail=5\n \n      - name: Set up Node.js\n        uses: actions/setup-node@v4\n        with:\n          node-version: &#039;20&#039;\n          cache: &#039;npm&#039;\n          cache-dependency-path: frontend/package-lock.json\n \n      - name: Install frontend dependencies\n        working-directory: ./frontend\n        run: npm ci\n \n      - name: Run frontend type checks\n        working-directory: ./frontend\n        run: npm run check\n \n      - name: Build frontend\n        working-directory: ./frontend\n        run: npm run build\n \n  deploy:\n    name: Deploy to VPS\n    needs: test\n    runs-on: ubuntu-latest\n    steps:\n      - name: Set up SSH key\n        run: |\n          mkdir -p ~/.ssh\n          echo &quot;${{ secrets.VPS_SSH_KEY }}&quot; &gt; ~/.ssh/id_ed25519\n          chmod 600 ~/.ssh/id_ed25519\n          ssh-keyscan -H ${{ secrets.VPS_HOST }} &gt;&gt; ~/.ssh/known_hosts\n \n      - name: Deploy to VPS\n        env:\n          VPS_HOST: ${{ secrets.VPS_HOST }}\n          VPS_USER: ${{ secrets.VPS_USER }}\n        run: |\n          ssh ${VPS_USER}@${VPS_HOST} &lt;&lt; &#039;ENDSSH&#039;\n            set -e\n            cd /opt/darshi\n \n            # Pull latest code\n            git pull origin main\n \n            # Rebuild and restart containers\n            docker-compose -f docker-compose.azure.yml down\n            docker-compose -f docker-compose.azure.yml up -d --build\n \n            # Wait for health check\n            sleep 30\n \n            # Check backend health\n            if ! curl -f http://localhost:8080/health; then\n              echo &quot;Health check failed!&quot;\n              docker logs darshi-backend --tail 50\n              exit 1\n            fi\n \n            echo &quot;‚úÖ Deployment successful!&quot;\n          ENDSSH\n \n      - name: Clean up old Docker images\n        env:\n          VPS_HOST: ${{ secrets.VPS_HOST }}\n          VPS_USER: ${{ secrets.VPS_USER }}\n        run: |\n          ssh ${VPS_USER}@${VPS_HOST} &lt;&lt; &#039;ENDSSH&#039;\n            docker image prune -af --filter &quot;until=24h&quot;\n            docker volume prune -f\n          ENDSSH\nStep 4: Set Up Auto-Restart on Boot\nCreate systemd service on VPS:\n# Create service file\nsudo tee /etc/systemd/system/darshi-deploy.service &gt; /dev/null &lt;&lt;&#039;EOF&#039;\n[Unit]\nDescription=Darshi Application Auto-Deploy\nAfter=docker.service\nRequires=docker.service\n \n[Service]\nType=oneshot\nRemainAfterExit=yes\nWorkingDirectory=/opt/darshi\nUser=darshi\nGroup=darshi\nExecStart=/usr/bin/docker compose -f docker-compose.azure.yml up -d\nExecStop=/usr/bin/docker compose -f docker-compose.azure.yml down\nRestart=on-failure\nRestartSec=10s\n \n[Install]\nWantedBy=multi-user.target\nEOF\n \n# Enable and start service\nsudo systemctl daemon-reload\nsudo systemctl enable darshi-deploy.service\nsudo systemctl start darshi-deploy.service\n \n# Verify status\nsudo systemctl status darshi-deploy.service\n\nSSL &amp; Domain Configuration\nStep 1: Configure Nginx\nInstall Nginx:\nsudo apt install -y nginx\nCreate Nginx config /etc/nginx/sites-available/darshi:\nserver {\n    listen 80;\n    server_name api.darshi.app;\n    return 301 https://$server_name$request_uri;\n}\n \nserver {\n    listen 443 ssl http2;\n    server_name api.darshi.app;\n \n    ssl_certificate /opt/darshi/ssl/fullchain.pem;\n    ssl_certificate_key /opt/darshi/ssl/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n \n    # Security headers\n    add_header X-Frame-Options &quot;DENY&quot; always;\n    add_header X-Content-Type-Options &quot;nosniff&quot; always;\n    add_header X-XSS-Protection &quot;1; mode=block&quot; always;\n \n    # GZip compression\n    gzip on;\n    gzip_types application/json text/plain text/css application/javascript;\n    gzip_min_length 1000;\n \n    # Rate limiting\n    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;\n    limit_req zone=api burst=20 nodelay;\n \n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n \n        # Timeouts\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n \n    location /health {\n        proxy_pass http://localhost:8080/health;\n        access_log off;\n    }\n}\nEnable config:\nsudo ln -s /etc/nginx/sites-available/darshi /etc/nginx/sites-enabled/\nsudo nginx -t\nsudo systemctl restart nginx\nStep 2: Install SSL Certificates\n# Install Certbot\nsudo apt install -y certbot python3-certbot-nginx\n \n# Generate SSL certificate\nsudo certbot --nginx -d api.darshi.app\n \n# Verify auto-renewal\nsudo certbot renew --dry-run\nStep 3: Configure Cloudflare DNS\n\nGo to Cloudflare Dashboard\nSelect domain darshi.app\nGo to DNS ‚Üí Records\nAdd A record:\n\nType: A\nName: api\nIPv4 address: 20.193.150.79\nProxy status: Proxied (orange cloud)\nTTL: Auto\n\n\nClick Save\n\n\nMonitoring &amp; Logging\nPrometheus Metrics\nAccess Prometheus at: http://20.193.150.79:9090\nUseful Queries:\n# Request rate\nrate(http_requests_total[5m])\n \n# Average response time\nrate(http_request_duration_seconds_sum[5m]) / rate(http_request_duration_seconds_count[5m])\n \n# Error rate\nrate(http_requests_total{status=~&quot;5..&quot;}[5m])\n \n# Reports created\nrate(reports_created_total[1h])\nApplication Logs\n# Backend logs\ndocker logs darshi-backend -f\n \n# PostgreSQL logs\ndocker logs darshi-postgres -f\n \n# Redis logs\ndocker logs darshi-redis -f\n \n# Nginx logs\nsudo tail -f /var/log/nginx/access.log\nsudo tail -f /var/log/nginx/error.log\nHealth Checks\n# Backend health\ncurl api.darshi.app/health\n \n# Database connection\ndocker exec darshi-postgres psql -U postgres -d darshi -c &quot;SELECT COUNT(*) FROM reports;&quot;\n \n# Redis connection\ndocker exec darshi-redis redis-cli ping\n\nBackup &amp; Recovery\nDatabase Backup\nCreate backup script /opt/darshi/backup-database.sh:\n#!/bin/bash\nBACKUP_DIR=~/backups\nmkdir -p $BACKUP_DIR\n \n# Create backup\ndocker exec darshi-postgres pg_dump -U postgres darshi | gzip &gt; $BACKUP_DIR/darshi_$(date +%Y%m%d_%H%M%S).sql.gz\n \n# Keep only last 7 days\nfind $BACKUP_DIR -name &quot;darshi_*.sql.gz&quot; -mtime +7 -delete\n \necho &quot;Backup complete: $(ls -lh $BACKUP_DIR | tail -1)&quot;\nMake executable and add to cron:\nchmod +x /opt/darshi/backup-database.sh\n \n# Add to crontab (daily at 2 AM)\ncrontab -e\n# Add line:\n0 2 * * * /opt/darshi/backup-database.sh\nDatabase Restore\n# Restore from backup\ngunzip -c ~/backups/darshi_20251227_020000.sql.gz | \\\n  docker exec -i darshi-postgres psql -U postgres darshi\nVolume Backup\n# Backup Docker volumes\ndocker run --rm \\\n  -v darshi_postgres_data:/data \\\n  -v $(pwd)/backups:/backup \\\n  alpine tar czf /backup/postgres_data_$(date +%Y%m%d).tar.gz -C /data .\n \n# Restore Docker volume\ndocker run --rm \\\n  -v darshi_postgres_data:/data \\\n  -v $(pwd)/backups:/backup \\\n  alpine tar xzf /backup/postgres_data_20251227.tar.gz -C /data\n\nTroubleshooting\nBackend Won‚Äôt Start\nCheck logs:\ndocker logs darshi-backend --tail 100\nCommon issues:\n\nDatabase connection failed ‚Üí Check PostgreSQL is running\nRedis connection failed ‚Üí Check Redis is running\nMissing environment variables ‚Üí Verify .env file\n\nDatabase Connection Issues\n# Check PostgreSQL status\ndocker ps | grep postgres\n \n# Test connection\ndocker exec darshi-postgres psql -U postgres -d darshi -c &quot;SELECT version();&quot;\n \n# Check logs\ndocker logs darshi-postgres --tail 50\nHigh Memory Usage\n# Check Docker stats\ndocker stats\n \n# Check system memory\nfree -h\n \n# Restart containers if needed\ndocker-compose -f docker-compose.azure.yml restart\nSSL Certificate Issues\n# Check certificate expiry\nsudo certbot certificates\n \n# Renew certificate manually\nsudo certbot renew\n \n# Check Nginx config\nsudo nginx -t\nDeployment Failures\n# Check GitHub Actions logs\n# Go to: github.com/Sarthak-Sidhant/darshi/actions\n \n# SSH into VPS and check manually\nssh darshi@20.193.150.79\ncd /opt/darshi\ndocker-compose -f docker-compose.azure.yml logs\nPort Already in Use\n# Find process using port 8080\nsudo lsof -i :8080\nsudo netstat -tulpn | grep 8080\n \n# Kill process\nsudo kill -9 &lt;PID&gt;\nDisk Space Full\n# Check disk usage\ndf -h\n \n# Clean Docker\ndocker system prune -a\ndocker volume prune\n \n# Clean logs\nsudo journalctl --vacuum-time=7d\n\nPerformance Optimization\nDatabase Tuning\nEdit PostgreSQL config:\ndocker exec -it darshi-postgres bash\nvi /var/lib/postgresql/data/postgresql.conf\nAdd:\nshared_buffers = 2GB\neffective_cache_size = 6GB\nmaintenance_work_mem = 512MB\nmax_connections = 100\n\nRedis Tuning\ndocker exec -it darshi-redis redis-cli CONFIG SET maxmemory 1gb\ndocker exec -it darshi-redis redis-cli CONFIG SET maxmemory-policy allkeys-lru\nNginx Tuning\nEdit /etc/nginx/nginx.conf:\nworker_processes auto;\nworker_connections 1024;\nkeepalive_timeout 65;\n \n# Enable caching\nproxy_cache_path /var/cache/nginx levels=1:2 keys_zone=api_cache:10m max_size=100m inactive=60m;\n\nSecurity Checklist\n\n Firewall configured (UFW)\n SSH key authentication only (no password)\n Non-root user created (darshi)\n Docker containers run as non-root\n SSL certificates installed and auto-renewing\n Strong PostgreSQL password\n Environment variables secured in .env\n Rate limiting enabled in Nginx\n Security headers configured\n Regular backups scheduled\n Monitoring set up (Prometheus)\n Cloudflare proxy enabled (DDoS protection)\n\n\nDocumentation Last Updated: December 27, 2025\nInfrastructure: Azure VPS + Cloudflare + PostgreSQL + Docker\nDeployment Method: GitHub Actions + Docker Compose"},"guides/DEVELOPMENT":{"slug":"guides/DEVELOPMENT","filePath":"guides/DEVELOPMENT.md","title":"DEVELOPMENT","links":["reference/PHILOSOPHY","guides/API","guides/ARCHITECTURE","guides/DEPLOYMENT"],"tags":[],"content":"Development Guide - Darshi Platform\nThis comprehensive guide covers everything developers need to know when working on the Darshi platform, from setting up your development environment to understanding code patterns and contributing guidelines.\nTable of Contents\n\nDevelopment Environment Setup\nProject Structure\nBackend Development\nFrontend Development\nDatabase &amp; Storage\nTesting\nCode Patterns &amp; Standards\nGit Workflow\nDebugging &amp; Troubleshooting\nPerformance Optimization\nSecurity Guidelines\n\n\nDevelopment Environment Setup\nPrerequisites\nRequired Software:\n\nPython 3.11+: Download\nNode.js 20+: Download\nGit: Download\nDocker + Docker Compose: Download\nPostgreSQL 15+: Download (or use Docker)\nRedis 7+: Download (or use Docker)\n\nRecommended IDE Setup:\n\n\nVSCode with extensions:\n\nPython\nPylance\nSvelte for VS Code\nESLint\nPrettier\nPostgreSQL (for database inspection)\n\n\n\nPyCharm Professional with:\n\nSvelte plugin\nDatabase tools (built-in)\n\n\n\nInitial Setup\n1. Clone the Repository\ngit clone github.com/Sarthak-Sidhant/darshi.git\ncd darshi\n2. Start Database and Cache (Docker)\n# Start PostgreSQL and Redis\ndocker compose up -d postgres redis\n \n# Verify containers are running\ndocker ps\n \n# Check logs\ndocker logs darshi-postgres\ndocker logs darshi-redis\nDefault credentials:\n\nPostgreSQL: postgres:postgres@localhost:5432/darshi\nRedis: redis://localhost:6379\n\n3. Backend Setup\n# Create and activate virtual environment\npython3 -m venv venv\nsource venv/bin/activate  # On Windows: venv\\Scripts\\activate\n \n# Install dependencies\npip install -r requirements.txt\n \n# Install dev dependencies\npip install pytest pytest-asyncio pytest-cov black ruff mypy\n \n# Copy environment template\ncp .env.example .env\n4. Configure Environment Variables\nEdit .env file:\n# Database\nDATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/darshi\n \n# Redis\nREDIS_URL=redis://localhost:6379/0\n \n# Cloudflare R2 (Optional for local dev - can use mock)\nR2_ACCOUNT_ID=your-account-id\nR2_ACCESS_KEY_ID=your-access-key-id\nR2_SECRET_ACCESS_KEY=your-secret-access-key\nR2_BUCKET_NAME=darshi-reports-dev\nR2_PUBLIC_URL=darshi-reports-dev.your-account.r2.cloudflarestorage.com\n \n# Gemini AI (Get from: aistudio.google.com/app/apikey)\nGEMINI_API_KEY=your-gemini-api-key\n \n# Security (generate new key!)\nSECRET_KEY=$(python3 -c &quot;import secrets; print(secrets.token_urlsafe(64))&quot;)\n \n# Development settings\nENVIRONMENT=development\nLOG_LEVEL=DEBUG\n \n# CORS\nCORS_ORIGINS=http://localhost:5173,http://localhost:8080\n \n# Frontend URL\nFRONTEND_URL=http://localhost:5173\n \n# OAuth (Optional - leave blank if not testing OAuth)\nGOOGLE_CLIENT_ID=your-google-client-id\nGOOGLE_CLIENT_SECRET=your-google-client-secret\nGITHUB_CLIENT_ID=your-github-client-id\nGITHUB_CLIENT_SECRET=your-github-client-secret\nFACEBOOK_CLIENT_ID=your-facebook-client-id\nFACEBOOK_CLIENT_SECRET=your-facebook-client-secret\nIMPORTANT: Never commit .env to git!\n5. Initialize Database\n# Run migrations\nalembic upgrade head\n \n# Verify tables created\ndocker exec darshi-postgres psql -U postgres -d darshi -c &quot;\\dt&quot;\n \n# Optional: Create test data\npython scripts/seed_database.py\n6. Frontend Setup\ncd frontend\n \n# Install dependencies\nnpm install\n \n# Copy environment template (optional - has defaults)\ncp .env.example .env\nEdit frontend/.env (optional):\n# Backend API URL (default: http://localhost:8080)\nVITE_API_URL=http://localhost:8080\n7. Run Development Servers\nTerminal 1 - Backend:\ncd darshi\nsource venv/bin/activate\nuvicorn app.main:app --reload --host 0.0.0.0 --port 8080\nTerminal 2 - Frontend:\ncd darshi/frontend\nnpm run dev\nAccess Points:\n\nFrontend: http://localhost:5173\nBackend API: http://localhost:8080\nAPI Docs (Swagger): http://localhost:8080/docs\nAPI Docs (ReDoc): http://localhost:8080/redoc\n\n\nProject Structure\ndarshi/\n‚îú‚îÄ‚îÄ app/                           # Backend (FastAPI)\n‚îÇ   ‚îú‚îÄ‚îÄ main.py                   # Application entry point\n‚îÇ   ‚îú‚îÄ‚îÄ core/                     # Core utilities\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py            # Environment configuration\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security.py          # JWT, bcrypt, rate limiting\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exceptions.py        # Custom exception types\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ error_handling.py    # Circuit breakers, retry logic\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.py        # Input validators\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging_config.py    # Structured logging\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ redis_client.py      # Redis connection\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cache.py             # Caching layer\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ http_client.py       # HTTP client with retries\n‚îÇ   ‚îú‚îÄ‚îÄ db/                       # Database layer\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session.py           # SQLAlchemy session\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py            # ORM models\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/          # Alembic migrations\n‚îÇ   ‚îú‚îÄ‚îÄ routers/                  # API endpoints\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ reports.py           # Report CRUD, upvotes, comments\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py             # Admin dashboard\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py              # Username/password auth\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ oauth.py             # OAuth providers\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py             # User management\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notifications.py     # Push notifications\n‚îÇ   ‚îú‚îÄ‚îÄ services/                 # Business logic\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db_service.py        # PostgreSQL operations\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py        # Gemini AI integration\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage_service.py   # Cloudflare R2\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ geo_service.py       # Geocoding, geohashing\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_service.py      # JWT, passwords\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin_service.py     # Admin operations\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ image_service.py     # Image hashing, duplicates\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ oauth_service.py     # OAuth integration\n‚îÇ   ‚îú‚îÄ‚îÄ models/                   # Pydantic schemas\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report.py\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ comment.py\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin.py\n‚îÇ   ‚îî‚îÄ‚îÄ middleware/               # Custom middleware\n‚îÇ       ‚îî‚îÄ‚îÄ performance.py        # Prometheus metrics\n‚îÇ\n‚îú‚îÄ‚îÄ frontend/                      # Frontend (SvelteKit 5)\n‚îÇ   ‚îú‚îÄ‚îÄ src/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/               # Pages (file-based routing)\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ +page.svelte     # Home\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ +layout.svelte   # App layout\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ submit/          # Submit report\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ report/[id]/     # Report detail\n‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ signin/          # Unified auth\n‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin/           # Admin dashboard\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ lib/                  # Shared code\n‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ api.ts           # API client\n‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ validation.ts    # Form validation\n‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ stores/          # Svelte stores\n‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts\n‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ theme.ts\n‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ i18n.ts\n‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ toast.ts\n‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ components/      # UI components\n‚îÇ   ‚îú‚îÄ‚îÄ static/                   # Static assets\n‚îÇ   ‚îú‚îÄ‚îÄ svelte.config.js\n‚îÇ   ‚îú‚îÄ‚îÄ vite.config.ts\n‚îÇ   ‚îî‚îÄ‚îÄ tsconfig.json\n‚îÇ\n‚îú‚îÄ‚îÄ tests/                         # Backend tests\n‚îÇ   ‚îú‚îÄ‚îÄ unit/\n‚îÇ   ‚îú‚îÄ‚îÄ integration/\n‚îÇ   ‚îî‚îÄ‚îÄ conftest.py\n‚îÇ\n‚îú‚îÄ‚îÄ scripts/                       # Utility scripts\n‚îÇ   ‚îú‚îÄ‚îÄ seed_database.py\n‚îÇ   ‚îú‚îÄ‚îÄ create_admin.py\n‚îÇ   ‚îî‚îÄ‚îÄ backup_database.sh\n‚îÇ\n‚îú‚îÄ‚îÄ docs/                          # Documentation\n‚îÇ   ‚îú‚îÄ‚îÄ index.md\n‚îÇ   ‚îú‚îÄ‚îÄ QUICK_START.md\n‚îÇ   ‚îú‚îÄ‚îÄ guides/\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE.md\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DEPLOYMENT.md\n‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DEVELOPMENT.md       # This file\n‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ API.md\n‚îÇ   ‚îî‚îÄ‚îÄ reference/\n‚îÇ       ‚îú‚îÄ‚îÄ PHILOSOPHY.md\n‚îÇ       ‚îî‚îÄ‚îÄ CLAUDE.md\n‚îÇ\n‚îú‚îÄ‚îÄ .github/                       # GitHub Actions\n‚îÇ   ‚îî‚îÄ‚îÄ workflows/\n‚îÇ       ‚îî‚îÄ‚îÄ deploy.yml\n‚îÇ\n‚îú‚îÄ‚îÄ docker-compose.yml             # Local development\n‚îú‚îÄ‚îÄ docker-compose.azure.yml       # Production (Azure VPS)\n‚îú‚îÄ‚îÄ Dockerfile                     # Backend container\n‚îú‚îÄ‚îÄ requirements.txt               # Python dependencies\n‚îú‚îÄ‚îÄ alembic.ini                    # Alembic configuration\n‚îú‚îÄ‚îÄ prometheus.yml                 # Prometheus config\n‚îú‚îÄ‚îÄ .env.example                   # Environment template\n‚îî‚îÄ‚îÄ README.md\n\n\nBackend Development\nRunning the Backend\n# Development mode with auto-reload\nuvicorn app.main:app --reload --host 0.0.0.0 --port 8080\n \n# With specific log level\nuvicorn app.main:app --reload --log-level debug\n \n# Production mode (2 workers)\nuvicorn app.main:app --host 0.0.0.0 --port 8080 --workers 2\nDatabase Migrations\n# Create a new migration\nalembic revision --autogenerate -m &quot;Add new column to reports&quot;\n \n# Apply migrations\nalembic upgrade head\n \n# Rollback one migration\nalembic downgrade -1\n \n# Show current version\nalembic current\n \n# Show migration history\nalembic history\nAdding a New API Endpoint\n\nDefine Pydantic schema (app/models/)\n\n# app/models/report.py\nfrom pydantic import BaseModel, Field\n \nclass ReportCreate(BaseModel):\n    title: str = Field(..., min_length=5, max_length=200)\n    description: str = Field(..., min_length=10, max_length=1000)\n    latitude: float = Field(..., ge=-90, le=90)\n    longitude: float = Field(..., ge=-180, le=180)\n\nCreate database model (app/db/models.py)\n\n# app/db/models.py\nfrom sqlalchemy import Column, Integer, String, Float\nfrom sqlalchemy.ext.declarative import declarative_base\n \nBase = declarative_base()\n \nclass Report(Base):\n    __tablename__ = &quot;reports&quot;\n \n    id = Column(Integer, primary_key=True)\n    title = Column(String(200), nullable=False)\n    description = Column(Text, nullable=False)\n    latitude = Column(Float, nullable=False)\n    longitude = Column(Float, nullable=False)\n\nCreate service function (app/services/db_service.py)\n\n# app/services/db_service.py\nfrom app.core.error_handling import retry_database_operation\nfrom app.core.exceptions import DatabaseError\n \n@retry_database_operation\nasync def create_report(db: AsyncSession, data: dict) -&gt; int:\n    &quot;&quot;&quot;Create a new report.&quot;&quot;&quot;\n    try:\n        stmt = insert(Report).values(**data).returning(Report.id)\n        result = await db.execute(stmt)\n        await db.commit()\n        return result.scalar()\n    except SQLAlchemyError as e:\n        await db.rollback()\n        raise DatabaseError(&quot;Failed to create report&quot;, details=str(e))\n\nAdd router endpoint (app/routers/reports.py)\n\n# app/routers/reports.py\nfrom fastapi import APIRouter, Depends, HTTPException\nfrom app.models.report import ReportCreate\nfrom app.services import db_service\nfrom app.core.security import get_current_user\n \nrouter = APIRouter(prefix=&quot;/api/v1&quot;, tags=[&quot;reports&quot;])\n \n@router.post(&quot;/report&quot;)\nasync def create_report_endpoint(\n    report: ReportCreate,\n    user: dict = Depends(get_current_user),\n    db: AsyncSession = Depends(get_db)\n):\n    &quot;&quot;&quot;Create a new civic report.&quot;&quot;&quot;\n    try:\n        report_id = await db_service.create_report(db, report.dict())\n        return {&quot;report_id&quot;: report_id}\n    except DatabaseError as e:\n        raise HTTPException(status_code=500, detail=str(e))\n\nRegister router (app/main.py)\n\n# app/main.py\nfrom app.routers import reports\n \napp.include_router(reports.router)\nCode Formatting &amp; Linting\n# Format code with Black\nblack app/ tests/\n \n# Lint with Ruff\nruff check app/ tests/\n \n# Type check with mypy\nmypy app/\nCommon Development Tasks\nCheck database connection:\ndocker exec darshi-postgres psql -U postgres -d darshi -c &quot;SELECT version();&quot;\nReset database:\n# Drop all tables\nalembic downgrade base\n \n# Recreate tables\nalembic upgrade head\n \n# Seed with test data\npython scripts/seed_database.py\nClear Redis cache:\ndocker exec darshi-redis redis-cli FLUSHALL\n\nFrontend Development\nRunning the Frontend\n# Development mode with HMR\nnpm run dev\n \n# Type checking (watch mode)\nnpm run check:watch\n \n# Type checking (single run)\nnpm run check\n \n# Build for production\nnpm run build\n \n# Preview production build\nnpm run preview\nSvelteKit 5 Runes API\nAll components use the new Runes API:\n&lt;script lang=&quot;ts&quot;&gt;\n  import { toast } from &#039;$lib/stores/toast&#039;;\n \n  // State - replaces `let` with $state\n  let count = $state(0);\n  let items = $state&lt;string[]&gt;([]);\n \n  // Derived - replaces $: reactive statements\n  let doubled = $derived(count * 2);\n  let isEmpty = $derived(items.length === 0);\n \n  // Effect - replaces onMount + $: for side effects\n  $effect(() =&gt; {\n    console.log(&#039;Count changed:&#039;, count);\n    // Cleanup\n    return () =&gt; console.log(&#039;Cleanup&#039;);\n  });\n \n  // Props - replaces export let\n  let { title, onSubmit }: { title: string; onSubmit: () =&gt; void } = $props();\n \n  function increment() {\n    count++;\n  }\n&lt;/script&gt;\n \n&lt;h1&gt;{title}&lt;/h1&gt;\n&lt;p&gt;Count: {count}, Doubled: {doubled}&lt;/p&gt;\n&lt;button onclick={increment}&gt;Increment&lt;/button&gt;\nAdding a New Page\n\nCreate route file (frontend/src/routes/example/+page.svelte)\n\n&lt;script lang=&quot;ts&quot;&gt;\n  import { onMount } from &#039;svelte&#039;;\n  import { goto } from &#039;$app/navigation&#039;;\n  import { api } from &#039;$lib/api&#039;;\n  import { toast } from &#039;$lib/stores/toast&#039;;\n  import LoadingSpinner from &#039;$lib/components/LoadingSpinner.svelte&#039;;\n \n  let loading = $state(true);\n  let data = $state&lt;any&gt;(null);\n \n  onMount(async () =&gt; {\n    try {\n      data = await api.get(&#039;/api/v1/example&#039;);\n    } catch (error) {\n      toast.show(&#039;Failed to load data&#039;, &#039;error&#039;);\n    } finally {\n      loading = false;\n    }\n  });\n&lt;/script&gt;\n \n&lt;div class=&quot;container&quot;&gt;\n  {#if loading}\n    &lt;LoadingSpinner /&gt;\n  {:else}\n    &lt;h1&gt;Example Page&lt;/h1&gt;\n    &lt;pre&gt;{JSON.stringify(data, null, 2)}&lt;/pre&gt;\n  {/if}\n&lt;/div&gt;\n \n&lt;style&gt;\n  .container {\n    padding: 2rem;\n  }\n&lt;/style&gt;\n\nAdd navigation link (frontend/src/routes/+layout.svelte)\n\n&lt;nav&gt;\n  &lt;a href=&quot;/example&quot;&gt;Example&lt;/a&gt;\n&lt;/nav&gt;\nDark Mode Implementation\nUse CSS custom properties:\n&lt;style&gt;\n  .card {\n    background: var(--bg-primary);\n    color: var(--text-primary);\n    border: 1px solid var(--border-color);\n  }\n \n  /* Dark mode is applied via [data-theme=&quot;dark&quot;] on &lt;html&gt; */\n&lt;/style&gt;\nDark mode variables defined in app.css:\n[data-theme=&quot;dark&quot;] {\n  --bg-primary: #000000;\n  --text-primary: #ffffff;\n  --bg-secondary: #121212;\n  --border-color: #2a2a2a;\n}\nInternationalization (i18n)\n&lt;script lang=&quot;ts&quot;&gt;\n  import { t } from &#039;$lib/stores/i18n&#039;;\n&lt;/script&gt;\n \n&lt;h1&gt;{$t.home.title}&lt;/h1&gt;\n&lt;p&gt;{$t.home.description}&lt;/p&gt;\nAdd translations in frontend/src/lib/stores/i18n.ts:\nconst translations = {\n  en: {\n    home: {\n      title: &#039;Welcome to Darshi&#039;,\n      description: &#039;Report civic issues&#039;\n    }\n  },\n  hi: {\n    home: {\n      title: &#039;‡§¶‡§∞‡•ç‡§∂‡•Ä ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à&#039;,\n      description: &#039;‡§®‡§æ‡§ó‡§∞‡§ø‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ‡§ì‡§Ç ‡§ï‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç&#039;\n    }\n  }\n};\n\nDatabase &amp; Storage\nPostgreSQL Development\nConnect to database:\ndocker exec -it darshi-postgres psql -U postgres -d darshi\nCommon queries:\n-- List all reports\nSELECT id, title, status, created_at FROM reports ORDER BY created_at DESC LIMIT 10;\n \n-- Check user counts\nSELECT role, COUNT(*) FROM users GROUP BY role;\n \n-- Find reports near coordinates (PostGIS)\nSELECT id, title, ST_Distance(\n  geom,\n  ST_SetSRID(ST_MakePoint(77.5946, 12.9716), 4326)::geography\n) as distance_meters\nFROM reports\nWHERE ST_DWithin(\n  geom,\n  ST_SetSRID(ST_MakePoint(77.5946, 12.9716), 4326)::geography,\n  5000  -- 5km radius\n)\nORDER BY distance_meters;\nDatabase inspection:\n-- Show table structure\n\\d reports\n \n-- Show indexes\n\\di\n \n-- Show table sizes\nSELECT\n  tablename,\n  pg_size_pretty(pg_total_relation_size(schemaname||&#039;.&#039;||tablename)) AS size\nFROM pg_tables\nWHERE schemaname = &#039;public&#039;\nORDER BY pg_total_relation_size(schemaname||&#039;.&#039;||tablename) DESC;\nRedis Development\nConnect to Redis:\ndocker exec -it darshi-redis redis-cli\nCommon commands:\n# List all keys\nKEYS *\n \n# Get value\nGET report:123\n \n# Check key type\nTYPE report:123\n \n# Check TTL\nTTL report:123\n \n# Delete key\nDEL report:123\n \n# Flush all keys\nFLUSHALL\nLocal File Storage (Development)\nFor local development without R2:\n# app/services/storage_service.py\nimport os\n \nasync def upload_image_local(file: UploadFile) -&gt; str:\n    &quot;&quot;&quot;Upload image to local filesystem (dev only).&quot;&quot;&quot;\n    upload_dir = &quot;uploads&quot;\n    os.makedirs(upload_dir, exist_ok=True)\n \n    file_path = os.path.join(upload_dir, file.filename)\n    with open(file_path, &quot;wb&quot;) as f:\n        f.write(await file.read())\n \n    return f&quot;http://localhost:8080/uploads/{file.filename}&quot;\n\nTesting\nBackend Tests\n# Run all tests\npytest\n \n# Run with coverage\npytest --cov=app --cov-report=html\n \n# Run specific test file\npytest tests/unit/test_reports.py -v\n \n# Run specific test\npytest tests/unit/test_reports.py::test_create_report -v\n \n# Run with print statements\npytest -s\n \n# Stop on first failure\npytest -x\nWriting a unit test:\n# tests/unit/test_reports.py\nimport pytest\nfrom app.services import db_service\n \n@pytest.mark.asyncio\nasync def test_create_report(test_db):\n    &quot;&quot;&quot;Test report creation.&quot;&quot;&quot;\n    data = {\n        &quot;title&quot;: &quot;Test pothole&quot;,\n        &quot;description&quot;: &quot;Large pothole on main street&quot;,\n        &quot;latitude&quot;: 12.9716,\n        &quot;longitude&quot;: 77.5946\n    }\n \n    report_id = await db_service.create_report(test_db, data)\n \n    assert report_id is not None\n    assert isinstance(report_id, int)\nFrontend Tests\n# Run tests\nnpm run test\n \n# Run in watch mode\nnpm run test:watch\n \n# Run with coverage\nnpm run test:coverage\nWriting a component test:\n// src/lib/components/LoadingButton.test.ts\nimport { render, fireEvent } from &#039;@testing-library/svelte&#039;;\nimport LoadingButton from &#039;./LoadingButton.svelte&#039;;\n \ntest(&#039;shows loading spinner when loading&#039;, () =&gt; {\n  const { getByRole } = render(LoadingButton, {\n    props: { loading: true }\n  });\n \n  const button = getByRole(&#039;button&#039;);\n  expect(button).toBeDisabled();\n});\nIntegration Tests\n# tests/integration/test_api.py\nimport pytest\nfrom httpx import AsyncClient\n \n@pytest.mark.asyncio\nasync def test_create_report_endpoint(client: AsyncClient, auth_headers):\n    &quot;&quot;&quot;Test report creation via API.&quot;&quot;&quot;\n    response = await client.post(\n        &quot;/api/v1/report&quot;,\n        json={\n            &quot;title&quot;: &quot;Test report&quot;,\n            &quot;description&quot;: &quot;Testing the API&quot;,\n            &quot;latitude&quot;: 12.9716,\n            &quot;longitude&quot;: 77.5946\n        },\n        headers=auth_headers\n    )\n \n    assert response.status_code == 201\n    assert &quot;report_id&quot; in response.json()\n\nCode Patterns &amp; Standards\nBackend Patterns\n1. Service Functions (Not Classes)\n# ‚úÖ Good - Module-level function\nasync def create_report(db: AsyncSession, data: dict) -&gt; int:\n    return await db_service.create_report(db, data)\n \n# ‚ùå Avoid - Class-based service\nclass ReportService:\n    def __init__(self, db: AsyncSession):\n        self.db = db\n2. Always Raise Specific Exceptions\n# ‚úÖ Good\nif not user:\n    raise AuthenticationError(&quot;User not found&quot;)\n \n# ‚ùå Avoid\nif not user:\n    return None  # Don&#039;t return None for errors\n3. Use Retry Decorators\n@retry_database_operation\nasync def query_database():\n    # Will retry 3 times with exponential backoff\n    pass\n4. Include Context in Exceptions\nraise DatabaseError(\n    message=&quot;Failed to create report&quot;,\n    details=str(e),\n    context={&quot;user_id&quot;: user_id, &quot;operation&quot;: &quot;create&quot;}\n)\n5. Structured Logging\nlogger.info(\n    &quot;Report created&quot;,\n    extra={\n        &quot;report_id&quot;: report_id,\n        &quot;username&quot;: username,\n        &quot;category&quot;: category\n    }\n)\nFrontend Patterns\n1. Always Use Toast Notifications\n// ‚úÖ Good\ntoast.show(&#039;Report created successfully!&#039;, &#039;success&#039;);\n \n// ‚ùå Avoid\nalert(&#039;Report created successfully!&#039;);\n2. Always Use LoadingButton for Forms\n&lt;LoadingButton loading={submitting} disabled={!isValid}&gt;\n  Submit\n&lt;/LoadingButton&gt;\n3. Handle All Async Errors\ntry {\n  await api.post(&#039;/api/v1/report&#039;, data);\n  toast.show(&#039;Success!&#039;, &#039;success&#039;);\n} catch (error) {\n  toast.show(getErrorMessage(error), &#039;error&#039;);\n}\n4. Use Runes API\n// ‚úÖ Good - Runes\nlet count = $state(0);\nlet doubled = $derived(count * 2);\n \n// ‚ùå Avoid - Old reactive syntax\nlet count = 0;\n$: doubled = count * 2;\n\nGit Workflow\nCommit Convention\nFollow Conventional Commits:\nfeat(scope): add new feature\nfix(scope): resolve bug\nrefactor(scope): restructure code\nperf(scope): improve performance\ndocs(scope): update documentation\ntest(scope): add/modify tests\nchore(scope): build process, dependencies\n\nExamples:\ngit commit -m &quot;feat(reports): add duplicate detection with perceptual hashing&quot;\ngit commit -m &quot;fix(auth): resolve undefined username in delete endpoint&quot;\ngit commit -m &quot;docs(api): update endpoint documentation with rate limits&quot;\nBranch Strategy\n\nmain - Production branch (auto-deploys via CI/CD)\nfeat/feature-name - Feature branches\nfix/bug-name - Bug fix branches\n\nWorkflow:\n# Create feature branch\ngit checkout -b feat/add-notifications\n \n# Make changes and commit\ngit add .\ngit commit -m &quot;feat(notifications): add push notification support&quot;\n \n# Push to GitHub\ngit push origin feat/add-notifications\n \n# Create pull request on GitHub\n# After approval, merge to main (triggers deployment)\n\nDebugging &amp; Troubleshooting\nBackend Debugging\nEnable debug logging:\n# In .env\nLOG_LEVEL=DEBUG\n \n# Restart backend\nuvicorn app.main:app --reload --log-level debug\nUse pdb for breakpoints:\nimport pdb; pdb.set_trace()  # Execution stops here\nCheck PostgreSQL logs:\ndocker logs darshi-postgres --tail 100 -f\nCheck Redis logs:\ndocker logs darshi-redis --tail 100 -f\nFrontend Debugging\nBrowser DevTools:\n\nF12 ‚Üí Console tab (view logs)\nF12 ‚Üí Network tab (view API requests)\nF12 ‚Üí Application tab (view localStorage)\n\nSvelte DevTools:\nInstall extension: Svelte DevTools\nDebug reactive values:\n&lt;script&gt;\n  let count = $state(0);\n \n  $effect(() =&gt; {\n    console.log(&#039;Count changed:&#039;, count);\n  });\n&lt;/script&gt;\nCommon Issues\n‚ÄúConnection refused‚Äù error:\n# Check if PostgreSQL is running\ndocker ps | grep postgres\n \n# Restart if needed\ndocker restart darshi-postgres\n‚ÄúModule not found‚Äù error:\n# Backend\npip install -r requirements.txt\n \n# Frontend\ncd frontend &amp;&amp; npm install\n‚ÄúPort already in use‚Äù:\n# Find process using port 8080\nlsof -ti:8080 | xargs kill -9\n\nPerformance Optimization\nBackend Optimization\n1. Use async/await everywhere:\n# ‚úÖ Good\nasync def get_reports(db: AsyncSession):\n    result = await db.execute(select(Report))\n    return result.scalars().all()\n2. Add database indexes:\nCREATE INDEX idx_reports_status_created ON reports(status, created_at DESC);\n3. Use Redis caching:\nfrom app.core.cache import cache\n \n@cache(ttl=300)  # Cache for 5 minutes\nasync def get_popular_reports():\n    return await db.query(Report).limit(10).all()\n4. Optimize queries:\n# Use select_related to avoid N+1 queries\nreports = await db.execute(\n    select(Report).options(selectinload(Report.comments))\n)\nFrontend Optimization\n1. Lazy load routes:\n// vite.config.ts - automatic with SvelteKit\n2. Optimize images:\n&lt;!-- Use WebP with fallback --&gt;\n&lt;picture&gt;\n  &lt;source srcset=&quot;image.webp&quot; type=&quot;image/webp&quot;&gt;\n  &lt;img src=&quot;image.jpg&quot; alt=&quot;Description&quot;&gt;\n&lt;/picture&gt;\n3. Debounce search inputs:\nimport { debounce } from &#039;$lib/utils&#039;;\n \nconst handleSearch = debounce(async (query: string) =&gt; {\n  // API call\n}, 300);\n\nSecurity Guidelines\nBackend Security\n1. Never log sensitive data:\n# ‚ùå Bad\nlogger.info(f&quot;User logged in: {password}&quot;)\n \n# ‚úÖ Good\nlogger.info(f&quot;User logged in: {username}&quot;)\n2. Always validate inputs:\nfrom app.core.validation import validate_coordinates, sanitize_form_data\n \ncoords = validate_coordinates(lat, lon)\ndata = sanitize_form_data(form_data)\n3. Use parameterized queries:\n# ‚úÖ Good - SQLAlchemy automatically parameterizes\nresult = await db.execute(\n    select(User).where(User.username == username)\n)\n \n# ‚ùå Never use string formatting\nquery = f&quot;SELECT * FROM users WHERE username = &#039;{username}&#039;&quot;\n4. Rate limit sensitive endpoints:\nfrom app.core.security import rate_limit\n \n@router.post(&quot;/api/v1/auth/login&quot;)\n@rate_limit(requests=5, window=300)  # 5 requests per 5 minutes\nasync def login():\n    pass\nFrontend Security\n1. Sanitize user input:\nimport DOMPurify from &#039;dompurify&#039;;\n \nconst clean = DOMPurify.sanitize(userInput);\n2. Use HTTPS only:\n// Ensure API_URL uses https in production\nconst API_URL = import.meta.env.PROD\n  ? &#039;api.darshi.app&#039;\n  : &#039;http://localhost:8080&#039;;\n3. Store tokens securely:\n// Use httpOnly cookies (preferred) or localStorage\nlocalStorage.setItem(&#039;token&#039;, token);\n \n// Clear on logout\nlocalStorage.removeItem(&#039;token&#039;);\n\nAdditional Resources\n\nPHILOSOPHY.md - Development principles and conventions\nAPI.md - Complete API documentation\nARCHITECTURE.md - System architecture\nDEPLOYMENT.md - Production deployment\nAPI Docs: http://localhost:8080/docs\n\n\nDocumentation Last Updated: December 27, 2025\nTech Stack: FastAPI + PostgreSQL + Redis + SvelteKit 5\nDevelopment Environment: Docker Compose + Local Python + Node.js"},"index":{"slug":"index","filePath":"index.md","title":"index","links":["QUICK_START","guides/DEVELOPMENT","CI_CD_SETUP","guides/ARCHITECTURE","guides/DEPLOYMENT","guides/API","reference/PHILOSOPHY","CLAUDE"],"tags":[],"content":"Darshi Documentation\n\nAI-powered civic grievance platform for reporting and tracking municipal issues\n\nLive Site: darshi.app\nBackend API: api.darshi.app\n\nüìö Documentation Structure\nGetting Started\n\nQuick Start Guide - Get Darshi running locally in 5 minutes\nDevelopment Guide - Developer workflow and best practices\nCD Setup - GitHub Actions auto-deployment\n\nArchitecture &amp; Deployment\n\nArchitecture Guide - System design and tech stack\nDeployment Guide - Production deployment on Azure VPS\nAPI Reference - Complete API documentation (62 endpoints)\n\nReference\n\nPhilosophy - Development principles and conventions\nCLAUDE.md - Instructions for Claude Code AI assistant\n\n\nüèóÔ∏è Current Tech Stack (2025)\nBackend\n\nFastAPI (Python 3.11) - Web framework\nPostgreSQL 15 + PostGIS - Relational database with geospatial support\nRedis 7 - Caching and rate limiting\nGemini 2.5 Flash - AI image verification\nCloudflare R2 - Image storage (S3-compatible)\n\nFrontend\n\nSvelteKit 5 - Web framework with Runes API\nTypeScript - Type safety\nLeaflet - Interactive maps\nVite - Build tool\n\nInfrastructure\n\nAzure VPS (16GB RAM, 4 vCPU) - Self-hosted\nDocker + Docker Compose - Containerization\nNginx - Reverse proxy with SSL\nGitHub Actions - CI/CD pipeline\nPrometheus - Metrics and monitoring\n\nPrevious Stack (Migrated From)\n\nGoogle Cloud Run ‚Üí Azure VPS\nFirestore ‚Üí PostgreSQL\nGoogle Cloud Storage ‚Üí Cloudflare R2\nFirebase Hosting ‚Üí Cloudflare Pages (frontend)\n\n\nüöÄ Quick Links\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nResourceURLProduction Sitedarshi.appAPI Endpointapi.darshi.app/api/v1API Docs (Swagger)api.darshi.app/docsGitHub Repositorygithub.com/Sarthak-Sidhant/darshiCI/CD Dashboardgithub.com/Sarthak-Sidhant/darshi/actions\n\nüìñ Key Features\nFor Citizens\n\nReport Civic Issues - Potholes, broken streetlights, garbage, drainage, etc.\nAI Verification - Gemini 2.5 Flash auto-verifies reports with image analysis\nTrack Progress - Timeline showing report status from submission to resolution\nUpvote &amp; Comment - Community engagement on reports\nLocation-based Filtering - Find issues near you\nDuplicate Detection - Automatic detection using perceptual hashing + geohashing\nBilingual Support - English and Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)\nDark Mode - Uber Black theme\n\nFor Administrators\n\nAdmin Dashboard - Manage reports, users, and moderators\nStatus Management - Update report status with notes\nUser Management - Create moderators and admins\nAnalytics - View trends and statistics\nAudit Logs - Track all admin actions\n\nTechnical Features\n\nOAuth Integration - Google, GitHub, Facebook login\nReal-time Updates - WebSocket support for live notifications\nGeospatial Queries - PostGIS-powered location search\nImage Optimization - WebP conversion for 30% smaller files\nRate Limiting - Tiered limits (anonymous: 3/hr, registered: 10/hr)\nOffline Support - Service worker for PWA capabilities\nResponsive Design - Mobile-first, works on all devices\n\n\nüîê Authentication Methods\nUser Authentication\n\nUsername/Password - Traditional login with JWT tokens (30-day expiry)\nOAuth Providers - Google, GitHub, Facebook via backend OAuth flow\nEmail Verification - Optional email verification for accounts\n\nAdmin Authentication\n\nSeparate JWT with 1-hour expiry\nRequires role=&quot;super_admin&quot; or role=&quot;moderator&quot;\nTwo-factor authentication support (optional)\n\n\nüó∫Ô∏è Report Lifecycle\n1. User submits report with image(s)\n   ‚Üì\n2. Images uploaded to Cloudflare R2 (WebP optimized)\n   ‚Üì\n3. Perceptual hash (dHash) calculated for duplicate detection\n   ‚Üì\n4. Background task: AI verification with Gemini 2.5 Flash\n   ‚Üì\n5. AI extracts: is_valid, category, severity, description\n   ‚Üì\n6. Check for duplicates (perceptual hash + geohash proximity)\n   ‚Üì\n7. Status updated: VERIFIED / REJECTED / DUPLICATE\n   ‚Üì\n8. Timeline updated with state change event\n   ‚Üì\n9. BigQuery analytics identifies hotspots (3+ severe issues in 24h)\n\nReport Status Flow\nPENDING_VERIFICATION ‚Üí VERIFIED ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí IN_PROGRESS ‚îÄ‚îÄ‚Üí RESOLVED\n                    ‚Üì           ‚Üò                ‚Üó\n                 REJECTED       FLAGGED (system error)\n                    ‚Üì\n                 DUPLICATE (links to original report)\n\n\nüîß Local Development\nPrerequisites\n\nPython 3.11+\nNode.js 20+\nPostgreSQL 15+ with PostGIS\nRedis 7+\nDocker &amp; Docker Compose (optional)\n\nQuick Start\n# 1. Clone repository\ngit clone github.com/Sarthak-Sidhant/darshi.git\ncd darshi\n \n# 2. Backend setup\npython3 -m venv venv\nsource venv/bin/activate\npip install -r requirements.txt\ncp .env.example .env  # Edit with your credentials\n \n# 3. Start database &amp; cache\ndocker compose up -d postgres redis\n \n# 4. Run backend\nuvicorn app.main:app --reload --port 8080\n \n# 5. Frontend setup (new terminal)\ncd frontend\nnpm install\nnpm run dev\nVisit: http://localhost:5173\nSee QUICK_START.md for detailed instructions.\n\nüöÄ Production Deployment\nInfrastructure\n\nVPS: Azure VM (16GB RAM, 4 vCPU, Ubuntu 22.04)\nIP: 20.193.150.79\nDomains:\n\ndarshi.app (frontend on Cloudflare Pages)\napi.darshi.app (backend on Azure VPS)\n\n\n\nDeployment Method\n\nCI/CD: GitHub Actions auto-deploys on push to main\nContainers: Docker Compose with health checks\nPersistence: Docker volumes for data\nAuto-restart: systemd service darshi-deploy.service\nSSL: Cloudflare proxy + Let‚Äôs Encrypt\n\nData Persistence\nAll data survives VPS reboots:\n\nPostgreSQL database (postgres_data volume)\nRedis cache with AOF (redis_data volume)\nPrometheus metrics (prometheus_data volume)\n\nSee Deployment Guide for full details.\n\nüìä Architecture Overview\nHigh-Level Architecture\n[User Browser]\n    ‚Üì HTTPS\n[Cloudflare Pages] ‚Üê Frontend (SvelteKit)\n    ‚Üì API Calls\n[Cloudflare Proxy]\n    ‚Üì HTTPS\n[Nginx] ‚Üê Azure VPS (20.193.150.79)\n    ‚Üì\n[Backend (FastAPI)] ‚Üê Docker Container (port 8080)\n    ‚Üì\n[PostgreSQL] + [Redis] ‚Üê Docker Containers\n    ‚Üì\n[Cloudflare R2] ‚Üê Image Storage\n\nRequest Flow\n\nUser visits darshi.app (served by Cloudflare Pages)\nFrontend makes API calls to api.darshi.app\nCloudflare proxy routes to Azure VPS (20.193.150.79)\nNginx reverse proxy forwards to backend container (port 8080)\nBackend queries PostgreSQL, caches in Redis\nImages served from Cloudflare R2 CDN\n\nSee Architecture Guide for detailed diagrams.\n\nüß™ Testing\nBackend Tests\n# Run all tests\npytest\n \n# With coverage\npytest --cov=app --cov-report=html\n \n# Specific test file\npytest tests/unit/test_reports.py -v\nFrontend Tests\ncd frontend\n \n# Run tests\nnpm run test\n \n# Watch mode\nnpm run test:watch\n \n# With coverage\nnpm run test:coverage\n\nüìù Contributing\nCommit Convention\nFollow Conventional Commits:\nfeat(scope): add new feature\nfix(scope): resolve bug\nrefactor(scope): restructure code\nperf(scope): improve performance\ndocs(scope): update documentation\ntest(scope): add/modify tests\nchore(scope): build process, dependencies\n\nDevelopment Workflow\n\nCreate feature branch: git checkout -b feat/my-feature\nMake changes and test locally\nRun tests: pytest and npm run test\nCommit with conventional format\nPush to GitHub\nCI/CD runs tests automatically\nIf tests pass, auto-deploys to production\n\nSee PHILOSOPHY.md for coding standards.\n\nüÜò Support &amp; Resources\nDocumentation\n\nAPI Reference - All 62 endpoints documented\nDevelopment Guide - Setup and best practices\nDeployment Guide - Production hosting\nCD Setup - GitHub Actions configuration\n\nMonitoring\n\nGitHub Actions: github.com/Sarthak-Sidhant/darshi/actions\nAPI Health: api.darshi.app/health\nPrometheus: http://20.193.150.79:9090 (VPS only)\n\nGetting Help\n\nCheck relevant documentation above\nReview PHILOSOPHY.md for conventions\nCheck GitHub Issues for similar problems\nSSH into VPS and check Docker logs:\nssh darshi@20.193.150.79\ndocker logs darshi-backend --tail 100 -f\n\n\n\nDocumentation Last Updated: December 27, 2025\nCodebase Version: 2.0.0 (Azure Migration Complete)\nInfrastructure: Azure VPS + Cloudflare + PostgreSQL"},"misc/future-stuff":{"slug":"misc/future-stuff","filePath":"misc/future stuff.md","title":"future stuff","links":[],"tags":[],"content":""},"misc/future/fund-tracking":{"slug":"misc/future/fund-tracking","filePath":"misc/future/fund-tracking.md","title":"fund-tracking","links":[],"tags":[],"content":"MP/MLA Fund Tracking Platform\n\nTransparency and Accountability in Local Area Development Spending\n\nPart of: Darshi Civic Suite\nThis document outlines the integration strategy for tracking Member of Parliament (MP) and Member of Legislative Assembly (MLA) fund utilization, project progress, and expenditure patterns.\n\nTable of Contents\n\nExecutive Summary\nProblem Statement\nSolution Overview\nArchitecture\nData Model\nData Sources\nAnalytics &amp; Visualization\nUser Interface\nIntegration with Darshi\nMigration Path\nChallenges &amp; Mitigations\nTech Stack\n\n\nExecutive Summary\nBackground:\n\nMPs receive ‚Çπ5 crores/year (MPLADS - Member of Parliament Local Area Development Scheme)\nMLAs receive ‚Çπ1-5 crores/year (varies by state - MLA LAD fund)\nFunds for local development: roads, schools, healthcare, sanitation\n\nProblem: Citizens don‚Äôt know:\n\nHow their MP/MLA is spending these funds\nWhich projects are funded in their area\nProject completion status\nHistorical spending patterns\nComparison with other MPs/MLAs\n\nSolution: A transparent, visual platform that:\n\nTracks every project funded by MPLADS/MLA LAD funds\nShows project status (sanctioned ‚Üí ongoing ‚Üí completed)\nMaps projects geographically\nAnalyzes spending patterns\nCompares representatives‚Äô performance\nAllows citizen feedback on project quality\n\nValue Proposition: Hold elected representatives accountable by making their development spending visible and measurable.\n\nProblem Statement\nThe Transparency Gap\n1. Information Asymmetry\nCurrent State:\n\nMPLADS data published on government portal (mplads.gov.in)\nBut: PDFs, hard to search/analyze\nBut: No state-level aggregation for MLA funds\nBut: No project status updates post-sanction\nBut: No citizen feedback mechanism\n\nCitizen Questions (Currently Unanswered):\n\n‚ÄúHas my MP done anything in my area?‚Äù\n‚ÄúWhere did the ‚Çπ5 crores go?‚Äù\n‚ÄúWhy is my area‚Äôs school still broken when funds exist?‚Äù\n‚ÄúIs this MP better than the previous one?‚Äú\n\n2. Lack of Accountability\nProblems:\n\nFunds sanctioned but projects not completed\nPoor quality construction (leaks, cracks within months)\nNepotism in project selection (benefit MP‚Äôs preferred areas)\nNo consequences for non-utilization\n\nExample:\nMP X sanctioned ‚Çπ50 lakhs for community center in 2022\n‚îú‚îÄ Status on portal: &quot;Sanctioned&quot;\n‚îú‚îÄ Ground reality: Construction incomplete, abandoned\n‚îú‚îÄ Quality: Roof leaking, walls cracked\n‚îî‚îÄ Citizen recourse: None (don&#039;t know whom to complain to)\n\n3. No Comparative Analysis\nCitizens can‚Äôt answer:\n\n‚ÄúHow does my MP compare to MPs in neighboring constituencies?‚Äù\n‚ÄúWhich party‚Äôs MPs deliver better infrastructure?‚Äù\n‚ÄúWhich categories (health, education, roads) get most funding?‚Äù\n\n\nSolution Overview\nPlatform Capabilities\n1. Comprehensive Fund Tracking\nFor each MP/MLA:\n‚îú‚îÄ Annual allocation (‚Çπ5 crores for MPs)\n‚îú‚îÄ Projects sanctioned (itemized list)\n‚îÇ  ‚îú‚îÄ Project name &amp; description\n‚îÇ  ‚îú‚îÄ Location (constituency, ward, geolocation)\n‚îÇ  ‚îú‚îÄ Category (health, education, roads, etc.)\n‚îÇ  ‚îú‚îÄ Sanctioned amount\n‚îÇ  ‚îú‚îÄ Sanctioned date\n‚îÇ  ‚îú‚îÄ Implementing agency\n‚îÇ  ‚îî‚îÄ Expected completion date\n‚îú‚îÄ Funds utilized (vs allocated)\n‚îú‚îÄ Projects completed (vs sanctioned)\n‚îî‚îÄ Year-over-year trends\n\n2. Real-Time Project Status\nProject Lifecycle:\nSanctioned ‚Üí Approval ‚Üí Tendering ‚Üí Work Order ‚Üí\nConstruction Started ‚Üí Ongoing ‚Üí Inspection ‚Üí\nCompleted ‚Üí Citizen Feedback\n\nCurrent government data: Only &quot;Sanctioned&quot;\nOur platform: All stages + photos + citizen feedback\n\n3. Geographic Visualization\nInteractive Map:\n‚îú‚îÄ Color-coded by project status\n‚îÇ  ‚îú‚îÄ Green: Completed\n‚îÇ  ‚îú‚îÄ Yellow: Ongoing\n‚îÇ  ‚îú‚îÄ Red: Delayed/Stalled\n‚îÇ  ‚îî‚îÄ Gray: Sanctioned but not started\n‚îú‚îÄ Filter by category (schools, roads, healthcare)\n‚îú‚îÄ Filter by year (2020, 2021, 2022, 2023, 2024)\n‚îî‚îÄ Click project ‚Üí See details, photos, status\n\n4. Citizen Feedback\nFor each project:\n‚îú‚îÄ &quot;Is this project completed?&quot; (Yes/No)\n‚îú‚îÄ &quot;Quality rating&quot; (1-5 stars)\n‚îú‚îÄ &quot;Upload photo of current state&quot;\n‚îú‚îÄ &quot;Report issue&quot; (incomplete, poor quality, not started)\n‚îî‚îÄ Comments section\n\n5. Comparative Analytics\nCompare MPs/MLAs:\n‚îú‚îÄ Funds utilization rate (%)\n‚îú‚îÄ Projects completed (%)\n‚îú‚îÄ Average project completion time\n‚îú‚îÄ Citizen satisfaction score\n‚îú‚îÄ Category-wise spending distribution\n‚îî‚îÄ Timeline comparison (term 1 vs term 2)\n\n\nArchitecture\nHigh-Level System Architecture\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                      DATA SOURCES                                ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  MPLADS     State MLA    RTI          Citizen      Government   ‚îÇ\n‚îÇ  Portal     Portals      Responses    Reports      Orders       ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n       ‚îÇ            ‚îÇ          ‚îÇ            ‚îÇ            ‚îÇ\n       ‚ñº            ‚ñº          ‚ñº            ‚ñº            ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    INGESTION LAYER                               ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Web Scrapers  ‚îÇ  PDF Parsers  ‚îÇ  Manual Entry  ‚îÇ  API Clients ‚îÇ\n‚îÇ  (Grivredr)    ‚îÇ               ‚îÇ  (Admin)       ‚îÇ               ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    PROCESSING LAYER                              ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  ‚Ä¢ Geocoding (project addresses ‚Üí coordinates)                   ‚îÇ\n‚îÇ  ‚Ä¢ Categorization (education, health, infrastructure)            ‚îÇ\n‚îÇ  ‚Ä¢ Deduplication (same project from multiple sources)            ‚îÇ\n‚îÇ  ‚Ä¢ Entity extraction (MP name, constituency, amounts)            ‚îÇ\n‚îÇ  ‚Ä¢ Status inference (from text descriptions)                     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DATA LAYER                                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Firestore (Real-time)           ‚îÇ  BigQuery (Analytics)        ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ MPs/MLAs                    ‚îÇ  ‚îú‚îÄ‚îÄ Spending patterns       ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Projects                    ‚îÇ  ‚îú‚îÄ‚îÄ Completion rates        ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Citizen feedback            ‚îÇ  ‚îú‚îÄ‚îÄ Constituency analysis   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Status updates              ‚îÇ  ‚îî‚îÄ‚îÄ Comparative metrics     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    ANALYTICS ENGINE                              ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  ‚Ä¢ Utilization rate calculation                                  ‚îÇ\n‚îÇ  ‚Ä¢ Completion rate tracking                                      ‚îÇ\n‚îÇ  ‚Ä¢ Delay detection                                               ‚îÇ\n‚îÇ  ‚Ä¢ Citizen satisfaction scoring                                  ‚îÇ\n‚îÇ  ‚Ä¢ Constituency ranking                                          ‚îÇ\n‚îÇ  ‚Ä¢ Spending pattern analysis                                     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    OUTPUT LAYER                                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Web Portal    Mobile App    Public API     Data Export         ‚îÇ\n‚îÇ  (Dashboard)   (PWA)         (Developers)   (CSV/JSON)          ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n\nData Model\nMP/MLA Schema\n# Collection: representatives\n{\n    &quot;id&quot;: &quot;uuid&quot;,\n \n    # Personal Info\n    &quot;name&quot;: &quot;Rajeev Chandrashekhar&quot;,\n    &quot;party&quot;: &quot;BJP&quot;,\n    &quot;position&quot;: &quot;mp|mla|former_mp|former_mla&quot;,\n \n    # Constituency\n    &quot;constituency&quot;: {\n        &quot;name&quot;: &quot;Bangalore South&quot;,\n        &quot;type&quot;: &quot;lok_sabha|vidhan_sabha&quot;,\n        &quot;state&quot;: &quot;Karnataka&quot;,\n        &quot;districts&quot;: [&quot;Bengaluru Urban&quot;],\n        &quot;geohashes&quot;: [&quot;tdr1&quot;, &quot;tdr2&quot;]  # Coverage area\n    },\n \n    # Tenure\n    &quot;tenure&quot;: {\n        &quot;start_date&quot;: &quot;2019-05-23&quot;,\n        &quot;end_date&quot;: null,  # null if current\n        &quot;term&quot;: &quot;17th Lok Sabha&quot;,\n        &quot;previous_terms&quot;: [&quot;16th Lok Sabha&quot;]\n    },\n \n    # Contact\n    &quot;contact&quot;: {\n        &quot;email&quot;: &quot;rajeevchandrashekhar@sansad.nic.in&quot;,\n        &quot;phone&quot;: &quot;+91-11-2301-XXXX&quot;,\n        &quot;office_address&quot;: &quot;...&quot;,\n        &quot;website&quot;: &quot;https://...&quot;,\n        &quot;social_media&quot;: {\n            &quot;twitter&quot;: &quot;@Rajeev_GoI&quot;,\n            &quot;facebook&quot;: &quot;...&quot;\n        }\n    },\n \n    # Fund Allocation\n    &quot;fund_allocation&quot;: {\n        &quot;scheme&quot;: &quot;MPLADS&quot;,\n        &quot;annual_amount&quot;: 50000000,  # ‚Çπ5 crores\n        &quot;currency&quot;: &quot;INR&quot;\n    },\n \n    # Performance Summary (calculated)\n    &quot;performance&quot;: {\n        &quot;total_allocated&quot;: 250000000,  # Over 5 years\n        &quot;total_utilized&quot;: 230000000,\n        &quot;utilization_rate&quot;: 0.92,  # 92%\n        &quot;projects_sanctioned&quot;: 142,\n        &quot;projects_completed&quot;: 118,\n        &quot;completion_rate&quot;: 0.83,  # 83%\n        &quot;avg_project_completion_days&quot;: 245,\n        &quot;citizen_satisfaction&quot;: 4.1  # out of 5\n    },\n \n    &quot;created_at&quot;: timestamp,\n    &quot;updated_at&quot;: timestamp\n}\nProject Schema\n# Collection: projects\n{\n    &quot;id&quot;: &quot;uuid&quot;,\n \n    # Representative\n    &quot;representative_id&quot;: &quot;uuid&quot;,\n    &quot;representative_name&quot;: &quot;Rajeev Chandrashekhar&quot;,\n    &quot;representative_position&quot;: &quot;MP&quot;,\n    &quot;constituency&quot;: &quot;Bangalore South&quot;,\n \n    # Project Details\n    &quot;title&quot;: &quot;Construction of Community Health Center&quot;,\n    &quot;description&quot;: &quot;Construction of a 50-bed community health center with...&quot;,\n    &quot;category&quot;: &quot;healthcare&quot;,  # Standardized categories\n    &quot;subcategory&quot;: &quot;hospital&quot;,\n \n    # Financial\n    &quot;sanctioned_amount&quot;: 15000000,  # ‚Çπ1.5 crores\n    &quot;released_amount&quot;: 12000000,   # Amount actually released\n    &quot;spent_amount&quot;: 11500000,      # Amount spent so far\n    &quot;currency&quot;: &quot;INR&quot;,\n \n    # Timeline\n    &quot;sanctioned_date&quot;: &quot;2022-04-15&quot;,\n    &quot;approval_date&quot;: &quot;2022-05-20&quot;,\n    &quot;work_order_date&quot;: &quot;2022-07-01&quot;,\n    &quot;construction_start_date&quot;: &quot;2022-08-15&quot;,\n    &quot;expected_completion_date&quot;: &quot;2024-02-15&quot;,\n    &quot;actual_completion_date&quot;: null,  # null if not completed\n \n    # Status\n    &quot;status&quot;: &quot;sanctioned|approved|tendering|ongoing|completed|stalled|cancelled&quot;,\n    &quot;status_updated_at&quot;: timestamp,\n    &quot;status_history&quot;: [\n        {&quot;status&quot;: &quot;sanctioned&quot;, &quot;date&quot;: &quot;2022-04-15&quot;},\n        {&quot;status&quot;: &quot;approved&quot;, &quot;date&quot;: &quot;2022-05-20&quot;},\n        {&quot;status&quot;: &quot;ongoing&quot;, &quot;date&quot;: &quot;2022-08-15&quot;}\n    ],\n \n    # Location\n    &quot;location&quot;: {\n        &quot;address&quot;: &quot;Ward 98, Koramangala, Bangalore&quot;,\n        &quot;ward&quot;: &quot;98&quot;,\n        &quot;zone&quot;: &quot;South Zone&quot;,\n        &quot;city&quot;: &quot;Bangalore&quot;,\n        &quot;state&quot;: &quot;Karnataka&quot;,\n        &quot;latitude&quot;: 12.9352,\n        &quot;longitude&quot;: 77.6245,\n        &quot;geohash&quot;: &quot;tdr1hv&quot;\n    },\n \n    # Implementing Agency\n    &quot;implementing_agency&quot;: {\n        &quot;name&quot;: &quot;BBMP&quot;,\n        &quot;department&quot;: &quot;Health Department&quot;,\n        &quot;contractor&quot;: &quot;XYZ Constructions Pvt Ltd&quot;\n    },\n \n    # Documents\n    &quot;documents&quot;: {\n        &quot;sanction_letter_url&quot;: &quot;gs://...&quot;,\n        &quot;tender_document_url&quot;: &quot;gs://...&quot;,\n        &quot;work_order_url&quot;: &quot;gs://...&quot;,\n        &quot;completion_certificate_url&quot;: null\n    },\n \n    # Photos\n    &quot;photos&quot;: [\n        {\n            &quot;url&quot;: &quot;gs://...&quot;,\n            &quot;caption&quot;: &quot;Foundation laying ceremony&quot;,\n            &quot;date&quot;: &quot;2022-08-15&quot;,\n            &quot;source&quot;: &quot;official|citizen&quot;\n        }\n    ],\n \n    # Citizen Feedback\n    &quot;feedback&quot;: {\n        &quot;completion_confirmations&quot;: 0,  # How many citizens confirmed completed\n        &quot;quality_ratings&quot;: [],  # [5, 4, 4, 5] - citizen ratings\n        &quot;avg_quality_rating&quot;: null,\n        &quot;issues_reported&quot;: [\n            {\n                &quot;user_id&quot;: &quot;uuid&quot;,\n                &quot;issue&quot;: &quot;Construction quality poor, cracks visible&quot;,\n                &quot;reported_at&quot;: timestamp,\n                &quot;photos&quot;: [&quot;gs://...&quot;]\n            }\n        ]\n    },\n \n    # Metadata\n    &quot;data_source&quot;: &quot;mplads_portal|state_portal|rti|citizen&quot;,\n    &quot;scraped_from_url&quot;: &quot;https://...&quot;,\n    &quot;verified&quot;: true,\n    &quot;verified_by&quot;: &quot;admin_user_id&quot;,\n    &quot;created_at&quot;: timestamp,\n    &quot;updated_at&quot;: timestamp\n}\nCategories\nPROJECT_CATEGORIES = {\n    &quot;healthcare&quot;: [&quot;hospital&quot;, &quot;clinic&quot;, &quot;pharmacy&quot;, &quot;ambulance&quot;],\n    &quot;education&quot;: [&quot;school&quot;, &quot;college&quot;, &quot;library&quot;, &quot;digital_classroom&quot;, &quot;lab&quot;],\n    &quot;infrastructure&quot;: [&quot;road&quot;, &quot;bridge&quot;, &quot;footpath&quot;, &quot;drainage&quot;, &quot;streetlight&quot;],\n    &quot;water&quot;: [&quot;water_supply&quot;, &quot;tank&quot;, &quot;pipeline&quot;, &quot;purification&quot;],\n    &quot;sanitation&quot;: [&quot;toilet&quot;, &quot;waste_management&quot;, &quot;sewage&quot;],\n    &quot;sports&quot;: [&quot;stadium&quot;, &quot;playground&quot;, &quot;gym&quot;],\n    &quot;culture&quot;: [&quot;community_center&quot;, &quot;auditorium&quot;, &quot;library&quot;, &quot;park&quot;],\n    &quot;electricity&quot;: [&quot;power_supply&quot;, &quot;transformer&quot;, &quot;poles&quot;],\n    &quot;other&quot;: [&quot;miscellaneous&quot;]\n}\n\nData Sources\n1. MPLADS Portal (mplads.gov.in)\nWhat‚Äôs Available:\n\nAll MP-sanctioned projects (since 2006)\nConstituency-wise data\nCategory-wise data\nSanctioned amounts\n\nFormat: PDF reports, Excel downloads, web pages\nScraping Strategy:\nclass MPLADSScraper:\n    &quot;&quot;&quot;\n    Scrape MPLADS portal for project data.\n    &quot;&quot;&quot;\n \n    async def scrape_constituency(self, constituency: str, year: int) -&gt; list:\n        &quot;&quot;&quot;\n        Scrape all projects for a constituency in a year.\n        &quot;&quot;&quot;\n        # 1. Navigate to constituency page\n        # 2. Extract project list\n        # 3. For each project, extract details\n        # 4. Parse financial data\n        # 5. Geocode project locations\n        pass\n2. State MLA Fund Portals\nExamples:\n\nMaharashtra: mahades.maharashtra.gov.in\nKarnataka: (varies by district)\nTamil Nadu: (district-level portals)\n\nChallenge: Each state has different format, some don‚Äôt publish online.\nStrategy:\n\nGrivredr adaptive scrapers for each state\nRTI requests for data not published\nManual entry for smaller states\n\n3. RTI Responses\nUse Cases:\n\nRequest project status updates (not on portals)\nRequest contractor details\nRequest quality inspection reports\n\n4. Government Orders &amp; Gazettes\nMonitor for:\n\nFund release notifications\nProject completion announcements\nTransfer of funds to agencies\n\n5. Citizen Reports (via Darshi)\nIntegration:\n\nCitizens upload photos of project sites\nReport project status (‚Äúconstruction started‚Äù, ‚Äúcompleted‚Äù)\nRate project quality\n\n\nAnalytics &amp; Visualization\nKey Metrics\n1. Utilization Rate\n-- Calculate fund utilization rate for an MP\nSELECT\n  representative_name,\n  SUM(sanctioned_amount) as total_sanctioned,\n  SUM(spent_amount) as total_spent,\n  (SUM(spent_amount) / SUM(sanctioned_amount)) as utilization_rate\nFROM projects\nWHERE representative_id = &#039;xyz&#039;\nGROUP BY representative_name\n2. Completion Rate\n-- Calculate project completion rate\nSELECT\n  representative_name,\n  COUNT(*) as total_projects,\n  SUM(CASE WHEN status = &#039;completed&#039; THEN 1 ELSE 0 END) as completed_projects,\n  (SUM(CASE WHEN status = &#039;completed&#039; THEN 1 ELSE 0 END) / COUNT(*)) as completion_rate\nFROM projects\nWHERE representative_id = &#039;xyz&#039;\n3. Average Completion Time\n-- Average days to complete projects\nSELECT\n  representative_name,\n  AVG(DATE_DIFF(actual_completion_date, construction_start_date, DAY)) as avg_completion_days\nFROM projects\nWHERE status = &#039;completed&#039;\n  AND representative_id = &#039;xyz&#039;\n4. Spending by Category\n-- Category-wise spending distribution\nSELECT\n  category,\n  SUM(sanctioned_amount) as total_amount,\n  (SUM(sanctioned_amount) / (SELECT SUM(sanctioned_amount) FROM projects WHERE representative_id = &#039;xyz&#039;)) as percentage\nFROM projects\nWHERE representative_id = &#039;xyz&#039;\nGROUP BY category\nORDER BY total_amount DESC\n5. Citizen Satisfaction\ndef calculate_citizen_satisfaction(representative_id: str) -&gt; float:\n    &quot;&quot;&quot;\n    Calculate average citizen satisfaction score.\n    Based on project quality ratings and completion confirmations.\n    &quot;&quot;&quot;\n    projects = get_projects(representative_id, status=&#039;completed&#039;)\n \n    total_rating = 0\n    count = 0\n \n    for project in projects:\n        if project.feedback.quality_ratings:\n            avg_rating = sum(project.feedback.quality_ratings) / len(project.feedback.quality_ratings)\n            total_rating += avg_rating\n            count += 1\n \n    if count == 0:\n        return None\n \n    return total_rating / count\nVisualization Examples\n1. Constituency Map\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Bangalore South - MP: Rajeev Chandrashekhar               ‚îÇ\n‚îÇ  Fund Utilization: 92% | Projects Completed: 118/142       ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ        [Interactive Map of Constituency]                    ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  Legend:                                                    ‚îÇ\n‚îÇ  üü¢ Completed (118)                                         ‚îÇ\n‚îÇ  üü° Ongoing (18)                                            ‚îÇ\n‚îÇ  üî¥ Stalled/Delayed (4)                                     ‚îÇ\n‚îÇ  ‚ö™ Sanctioned (not started) (2)                            ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  Filters:                                                   ‚îÇ\n‚îÇ  [All ‚ñº] [2020 ‚ñº] [2021 ‚ñº] [2022 ‚ñº] [2023 ‚ñº] [2024 ‚ñº]    ‚îÇ\n‚îÇ  [Healthcare] [Education] [Roads] [Water] [All Categories] ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n2. Spending Breakdown\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Spending by Category (2019-2024)                           ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  Healthcare       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 32% (‚Çπ80 Cr)            ‚îÇ\n‚îÇ  Education        ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 24% (‚Çπ60 Cr)                ‚îÇ\n‚îÇ  Infrastructure   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 20% (‚Çπ50 Cr)                  ‚îÇ\n‚îÇ  Water &amp; Sanit.   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 12% (‚Çπ30 Cr)                      ‚îÇ\n‚îÇ  Sports           ‚ñà‚ñà‚ñà‚ñà 8% (‚Çπ20 Cr)                          ‚îÇ\n‚îÇ  Other            ‚ñà‚ñà 4% (‚Çπ10 Cr)                            ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  Total: ‚Çπ250 Crores (5 years @ ‚Çπ5 Cr/year)                 ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n3. Timeline View\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Project Timeline: Community Health Center, Koramangala     ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  Sanctioned        Approved       Work Started    Expected  ‚îÇ\n‚îÇ  Apr 2022          May 2022       Aug 2022        Feb 2024  ‚îÇ\n‚îÇ      ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óã        ‚îÇ\n‚îÇ                                    ‚îÇ                         ‚îÇ\n‚îÇ                               Current status:                ‚îÇ\n‚îÇ                               60% complete                   ‚îÇ\n‚îÇ                               (as of Dec 2024)               ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚ö†Ô∏è Delayed by 45 days                                      ‚îÇ\n‚îÇ  New expected completion: Mar 2024                          ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n4. Comparative Dashboard\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Compare MPs: Bangalore Constituencies                      ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  Metric              South    North    Central   Average   ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ\n‚îÇ  Utilization Rate    92%      87%      95%       91%       ‚îÇ\n‚îÇ  Completion Rate     83%      78%      88%       83%       ‚îÇ\n‚îÇ  Projects Completed  118      102      135       118       ‚îÇ\n‚îÇ  Avg Completion Time 245d     267d     228d      247d      ‚îÇ\n‚îÇ  Citizen Rating      4.1‚≠ê    3.8‚≠ê    4.3‚≠ê      4.1‚≠ê     ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  Best Performer: Bangalore Central (Overall Score: 9.2/10) ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n\nUser Interface\nWeb Portal\n1. Homepage\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  üí∞ Track Your MP/MLA Development Funds                     ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  üîç Search by:                                              ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ MP/MLA Name, Constituency, or Your Location         ‚îÇ   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  OR                                                         ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üìç Detect My Location                                      ‚îÇ\n‚îÇ     [Allow Location Access]                                 ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üìä National Statistics                                     ‚îÇ\n‚îÇ  ‚Ä¢ ‚Çπ2,725 Crores allocated (545 MPs @ ‚Çπ5 Cr each)          ‚îÇ\n‚îÇ  ‚Ä¢ 89% utilization rate                                     ‚îÇ\n‚îÇ  ‚Ä¢ 15,234 projects completed this year                      ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n2. Representative Profile\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  üë§ Rajeev Chandrashekhar                                   ‚îÇ\n‚îÇ     MP, Bangalore South (BJP) | 2019-2024                   ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  üìä Performance Overview                                    ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ Fund Utilization: 92% ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë  (‚Çπ230/250 Cr) ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ Projects Completed: 83% ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë (118/142)     ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ Citizen Rating: 4.1‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ                            ‚îÇ   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [View Projects Map] [Spending Analysis] [Compare with...] ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üìã Recent Projects (2024)                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ üè• Community Health Center, Koramangala               ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ    ‚Çπ1.5 Cr | üü° 60% complete | Healthcare             ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ    [View Details]                                     ‚îÇ   ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îÇ\n‚îÇ  ‚îÇ üè´ Digital Classroom, Govt School HSR                 ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ    ‚Çπ25 Lakhs | üü¢ Completed | Education               ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ    Citizen Rating: 4.5‚≠ê [View Details]               ‚îÇ   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [See All 142 Projects]                                     ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n3. Project Detail Page\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  ‚Üê Back to Rajeev Chandrashekhar&#039;s Projects                 ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  üè• Community Health Center, Koramangala                    ‚îÇ\n‚îÇ  Status: üü° Ongoing (60% complete)                          ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üí∞ Financial Details                                       ‚îÇ\n‚îÇ  ‚Ä¢ Sanctioned: ‚Çπ1.5 Crores                                  ‚îÇ\n‚îÇ  ‚Ä¢ Released: ‚Çπ1.2 Crores                                    ‚îÇ\n‚îÇ  ‚Ä¢ Spent: ‚Çπ1.15 Crores                                      ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üìÖ Timeline                                                ‚îÇ\n‚îÇ  ‚Ä¢ Sanctioned: Apr 15, 2022                                 ‚îÇ\n‚îÇ  ‚Ä¢ Construction Started: Aug 15, 2022                       ‚îÇ\n‚îÇ  ‚Ä¢ Expected Completion: Mar 2024 (delayed by 45 days)      ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üìç Location                                                ‚îÇ\n‚îÇ  Ward 98, Koramangala, Bangalore South                      ‚îÇ\n‚îÇ  [View on Map]                                              ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üèóÔ∏è Implementing Agency                                     ‚îÇ\n‚îÇ  BBMP Health Department                                     ‚îÇ\n‚îÇ  Contractor: XYZ Constructions Pvt Ltd                      ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üì∏ Photos                                                  ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                          ‚îÇ\n‚îÇ  ‚îÇ Found- ‚îÇ ‚îÇ Under  ‚îÇ ‚îÇ Recent ‚îÇ                          ‚îÇ\n‚îÇ  ‚îÇ ation  ‚îÇ ‚îÇ Const. ‚îÇ ‚îÇ (Dec)  ‚îÇ                          ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                          ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üë• Citizen Feedback                                        ‚îÇ\n‚îÇ  ‚Ä¢ 3 people confirmed construction ongoing                  ‚îÇ\n‚îÇ  ‚Ä¢ No quality issues reported                               ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚ùì Have you visited this site?                             ‚îÇ\n‚îÇ  [‚úì Confirm Status] [‚≠ê Rate Quality] [üì∑ Upload Photo]    ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nMobile App (PWA)\nKey Features:\n\nGeolocation-based project discovery (‚ÄúShow projects near me‚Äù)\nBarcode/QR scanning (if projects have signboards with codes)\nEasy photo upload for citizen feedback\nOffline mode (cached data)\nPush notifications (‚ÄúNew project sanctioned in your area‚Äù)\n\n\nIntegration with Darshi\nUse Cases\n1. Link Reports to Funded Projects\nScenario: Citizen reports poor construction quality\nDarshi Report: &quot;Community center roof leaking&quot;\nLocation: Koramangala\n\nSystem automatically links to:\nFund Tracking Entry: &quot;Community Center, Koramangala&quot;\n‚îú‚îÄ Funded by: MP Rajeev Chandrashekhar\n‚îú‚îÄ Amount: ‚Çπ75 Lakhs\n‚îú‚îÄ Contractor: ABC Constructions\n‚îî‚îÄ Completion: 2023-02-15\n\nAction:\n- Tag report as &quot;funded project quality issue&quot;\n- Notify MP office\n- Update project feedback score\n- Escalate if needed\n\n2. Track Report ‚Üí Fund Allocation\nScenario: Multiple reports about missing school playground\nDarshi Reports: 15 reports about &quot;School needs playground&quot;\nLocation: Govt School, HSR Layout\n\nFund Tracking System:\n- Check: Has MP/MLA sanctioned funds for this school?\n  Result: No recent projects\n- Suggest: &quot;Submit petition to MP for playground funding&quot;\n- Provide: MP contact details, MPLADS application process\n\n3. Monitor Fund-Backed Projects\nScenario: MP sanctions school renovation\nFund Tracking: &quot;School building renovation sanctioned&quot;\nLocation: Govt School, HSR Layout\nAmount: ‚Çπ50 Lakhs\nExpected Completion: 6 months\n\nDarshi Integration:\n- Create monitoring timeline\n- Send notifications to nearby citizens\n- Encourage progress photos\n- Alert if project stalled\n- Collect feedback post-completion\n\n\nMigration Path\nPhase 1: Data Foundation (6-8 weeks)\nGoals: Build data model, scrape MPLADS data\nTasks:\n\n Design data models (representatives, projects)\n Build MPLADS scraper (all 545 MPs)\n Geocode project locations\n Categorize projects\n Calculate baseline metrics\n\nDeliverables:\n\nDatabase with 50,000+ MPLADS projects\nAll MP profiles with performance metrics\n\nPhase 2: State MLA Funds (8-10 weeks)\nGoals: Add state-level data\nTasks:\n\n Identify state MLA fund portals (28 states)\n Build Grivredr scrapers for each state\n RTI requests for states without online data\n Integrate MLA data into database\n Calculate state-level metrics\n\nDeliverables:\n\nMLA data for 5 major states (Maharashtra, Karnataka, Tamil Nadu, UP, MP)\n\nPhase 3: Web Portal (6-8 weeks)\nGoals: Public-facing website\nTasks:\n\n Build representative profile pages\n Create project detail pages\n Interactive map visualization\n Search and filters\n Comparative analytics dashboard\n\nDeliverables:\n\nWeb portal live (view-only, no citizen feedback yet)\n\nPhase 4: Citizen Feedback (4-5 weeks)\nGoals: Enable citizen participation\nTasks:\n\n Build project status confirmation feature\n Add quality rating system\n Photo upload for projects\n Issue reporting\n Feedback moderation system\n\nDeliverables:\n\nCitizens can contribute project updates\n\nPhase 5: Darshi Integration (3-4 weeks)\nGoals: Connect with existing Darshi platform\nTasks:\n\n Link Darshi reports to funded projects\n Add ‚ÄúCheck if funded‚Äù feature to report submission\n Monitor funded projects via Darshi reports\n Shared user accounts\n\nDeliverables:\n\nSeamless integration between platforms\n\nPhase 6: Advanced Analytics (Ongoing)\nGoals: Deep insights, ML models\nTasks:\n\n Predictive models (which projects likely to stall?)\n Anomaly detection (unusual spending patterns)\n Sentiment analysis (citizen feedback text)\n Comparative ranking algorithms\n\n\nChallenges &amp; Mitigations\n1. Data Availability\nChallenge: Many states don‚Äôt publish MLA fund data online.\nMitigations:\n\nFocus on states that publish (start with 5-6 major states)\nRTI requests for remaining states\nManual entry for high-priority constituencies\nCrowdsourcing: Allow users to submit project info\n\n2. Data Staleness\nChallenge: Government portals update infrequently.\nMitigations:\n\nMonthly scraping schedule\nCitizen feedback fills gaps (real-time status updates)\nMonitor government order websites for new sanctions\n\n3. Geocoding Accuracy\nChallenge: Project addresses vague (‚ÄúGovt School, Ward 98‚Äù)\nMitigations:\n\nUse Google Maps Geocoding API\nFallback to ward centroid if address ambiguous\nCitizen-submitted photos with GPS coordinates\nManual correction for high-value projects\n\n4. Citizen Engagement\nChallenge: Will citizens actually provide feedback?\nMitigations:\n\nGamification (badges for contributions)\nIntegration with Darshi (existing user base)\nWhatsApp notifications (‚ÄúRate this completed project‚Äù)\nMake it easy (1-tap ‚ÄúIs this complete? Yes/No‚Äù)\n\n5. Political Sensitivity\nChallenge: Platform exposes underperforming MPs/MLAs.\nMitigations:\n\nData-driven, objective metrics (no editorial bias)\nTransparency: Data sources clearly cited\nRight to reply: MPs/MLAs can respond to feedback\nLegal review: Ensure compliance with defamation laws\n\n6. Verification\nChallenge: How to verify citizen-submitted updates?\nMitigations:\n\nRequire multiple confirmations (3+ people)\nPhoto evidence with GPS + timestamp\nAdmin review for sensitive claims\nCommunity moderation (trusted users)\n\n\nTech Stack\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nComponentTechnologyPurposeScrapingGrivredrAdaptive scrapers for government portalsGeocodingGoogle Maps Geocoding APIConvert addresses to coordinatesDatabaseFirestoreProjects, representatives, feedbackAnalyticsBigQueryHistorical analysis, rankingsBackendFastAPIAPI serverFrontendSvelteKitWeb portalMapsGoogle Maps PlatformInteractive mapsStorageCloud StoragePhotos, documents\n\nSuccess Metrics\nData Coverage\n\nNumber of MPs covered (target: 545/545)\nNumber of MLAs covered (target: 500+)\nProjects in database (target: 100,000+)\n\nUser Engagement\n\nMonthly active users\nCitizen feedback submissions per month\nPhotos uploaded per month\n\nImpact\n\nMedia coverage / citations\nDownloads of data by researchers/journalists\nRequests for data access (API usage)\n\nAccountability\n\nNumber of underperforming representatives exposed\nProjects marked as stalled ‚Üí resumed\nCitizen satisfaction improvement (year-over-year)\n\n\nConclusion\nThe MP/MLA Fund Tracking Platform brings transparency to development spending by making fund utilization data accessible, visual, and participatory. By combining:\n\nComprehensive data (scraped + RTI + citizen-contributed)\nVisual analytics (maps, charts, comparisons)\nCitizen participation (feedback, ratings, photos)\nIntegration with Darshi (link reports to funded projects)\n\nWe empower citizens to hold their elected representatives accountable for how they spend public development funds.\n\nDocument Version: 1.0\nLast Updated: December 2024\nPart of: Darshi Civic Suite"},"misc/future/government-communication":{"slug":"misc/future/government-communication","filePath":"misc/future/government-communication.md","title":"government-communication","links":[],"tags":[],"content":"Government Communication Platform Integration\n\nMaking Government Announcements Accessible Through AI-Powered Translation\n\nPart of: Darshi Civic Suite\nThis document outlines the integration strategy for making government circulars and announcements accessible to all citizens regardless of language barriers or literacy levels.\n\nTable of Contents\n\nExecutive Summary\nProblem Statement\nSolution Overview\nArchitecture\nData Model\nContent Pipeline\nTranslation &amp; Simplification\nAudio Generation\nUser Interface\nDiscovery &amp; Aggregation\nMigration Path\nChallenges &amp; Mitigations\nTech Stack\n\n\nExecutive Summary\nProblem: Government announcements are published in inaccessible bureaucratic language, often only in English or regional languages, excluding large portions of the population.\nSolution: Automatically fetch, translate, simplify, and deliver government announcements in plain language across multiple formats (text, audio) and languages.\nValue Proposition: Every citizen can understand what their government is saying, regardless of education level or language preference.\n\nProblem Statement\nThe Accessibility Crisis\n\n\nBureaucratic Language Barrier\n\nGovernment documents use complex legal/administrative English\nExample: ‚ÄúThe undersigned is directed to bring to your notice‚Ä¶‚Äù\nCitizens need: ‚ÄúImportant update about‚Ä¶‚Äù\n\n\n\nLanguage Diversity\n\nNational announcements often only in English/Hindi\nState/district announcements only in regional language\nMigrants don‚Äôt speak local language\nNo pan-India unified access point\n\n\n\nLiteracy Challenges\n\n~25% of Indian adults have limited literacy\nCannot read long PDF circulars\nNeed audio/video formats\n\n\n\nScattered Sources\n\nMinistry websites (50+ national ministries)\nState government portals (28+ states)\nDistrict administration websites (700+ districts)\nNo single place to check ‚Äúwhat did government announce today?‚Äù\n\n\n\nDiscovery Problem\n\nEven tech-savvy citizens don‚Äôt know where to look\nCritical announcements buried in PDFs\nNo search across all government sources\n\n\n\nCurrent Gaps in Darshi\nDarshi focuses on:\n\nCitizen ‚Üí Government (reporting issues)\nReactive problem-solving\n\nMissing:\n\nGovernment ‚Üí Citizen (announcements, policies)\nProactive information dissemination\nMulti-modal accessibility (audio, simplified text)\n\n\nSolution Overview\nPlatform Capabilities\n\n\nUniversal Aggregation\n\nScrape/fetch announcements from all government sources\nNational ministries, state governments, district offices\nSupport multiple formats: web pages, PDFs, press releases\n\n\n\nAI-Powered Translation\n\nTranslate to 8+ Indian languages\nMaintain meaning and context\nHandle domain-specific terminology\n\n\n\nSimplification\n\nRewrite bureaucratic language into plain language\n‚ÄúGrade 5 reading level‚Äù versions available\nExtract key points, deadlines, affected citizens\n\n\n\nMulti-Modal Output\n\nText (web, mobile)\nAudio (text-to-speech in native languages)\nSummary cards (visual, shareable)\nWhatsApp integration (leveraging Nagar Alert Hub)\n\n\n\nPersonalization\n\nFilter by location (state, district, city)\nFilter by category (health, education, employment, etc.)\nSubscribe to specific topics\nGet notified of relevant announcements\n\n\n\n\nArchitecture\nHigh-Level System Architecture\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    GOVERNMENT SOURCES                            ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Ministry     State Gov    District     PIB          Gazette    ‚îÇ\n‚îÇ  Websites     Portals      Offices      (Press)      of India   ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n       ‚îÇ            ‚îÇ          ‚îÇ            ‚îÇ            ‚îÇ\n       ‚ñº            ‚ñº          ‚ñº            ‚ñº            ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DISCOVERY LAYER                               ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Web Scrapers  ‚îÇ  RSS Feeds  ‚îÇ  API Clients  ‚îÇ  PDF Parsers    ‚îÇ\n‚îÇ  (Grivredr)    ‚îÇ             ‚îÇ               ‚îÇ                 ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    EXTRACTION LAYER                              ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Content Extraction (from HTML, PDF, images)                    ‚îÇ\n‚îÇ  Metadata Extraction (date, ministry, category, jurisdiction)   ‚îÇ\n‚îÇ  Deduplication (same announcement from multiple sources)        ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    AI PROCESSING LAYER                           ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Gemini Multimodal Processing                                   ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Language Detection                                         ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Content Classification (category, urgency, audience)       ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Translation to 8+ languages                                ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Simplification (multiple reading levels)                   ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Key Information Extraction (deadlines, eligibility, etc.)  ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Summary Generation                                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    AUDIO GENERATION LAYER                        ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Text-to-Speech (Google Cloud TTS / ElevenLabs)                 ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Generate audio in user&#039;s preferred language                ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Natural, conversational voice                              ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Cache generated audio files                                ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DATA LAYER                                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Firestore (Real-time)           ‚îÇ  Cloud Storage               ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Announcements               ‚îÇ  ‚îú‚îÄ‚îÄ Original PDFs           ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Translations                ‚îÇ  ‚îú‚îÄ‚îÄ Generated audio         ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ User subscriptions          ‚îÇ  ‚îî‚îÄ‚îÄ Summary cards           ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Notification queue          ‚îÇ                              ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    OUTPUT LAYER                                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Web Portal    Mobile App    WhatsApp    Voice        Email     ‚îÇ\n‚îÇ  (Darshi)      (PWA)         (Alerts)    (Hotline)    (Digest)  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nComponent Breakdown\n1. Discovery Layer\n\nWeb Scrapers: Grivredr-powered adaptive scrapers for government portals\nRSS Feeds: Where available (PIB, some ministries)\nAPI Clients: For government APIs (e.g., data.gov.in)\nPDF Parsers: Extract text from scanned/native PDFs\n\n2. Extraction Layer\n\nContent Extraction: Clean HTML, parse PDFs, OCR images\nMetadata Extraction: Date, ministry, category, geography\nDeduplication: Hash-based + semantic similarity\n\n3. AI Processing Layer\n\nGemini: Translation, simplification, summarization\nClassification: Auto-categorize by topic and audience\n\n4. Audio Generation Layer\n\nTTS: Natural-sounding audio in multiple languages\nCaching: Store generated audio to avoid redundant processing\n\n\nData Model\nAnnouncement Schema\n# Collection: announcements\n{\n    &quot;id&quot;: &quot;uuid&quot;,\n    &quot;title&quot;: {\n        &quot;original&quot;: &quot;string&quot;,  # Original title\n        &quot;en&quot;: &quot;string&quot;,        # English\n        &quot;hi&quot;: &quot;string&quot;,        # Hindi\n        &quot;mr&quot;: &quot;string&quot;,        # Marathi\n        # ... other languages\n    },\n \n    # Original content\n    &quot;content&quot;: {\n        &quot;original&quot;: {\n            &quot;text&quot;: &quot;string&quot;,       # Extracted text\n            &quot;language&quot;: &quot;en|hi|...&quot;,\n            &quot;format&quot;: &quot;html|pdf|text&quot;\n        },\n        &quot;source_url&quot;: &quot;string&quot;,\n        &quot;source_pdf_url&quot;: &quot;string | null&quot;,\n        &quot;source_document_id&quot;: &quot;string | null&quot;\n    },\n \n    # Processed content\n    &quot;translations&quot;: {\n        &quot;en&quot;: {\n            &quot;full&quot;: &quot;string&quot;,           # Full translation\n            &quot;simplified&quot;: &quot;string&quot;,      # Grade 5 level\n            &quot;summary&quot;: &quot;string&quot;,         # 2-3 sentence summary\n            &quot;key_points&quot;: [...]          # Bullet points\n        },\n        &quot;hi&quot;: {...},\n        # ... other languages\n    },\n \n    # Audio versions\n    &quot;audio_urls&quot;: {\n        &quot;en&quot;: &quot;gs://bucket/announcements/{id}/en.mp3&quot;,\n        &quot;hi&quot;: &quot;gs://bucket/announcements/{id}/hi.mp3&quot;,\n        # ... other languages\n    },\n \n    # Metadata\n    &quot;source&quot;: {\n        &quot;ministry&quot;: &quot;Ministry of Health&quot;,\n        &quot;department&quot;: &quot;Department of Health Services&quot;,\n        &quot;state&quot;: &quot;Maharashtra | null&quot;,  # null for national\n        &quot;district&quot;: &quot;Pune | null&quot;,\n        &quot;level&quot;: &quot;national|state|district|municipal&quot;\n    },\n \n    # Classification\n    &quot;category&quot;: &quot;health|education|employment|infrastructure|finance|...&quot;,\n    &quot;subcategory&quot;: &quot;vaccination|admission|jobs|...&quot;,\n    &quot;tags&quot;: [&quot;covid&quot;, &quot;vaccination&quot;, &quot;children&quot;],\n \n    &quot;urgency&quot;: &quot;low|medium|high|critical&quot;,\n    &quot;audience&quot;: [&quot;citizens&quot;, &quot;businesses&quot;, &quot;farmers&quot;, ...],\n \n    # Geographic scope\n    &quot;jurisdiction&quot;: {\n        &quot;type&quot;: &quot;national|state|district|city&quot;,\n        &quot;state&quot;: &quot;string | null&quot;,\n        &quot;district&quot;: &quot;string | null&quot;,\n        &quot;city&quot;: &quot;string | null&quot;,\n        &quot;geohashes&quot;: [...]  # Affected areas\n    },\n \n    # Important dates\n    &quot;published_date&quot;: timestamp,\n    &quot;effective_date&quot;: timestamp | null,\n    &quot;deadline&quot;: timestamp | null,\n    &quot;expiry_date&quot;: timestamp | null,\n \n    # Processing metadata\n    &quot;discovered_at&quot;: timestamp,\n    &quot;processed_at&quot;: timestamp,\n    &quot;last_updated&quot;: timestamp,\n    &quot;processing_status&quot;: &quot;pending|processing|completed|failed&quot;,\n    &quot;translation_status&quot;: {\n        &quot;en&quot;: &quot;completed&quot;,\n        &quot;hi&quot;: &quot;completed&quot;,\n        # ...\n    },\n \n    # Engagement metrics\n    &quot;views&quot;: int,\n    &quot;audio_plays&quot;: int,\n    &quot;shares&quot;: int,\n \n    # Deduplication\n    &quot;content_hash&quot;: &quot;sha256&quot;,\n    &quot;duplicate_of&quot;: &quot;uuid | null&quot;,\n    &quot;related_announcements&quot;: [...]\n}\nUser Subscription Schema\n# Collection: announcement_subscriptions\n{\n    &quot;user_id&quot;: &quot;string&quot;,\n    &quot;phone_number&quot;: &quot;string&quot;,  # For WhatsApp\n    &quot;email&quot;: &quot;string | null&quot;,\n \n    # Language preference\n    &quot;preferred_language&quot;: &quot;en|hi|mr|...&quot;,\n    &quot;reading_level&quot;: &quot;original|simplified&quot;,  # Simplified = Grade 5 level\n    &quot;prefer_audio&quot;: bool,\n \n    # Location-based filters\n    &quot;location&quot;: {\n        &quot;state&quot;: &quot;string | null&quot;,\n        &quot;district&quot;: &quot;string | null&quot;,\n        &quot;city&quot;: &quot;string | null&quot;\n    },\n    &quot;include_national&quot;: bool,  # Subscribe to national announcements\n \n    # Topic-based filters\n    &quot;categories&quot;: [&quot;health&quot;, &quot;education&quot;, &quot;employment&quot;],\n    &quot;tags&quot;: [&quot;covid&quot;, &quot;scholarship&quot;, &quot;farmer&quot;],\n \n    # Notification preferences\n    &quot;notification_channels&quot;: [&quot;whatsapp&quot;, &quot;email&quot;, &quot;push&quot;, &quot;sms&quot;],\n    &quot;urgency_threshold&quot;: &quot;medium|high|critical&quot;,  # Only notify for these\n    &quot;digest_frequency&quot;: &quot;realtime|daily|weekly|none&quot;,\n \n    &quot;created_at&quot;: timestamp,\n    &quot;updated_at&quot;: timestamp\n}\nSource Registry Schema\n# Collection: government_sources\n{\n    &quot;id&quot;: &quot;uuid&quot;,\n    &quot;name&quot;: &quot;Ministry of Health and Family Welfare&quot;,\n    &quot;url&quot;: &quot;mohfw.gov.in&quot;,\n    &quot;type&quot;: &quot;ministry|state_gov|district_office|psu|authority&quot;,\n \n    &quot;scraping_config&quot;: {\n        &quot;method&quot;: &quot;rss|scraper|api&quot;,\n        &quot;scraper_id&quot;: &quot;string | null&quot;,  # Grivredr scraper ID\n        &quot;rss_url&quot;: &quot;string | null&quot;,\n        &quot;api_endpoint&quot;: &quot;string | null&quot;,\n        &quot;selectors&quot;: {...}  # CSS selectors for content\n    },\n \n    &quot;update_frequency&quot;: &quot;hourly|daily|weekly&quot;,\n    &quot;last_scraped&quot;: timestamp,\n    &quot;next_scrape&quot;: timestamp,\n \n    &quot;jurisdiction&quot;: {\n        &quot;level&quot;: &quot;national|state|district&quot;,\n        &quot;state&quot;: &quot;string | null&quot;,\n        &quot;district&quot;: &quot;string | null&quot;\n    },\n \n    &quot;primary_language&quot;: &quot;en|hi|...&quot;,\n    &quot;status&quot;: &quot;active|paused|error&quot;,\n \n    &quot;created_at&quot;: timestamp\n}\n\nContent Pipeline\nDiscovery &amp; Ingestion Flow\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    SCHEDULED SCRAPER                             ‚îÇ\n‚îÇ              (Runs hourly/daily per source config)               ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n                    Check source type\n                           ‚îÇ\n           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n           ‚îÇ               ‚îÇ               ‚îÇ\n           ‚ñº               ‚ñº               ‚ñº\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ   RSS    ‚îÇ    ‚îÇ  Scraper ‚îÇ    ‚îÇ   API    ‚îÇ\n    ‚îÇ  Parser  ‚îÇ    ‚îÇ (Grivredr)‚îÇ   ‚îÇ  Client  ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n         ‚îÇ               ‚îÇ               ‚îÇ\n         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                         ‚îÇ\n                         ‚ñº\n                  Extract content\n                  (HTML/PDF/Image)\n                         ‚îÇ\n                         ‚ñº\n                  Extract metadata\n                  (date, ministry, etc.)\n                         ‚îÇ\n                         ‚ñº\n                  Calculate content hash\n                         ‚îÇ\n                         ‚ñº\n                  Check for duplicate\n                         ‚îÇ\n         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n         ‚îÇ               ‚îÇ               ‚îÇ\n         ‚ñº               ‚ñº               ‚ñº\n    New content    Duplicate        Updated\n                   (skip)           (version)\n         ‚îÇ                              ‚îÇ\n         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                        ‚îÇ\n                        ‚ñº\n              Create announcement record\n                        ‚îÇ\n                        ‚ñº\n              Queue for AI processing\n\nAI Processing Flow\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ               ANNOUNCEMENT PROCESSING PIPELINE                    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n                 Step 1: Language Detection\n                 (Gemini identifies source language)\n                           ‚îÇ\n                           ‚ñº\n                 Step 2: Content Analysis\n                 Extract:\n                 ‚Ä¢ Category (health, education, etc.)\n                 ‚Ä¢ Urgency (low, medium, high, critical)\n                 ‚Ä¢ Audience (citizens, businesses, etc.)\n                 ‚Ä¢ Key dates (deadline, effective date)\n                 ‚Ä¢ Geographic scope\n                           ‚îÇ\n                           ‚ñº\n                 Step 3: Translation (Parallel)\n              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n              ‚îÇ            ‚îÇ            ‚îÇ\n              ‚ñº            ‚ñº            ‚ñº\n         Translate to  Translate to  Translate to\n         English (en)  Hindi (hi)    Marathi (mr)\n              ‚îÇ            ‚îÇ            ‚îÇ\n              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n                 Step 4: Simplification\n                 For each language:\n                 ‚Ä¢ Original (bureaucratic)\n                 ‚Ä¢ Simplified (Grade 5 level)\n                 ‚Ä¢ Summary (2-3 sentences)\n                 ‚Ä¢ Key points (bullets)\n                           ‚îÇ\n                           ‚ñº\n                 Step 5: Audio Generation\n              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n              ‚îÇ            ‚îÇ            ‚îÇ\n              ‚ñº            ‚ñº            ‚ñº\n         TTS: English  TTS: Hindi   TTS: Marathi\n              ‚îÇ            ‚îÇ            ‚îÇ\n              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n                 Step 6: Store &amp; Publish\n                 ‚Ä¢ Save to Firestore\n                 ‚Ä¢ Upload audio to GCS\n                 ‚Ä¢ Index for search\n                 ‚Ä¢ Trigger notifications\n\n\nTranslation &amp; Simplification\nTranslation Strategy\nApproach: Context-aware, domain-specific translation\nasync def translate_announcement(\n    content: str,\n    source_language: str,\n    target_language: str,\n    metadata: dict\n) -&gt; dict:\n    &quot;&quot;&quot;\n    Translate government announcement with context preservation.\n    &quot;&quot;&quot;\n    prompt = f&quot;&quot;&quot;\n    You are translating an official government announcement from {source_language} to {target_language}.\n \n    Context:\n    - Ministry/Department: {metadata[&#039;ministry&#039;]}\n    - Category: {metadata[&#039;category&#039;]}\n    - Audience: {metadata[&#039;audience&#039;]}\n \n    IMPORTANT:\n    1. Preserve all technical terms, schemes names, dates, numbers\n    2. Maintain official tone\n    3. Keep formatting (paragraphs, bullets, headings)\n    4. Translate idioms contextually, don&#039;t transliterate\n \n    Original text:\n    {content}\n \n    Provide translation in {target_language}.\n    &quot;&quot;&quot;\n \n    response = await gemini.generate(prompt)\n    return {\n        &quot;translated_text&quot;: response,\n        &quot;language&quot;: target_language,\n        &quot;confidence&quot;: extract_confidence(response)\n    }\nSimplification Strategy\nGoal: Make content accessible to Grade 5 reading level\nasync def simplify_content(\n    content: str,\n    language: str,\n    target_level: str = &quot;grade5&quot;\n) -&gt; dict:\n    &quot;&quot;&quot;\n    Rewrite bureaucratic language into plain language.\n    &quot;&quot;&quot;\n    prompt = f&quot;&quot;&quot;\n    Rewrite this government announcement in simple {language}.\n \n    Target audience: Someone with {target_level} education level.\n \n    Guidelines:\n    1. Use simple, common words (avoid: &quot;aforementioned&quot;, &quot;henceforth&quot;)\n    2. Short sentences (max 15-20 words)\n    3. Active voice (&quot;Government will provide&quot; not &quot;will be provided by government&quot;)\n    4. Explain technical terms in parentheses\n    5. Keep all important information (dates, eligibility, procedures)\n \n    EXAMPLES:\n    ‚ùå &quot;The undersigned is directed to bring to your notice that...&quot;\n    ‚úÖ &quot;Important update:&quot;\n \n    ‚ùå &quot;Eligible beneficiaries may avail of the scheme...&quot;\n    ‚úÖ &quot;If you qualify, you can get benefits from this program...&quot;\n \n    Original text:\n    {content}\n \n    Provide simplified version:\n    &quot;&quot;&quot;\n \n    response = await gemini.generate(prompt)\n    return {\n        &quot;simplified_text&quot;: response,\n        &quot;reading_level&quot;: target_level\n    }\nSummary Generation\nasync def generate_summary(content: str, language: str) -&gt; dict:\n    &quot;&quot;&quot;\n    Generate multi-level summaries.\n    &quot;&quot;&quot;\n    prompt = f&quot;&quot;&quot;\n    Generate summaries of this government announcement in {language}.\n \n    Provide:\n    1. TLDR (1 sentence, max 20 words)\n    2. Short summary (2-3 sentences)\n    3. Key points (3-5 bullet points)\n    4. Action items (what citizens need to do, if any)\n \n    Original text:\n    {content}\n \n    Format response as JSON.\n    &quot;&quot;&quot;\n \n    response = await gemini.generate(prompt)\n    return parse_json(response)\n\nAudio Generation\nText-to-Speech Pipeline\nclass AnnouncementAudioGenerator:\n    &quot;&quot;&quot;\n    Generate natural-sounding audio for announcements.\n    Uses Google Cloud TTS with WaveNet voices.\n    &quot;&quot;&quot;\n \n    def __init__(self):\n        self.tts_client = texttospeech.TextToSpeechClient()\n        self.storage_client = storage.Client()\n \n    async def generate_audio(\n        self,\n        announcement_id: str,\n        text: str,\n        language: str,\n        reading_level: str = &quot;simplified&quot;\n    ) -&gt; str:\n        &quot;&quot;&quot;\n        Generate audio file and upload to Cloud Storage.\n        &quot;&quot;&quot;\n        # Select voice based on language\n        voice = self._select_voice(language)\n \n        # Prepare text (add pauses for better comprehension)\n        processed_text = self._prepare_text_for_audio(text)\n \n        # Generate audio\n        synthesis_input = texttospeech.SynthesisInput(text=processed_text)\n \n        audio_config = texttospeech.AudioConfig(\n            audio_encoding=texttospeech.AudioEncoding.MP3,\n            speaking_rate=0.9,  # Slightly slower for clarity\n            pitch=0.0\n        )\n \n        response = self.tts_client.synthesize_speech(\n            input=synthesis_input,\n            voice=voice,\n            audio_config=audio_config\n        )\n \n        # Upload to Cloud Storage\n        filename = f&quot;announcements/{announcement_id}/{language}_{reading_level}.mp3&quot;\n        blob = self.storage_client.bucket(BUCKET_NAME).blob(filename)\n        blob.upload_from_string(response.audio_content, content_type=&quot;audio/mpeg&quot;)\n \n        # Make public\n        blob.make_public()\n \n        return blob.public_url\n \n    def _select_voice(self, language: str) -&gt; texttospeech.VoiceSelectionParams:\n        &quot;&quot;&quot;Select appropriate WaveNet voice for language.&quot;&quot;&quot;\n        voice_map = {\n            &quot;en&quot;: (&quot;en-IN&quot;, &quot;en-IN-Wavenet-D&quot;),  # Indian English, male\n            &quot;hi&quot;: (&quot;hi-IN&quot;, &quot;hi-IN-Wavenet-A&quot;),  # Hindi, female\n            &quot;mr&quot;: (&quot;mr-IN&quot;, &quot;mr-IN-Wavenet-A&quot;),  # Marathi\n            &quot;ta&quot;: (&quot;ta-IN&quot;, &quot;ta-IN-Wavenet-A&quot;),  # Tamil\n            &quot;te&quot;: (&quot;te-IN&quot;, &quot;te-IN-Wavenet-A&quot;),  # Telugu\n            &quot;bn&quot;: (&quot;bn-IN&quot;, &quot;bn-IN-Wavenet-A&quot;),  # Bengali\n            &quot;gu&quot;: (&quot;gu-IN&quot;, &quot;gu-IN-Wavenet-A&quot;),  # Gujarati\n            &quot;kn&quot;: (&quot;kn-IN&quot;, &quot;kn-IN-Wavenet-A&quot;),  # Kannada\n        }\n \n        lang_code, name = voice_map.get(language, voice_map[&quot;en&quot;])\n \n        return texttospeech.VoiceSelectionParams(\n            language_code=lang_code,\n            name=name\n        )\n \n    def _prepare_text_for_audio(self, text: str) -&gt; str:\n        &quot;&quot;&quot;\n        Add SSML markup for better audio rendering.\n        &quot;&quot;&quot;\n        # Add pauses after sentences\n        text = text.replace(&#039;. &#039;, &#039;. &lt;break time=&quot;500ms&quot;/&gt; &#039;)\n \n        # Add pauses after commas\n        text = text.replace(&#039;, &#039;, &#039;, &lt;break time=&quot;300ms&quot;/&gt; &#039;)\n \n        # Wrap in SSML\n        return f&#039;&lt;speak&gt;{text}&lt;/speak&gt;&#039;\nAudio Features\nSupported Languages:\n\nEnglish (Indian accent)\nHindi\nMarathi\nTamil\nTelugu\nBengali\nGujarati\nKannada\n\nVoice Options:\n\nStandard clarity (faster generation)\nWaveNet (natural, human-like)\n\nAccessibility:\n\nAdjustable playback speed (web player)\nDownloadable MP3 (offline listening)\nShareable via WhatsApp\n\n\nUser Interface\nWeb Portal Features\n1. Announcement Feed\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Government Announcements                    [Filters ‚ñº]    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  üî¥ CRITICAL ‚îÇ Ministry of Health ‚îÇ Today, 10:30 AM        ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ       ‚îÇ\n‚îÇ  New COVID Vaccination Drive for Children 15-18             ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ          ‚îÇ\n‚îÇ  Registration opens December 28. Free vaccines at all       ‚îÇ\n‚îÇ  government centers. Bring birth certificate...             ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [Read More] [üîä Listen in Hindi] [Share]                  ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  üü° MEDIUM ‚îÇ Maharashtra Govt ‚îÇ Yesterday, 3:15 PM         ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ       ‚îÇ\n‚îÇ  New Property Tax Payment Deadline Extended                 ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ          ‚îÇ\n‚îÇ  Deadline extended to January 31, 2025. Pay online or...   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [Read More] [üîä Listen in Marathi] [Share]                ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n2. Filters &amp; Search\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Filters                                                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  üìç Location                                                ‚îÇ\n‚îÇ     ‚òë National                                              ‚îÇ\n‚îÇ     ‚òë Maharashtra                                           ‚îÇ\n‚îÇ     ‚òë Pune District                                         ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üìÅ Categories                                              ‚îÇ\n‚îÇ     ‚òë Health                                                ‚îÇ\n‚îÇ     ‚òê Education                                             ‚îÇ\n‚îÇ     ‚òë Employment                                            ‚îÇ\n‚îÇ     ‚òê Infrastructure                                        ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üïí Time Range                                              ‚îÇ\n‚îÇ     ‚óã Last 24 hours                                         ‚îÇ\n‚îÇ     ‚óè Last 7 days                                           ‚îÇ\n‚îÇ     ‚óã Last 30 days                                          ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  üö® Urgency                                                 ‚îÇ\n‚îÇ     ‚òë Critical                                              ‚îÇ\n‚îÇ     ‚òë High                                                  ‚îÇ\n‚îÇ     ‚òê Medium                                                ‚îÇ\n‚îÇ     ‚òê Low                                                   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [Apply Filters]                                            ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n3. Announcement Detail View\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  ‚Üê Back to Announcements                                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  üî¥ CRITICAL                                                ‚îÇ\n‚îÇ  Ministry of Health and Family Welfare                      ‚îÇ\n‚îÇ  Published: December 27, 2024 ‚îÇ Effective: January 1, 2025 ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  New COVID Vaccination Drive for Children Aged 15-18       ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [Original] [Simplified ‚úì] [Summary]                       ‚îÇ\n‚îÇ  [üîä Listen in: English ‚ñº]                                 ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  KEY POINTS:                                                ‚îÇ\n‚îÇ  ‚Ä¢ Registration starts December 28, 2024                    ‚îÇ\n‚îÇ  ‚Ä¢ Free vaccination at all government health centers        ‚îÇ\n‚îÇ  ‚Ä¢ Bring child&#039;s birth certificate or school ID            ‚îÇ\n‚îÇ  ‚Ä¢ First dose: January 1-15, Second dose: After 84 days    ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  FULL ANNOUNCEMENT (Simplified):                            ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  The government is starting a new vaccination program for   ‚îÇ\n‚îÇ  children between 15 and 18 years old. This is to protect  ‚îÇ\n‚îÇ  them from COVID-19.                                        ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  Who can get the vaccine?                                   ‚îÇ\n‚îÇ  Children who are 15, 16, 17, or 18 years old on January   ‚îÇ\n‚îÇ  1, 2025.                                                   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  How to register?                                           ‚îÇ\n‚îÇ  ...                                                        ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ORIGINAL ANNOUNCEMENT:                                     ‚îÇ\n‚îÇ  [View Original PDF] [View Original Webpage]                ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  Source: Ministry of Health and Family Welfare              ‚îÇ\n‚îÇ  Reference Number: S-29012/01/2024-DHS                      ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [üì± Share on WhatsApp] [‚úâÔ∏è Email] [üîó Copy Link]          ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nMobile Experience (PWA)\nKey Features:\n\nSwipe between announcements (card UI)\nVoice playback with background audio support\nOffline reading (cached announcements)\nPush notifications for critical alerts\nShare to WhatsApp directly\n\nWhatsApp Integration\nUse Cases:\n\n\nDaily Digest\nüì¢ Government Updates - December 28\n\n3 new announcements today:\n\n1. üî¥ CRITICAL - Health Ministry\n   New COVID vaccination for teens\n   [Read] [Listen]\n\n2. üü° MEDIUM - Maharashtra Govt\n   Property tax deadline extended\n   [Read] [Listen]\n\n3. üü¢ LOW - Employment Ministry\n   New apprenticeship scheme\n   [Read] [Listen]\n\nReply with number to read full announcement\n\n\n\nInstant Critical Alerts\nüö® URGENT GOVERNMENT ALERT\n\nMinistry of Home Affairs\nCyclone warning for coastal areas\n\nPlease evacuate if you are in:\n‚Ä¢ Ratnagiri district\n‚Ä¢ Sindhudurg district\n\nCyclone expected: Tomorrow 6 AM\n\n[Read full alert] [Safety instructions]\n\n\n\nQuery Support\nUser: &quot;Any new scholarship announcements?&quot;\n\nBot: Found 2 recent scholarship announcements:\n\n1. National Scholarship Portal - Last date Dec 31\n2. Maharashtra Scholarship - Last date Jan 15\n\nReply with number to learn more\n\n\n\n\nDiscovery &amp; Aggregation\nSource Types\n1. National Ministries (50+)\nNATIONAL_SOURCES = [\n    {\n        &quot;name&quot;: &quot;Ministry of Health and Family Welfare&quot;,\n        &quot;url&quot;: &quot;mohfw.gov.in&quot;,\n        &quot;type&quot;: &quot;ministry&quot;,\n        &quot;scraping_method&quot;: &quot;rss&quot;,\n        &quot;rss_url&quot;: &quot;mohfw.gov.in/feeds/LatestUpdates.xml&quot;\n    },\n    {\n        &quot;name&quot;: &quot;Ministry of Education&quot;,\n        &quot;url&quot;: &quot;www.education.gov.in&quot;,\n        &quot;type&quot;: &quot;ministry&quot;,\n        &quot;scraping_method&quot;: &quot;scraper&quot;,\n        &quot;update_frequency&quot;: &quot;daily&quot;\n    },\n    {\n        &quot;name&quot;: &quot;Press Information Bureau (PIB)&quot;,\n        &quot;url&quot;: &quot;pib.gov.in&quot;,\n        &quot;type&quot;: &quot;press_bureau&quot;,\n        &quot;scraping_method&quot;: &quot;api&quot;,\n        &quot;api_endpoint&quot;: &quot;pib.gov.in/api/releases&quot;\n    },\n    # ... 47 more ministries\n]\n2. State Governments (28 states + 8 UTs)\nSTATE_SOURCES = [\n    {\n        &quot;name&quot;: &quot;Government of Maharashtra&quot;,\n        &quot;url&quot;: &quot;maharashtra.gov.in&quot;,\n        &quot;state&quot;: &quot;Maharashtra&quot;,\n        &quot;type&quot;: &quot;state_government&quot;,\n        &quot;scraping_method&quot;: &quot;scraper&quot;,\n        &quot;primary_language&quot;: &quot;mr&quot;  # Marathi\n    },\n    # ... 35 more states/UTs\n]\n3. District Administrations (700+)\n# Auto-discovery from state government portals\n# Example: pune.nic.in\nScraper Management\nLeverage Grivredr Architecture:\nclass GovernmentSourceScraper:\n    &quot;&quot;&quot;\n    Adaptive scraper for government portals.\n    Uses Grivredr&#039;s AI-powered scraping.\n    &quot;&quot;&quot;\n \n    async def discover_source_structure(self, url: str) -&gt; dict:\n        &quot;&quot;&quot;Use Grivredr to auto-discover announcement list structure.&quot;&quot;&quot;\n        pass\n \n    async def scrape_announcements(self, source_id: str) -&gt; list:\n        &quot;&quot;&quot;Scrape new announcements from source.&quot;&quot;&quot;\n        pass\n \n    async def extract_content(self, announcement_url: str) -&gt; dict:\n        &quot;&quot;&quot;Extract full content from announcement page/PDF.&quot;&quot;&quot;\n        pass\nDeduplication Strategy\nProblem: Same announcement published on:\n\nMinistry website\nPIB press release\nState government portal\nDistrict website\n\nSolution:\n\nContent Hash: SHA256 of cleaned text\nFuzzy Matching: Semantic similarity (Gemini embeddings)\nReference Numbers: Extract and match official reference IDs\n\nasync def check_duplicate(new_announcement: dict) -&gt; str | None:\n    &quot;&quot;&quot;\n    Check if announcement already exists.\n    Returns existing announcement ID if duplicate.\n    &quot;&quot;&quot;\n    # Step 1: Exact hash match\n    content_hash = calculate_hash(new_announcement[&#039;content&#039;])\n    exact_match = db.collection(&#039;announcements&#039;) \\\n        .where(&#039;content_hash&#039;, &#039;==&#039;, content_hash) \\\n        .limit(1).get()\n \n    if exact_match:\n        return exact_match[0].id\n \n    # Step 2: Reference number match\n    if new_announcement.get(&#039;reference_number&#039;):\n        ref_match = db.collection(&#039;announcements&#039;) \\\n            .where(&#039;reference_number&#039;, &#039;==&#039;, new_announcement[&#039;reference_number&#039;]) \\\n            .limit(1).get()\n \n        if ref_match:\n            return ref_match[0].id\n \n    # Step 3: Semantic similarity (for near-duplicates)\n    embedding = await generate_embedding(new_announcement[&#039;content&#039;])\n    similar = await vector_search(embedding, threshold=0.95)\n \n    if similar:\n        return similar[0][&#039;id&#039;]\n \n    return None  # Not a duplicate\n\nMigration Path\nPhase 1: Foundation (3-4 weeks)\nGoals: Core infrastructure for announcement ingestion\nTasks:\n\n Design data model (announcements, sources, subscriptions)\n Build source registry system\n Implement PDF parser and text extractor\n Set up scraper orchestration (scheduled jobs)\n Create deduplication pipeline\n\nDeliverables:\n\nFirestore collections for announcements\nScraper framework (Grivredr-based)\nBasic web UI showing announcements feed\n\nPhase 2: AI Processing (4-5 weeks)\nGoals: Translation, simplification, summarization\nTasks:\n\n Implement Gemini translation pipeline (8 languages)\n Build simplification engine (Grade 5 level)\n Create summary generation (TLDR, key points)\n Add content classification (category, urgency)\n Build metadata extraction (dates, eligibility)\n\nDeliverables:\n\nMulti-language announcement content\nSimplified versions alongside originals\nAuto-categorization working\n\nPhase 3: Audio Generation (2-3 weeks)\nGoals: Text-to-speech in multiple languages\nTasks:\n\n Integrate Google Cloud TTS\n Implement voice selection per language\n Build audio generation pipeline\n Set up Cloud Storage for audio files\n Add audio player to web UI\n\nDeliverables:\n\nAudio versions of all announcements\nEmbedded audio player in web app\nDownloadable MP3 files\n\nPhase 4: Source Discovery (3-4 weeks)\nGoals: Auto-discover and scrape government sources\nTasks:\n\n Map all national ministry websites\n Map all state government portals\n Build Grivredr scrapers for top 20 sources\n Implement RSS feed readers (where available)\n Set up scheduled scraping (Cloud Scheduler)\n\nDeliverables:\n\n50+ national sources scraped\n28 state sources scraped\nDaily automated scraping\n\nPhase 5: User Features (3-4 weeks)\nGoals: Subscriptions, notifications, personalization\nTasks:\n\n Build subscription management UI\n Implement notification system (WhatsApp, email, push)\n Add filters and search to web UI\n Create daily digest generation\n Build query bot for WhatsApp\n\nDeliverables:\n\nUsers can subscribe to topics/locations\nWhatsApp daily digest working\nSmart filtering and search\n\nPhase 6: Scale &amp; Optimize (Ongoing)\nGoals: Production-ready, scalable system\nTasks:\n\n Optimize scraping costs (caching, rate limits)\n Optimize translation costs (batch processing)\n Implement vector search for semantic queries\n Add analytics dashboard\n Mobile app improvements\n\n\nChallenges &amp; Mitigations\n1. Source Fragmentation\nChallenge: 1000+ government websites, no standard format.\nMitigations:\n\nPrioritize high-traffic sources (ministries, PIB)\nUse Grivredr‚Äôs adaptive scraping (AI-powered)\nCommunity contribution model (add your district source)\nRSS where available (low-maintenance)\n\n2. Translation Quality\nChallenge: Government terminology is domain-specific (legal, medical, technical).\nMitigations:\n\nProvide original alongside translation\nBuild domain-specific glossaries\nHuman review for critical announcements\nUser feedback mechanism (‚Äúreport translation error‚Äù)\n\n3. Timeliness\nChallenge: Critical announcements need immediate dissemination.\nMitigations:\n\nHourly scraping for high-priority sources\nRSS polling every 15 minutes (where available)\nPriority queue for ‚Äúcritical‚Äù urgency\nDirect API integration (where available)\n\n4. Audio Generation Costs\nChallenge: TTS costs can add up at scale.\nMitigations:\n\nOnly generate audio for announcements with &gt;10 views\nCache generated audio (never regenerate)\nUse standard TTS for low-priority, WaveNet for high-priority\nBatch processing during off-peak hours\n\n5. Legal &amp; Accuracy\nChallenge: Misrepresenting government announcements could cause legal issues.\nMitigations:\n\nAlways link to original source (PDF/webpage)\nClear disclaimer: ‚ÄúUnofficial translation/simplification‚Äù\nWatermark: ‚ÄúFor informational purposes only‚Äù\nHuman review for legal/financial announcements\n\n6. Source Changes\nChallenge: Government websites change layout, breaking scrapers.\nMitigations:\n\nGrivredr‚Äôs self-healing scrapers (AI adapts to changes)\nMonitor scraper health (alert on failures)\nFallback to manual notification when scraper breaks\nQuarterly scraper maintenance sprints\n\n\nTech Stack\nCore Technologies\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nComponentTechnologyPurposeContent DiscoveryGrivredr (AI Scrapers)Adaptive scraping of government portalsTranslationGeminiMulti-language translation &amp; simplificationAudio GenerationGoogle Cloud TTSNatural-sounding speech in 8+ languagesDatabaseFirestoreAnnouncements, subscriptions, metadataStorageCloud StoragePDFs, audio files, imagesSearchFirestore + AlgoliaFull-text search, filtersNotificationsWhatsApp Business APIPush announcements to usersSchedulingCloud SchedulerPeriodic scraping jobsBackendFastAPIAPI serverFrontendSvelteKitWeb portal\nIntegration with Darshi\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DARSHI CIVIC SUITE                     ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                           ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ\n‚îÇ  ‚îÇ  Darshi    ‚îÇ  ‚îÇ   Nagar    ‚îÇ  ‚îÇ  Government‚îÇ         ‚îÇ\n‚îÇ  ‚îÇ  Issues    ‚îÇ  ‚îÇ   Alert    ‚îÇ  ‚îÇ  Comms     ‚îÇ         ‚îÇ\n‚îÇ  ‚îÇ  (Core)    ‚îÇ  ‚îÇ   Hub      ‚îÇ  ‚îÇ  Platform  ‚îÇ         ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ\n‚îÇ        ‚îÇ                ‚îÇ               ‚îÇ                ‚îÇ\n‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                ‚îÇ\n‚îÇ                         ‚îÇ                                ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ\n‚îÇ  ‚îÇ         SHARED INFRASTRUCTURE               ‚îÇ         ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§         ‚îÇ\n‚îÇ  ‚îÇ ‚Ä¢ User accounts &amp; authentication           ‚îÇ         ‚îÇ\n‚îÇ  ‚îÇ ‚Ä¢ WhatsApp messaging service               ‚îÇ         ‚îÇ\n‚îÇ  ‚îÇ ‚Ä¢ Location &amp; geohash utilities             ‚îÇ         ‚îÇ\n‚îÇ  ‚îÇ ‚Ä¢ Notification delivery system             ‚îÇ         ‚îÇ\n‚îÇ  ‚îÇ ‚Ä¢ Multi-language support                   ‚îÇ         ‚îÇ\n‚îÇ  ‚îÇ ‚Ä¢ Gemini AI client                         ‚îÇ         ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n\nSuccess Metrics\nPlatform Health\n\nNumber of sources scraped (target: 100+)\nScraping success rate (target: &gt;95%)\nTranslation accuracy (human eval sample)\nAudio generation coverage (% of announcements)\n\nUser Engagement\n\nDaily active users\nAnnouncements viewed per user\nAudio playback rate\nShare rate (WhatsApp, social media)\n\nAccessibility Impact\n\nLanguages accessed (diversity metric)\nSimplified version usage rate\nAudio vs text consumption ratio\nRegional reach (tier 2/3 cities)\n\nTimeliness\n\nAverage time from government publish to platform availability\nCritical announcement SLA (&lt;1 hour)\n\n\nConclusion\nThe Government Communication Platform integration transforms Darshi from a citizen ‚Üí government reporting tool into a bidirectional civic engagement platform. Citizens can both report issues AND stay informed about government actions.\nBy making government communication accessible through AI-powered translation, simplification, and audio generation, we democratize access to official information‚Äîespecially critical for India‚Äôs linguistically diverse, multi-literate population.\n\nDocument Version: 1.0\nLast Updated: December 2024\nPart of: Darshi Civic Suite"},"misc/future/grivredr":{"slug":"misc/future/grivredr","filePath":"misc/future/grivredr.md","title":"grivredr","links":[],"tags":[],"content":"Grivredr - AI-Powered Web Scraper Factory\n\nAutomated Government Portal Integration for Grievance Filing\n\nPart of: Darshi Civic Suite\nThis document outlines the integration and architecture of Grivredr, an intelligent system that automatically generates web scrapers for government grievance portals.\n\nTable of Contents\n\nExecutive Summary\nProblem Statement\nSolution Overview\nArchitecture Overview\nKey Components\nThe Discovery Process\nThe Validation &amp; Self-Healing Loop\nPattern Learning System\nDirectory Structure\nCLI Commands\nCost Tracking\nIntegration with Darshi\nMigration Path\nChallenges &amp; Mitigations\n\n\nExecutive Summary\nProblem: Indian government portals for grievance registration are diverse, complex, and frequently changing. Writing and maintaining scrapers manually is time-consuming and brittle.\nSolution: Grivredr uses AI (Claude with computer use) to automatically:\n\nDiscover form structures\nGenerate working scraper code\nValidate that scrapers work correctly\nSelf-heal when portals change\nLearn from successful patterns\n\nValue Proposition: Reduce portal integration time from 10-20 hours to ~5 minutes, with self-healing capabilities that adapt to portal changes and continuous learning that improves over time.\n\nProblem Statement\nThe Challenge\nIndian government portals for grievance registration have several challenges:\n1. Diverse Technologies\nPortal Technologies:\n‚îú‚îÄ React-based (Ant-Design components)\n‚îú‚îÄ jQuery-based (Select2 dropdowns)\n‚îú‚îÄ ASP.NET WebForms\n‚îú‚îÄ Plain HTML forms\n‚îú‚îÄ Angular/Vue applications\n‚îî‚îÄ Custom JavaScript frameworks\n\n2. Complex Dropdowns\nCascading Dependencies:\nState ‚Üí District ‚Üí Block ‚Üí Village\nZone ‚Üí Ward ‚Üí Locality\nCategory ‚Üí Subcategory ‚Üí Issue Type\n\n3. Dynamic Content\n\nFields appear/disappear based on selections\nOptions loaded via AJAX\nMulti-step forms\nFile uploads with specific requirements\n\n4. No APIs\n\nMost portals only have web forms\nNo programmatic access\nMust interact through browser\n\n5. Frequent Changes\n\nPortal UI updated without notice\nExisting scrapers break\nConstant maintenance required\n\nTraditional Approach (Painful)\nFor each portal:\n1. Manually inspect form (2-4 hours)\n   - Identify all fields\n   - Note all dropdown options\n   - Understand cascading logic\n   - Document required fields\n\n2. Write Playwright/Selenium code (4-8 hours)\n   - Handle each field type\n   - Implement cascade logic\n   - Add error handling\n   - Handle file uploads\n\n3. Handle edge cases (2-4 hours)\n   - Timeout issues\n   - Dynamic content loading\n   - Validation errors\n   - Popup dialogs\n\n4. Test and debug (2-4 hours)\n   - Test with various inputs\n   - Fix discovered issues\n   - Verify submission success\n\n5. Maintain when portal changes (ongoing)\n   - Monitor for breakage\n   - Update selectors\n   - Retest everything\n\nTotal: 10-20 hours per portal\n\nGrivredr Approach (Automated)\nFor each portal:\n1. Run: grivredr discover --url &lt;url&gt; --portal &lt;name&gt;\n2. AI discovers form structure (~2 minutes)\n3. AI generates scraper code (~30 seconds)\n4. Validate and auto-fix if needed (~2 minutes)\n\nTotal: ~5 minutes per portal, ~$0.30-0.70 in AI costs\n\nBonus: Each successful scraper teaches the system,\n       making future portals faster and more accurate.\n\n\nSolution Overview\nAutomated Scraper Generation Pipeline\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                        GRIVREDR PIPELINE                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n     ‚îÇ          ‚îÇ      ‚îÇ          ‚îÇ      ‚îÇ          ‚îÇ      ‚îÇ          ‚îÇ\n     ‚îÇ DISCOVER ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ GENERATE ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ VALIDATE ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ  IMPROVE ‚îÇ\n     ‚îÇ          ‚îÇ      ‚îÇ          ‚îÇ      ‚îÇ          ‚îÇ      ‚îÇ          ‚îÇ\n     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n          ‚îÇ                 ‚îÇ                 ‚îÇ                 ‚îÇ\n          ‚ñº                 ‚ñº                 ‚ñº                 ‚ñº\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ  Form    ‚îÇ      ‚îÇ Scraper  ‚îÇ      ‚îÇ  Test    ‚îÇ      ‚îÇ Working  ‚îÇ\n    ‚îÇ Structure‚îÇ      ‚îÇ   Code   ‚îÇ      ‚îÇ Results  ‚îÇ      ‚îÇ Scraper  ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                                                 ‚îÇ\n                                                                 ‚ñº\n                                                           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                                                           ‚îÇ  LEARN   ‚îÇ\n                                                           ‚îÇ Pattern  ‚îÇ\n                                                           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nStep-by-Step\n\n\nDiscovery Phase\n\nOpen portal URL in headless browser\nAI analyzes form structure (uses Playwright tools)\nExtract all fields, dropdowns, options\nIdentify cascading relationships\nDetect UI framework\n\n\n\nGeneration Phase\n\nUse discovered structure to generate Python code\nApply framework-specific patterns from library\nInclude all dropdown option values\nHandle cascading dependencies\n\n\n\nValidation Phase\n\nRun generated scraper with test data\nTake screenshots to verify correctness\nUse AI vision to check for errors\n\n\n\nSelf-Healing Phase (if needed)\n\nCapture runtime errors\nAI analyzes error + screenshot\nGenerate targeted fix\nApply fix and retry\n\n\n\nLearning Phase\n\nStore successful patterns in library\nUpdate framework-specific templates\nImprove future code generation\n\n\n\n\nArchitecture Overview\nSystem Components\ngrivredr/\n‚îÇ\n‚îú‚îÄ‚îÄ agents/                      # AI Agents (the brains)\n‚îÇ   ‚îú‚îÄ‚îÄ hybrid_form_discovery.py # Main discovery agent\n‚îÇ   ‚îú‚îÄ‚îÄ scraper_validator.py     # Validation + self-healing\n‚îÇ   ‚îú‚îÄ‚îÄ continuous_improvement_agent.py  # Iterative improvement\n‚îÇ   ‚îú‚îÄ‚îÄ code_generator_agent.py  # Code generation\n‚îÇ   ‚îî‚îÄ‚îÄ base_agent.py            # Base class with cost tracking\n‚îÇ\n‚îú‚îÄ‚îÄ cli/                         # Command-line interfaces\n‚îÇ   ‚îú‚îÄ‚îÄ factory_cli.py           # Main CLI (discover, validate, etc.)\n‚îÇ   ‚îî‚îÄ‚îÄ fill_cli.py              # Form filling CLI\n‚îÇ\n‚îú‚îÄ‚îÄ knowledge/                   # Pattern library &amp; templates\n‚îÇ   ‚îú‚îÄ‚îÄ pattern_library.py       # Store successful patterns\n‚îÇ   ‚îú‚îÄ‚îÄ code_templates.py        # Reusable code snippets\n‚îÇ   ‚îî‚îÄ‚îÄ framework_detector.py    # Detect UI frameworks\n‚îÇ\n‚îú‚îÄ‚îÄ utils/                       # Utilities\n‚îÇ   ‚îú‚îÄ‚îÄ portal_manager.py        # Manage portal data\n‚îÇ   ‚îú‚îÄ‚îÄ code_extraction.py       # Extract code from AI responses\n‚îÇ   ‚îú‚îÄ‚îÄ constants.py             # Configuration constants\n‚îÇ   ‚îî‚îÄ‚îÄ tracking.py              # Extract tracking IDs\n‚îÇ\n‚îú‚îÄ‚îÄ scrapers/                    # Generated scrapers (output)\n‚îÇ   ‚îú‚îÄ‚îÄ mcd_delhi/\n‚îÇ   ‚îî‚îÄ‚îÄ ranchi_smart/\n‚îÇ\n‚îú‚îÄ‚îÄ portals/                     # Unified portal data structure\n‚îÇ   ‚îî‚îÄ‚îÄ {state}/{district}/{portal}/\n‚îÇ       ‚îú‚îÄ‚îÄ scraper.py           # Generated scraper\n‚îÇ       ‚îú‚îÄ‚îÄ structure.json       # Form structure\n‚îÇ       ‚îú‚îÄ‚îÄ context/             # Dropdown context\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ dropdowns.json   # All dropdown options\n‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ cascades.json    # Cascade relationships\n‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ field_mappings.json\n‚îÇ       ‚îî‚îÄ‚îÄ metadata.json        # Training metadata\n‚îÇ\n‚îî‚îÄ‚îÄ config/                      # Configuration\n    ‚îî‚îÄ‚îÄ ai_client.py             # AI client setup\n\n\nKey Components\n1. Hybrid Form Discovery Agent\nThe main discovery engine that combines AI intelligence with browser automation.\nclass HybridFormDiscovery:\n    &quot;&quot;&quot;\n    AI orchestrates, Playwright executes.\n \n    The AI calls tools like:\n    - get_all_form_fields()      # Get field overview\n    - get_dropdown_options()     # Extract dropdown values\n    - select_dropdown_option()   # Test cascading\n    - complete_discovery()       # Finish with full structure\n    &quot;&quot;&quot;\n \n    async def discover_form(self, url: str) -&gt; dict:\n        &quot;&quot;&quot;\n        Main discovery method.\n        Returns complete form structure with all dropdown options.\n        &quot;&quot;&quot;\n        # 1. Navigate to URL\n        await self.page.goto(url)\n        await self.page.wait_for_load_state(&#039;networkidle&#039;)\n \n        # 2. Let AI discover structure\n        discovery_result = await self._run_ai_discovery()\n \n        # 3. Parse and validate result\n        form_structure = self._parse_discovery_result(discovery_result)\n \n        return form_structure\nKey Features:\n\nHandles both Ant-Design and Select2 dropdowns\nAutomatically detects UI framework\nCaptures ALL dropdown options\nIdentifies cascade relationships\n\n2. Scraper Validator\nSelf-healing validation loop that tests and fixes generated scrapers.\nclass ScraperValidator:\n    &quot;&quot;&quot;\n    Validates generated scrapers and fixes issues.\n    &quot;&quot;&quot;\n \n    async def validate_scraper(\n        self,\n        scraper_path: str,\n        max_attempts: int = 3\n    ) -&gt; dict:\n        &quot;&quot;&quot;\n        Run scraper, check for errors, fix if needed.\n        &quot;&quot;&quot;\n        for attempt in range(1, max_attempts + 1):\n            # Run scraper\n            result = await self._run_scraper(scraper_path)\n \n            if result.success:\n                # Store successful pattern\n                await self._store_pattern(scraper_path)\n                return {&quot;status&quot;: &quot;success&quot;, &quot;attempt&quot;: attempt}\n \n            # AI analyzes error\n            fix = await self._generate_fix(result.error, result.screenshot)\n \n            # Apply fix\n            await self._apply_fix(scraper_path, fix)\n \n        return {&quot;status&quot;: &quot;failed&quot;, &quot;attempts&quot;: max_attempts}\n3. Pattern Library\nStores successful patterns for reuse across similar portals.\nclass PatternLibrary:\n    &quot;&quot;&quot;\n    Store and retrieve successful scraper patterns.\n    &quot;&quot;&quot;\n \n    def store_pattern(\n        self,\n        portal_url: str,\n        form_schema: dict,\n        generated_code: str,\n        confidence: float\n    ):\n        &quot;&quot;&quot;\n        Store a successful pattern.\n \n        Args:\n            portal_url: Source portal URL\n            form_schema: Discovered form structure\n            generated_code: Working scraper code\n            confidence: Success rate (0.0-1.0)\n        &quot;&quot;&quot;\n        # Extract code snippets (dropdown handlers, cascade logic)\n        snippets = self._extract_code_snippets(generated_code)\n \n        # Store in SQLite + vector DB (optional)\n        self.db.insert({\n            &#039;url&#039;: portal_url,\n            &#039;framework&#039;: form_schema[&#039;ui_framework&#039;],\n            &#039;field_types&#039;: form_schema[&#039;field_types&#039;],\n            &#039;code&#039;: generated_code,\n            &#039;snippets&#039;: snippets,\n            &#039;confidence&#039;: confidence,\n            &#039;created_at&#039;: datetime.now()\n        })\n \n    def get_similar_patterns(self, form_schema: dict) -&gt; list:\n        &quot;&quot;&quot;\n        Find patterns similar to given form schema.\n \n        Returns: List of similar patterns, sorted by similarity score.\n        &quot;&quot;&quot;\n        # Match by:\n        # 1. UI framework (exact match)\n        # 2. Field types (overlap)\n        # 3. Cascade patterns (structural similarity)\n \n        patterns = self.db.query(\n            framework=form_schema[&#039;ui_framework&#039;]\n        ).order_by(&#039;confidence DESC&#039;).limit(5)\n \n        return patterns\n4. Code Templates\nProven, tested code snippets for common patterns.\n# Ant-Design dropdown handler (tested on MCD Delhi)\nANT_DESIGN_SEARCHABLE_SELECT = &quot;&quot;&quot;\nasync def _fill_searchable_select(self, selector, value, field_name):\n    \\&quot;\\&quot;\\&quot;Fill Ant-Design searchable select dropdown.\\&quot;\\&quot;\\&quot;\n    element = self.page.locator(selector)\n    wrapper = element.locator(&quot;xpath=ancestor::div[contains(@class,&#039;ant-select&#039;)]&quot;).first\n \n    # Click to open dropdown\n    await wrapper.click(force=True)\n    await asyncio.sleep(0.8)\n \n    # Type to search\n    search_input = self.page.locator(&quot;.ant-select-selection-search-input&quot;).first\n    await search_input.fill(value)\n    await asyncio.sleep(0.5)\n \n    # Click matching option\n    option = self.page.locator(f&quot;.ant-select-item-option &gt;&gt; text={value}&quot;).first\n    await option.click()\n    await asyncio.sleep(0.5)\n \n    self.logger.info(f&quot;Selected &#039;{value}&#039; in {field_name}&quot;)\n\\&quot;\\&quot;\\&quot;\n \n# Select2 dropdown handler (tested on Smart Ranchi)\nSELECT2_DROPDOWN = &quot;&quot;&quot;\nasync def _fill_select2_dropdown(self, selector, value, field_name):\n    \\&quot;\\&quot;\\&quot;Fill jQuery Select2 dropdown.\\&quot;\\&quot;\\&quot;\n    # Open dropdown\n    await self.page.click(f&quot;{selector} + .select2-container&quot;)\n    await asyncio.sleep(0.5)\n \n    # Search for value\n    search = self.page.locator(&quot;.select2-search__field&quot;).first\n    await search.fill(value)\n    await asyncio.sleep(0.5)\n \n    # Select option\n    option = self.page.locator(f&quot;.select2-results__option &gt;&gt; text={value}&quot;).first\n    await option.click()\n    await asyncio.sleep(0.3)\n \n    self.logger.info(f&quot;Selected &#039;{value}&#039; in {field_name}&quot;)\n\\&quot;\\&quot;\\&quot;\n \n# Cascade handler template\nCASCADE_HANDLER = &quot;&quot;&quot;\nasync def _handle_cascade(self, parent_selector, child_selector, parent_value, child_value):\n    \\&quot;\\&quot;\\&quot;Handle cascading dropdown (parent triggers child options).\\&quot;\\&quot;\\&quot;\n    # Fill parent\n    await self._fill_dropdown(parent_selector, parent_value)\n \n    # Wait for child to load\n    await asyncio.sleep(1.0)\n \n    # Verify child has options\n    child_options = await self._get_dropdown_options(child_selector)\n    if not child_options or child_value not in child_options:\n        raise ValueError(f&quot;Child value &#039;{child_value}&#039; not available after selecting parent&quot;)\n \n    # Fill child\n    await self._fill_dropdown(child_selector, child_value)\n\\&quot;\\&quot;\\&quot;\n\nThe Discovery Process\nWhat Happens During Discovery\ngrivredr discover \\\n    --url &quot;smartranchi.in/Portal/View/ComplaintRegistration.aspx&quot; \\\n    --portal ranchi_smart \\\n    --state jharkhand \\\n    --district ranchi\nDetailed Breakdown\nStep 1: Page Load\n[1] Loading page...\n    - Open headless Chromium browser\n    - Navigate to URL\n    - Wait for network idle (all requests complete)\n    - Wait 2 seconds for JS to initialize\n\nStep 2: AI Analysis\n[2] AI analyzing form with Playwright tools...\n\n    AI Call 1: get_all_form_fields()\n    ‚Üí Returns: All form fields with types, selectors, labels\n\n    AI Call 2: get_dropdown_options(&quot;#problem_dropdown&quot;)\n    ‚Üí Returns: [&quot;Water Supply&quot;, &quot;Drainage&quot;, &quot;Road&quot;, ...]\n\n    AI Call 3: get_dropdown_options(&quot;#ward_dropdown&quot;)\n    ‚Üí Returns: [&quot;Ward 1&quot;, &quot;Ward 2&quot;, ..., &quot;Ward 55&quot;]\n\n    AI Call 4: select_dropdown_option(&quot;#zone&quot;, &quot;Central Zone&quot;)\n    ‚Üí Selects option to test cascading\n\n    AI Call 5: get_dropdown_options(&quot;#ward_dropdown&quot;)\n    ‚Üí Returns: Ward options for Central Zone (cascade loaded)\n\n    ... continues until all dropdowns explored ...\n\n    AI Call N: complete_discovery(full_structure)\n    ‚Üí AI provides complete form structure with all options\n\nStep 3: Context Saved\n[3] Saving context...\n\n    portals/jharkhand/ranchi/ranchi_smart/\n    ‚îú‚îÄ‚îÄ context/\n    ‚îÇ   ‚îú‚îÄ‚îÄ dropdowns.json     # All dropdown options with values\n    ‚îÇ   ‚îú‚îÄ‚îÄ cascades.json      # Cascade relationships\n    ‚îÇ   ‚îî‚îÄ‚îÄ field_mappings.json\n    ‚îú‚îÄ‚îÄ structure.json         # Full form structure\n    ‚îî‚îÄ‚îÄ metadata.json          # Training cost, timestamp\n\nStep 4: Code Generation (with Pattern Learning)\n[4] Generating scraper code...\n\n    - AI receives form structure + dropdown context\n    - Detects UI framework: Select2\n    - Queries pattern library for similar forms\n    - Finds: 3 successful Select2 patterns\n    - Uses proven Select2 template (95% confidence)\n    - Generates complete Python class\n    - Saves to scrapers/ranchi_smart/ranchi_smart_scraper.py\n\n\nThe Validation &amp; Self-Healing Loop\nWhy Validation Matters\nGenerated code might have issues:\n\nSelector slightly wrong\nNeed more wait time\nFramework-specific quirk not handled\nCascade timing issue\n\nThe Self-Healing Process\ngrivredr validate \\\n    --scraper scrapers/ranchi_smart/ranchi_smart_scraper.py \\\n    --state jharkhand --district ranchi --portal ranchi_smart \\\n    --max-attempts 3\nValidation Loop\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                  VALIDATION LOOP                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n  ‚îÇ   RUN    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  ERROR?  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   FIX    ‚îÇ\n  ‚îÇ SCRAPER  ‚îÇ     ‚îÇ          ‚îÇ     ‚îÇ   CODE   ‚îÇ\n  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n       ‚ñ≤                ‚îÇ                ‚îÇ\n       ‚îÇ                ‚îÇ No             ‚îÇ\n       ‚îÇ                ‚ñº                ‚îÇ\n       ‚îÇ           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ\n       ‚îÇ           ‚îÇ SUCCESS! ‚îÇ          ‚îÇ\n       ‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ\n       ‚îÇ                ‚îÇ                ‚îÇ\n       ‚îÇ                ‚ñº                ‚îÇ\n       ‚îÇ           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ\n       ‚îÇ           ‚îÇ  STORE   ‚îÇ          ‚îÇ\n       ‚îÇ           ‚îÇ PATTERN  ‚îÇ          ‚îÇ\n       ‚îÇ           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ\n       ‚îÇ                                 ‚îÇ\n       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n              (retry with fixed code)\n\n\nPattern Learning System\nGrivredr automatically learns from successful scrapers to improve future generations.\nHow It Works\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    PATTERN LEARNING LOOP                         ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n     ‚îÇ DISCOVER ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ VALIDATE ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ  STORE   ‚îÇ\n     ‚îÇ  PORTAL  ‚îÇ      ‚îÇ SCRAPER  ‚îÇ      ‚îÇ PATTERN  ‚îÇ\n     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n          ‚ñ≤                                    ‚îÇ\n          ‚îÇ                                    ‚ñº\n     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n     ‚îÇ   USE    ‚îÇ ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÇ PATTERN  ‚îÇ\n     ‚îÇ PATTERNS ‚îÇ                        ‚îÇ LIBRARY  ‚îÇ\n     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nWhat Gets Learned\n\nCode Snippets: Working dropdown handlers, cascade patterns, validation triggers\nUI Framework Detection: Ant-Design, Select2, ASP.NET, Bootstrap patterns\nTiming Patterns: How long to wait for cascading dropdowns\nSuccess Rates: Which patterns work best for which form types\n\nPattern Library Components\nknowledge/pattern_library.py:\n\nSQLite storage for patterns\nOptional vector search for semantic similarity\nCode snippet extraction from working scrapers\nConfidence scoring based on validation success\n\nknowledge/code_templates.py:\n\nProven, tested code for each UI framework\nAnt-Design searchable select handler\nSelect2 jQuery dropdown handler\nASP.NET WebForms patterns\nCascade handling templates\n\nUsage in Code Generation\nWhen generating a new scraper:\n\nDetect UI Framework: Is this Ant-Design? Select2? ASP.NET?\nFind Similar Patterns: Search library for forms with similar field types\nInject Proven Templates: Use tested code instead of AI guessing\nGenerate with Context: AI knows what patterns work\n\nExample:\n# Code generation with pattern learning\nasync def generate_scraper(form_structure: dict) -&gt; str:\n    # 1. Detect framework\n    framework = detect_framework(form_structure)\n \n    # 2. Find similar patterns\n    similar = pattern_library.get_similar_patterns(form_structure)\n \n    # 3. Build prompt with proven patterns\n    prompt = f&quot;&quot;&quot;\n    Generate scraper for {framework} form.\n \n    Similar portals that worked:\n    {format_patterns(similar)}\n \n    Use these proven code snippets:\n    {get_templates_for_framework(framework)}\n \n    Form structure:\n    {json.dumps(form_structure)}\n    &quot;&quot;&quot;\n \n    # 4. AI generates with pattern context\n    code = await gemini.generate(prompt)\n    return code\nCLI Commands for Patterns\n# Show pattern library statistics\ngrivredr patterns\n \n# View patterns found similar to a new form\ngrivredr detect --url &quot;portal.example.com&quot;\n \n# Manually add a pattern (after validation)\ngrivredr store-pattern \\\n    --scraper scrapers/portal/scraper.py \\\n    --confidence 0.95\nWhen Patterns Are Stored\nPatterns are automatically stored when:\n\nValidation passes (scraper_validator.py)\nContinuous improvement succeeds (continuous_improvement_agent.py)\nDiscovery completes (hybrid_form_discovery.py)\n\nConfidence scores are calculated based on:\n\nNumber of validation attempts (fewer = higher confidence)\nSuccess rate during improvement\nCycles needed to reach target\n\nPattern Storage Schema\n# SQLite table: patterns\n{\n    &quot;id&quot;: &quot;uuid&quot;,\n    &quot;portal_url&quot;: &quot;smartranchi.in/...&quot;,\n    &quot;state&quot;: &quot;jharkhand&quot;,\n    &quot;district&quot;: &quot;ranchi&quot;,\n    &quot;portal_name&quot;: &quot;ranchi_smart&quot;,\n \n    # Form characteristics\n    &quot;ui_framework&quot;: &quot;select2&quot;,\n    &quot;field_count&quot;: 12,\n    &quot;field_types&quot;: [&quot;text&quot;, &quot;searchable_select&quot;, &quot;textarea&quot;, &quot;file&quot;],\n    &quot;has_cascades&quot;: true,\n    &quot;cascade_count&quot;: 2,\n \n    # Code snippets\n    &quot;full_code&quot;: &quot;...&quot;,  # Complete scraper\n    &quot;dropdown_handler&quot;: &quot;...&quot;,  # Extracted snippet\n    &quot;cascade_handler&quot;: &quot;...&quot;,  # Extracted snippet\n \n    # Success metrics\n    &quot;confidence&quot;: 0.95,\n    &quot;validation_attempts&quot;: 1,\n    &quot;success_rate&quot;: 1.0,\n \n    &quot;created_at&quot;: timestamp,\n    &quot;last_used_at&quot;: timestamp,\n    &quot;usage_count&quot;: 5\n}\nBenefits of Pattern Learning\n\nFaster Generation: Reuse proven code, less guesswork\nHigher Success Rate: Patterns have proven to work\nReduced Costs: Fewer AI calls for similar forms\nBetter Reliability: Tested patterns are more robust\nContinuous Improvement: System gets smarter over time\n\n\nDirectory Structure\nPortal Data Organization\nportals/\n‚îî‚îÄ‚îÄ {state}/                    # e.g., jharkhand, delhi\n    ‚îî‚îÄ‚îÄ {district}/             # e.g., ranchi, central_zone\n        ‚îî‚îÄ‚îÄ {portal_name}/      # e.g., ranchi_smart, mcd_delhi\n            ‚îÇ\n            ‚îú‚îÄ‚îÄ scraper.py      # Generated scraper code\n            ‚îÇ\n            ‚îú‚îÄ‚îÄ structure.json  # Discovered form structure\n            ‚îÇ   {\n            ‚îÇ     &quot;form_url&quot;: &quot;https://...&quot;,\n            ‚îÇ     &quot;form_title&quot;: &quot;Complaint Registration&quot;,\n            ‚îÇ     &quot;ui_framework&quot;: &quot;select2&quot;,\n            ‚îÇ     &quot;fields&quot;: [\n            ‚îÇ       {\n            ‚îÇ         &quot;name&quot;: &quot;Problem&quot;,\n            ‚îÇ         &quot;type&quot;: &quot;searchable_select&quot;,\n            ‚îÇ         &quot;selector&quot;: &quot;#problem_id&quot;,\n            ‚îÇ         &quot;required&quot;: true,\n            ‚îÇ         &quot;options&quot;: [&quot;Water Supply&quot;, &quot;Drainage&quot;, ...]\n            ‚îÇ       },\n            ‚îÇ       ...\n            ‚îÇ     ]\n            ‚îÇ   }\n            ‚îÇ\n            ‚îú‚îÄ‚îÄ context/        # Dropdown context (critical!)\n            ‚îÇ   ‚îÇ\n            ‚îÇ   ‚îú‚îÄ‚îÄ dropdowns.json\n            ‚îÇ   ‚îÇ   {\n            ‚îÇ   ‚îÇ     &quot;Problem&quot;: {\n            ‚îÇ   ‚îÇ       &quot;selector&quot;: &quot;#problem_id&quot;,\n            ‚îÇ   ‚îÇ       &quot;options&quot;: {\n            ‚îÇ   ‚îÇ         &quot;Water Supply&quot;: &quot;1&quot;,\n            ‚îÇ   ‚îÇ         &quot;Drainage&quot;: &quot;2&quot;\n            ‚îÇ   ‚îÇ       }\n            ‚îÇ   ‚îÇ     }\n            ‚îÇ   ‚îÇ   }\n            ‚îÇ   ‚îÇ\n            ‚îÇ   ‚îú‚îÄ‚îÄ cascades.json\n            ‚îÇ   ‚îÇ   {\n            ‚îÇ   ‚îÇ     &quot;Zone_to_Ward&quot;: {\n            ‚îÇ   ‚îÇ       &quot;parent&quot;: &quot;#zone_id&quot;,\n            ‚îÇ   ‚îÇ       &quot;child&quot;: &quot;#ward_id&quot;\n            ‚îÇ   ‚îÇ     }\n            ‚îÇ   ‚îÇ   }\n            ‚îÇ   ‚îÇ\n            ‚îÇ   ‚îî‚îÄ‚îÄ field_mappings.json\n            ‚îÇ\n            ‚îî‚îÄ‚îÄ metadata.json   # Training info\n                {\n                  &quot;created_at&quot;: &quot;2024-12-27T22:33:00&quot;,\n                  &quot;training_cost&quot;: 0.29,\n                  &quot;api_calls&quot;: 10,\n                  &quot;ui_framework&quot;: &quot;select2&quot;,\n                  &quot;pattern_confidence&quot;: 0.95,\n                  &quot;patterns_used&quot;: [&quot;pattern_uuid_1&quot;, &quot;pattern_uuid_2&quot;]\n                }\n\n\nCLI Commands\nMain Commands\n# 1. DISCOVER - Generate scraper for a new portal\ngrivredr discover \\\n    --url &quot;portal.example.com/form&quot; \\\n    --portal portal_name \\\n    --state state_name \\\n    --district district_name \\\n    [--visible]  # Show browser window\n \n# 2. TEST - Dry-run test (fill form, don&#039;t submit)\ngrivredr test \\\n    --scraper scrapers/portal_name/scraper.py \\\n    --state state_name \\\n    --district district_name \\\n    --portal portal_name \\\n    [--visible]\n \n# 3. VALIDATE - Self-healing validation loop\ngrivredr validate \\\n    --scraper scrapers/portal_name/scraper.py \\\n    --max-attempts 3 \\\n    [--submit]   # Actually submit form (not dry-run)\n \n# 4. IMPROVE - Continuous improvement\ngrivredr improve \\\n    --scraper scrapers/portal_name/scraper.py \\\n    --target 90           # 90% success rate target\n    --max-cycles 5\n \n# 5. LIST - Show all portals\ngrivredr list \\\n    [--state state_name]\n \n# 6. DETECT - Detect UI framework\ngrivredr detect \\\n    --url &quot;portal.example.com&quot;\n \n# 7. PATTERNS - View pattern library\ngrivredr patterns \\\n    [--framework select2]  # Filter by framework\n    [--top 10]             # Top N by confidence\n \n# 8. STORE-PATTERN - Manually store pattern\ngrivredr store-pattern \\\n    --scraper scrapers/portal/scraper.py \\\n    --confidence 0.95\n\nCost Tracking\nTypical Costs\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nOperationAI CallsTypical CostWith Pattern LearningDiscovery (simple form)8-12$0.15-0.25$0.10-0.20 (20% ‚Üì)Discovery (complex form)15-25$0.30-0.70$0.20-0.50 (30% ‚Üì)Code generation1$0.05-0.10$0.03-0.07 (40% ‚Üì)Validation (per attempt)1-2$0.01-0.05$0.01-0.03 (20% ‚Üì)Self-healing fix1$0.05-0.15$0.03-0.10 (30% ‚Üì)\nCost Reduction from Pattern Learning:\n\nFirst portal (no patterns): $0.50\n10th similar portal (with patterns): $0.30 (40% reduction)\n100th portal: $0.20 (60% reduction)\n\n\nIntegration with Darshi\nUse Cases\n1. Unified Grievance Filing\nScenario: User reports pothole via Darshi\nUser fills Darshi form:\n‚îú‚îÄ Issue: Pothole\n‚îú‚îÄ Location: Koramangala, Bangalore\n‚îú‚îÄ Photo: [image]\n‚îî‚îÄ Description: &quot;Large pothole near mall&quot;\n\nDarshi Backend:\n1. Store in Darshi database (as usual)\n2. Identify responsible portal: BBMP grievance portal\n3. Check if Grivredr scraper exists\n   ‚Üí Yes: bbmp_bangalore scraper (95% confidence pattern)\n\n4. Call Grivredr scraper:\n   await bbmp_scraper.fill_and_submit({\n     &quot;category&quot;: &quot;Road Maintenance&quot;,\n     &quot;ward&quot;: &quot;98&quot;,\n     &quot;issue&quot;: &quot;Pothole&quot;,\n     &quot;description&quot;: &quot;...&quot;,\n     &quot;location&quot;: &quot;...&quot;,\n     &quot;photo&quot;: image_file\n   })\n\n5. Capture tracking ID from portal\n   ‚Üí Store in Darshi: external_tracking_id = &quot;BBMP/2024/12345&quot;\n\n6. Return to user:\n   &quot;‚úÖ Report filed successfully!\n    Darshi ID: #DR123456\n    BBMP ID: BBMP/2024/12345&quot;\n\n2. Multi-Portal Filing\nScenario: Issue requires filing to multiple agencies\nUser reports: &quot;Construction site causing noise and dust pollution&quot;\n\nDarshi identifies multiple agencies:\n‚îú‚îÄ Municipal Corp (illegal construction check)\n‚îú‚îÄ Pollution Control Board (noise/dust)\n‚îî‚îÄ Traffic Police (road congestion)\n\nFor each agency:\n1. Check if Grivredr scraper available\n2. File complaint automatically (using learned patterns)\n3. Track all IDs\n4. Show consolidated view to user\n\n3. Status Tracking\nScenario: User wants to check status of filed complaint\nDarshi stores:\n‚îú‚îÄ Internal report ID: DR123456\n‚îî‚îÄ External tracking ID: BBMP/2024/12345\n\nUser clicks &quot;Check Status&quot;:\n\nDarshi calls Grivredr status checker:\nawait bbmp_scraper.check_status(&quot;BBMP/2024/12345&quot;)\n\nReturns:\n{\n  &quot;status&quot;: &quot;In Progress&quot;,\n  &quot;last_updated&quot;: &quot;2024-12-20&quot;,\n  &quot;assigned_to&quot;: &quot;Ward Engineer, Ward 98&quot;,\n  &quot;remarks&quot;: &quot;Site inspection scheduled for Dec 25&quot;\n}\n\nDarshi shows:\n&quot;üìä Status Update\n Your report (BBMP/2024/12345) is in progress.\n Inspection scheduled for Dec 25.\n Assigned to: Ward Engineer, Ward 98&quot;\n\nIntegration Architecture\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                      DARSHI CORE                             ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  User submits report ‚Üí Darshi processes ‚Üí Stores in DB      ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                  ‚îÇ  Portal Router ‚îÇ  (Which portal to file to?)\n                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                      GRIVREDR SERVICE                        ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  API Endpoints:                                              ‚îÇ\n‚îÇ  ‚Ä¢ POST /grivredr/file                                       ‚îÇ\n‚îÇ    - Parameters: portal_id, complaint_data                   ‚îÇ\n‚îÇ    - Returns: tracking_id, success                           ‚îÇ\n‚îÇ                                                              ‚îÇ\n‚îÇ  ‚Ä¢ GET /grivredr/status/{portal_id}/{tracking_id}            ‚îÇ\n‚îÇ    - Returns: status, updates, remarks                       ‚îÇ\n‚îÇ                                                              ‚îÇ\n‚îÇ  ‚Ä¢ GET /grivredr/portals                                     ‚îÇ\n‚îÇ    - Returns: list of available portal scrapers              ‚îÇ\n‚îÇ                                                              ‚îÇ\n‚îÇ  ‚Ä¢ GET /grivredr/patterns                                    ‚îÇ\n‚îÇ    - Returns: pattern library statistics                     ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                  ‚îÇ  Scraper Registry  ‚îÇ\n                  ‚îÇ  + Pattern Library ‚îÇ\n                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n              ‚ñº            ‚ñº            ‚ñº\n         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n         ‚îÇ  BBMP  ‚îÇ   ‚îÇ  PMC   ‚îÇ   ‚îÇ Ranchi ‚îÇ\n         ‚îÇ Scraper‚îÇ   ‚îÇ Scraper‚îÇ   ‚îÇ Scraper‚îÇ\n         ‚îÇ (95%)  ‚îÇ   ‚îÇ (92%)  ‚îÇ   ‚îÇ (98%)  ‚îÇ\n         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n         % = pattern confidence\n\n\nMigration Path\nPhase 1: Standalone Development (6-8 weeks)\nGoals: Build Grivredr as independent tool\nTasks:\n\n Core discovery agent\n Scraper generation\n Validation &amp; self-healing\n Pattern library foundation\n CLI interface polishing\n Documentation\n Test on 20+ portals\n\nDeliverables:\n\nWorking Grivredr tool (CLI)\n20+ portal scrapers generated\nPattern library with initial patterns\n\nPhase 2: Pattern Learning Enhancement (3-4 weeks)\nGoals: Enhance pattern learning capabilities\nTasks:\n\n Vector search for semantic similarity\n Automatic snippet extraction\n Confidence scoring improvements\n Pattern effectiveness tracking\n Pattern visualization dashboard\n\nDeliverables:\n\nAdvanced pattern matching\nPattern library dashboard\n\nPhase 3: API Service (4-5 weeks)\nGoals: Convert to API service\nTasks:\n\n Build FastAPI service wrapper\n Scraper registry system\n File complaint API endpoint\n Check status API endpoint\n Portal list API endpoint\n Pattern library API endpoint\n Authentication &amp; rate limiting\n\nDeliverables:\n\nGrivredr API service\nAPI documentation\n\nPhase 4: Darshi Integration (3-4 weeks)\nGoals: Integrate with Darshi\nTasks:\n\n Portal identification logic (which portal for which location?)\n Complaint data mapping (Darshi ‚Üí portal format)\n External tracking ID storage\n Status checking integration\n UI changes (show portal filing status)\n\nDeliverables:\n\nSeamless Darshi ‚Üí Grivredr ‚Üí Portal flow\nPattern-based portal suggestions\n\nPhase 5: Scale (Ongoing)\nGoals: 100+ portals, continuous learning\nTasks:\n\n Generate scrapers for top 50 cities\n Monitor scraper health (detect breakage)\n Auto-healing when portals change\n Portal coverage dashboard\n Pattern effectiveness analytics\n Continuous pattern refinement\n\n\nChallenges &amp; Mitigations\n1. Portal Changes\nChallenge: Portals change without notice, scrapers break.\nMitigations:\n\nHealth monitoring (daily tests)\nAuto-detection of breakage\nSelf-healing: Re-run discovery when scraper fails\nPattern library: Quickly regenerate with proven patterns\nGraceful degradation: Fall back to manual filing instructions\n\n2. CAPTCHA\nChallenge: Many portals have CAPTCHA.\nMitigations:\n\nHuman-in-the-loop for CAPTCHA solving\nCAPTCHA solving services (2Captcha, Anti-Captcha)\nAlternative: Generate direct link for user to complete\n\n3. Authentication\nChallenge: Some portals require login.\nMitigations:\n\nSupport for credential storage (encrypted)\nOAuth integration where available\nUser provides credentials once, stored securely\n\n4. Complex Multi-Step Forms\nChallenge: Forms with multiple pages.\nMitigations:\n\nDiscovery agent handles multi-step\nStore intermediate state\nValidation at each step\nPattern library includes multi-step patterns\n\n5. File Upload Validation\nChallenge: Strict file size/format requirements.\nMitigations:\n\nParse requirements during discovery\nPre-validate files before submission\nAuto-resize images if needed\nPattern library includes upload patterns\n\n6. Pattern Drift\nChallenge: Patterns become outdated as portals evolve.\nMitigations:\n\nTrack pattern age and usage\nMonitor pattern success rates\nAuto-deprecate low-performing patterns\nPeriodic pattern review and refresh\n\n\nSuccess Metrics\nCoverage\n\nNumber of portals with working scrapers (target: 100+)\nGeographic coverage (% of Indian cities)\nPattern library size (target: 500+ patterns)\n\nReliability\n\nScraper success rate (target: &gt;95%)\nAverage time to detect + fix breakage (target: &lt;24h)\nPattern match rate (% of new portals matched to patterns)\n\nEfficiency\n\nAverage discovery time (target: &lt;5 min)\nCost per portal (target: &lt;$0.50)\nCost reduction from patterns (target: &gt;40%)\n\nLearning\n\nPattern reuse rate (% of scrapers using patterns)\nPattern confidence improvement over time\nPattern library growth rate\n\nIntegration\n\n% of Darshi reports auto-filed to portals (target: 50%+)\nUser satisfaction with auto-filing\nReduction in manual filing time\n\n\nConclusion\nGrivredr transforms portal integration from a manual, time-consuming process to an automated, self-healing, continuously learning system. By combining:\n\nAI-powered discovery (understands any form)\nAutomated code generation (proven patterns)\nSelf-healing validation (fixes itself)\nPattern learning (gets smarter over time)\nContinuous improvement (adapts to changes)\n\nWe enable Darshi to integrate with 100+ government portals at scale, providing citizens with truly unified grievance filing across all jurisdictions. The pattern learning system ensures that each successful scraper makes future integrations faster, more reliable, and more cost-effective.\n\nDocument Version: 1.0\nLast Updated: December 2024\nPart of: Darshi Civic Suite"},"misc/future/nagar-alert-hub":{"slug":"misc/future/nagar-alert-hub","filePath":"misc/future/nagar-alert-hub.md","title":"nagar-alert-hub","links":[],"tags":[],"content":"Nagar Alert Hub Integration\n\nCommunity-Integrated Public Disruption Intelligence for Tier-2 &amp; Tier-3 Cities\n\nThis document outlines the integration strategy for evolving Darshi into a comprehensive city intelligence platform by incorporating Nagar Alert Hub capabilities.\n\nTable of Contents\n\nExecutive Summary\nProblem Statement\nSolution Overview\nCore Synergy\nArchitecture\nData Model\nWhatsApp Integration\nAuthority Integration\nIntelligence Layer\nUser Interface\nAgent Workflows\nMultilingual Support\nMigration Path\nChallenges &amp; Mitigations\nTech Stack\n\n\nExecutive Summary\nDarshi currently handles civic issue reporting (potholes, garbage, streetlights) with AI-powered verification. Nagar Alert Hub extends this to real-time community alerts delivered via WhatsApp, creating a unified platform for both static infrastructure issues and dynamic city disruptions.\nValue Proposition: The only system that catches infrastructure issues AND real-time disruptions, works through WhatsApp (no app download), has AI verification (no misinformation), connects citizens AND authorities, and learns and predicts city patterns.\n\nProblem Statement\nCurrent Challenges in Tier-2/3 Cities\n\nFrequent Disruptions: Road closures, power cuts, traffic jams, water issues, festival crowds, market congestion, school bus delays, safety incidents\nNo Unified System: No real-time method to inform residents quickly and reliably\nInformation Chaos: People depend on scattered WhatsApp forwards, informal groups, local pages, and hearsay\nDelayed Awareness: Residents learn updates too late ‚Üí blocked routes, unavailable services, overcrowded markets, escalated emergencies\nAuthority Communication Gap: Existing civic apps fail due to low adoption; authorities struggle to broadcast verified alerts\n\nWhat Darshi Currently Solves\n\nInfrastructure issue reporting with photo evidence\nAI-powered verification and categorization\nDuplicate detection via image hash and geolocation\nAdmin dashboard for issue tracking\nHotspot detection for problem clusters\n\nWhat‚Äôs Missing\n\nReal-time dynamic event handling\nWhatsApp-based communication (no app download required)\nAuthority broadcast integration\nPredictive intelligence\nTwo-way citizen-authority communication\n\n\nSolution Overview\nIntegrated Platform Capabilities\n\n\nWhatsApp-Based Alert Engine\n\nDelivers all city updates directly to users\nAuthorities push verified alerts\nAI cleans, standardizes, and summarizes messages across multiple languages\n\n\n\nGeo-Verified Citizen Reporting\n\nUsers submit photos/videos with location via WhatsApp or web\nAI identifies disruption type, validates authenticity\nMerges duplicate reports automatically\n\n\n\nReal-Time Web Dashboard\n\nMobile-friendly, no app required\nLive disruptions: power outages, blocked roads, traffic, accidents, water issues\nAuto-refreshing map with color-coded pins\n\n\n\nPredictive Intelligence\n\nDetects emerging issues early\nRecommends alternate routes or timings\nSends personalized location-based alerts based on user movement patterns\n\n\n\n\nCore Synergy\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDarshi (Current)Nagar Alert Hub (New)Static infrastructure issues (potholes, garbage)Dynamic disruptions (traffic, power cuts, crowds)Web-based submissionWhatsApp-based interactionIndividual report trackingCommunity-wide broadcastingAdmin-managed resolutionAuthority + AI-driven alertsReactive reportingProactive predictionsSingle-city focusMulti-city scalable\nUnified Value\n\nCitizens: One source of truth for all city happenings\nAuthorities: Direct channel to reach citizens with verified information\nCity: Reduced chaos, faster response, data-driven planning\n\n\nArchitecture\nHigh-Level System Architecture\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                        DATA SOURCES                              ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Web App     WhatsApp    Authority    External APIs   Sensors   ‚îÇ\n‚îÇ  (Darshi)    Messages    Broadcasts   (Traffic/Power) (Future)  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n       ‚îÇ            ‚îÇ          ‚îÇ            ‚îÇ            ‚îÇ\n       ‚ñº            ‚ñº          ‚ñº            ‚ñº            ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    INGESTION LAYER                               ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Message Parser ‚îÇ Image Processor ‚îÇ Location Extractor ‚îÇ Dedup  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    AI PROCESSING LAYER                           ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Gemini Multimodal Analysis                                      ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Event Classification (type, severity, affected area)       ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Authenticity Validation (real? current? location match?)   ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Language Processing (Hindi, regional, code-mixed)          ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Duplicate/Cluster Detection                                ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Vertex AI Models                                                ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Event Clustering &amp; Correlation                             ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Pattern Recognition                                        ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Predictive Alerts                                          ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DATA LAYER                                    ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Firestore (Real-time)           ‚îÇ  BigQuery (Analytics)        ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Reports/Events              ‚îÇ  ‚îú‚îÄ‚îÄ Historical patterns     ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ User subscriptions          ‚îÇ  ‚îú‚îÄ‚îÄ Hotspot analysis        ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Authority accounts          ‚îÇ  ‚îú‚îÄ‚îÄ Prediction models       ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ Alert queue                 ‚îÇ  ‚îî‚îÄ‚îÄ City insights           ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                               ‚îÇ\n                               ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    OUTPUT LAYER                                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  WhatsApp        Web Dashboard    Authority        Push          ‚îÇ\n‚îÇ  Broadcasts      (Real-time Map)  Notifications   Notifications  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nComponent Breakdown\n1. Ingestion Layer\n\nWeb Submissions: Existing Darshi flow (multipart form upload)\nWhatsApp Gateway: WhatsApp Business API integration\nAuthority Portal: Authenticated broadcast interface\nExternal APIs: Traffic data, power grid status (future)\n\n2. AI Processing Layer\n\nGemini Multimodal: Image/video analysis, text understanding\nVertex AI: Classification models, clustering, predictions\nLanguage Models: Multilingual processing, transliteration\n\n3. Data Layer\n\nFirestore: Real-time event storage, user data, subscriptions\nBigQuery: Historical analysis, pattern detection, reporting\n\n4. Output Layer\n\nWhatsApp: Personalized and broadcast alerts\nWeb Dashboard: Real-time map, filters, search\nAuthority Dashboard: Management, broadcasting, analytics\n\n\nData Model\nExtended Report Schema\n{\n    # === EXISTING DARSHI FIELDS ===\n    &quot;id&quot;: &quot;uuid&quot;,\n    &quot;title&quot;: &quot;string&quot;,\n    &quot;description&quot;: &quot;string&quot;,\n    &quot;category&quot;: &quot;pothole|garbage|streetlight|...&quot;,\n    &quot;latitude&quot;: float,\n    &quot;longitude&quot;: float,\n    &quot;geohash&quot;: &quot;string&quot;,  # Precision 5\n    &quot;image_url&quot;: &quot;string&quot;,\n    &quot;image_hash&quot;: &quot;sha256&quot;,\n    &quot;status&quot;: &quot;PENDING_VERIFICATION|VERIFIED|REJECTED|...&quot;,\n    &quot;severity&quot;: 1-10,\n    &quot;user_id&quot;: &quot;string&quot;,\n    &quot;created_at&quot;: timestamp,\n    &quot;updated_at&quot;: timestamp,\n    &quot;timeline&quot;: [...],\n    &quot;upvotes&quot;: int,\n    &quot;upvoters&quot;: [...],\n \n    # === NEW: EVENT CHARACTERISTICS ===\n    &quot;event_type&quot;: &quot;infrastructure|disruption|community|safety&quot;,\n    &quot;is_dynamic&quot;: bool,  # Does this resolve on its own?\n    &quot;expected_duration_minutes&quot;: int | null,\n    &quot;affected_radius_meters&quot;: int,  # Impact zone\n \n    # === NEW: SOURCE TRACKING ===\n    &quot;source&quot;: &quot;web|whatsapp|authority|automated|external_api&quot;,\n    &quot;source_message_id&quot;: &quot;string | null&quot;,  # WhatsApp message ID\n    &quot;authority_verified&quot;: bool,\n    &quot;authority_id&quot;: &quot;string | null&quot;,\n    &quot;authority_note&quot;: &quot;string | null&quot;,\n \n    # === NEW: TEMPORAL RELEVANCE ===\n    &quot;valid_until&quot;: timestamp | null,  # When alert expires\n    &quot;last_confirmed&quot;: timestamp,  # Last citizen confirmation\n    &quot;confirmation_count&quot;: int,  # How many people confirmed still active\n    &quot;auto_expire&quot;: bool,  # Should system auto-resolve?\n \n    # === NEW: CLUSTERING ===\n    &quot;cluster_id&quot;: &quot;uuid | null&quot;,\n    &quot;is_cluster_primary&quot;: bool,  # Is this the main report in cluster?\n    &quot;related_report_ids&quot;: [...],\n \n    # === NEW: RESOLUTION ===\n    &quot;resolution_source&quot;: &quot;authority|timeout|citizen_confirmed|auto&quot;,\n    &quot;resolution_eta&quot;: timestamp | null,\n    &quot;resolution_note&quot;: &quot;string | null&quot;\n}\nNew Collections\nUser Subscriptions\n# Collection: user_subscriptions\n{\n    &quot;user_id&quot;: &quot;string&quot;,\n    &quot;phone_number&quot;: &quot;string&quot;,  # For WhatsApp\n    &quot;whatsapp_opted_in&quot;: bool,\n    &quot;preferred_language&quot;: &quot;en|hi|...&quot;,\n \n    # Location-based subscriptions\n    &quot;home_location&quot;: {&quot;lat&quot;: float, &quot;lng&quot;: float, &quot;geohash&quot;: &quot;string&quot;},\n    &quot;work_location&quot;: {&quot;lat&quot;: float, &quot;lng&quot;: float, &quot;geohash&quot;: &quot;string&quot;},\n    &quot;custom_locations&quot;: [...],\n    &quot;subscription_radius_km&quot;: float,\n \n    # Alert preferences\n    &quot;alert_types&quot;: [&quot;traffic&quot;, &quot;power&quot;, &quot;water&quot;, &quot;safety&quot;, &quot;events&quot;],\n    &quot;severity_threshold&quot;: 1-10,  # Only alert if severity &gt;= threshold\n    &quot;quiet_hours&quot;: {&quot;start&quot;: &quot;22:00&quot;, &quot;end&quot;: &quot;07:00&quot;},\n \n    &quot;created_at&quot;: timestamp,\n    &quot;updated_at&quot;: timestamp\n}\nAuthority Accounts\n# Collection: authorities\n{\n    &quot;id&quot;: &quot;string&quot;,\n    &quot;name&quot;: &quot;Traffic Police - Pune&quot;,\n    &quot;type&quot;: &quot;traffic|power|water|municipal|police|admin&quot;,\n    &quot;jurisdiction_geohashes&quot;: [...],  # Areas they manage\n    &quot;contact_email&quot;: &quot;string&quot;,\n    &quot;contact_phone&quot;: &quot;string&quot;,\n    &quot;api_key&quot;: &quot;string&quot;,  # For programmatic access\n    &quot;broadcast_permissions&quot;: [&quot;traffic&quot;, &quot;safety&quot;, &quot;events&quot;],\n    &quot;verified&quot;: bool,\n    &quot;created_at&quot;: timestamp\n}\nAlert Queue\n# Collection: alert_queue\n{\n    &quot;id&quot;: &quot;string&quot;,\n    &quot;report_id&quot;: &quot;string&quot;,  # Related report\n    &quot;alert_type&quot;: &quot;broadcast|targeted|escalation&quot;,\n    &quot;target_geohashes&quot;: [...],\n    &quot;target_user_ids&quot;: [...],  # For targeted alerts\n    &quot;message_template&quot;: &quot;string&quot;,\n    &quot;language_variants&quot;: {\n        &quot;en&quot;: &quot;Traffic jam on MG Road...&quot;,\n        &quot;hi&quot;: &quot;‡§è‡§Æ‡§ú‡•Ä ‡§∞‡•ã‡§° ‡§™‡§∞ ‡§ü‡•ç‡§∞‡•à‡§´‡§ø‡§ï ‡§ú‡§æ‡§Æ...&quot;\n    },\n    &quot;priority&quot;: &quot;low|medium|high|critical&quot;,\n    &quot;status&quot;: &quot;pending|sending|sent|failed&quot;,\n    &quot;scheduled_at&quot;: timestamp,\n    &quot;sent_at&quot;: timestamp | null,\n    &quot;delivery_stats&quot;: {\n        &quot;total&quot;: int,\n        &quot;delivered&quot;: int,\n        &quot;read&quot;: int,\n        &quot;failed&quot;: int\n    }\n}\nExtended Category Taxonomy\nCATEGORIES = {\n    # Infrastructure (Existing Darshi)\n    &quot;infrastructure&quot;: [\n        &quot;pothole&quot;,\n        &quot;garbage&quot;,\n        &quot;streetlight&quot;,\n        &quot;drainage&quot;,\n        &quot;road_damage&quot;,\n        &quot;footpath&quot;,\n        &quot;public_toilet&quot;,\n        &quot;park_maintenance&quot;\n    ],\n \n    # Dynamic Disruptions (New)\n    &quot;disruption&quot;: [\n        &quot;traffic_congestion&quot;,\n        &quot;traffic_accident&quot;,\n        &quot;road_closure&quot;,\n        &quot;road_construction&quot;,\n        &quot;power_outage&quot;,\n        &quot;water_supply&quot;,\n        &quot;flooding&quot;,\n        &quot;waterlogging&quot;,\n        &quot;gas_leak&quot;\n    ],\n \n    # Community Events (New)\n    &quot;community&quot;: [\n        &quot;festival&quot;,\n        &quot;rally_protest&quot;,\n        &quot;market_congestion&quot;,\n        &quot;vip_movement&quot;,\n        &quot;sports_event&quot;,\n        &quot;religious_gathering&quot;,\n        &quot;school_traffic&quot;,\n        &quot;wedding_baraat&quot;\n    ],\n \n    # Safety Alerts (New)\n    &quot;safety&quot;: [\n        &quot;fire&quot;,\n        &quot;building_collapse&quot;,\n        &quot;crime_alert&quot;,\n        &quot;medical_emergency&quot;,\n        &quot;animal_sighting&quot;,  # Stray dogs, snakes, etc.\n        &quot;suspicious_activity&quot;\n    ]\n}\n\nWhatsApp Integration\nArchitecture\nUser sends WhatsApp message (text/photo/video/location)\n                    ‚îÇ\n                    ‚ñº\n         WhatsApp Business API\n         (Cloud API / On-Premise)\n                    ‚îÇ\n                    ‚ñº\n         Webhook Receiver (FastAPI)\n                    ‚îÇ\n                    ‚ñº\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ     Message Type Router       ‚îÇ\n    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n    ‚îÇ Text ‚Üí Intent Classification  ‚îÇ\n    ‚îÇ Image ‚Üí Gemini Analysis       ‚îÇ\n    ‚îÇ Video ‚Üí Frame Extraction + AI ‚îÇ\n    ‚îÇ Location ‚Üí Geohash Encoding   ‚îÇ\n    ‚îÇ Contact ‚Üí Subscription Mgmt   ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                    ‚îÇ\n                    ‚ñº\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ      AI Processing            ‚îÇ\n    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n    ‚îÇ ‚Ä¢ Extract/validate location   ‚îÇ\n    ‚îÇ ‚Ä¢ Classify event type         ‚îÇ\n    ‚îÇ ‚Ä¢ Assess severity             ‚îÇ\n    ‚îÇ ‚Ä¢ Check for duplicates        ‚îÇ\n    ‚îÇ ‚Ä¢ Validate authenticity       ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                    ‚îÇ\n                    ‚ñº\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ      Response Generator       ‚îÇ\n    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n    ‚îÇ ‚Ä¢ Acknowledgment message      ‚îÇ\n    ‚îÇ ‚Ä¢ Clarification questions     ‚îÇ\n    ‚îÇ ‚Ä¢ Status update               ‚îÇ\n    ‚îÇ ‚Ä¢ Related alerts              ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nInbound Message Flows\n1. Report Submission\nUser: &quot;Traffic jam near City Mall&quot; + üì∑ photo\n\nSystem:\n1. Parse text ‚Üí Extract keywords (traffic, City Mall)\n2. Analyze photo ‚Üí Confirm traffic congestion\n3. Extract location ‚Üí From photo EXIF or text geocoding\n4. Check duplicates ‚Üí Similar reports in area?\n5. Create report ‚Üí Store in Firestore\n6. Respond ‚Üí &quot;Thanks! Traffic congestion reported near City Mall.\n              We&#039;ll alert others in the area. Report ID: #12345&quot;\n\n2. Status Query\nUser: &quot;What&#039;s happening near Gandhi Chowk?&quot;\n\nSystem:\n1. Extract location ‚Üí Gandhi Chowk coordinates\n2. Query active events ‚Üí Within 2km radius\n3. Summarize ‚Üí Group by type, sort by severity\n4. Respond ‚Üí &quot;üö¶ Active near Gandhi Chowk:\n              ‚Ä¢ Traffic slow on MG Road (accident, clearing)\n              ‚Ä¢ Power out in Sector 5 (ETA: 30 mins)\n              ‚Ä¢ Festival crowd at Temple (until 10 PM)&quot;\n\n3. Route Query\nUser: &quot;Best route to railway station?&quot;\n\nSystem:\n1. Get user&#039;s current location (if shared)\n2. Query disruptions along common routes\n3. Calculate impact scores\n4. Respond ‚Üí &quot;üó∫Ô∏è Recommended: Via Ring Road\n              ‚ùå Avoid: MG Road (accident, 45 min delay)\n              ‚ùå Avoid: Station Road (waterlogging)&quot;\n\n4. Subscription Management\nUser: &quot;Alert me about power cuts in Sector 15&quot;\n\nSystem:\n1. Parse intent ‚Üí Subscription request\n2. Extract: type=power, location=Sector 15\n3. Update user subscription\n4. Respond ‚Üí &quot;‚úÖ You&#039;ll receive power outage alerts for Sector 15.\n              Reply STOP to unsubscribe.&quot;\n\nOutbound Alert Types\n1. Broadcast Alerts (High Severity)\nüö® TRAFFIC ALERT - Pune\n\nMajor accident on Pune-Mumbai Expressway near Lonavala.\nHighway blocked, expect 2+ hour delays.\n\nüîÑ Alternatives:\n‚Ä¢ Old Mumbai Highway via Talegaon\n‚Ä¢ Delay travel if possible\n\nSource: Traffic Police (Verified)\nUpdated: 10:30 AM\n\nReply INFO for more details\n\n2. Targeted Alerts (Based on Subscription)\n‚ö° POWER ALERT - Your Area\n\nUnscheduled power cut in Sector 15, Pune.\nStarted: 2:30 PM\nExpected restoration: 4:00 PM\nReason: Transformer maintenance\n\nSource: MSEDCL (Verified)\n\nReply UPDATES for notifications when restored\n\n3. Predictive Alerts\nüìä PREDICTED - Tomorrow\n\nHeavy traffic expected near Shivaji Stadium tomorrow 5-8 PM.\nReason: IPL Match\n\nüí° Suggestions:\n‚Ä¢ Leave before 4 PM or after 9 PM\n‚Ä¢ Use Metro if traveling to FC Road area\n‚Ä¢ Parking limited, use public transport\n\nReply REMIND to get alert tomorrow at 3 PM\n\nWhatsApp Business API Setup\n# app/services/whatsapp_service.py\n \nclass WhatsAppService:\n    &quot;&quot;&quot;\n    Handles WhatsApp Business API integration.\n    Supports both Cloud API and On-Premise deployment.\n    &quot;&quot;&quot;\n \n    def __init__(self):\n        self.api_url = settings.WHATSAPP_API_URL\n        self.access_token = settings.WHATSAPP_ACCESS_TOKEN\n        self.phone_number_id = settings.WHATSAPP_PHONE_NUMBER_ID\n \n    async def send_message(\n        self,\n        to: str,\n        message: str,\n        template: str = None,\n        language: str = &quot;en&quot;\n    ) -&gt; dict:\n        &quot;&quot;&quot;Send a WhatsApp message to a user.&quot;&quot;&quot;\n        pass\n \n    async def send_template(\n        self,\n        to: str,\n        template_name: str,\n        parameters: list,\n        language: str = &quot;en&quot;\n    ) -&gt; dict:\n        &quot;&quot;&quot;Send a pre-approved template message.&quot;&quot;&quot;\n        pass\n \n    async def send_broadcast(\n        self,\n        user_ids: list[str],\n        message: str,\n        priority: str = &quot;normal&quot;\n    ) -&gt; dict:\n        &quot;&quot;&quot;Send message to multiple users.&quot;&quot;&quot;\n        pass\n \n    async def process_webhook(self, payload: dict) -&gt; dict:\n        &quot;&quot;&quot;Process incoming webhook from WhatsApp.&quot;&quot;&quot;\n        pass\n\nAuthority Integration\nAuthority Dashboard Features\n1. Alert Broadcasting\n\nCompose and send verified alerts\nSelect target area (draw on map or select geohashes)\nSet severity and duration\nMulti-language message composition\nSchedule future alerts\nTrack delivery and read rates\n\n2. Report Management\n\nView citizen reports in jurisdiction\nVerify/reject reports\nAdd official updates and ETAs\nMerge duplicate reports\nEscalate to other departments\n\n3. Situational Awareness\n\nReal-time map of all active issues\nCluster detection and trending\nHistorical comparison\nResponse time metrics\n\n4. Analytics\n\nReport volume by type, area, time\nResolution time tracking\nCitizen satisfaction (feedback)\nPrediction accuracy\n\nAuthority Types &amp; Permissions\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAuthority TypeCan BroadcastCan VerifyCan ResolveCategoriesTraffic PoliceYesYesYestraffic_*, road_closureElectricity BoardYesYesYespower_outageWater DepartmentYesYesYeswater_supplyMunicipal CorpYesYesYesinfrastructure, garbageDistrict AdminYesYesYesALLPoliceYesYesLimitedsafety_*\nAuthority API Endpoints\n# New endpoints for authority integration\n \n# Authority Authentication\nPOST /api/v1/authority/login\nPOST /api/v1/authority/register  # Requires admin approval\n \n# Broadcasting\nPOST /api/v1/authority/broadcast\nGET  /api/v1/authority/broadcasts  # History\nGET  /api/v1/authority/broadcast/{id}/stats\n \n# Report Management\nGET  /api/v1/authority/reports  # In jurisdiction\nPUT  /api/v1/authority/report/{id}/verify\nPUT  /api/v1/authority/report/{id}/update\nPUT  /api/v1/authority/report/{id}/resolve\n \n# Analytics\nGET  /api/v1/authority/analytics/overview\nGET  /api/v1/authority/analytics/response-times\nGET  /api/v1/authority/analytics/hotspots\nEscalation Flow\nCitizen Report (High Severity)\n         ‚îÇ\n         ‚ñº\n    AI Verification\n         ‚îÇ\n         ‚îú‚îÄ‚îÄ Severity &gt;= 8?\n         ‚îÇ        ‚îÇ\n         ‚îÇ        ‚ñº Yes\n         ‚îÇ   Auto-escalate to relevant authority\n         ‚îÇ        ‚îÇ\n         ‚îÇ        ‚ñº\n         ‚îÇ   Authority notified via:\n         ‚îÇ   ‚Ä¢ Dashboard alert\n         ‚îÇ   ‚Ä¢ Email notification\n         ‚îÇ   ‚Ä¢ WhatsApp (if configured)\n         ‚îÇ        ‚îÇ\n         ‚îÇ        ‚ñº\n         ‚îÇ   15 min timeout?\n         ‚îÇ        ‚îÇ\n         ‚îÇ        ‚ñº No response\n         ‚îÇ   Escalate to supervisor\n         ‚îÇ        ‚îÇ\n         ‚îÇ        ‚ñº\n         ‚îÇ   30 min timeout?\n         ‚îÇ        ‚îÇ\n         ‚îÇ        ‚ñº No response\n         ‚îÇ   Escalate to district admin\n         ‚îÇ\n         ‚îî‚îÄ‚îÄ Severity &lt; 8\n                  ‚îÇ\n                  ‚ñº\n             Normal queue\n\n\nIntelligence Layer\nPattern Detection (BigQuery)\nDaily Patterns\n-- Identify recurring traffic congestion patterns\nSELECT\n  EXTRACT(DAYOFWEEK FROM created_at) as day_of_week,\n  EXTRACT(HOUR FROM created_at) as hour,\n  geohash_prefix,\n  COUNT(*) as incident_count,\n  AVG(severity) as avg_severity\nFROM `darshi_analytics.events`\nWHERE\n  category LIKE &#039;traffic%&#039;\n  AND created_at &gt; TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 90 DAY)\nGROUP BY day_of_week, hour, geohash_prefix\nHAVING incident_count &gt;= 5\nORDER BY incident_count DESC\nCorrelation Analysis\n-- Find correlations (e.g., rain ‚Üí waterlogging ‚Üí traffic)\nSELECT\n  a.category as trigger_category,\n  b.category as result_category,\n  COUNT(*) as correlation_count,\n  AVG(TIMESTAMP_DIFF(b.created_at, a.created_at, MINUTE)) as avg_lag_minutes\nFROM `darshi_analytics.events` a\nJOIN `darshi_analytics.events` b\n  ON ST_DISTANCE(\n    ST_GEOGPOINT(a.longitude, a.latitude),\n    ST_GEOGPOINT(b.longitude, b.latitude)\n  ) &lt; 1000  -- Within 1km\n  AND b.created_at &gt; a.created_at\n  AND b.created_at &lt; TIMESTAMP_ADD(a.created_at, INTERVAL 2 HOUR)\nWHERE a.category != b.category\nGROUP BY trigger_category, result_category\nHAVING correlation_count &gt;= 10\nPredictive Alerts\nTypes of Predictions\n\n\nTime-Based\n\n‚ÄúSchool zone traffic at 8 AM and 2 PM‚Äù\n‚ÄúMarket congestion on Saturdays‚Äù\n‚ÄúTemple crowd on festival days‚Äù\n\n\n\nEvent-Based\n\n‚ÄúTraffic spike when cricket match ends‚Äù\n‚ÄúPower load increase during heat waves‚Äù\n‚ÄúWaterlogging when rainfall &gt; 50mm‚Äù\n\n\n\nCorrelation-Based\n\n‚ÄúAccident on highway ‚Üí traffic on alternate routes‚Äù\n‚ÄúPower outage in area A ‚Üí load increase in area B‚Äù\n\n\n\nPrediction Pipeline\nHistorical Data (BigQuery)\n         ‚îÇ\n         ‚ñº\nPattern Extraction\n‚îú‚îÄ‚îÄ Time series analysis\n‚îú‚îÄ‚îÄ Geospatial clustering\n‚îú‚îÄ‚îÄ Event correlation\n‚îî‚îÄ‚îÄ Seasonality detection\n         ‚îÇ\n         ‚ñº\nVertex AI Model Training\n‚îú‚îÄ‚îÄ Classification: What type of event?\n‚îú‚îÄ‚îÄ Regression: How severe?\n‚îú‚îÄ‚îÄ Time series: When will it happen?\n‚îî‚îÄ‚îÄ Clustering: What areas affected?\n         ‚îÇ\n         ‚ñº\nReal-time Triggers\n‚îú‚îÄ‚îÄ Calendar events (festivals, holidays)\n‚îú‚îÄ‚îÄ Weather forecasts\n‚îú‚îÄ‚îÄ Scheduled events (matches, rallies)\n‚îú‚îÄ‚îÄ Current conditions (ongoing incidents)\n         ‚îÇ\n         ‚ñº\nPrediction Generation\n         ‚îÇ\n         ‚ñº\nAlert if confidence &gt; threshold\n\nClustering Algorithm\ndef cluster_reports(reports: list, radius_meters: int = 500) -&gt; list:\n    &quot;&quot;&quot;\n    Cluster nearby reports of the same type.\n    Uses DBSCAN-like approach with geohash optimization.\n    &quot;&quot;&quot;\n    clusters = []\n \n    # Group by category first\n    by_category = group_by(reports, &#039;category&#039;)\n \n    for category, cat_reports in by_category.items():\n        # Use geohash for initial grouping (fast)\n        by_geohash = group_by(cat_reports, lambda r: r.geohash[:6])\n \n        for geohash, geo_reports in by_geohash.items():\n            # Fine-grained clustering within geohash\n            sub_clusters = dbscan(\n                geo_reports,\n                eps=radius_meters,\n                min_samples=2,\n                metric=haversine_distance\n            )\n \n            for cluster in sub_clusters:\n                # Create cluster record\n                primary = max(cluster, key=lambda r: r.upvotes + r.severity)\n                clusters.append({\n                    &#039;primary_report_id&#039;: primary.id,\n                    &#039;report_ids&#039;: [r.id for r in cluster],\n                    &#039;category&#039;: category,\n                    &#039;center&#039;: calculate_centroid(cluster),\n                    &#039;severity&#039;: max(r.severity for r in cluster),\n                    &#039;report_count&#039;: len(cluster),\n                    &#039;affected_radius&#039;: calculate_spread(cluster)\n                })\n \n    return clusters\n\nUser Interface\nReal-Time Map Dashboard\nFeatures\n\nLive Map: Color-coded pins by event type\nClustering: Grouped markers for dense areas\nFilters: Type, severity, time, source\nSearch: Address or landmark lookup\nLayers: Traffic, power grid, water zones\nAuto-refresh: Every 30 seconds\nOffline: Cached map tiles for poor connectivity\n\nColor Coding\nüî¥ Red     - Critical/Safety (accidents, fire, crime)\nüü† Orange  - High severity (major traffic, power outage)\nüü° Yellow  - Medium (congestion, water issues)\nüü¢ Green   - Low/Resolved\nüîµ Blue    - Community events (neutral)\n‚ö™ Gray    - Expired/Historical\n\nPin Interactions\nClick pin ‚Üí Show summary card\n‚îú‚îÄ‚îÄ Event type icon\n‚îú‚îÄ‚îÄ Title/description\n‚îú‚îÄ‚îÄ Severity badge\n‚îú‚îÄ‚îÄ Time ago\n‚îú‚îÄ‚îÄ Source (citizen/authority)\n‚îú‚îÄ‚îÄ Action buttons:\n‚îÇ   ‚îú‚îÄ‚îÄ &quot;Still happening&quot; (confirm)\n‚îÇ   ‚îú‚îÄ‚îÄ &quot;Resolved&quot; (report resolution)\n‚îÇ   ‚îú‚îÄ‚îÄ &quot;Share&quot; (WhatsApp/copy link)\n‚îÇ   ‚îî‚îÄ‚îÄ &quot;Navigate&quot; (open in maps)\n\nMobile PWA Enhancements\n\nAdd to Home Screen: Native app-like experience\nPush Notifications: Via service worker\nOffline Mode: View cached reports, queue submissions\nLocation Background: Track for relevant alerts (with permission)\nQuick Actions: Long-press for report, query, or share\n\nReport Submission Flow (Enhanced)\nStep 1: Capture\n‚îú‚îÄ‚îÄ Take photo/video\n‚îú‚îÄ‚îÄ Select from gallery\n‚îî‚îÄ‚îÄ Text-only report\n\nStep 2: Location\n‚îú‚îÄ‚îÄ Auto-detect GPS\n‚îú‚îÄ‚îÄ Pick on map\n‚îú‚îÄ‚îÄ Search address\n‚îî‚îÄ‚îÄ Share current location\n\nStep 3: Details\n‚îú‚îÄ‚îÄ AI auto-suggests:\n‚îÇ   ‚îú‚îÄ‚îÄ Category (from image)\n‚îÇ   ‚îú‚îÄ‚îÄ Severity (from image)\n‚îÇ   ‚îî‚îÄ‚îÄ Description (from image)\n‚îú‚îÄ‚îÄ User can edit/override\n‚îî‚îÄ‚îÄ Add additional notes\n\nStep 4: Submit\n‚îú‚îÄ‚îÄ Show preview\n‚îú‚îÄ‚îÄ Submit button\n‚îî‚îÄ‚îÄ Share to WhatsApp option\n\nStep 5: Confirmation\n‚îú‚îÄ‚îÄ Report ID\n‚îú‚îÄ‚îÄ Current status\n‚îú‚îÄ‚îÄ Expected processing time\n‚îî‚îÄ‚îÄ &quot;Subscribe to updates&quot; option\n\n\nAgent Workflows\nAlert Generation Agent\nname: alert_generation_agent\ntrigger:\n  - new_cluster_detected\n  - authority_broadcast\n  - severity_threshold_exceeded\n \nsteps:\n  1. analyze_event:\n      - Determine affected area (geohashes)\n      - Calculate impact radius\n      - Identify affected user segments\n \n  2. generate_content:\n      - Create alert title\n      - Write description (concise, actionable)\n      - Add relevant details (source, ETA, alternatives)\n      - Translate to supported languages\n \n  3. determine_recipients:\n      - Query subscribed users in affected area\n      - Filter by alert preferences\n      - Respect quiet hours\n \n  4. send_alerts:\n      - Queue WhatsApp messages\n      - Send push notifications\n      - Update dashboard\n \n  5. track_metrics:\n      - Log send attempts\n      - Track delivery status\n      - Monitor engagement\nEscalation Agent\nname: escalation_agent\ntrigger:\n  - high_severity_report (severity &gt;= 8)\n  - no_authority_response (timeout: 15min)\n  - cluster_size_exceeded (count &gt;= 5)\n \nsteps:\n  1. assess_situation:\n      - Compile all related reports\n      - Calculate aggregate severity\n      - Identify affected population\n \n  2. identify_authority:\n      - Match category to authority type\n      - Find authority for jurisdiction\n      - Check authority availability\n \n  3. prepare_escalation:\n      - Generate summary report\n      - Attach evidence (images, locations)\n      - Add citizen report count\n      - Include historical context\n \n  4. send_escalation:\n      - Notify via dashboard\n      - Send email\n      - Send WhatsApp (if configured)\n      - Log escalation event\n \n  5. monitor_response:\n      - Set response timeout (15min)\n      - If no response ‚Üí escalate to supervisor\n      - If supervisor timeout ‚Üí notify district admin\nResolution Agent\nname: resolution_agent\ntrigger:\n  - authority_marks_resolved\n  - auto_expire_timeout\n  - citizen_confirms_resolved (count &gt;= 3)\n \nsteps:\n  1. verify_resolution:\n      - Check resolution source\n      - For auto-expire: verify no recent confirmations\n      - For citizen: check confirmation count\n \n  2. update_status:\n      - Mark report as resolved\n      - Update cluster if applicable\n      - Record resolution details\n \n  3. notify_stakeholders:\n      - Alert users who reported/upvoted\n      - Message: &quot;Issue resolved&quot; + details\n      - Request feedback (optional)\n \n  4. archive_for_analysis:\n      - Calculate resolution time\n      - Log resolution path\n      - Update authority metrics\n      - Feed into pattern analysis\nDuplicate Detection Agent\nname: duplicate_detection_agent\ntrigger:\n  - new_report_created\n \nsteps:\n  1. exact_match_check:\n      - Compare image hash (SHA256)\n      - If match ‚Üí mark as duplicate immediately\n \n  2. proximity_check:\n      - Query reports in same geohash (precision 6)\n      - Filter by same category\n      - Filter by time window (24h for infrastructure, 2h for disruptions)\n \n  3. similarity_analysis:\n      - If candidates found:\n        - Compare descriptions (semantic similarity)\n        - Compare images (Gemini visual comparison)\n        - Calculate confidence score\n \n  4. decide_action:\n      - Confidence &gt; 90%: Auto-merge\n      - Confidence 70-90%: Link as related\n      - Confidence &lt; 70%: Keep separate\n \n  5. update_records:\n      - Add to cluster if merged\n      - Update confirmation count\n      - Notify original reporter (optional)\n\nMultilingual Support\nSupported Languages (Initial)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLanguageCodeScriptPriorityEnglishenLatinP0HindihiDevanagariP0MarathimrDevanagariP1TamiltaTamilP1TeluguteTeluguP1KannadaknKannadaP2BengalibnBengaliP2\nProcessing Pipeline\nInput (any language/script)\n         ‚îÇ\n         ‚ñº\nLanguage Detection (Gemini)\n         ‚îÇ\n         ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Structured Data ‚îÇ\n‚îÇ   Extraction    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n         ‚îÇ\n    Standardized JSON\n    (English keys, original values preserved)\n         ‚îÇ\n         ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ    Storage      ‚îÇ\n‚îÇ (Multilingual)  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n         ‚îÇ\n         ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ Output Generation‚îÇ\n‚îÇ (User&#039;s language)‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nCode-Mixed Text Handling\nCommon in India: ‚ÄúYahan pe bohot traffic hai near City Mall‚Äù\nasync def process_mixed_language_text(text: str) -&gt; dict:\n    &quot;&quot;&quot;\n    Process code-mixed text (Hindi-English common in India).\n    &quot;&quot;&quot;\n    prompt = &quot;&quot;&quot;\n    Analyze this message which may be in Hindi, English, or mixed.\n    Extract:\n    1. Event type (traffic, power, water, safety, infrastructure, community)\n    2. Location mentioned (if any)\n    3. Severity (1-10)\n    4. Key details\n \n    Respond in JSON format.\n \n    Message: {text}\n    &quot;&quot;&quot;\n \n    response = await gemini.generate(prompt.format(text=text))\n    return parse_json(response)\nAlert Templates (Multilingual)\nALERT_TEMPLATES = {\n    &quot;traffic_congestion&quot;: {\n        &quot;en&quot;: &quot;üö¶ TRAFFIC ALERT: Heavy traffic on {location}. Expect {delay} delay. Alternative: {alternative}&quot;,\n        &quot;hi&quot;: &quot;üö¶ ‡§ü‡•ç‡§∞‡•à‡§´‡§ø‡§ï ‡§Ö‡§≤‡§∞‡•ç‡§ü: {location} ‡§™‡§∞ ‡§≠‡§æ‡§∞‡•Ä ‡§ü‡•ç‡§∞‡•à‡§´‡§ø‡§ï‡•§ {delay} ‡§ï‡•Ä ‡§¶‡•á‡§∞‡•Ä‡•§ ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™: {alternative}&quot;,\n        &quot;mr&quot;: &quot;üö¶ ‡§ü‡•ç‡§∞‡•Ö‡§´‡§ø‡§ï ‡§Ö‡§≤‡§∞‡•ç‡§ü: {location} ‡§µ‡§∞ ‡§ú‡§æ‡§∏‡•ç‡§§ ‡§ü‡•ç‡§∞‡•Ö‡§´‡§ø‡§ï. {delay} ‡§â‡§∂‡•Ä‡§∞. ‡§™‡§∞‡•ç‡§Ø‡§æ‡§Ø: {alternative}&quot;\n    },\n    &quot;power_outage&quot;: {\n        &quot;en&quot;: &quot;‚ö° POWER ALERT: Outage in {location}. Expected restoration: {eta}. Reason: {reason}&quot;,\n        &quot;hi&quot;: &quot;‚ö° ‡§¨‡§ø‡§ú‡§≤‡•Ä ‡§Ö‡§≤‡§∞‡•ç‡§ü: {location} ‡§Æ‡•á‡§Ç ‡§¨‡§ø‡§ú‡§≤‡•Ä ‡§ó‡•Å‡§≤‡•§ ‡§¨‡§π‡§æ‡§≤‡•Ä: {eta}‡•§ ‡§ï‡§æ‡§∞‡§£: {reason}&quot;,\n        &quot;mr&quot;: &quot;‚ö° ‡§µ‡•Ä‡§ú ‡§Ö‡§≤‡§∞‡•ç‡§ü: {location} ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§µ‡•Ä‡§ú ‡§ó‡•á‡§≤‡•Ä. ‡§™‡•Å‡§®‡§∞‡•ç‡§∏‡•ç‡§•‡§æ‡§™‡§®‡§æ: {eta}. ‡§ï‡§æ‡§∞‡§£: {reason}&quot;\n    }\n}\n\nMigration Path\nPhase 1: Foundation (4-6 weeks)\nGoals: Extend Darshi data model, add real-time capabilities\nTasks:\n\n Extend report schema with new fields\n Add new event categories (disruptions, community, safety)\n Implement temporal validity (valid_until, auto_expire)\n Add clustering logic\n Create real-time map view with filters\n Set up BigQuery analytics pipeline\n\nDeliverables:\n\nExtended API supporting all event types\nReal-time dashboard with live map\nBasic clustering and duplicate detection\n\nPhase 2: WhatsApp Integration (6-8 weeks)\nGoals: Enable two-way WhatsApp communication\nTasks:\n\n Set up WhatsApp Business API account\n Implement webhook receiver for incoming messages\n Build message parsing and intent detection\n Integrate Gemini for message/image analysis\n Create outbound messaging service\n Implement user subscription management\n Design and approve message templates\n Build basic alert broadcasting\n\nDeliverables:\n\nCitizens can report via WhatsApp\nCitizens can query status via WhatsApp\nSystem can broadcast alerts to subscribed users\n\nPhase 3: Authority Layer (4-6 weeks)\nGoals: Enable authority verification and broadcasting\nTasks:\n\n Design authority dashboard UI\n Implement authority authentication\n Build broadcast composition interface\n Create verification workflow\n Implement escalation logic\n Add authority analytics\n Onboard pilot authorities (traffic police, electricity)\n\nDeliverables:\n\nAuthority dashboard for verification and broadcasting\nAutomated escalation pipeline\nAuthority performance metrics\n\nPhase 4: Intelligence (6-8 weeks)\nGoals: Add predictive capabilities\nTasks:\n\n Build pattern detection queries (BigQuery)\n Train Vertex AI classification models\n Implement prediction pipeline\n Create predictive alert system\n Add personalized recommendations\n Build correlation detection\n\nDeliverables:\n\nPredictive alerts for common patterns\nPersonalized route/timing suggestions\nCorrelation-based early warning\n\nPhase 5: Scale &amp; Optimize (Ongoing)\nGoals: Multi-city deployment, optimization\nTasks:\n\n Multi-tenant architecture\n City-specific configuration\n Regional language expansion\n Performance optimization\n Cost optimization (WhatsApp messages, AI calls)\n Advanced analytics and reporting\n\nDeliverables:\n\nMulti-city deployment capability\nComprehensive admin analytics\nOptimized costs at scale\n\n\nChallenges &amp; Mitigations\n1. WhatsApp Business API Costs\nChallenge: Per-message pricing (‚Çπ0.50-1.50 per message) can be expensive at scale.\nMitigations:\n\nBatch alerts to reduce message count\nUse user-initiated conversations (free for 24h)\nImplement smart throttling (don‚Äôt over-alert)\nEncourage web dashboard for non-urgent queries\nTiered subscription (free: limited alerts, premium: all alerts)\n\n2. Spam and Fake Reports\nChallenge: Bad actors could flood system with false reports.\nMitigations:\n\nAI verification of images (Gemini)\nReputation scoring for users\nRate limiting per user\nRequire location verification\nCommunity flagging of false reports\nPhone number verification for WhatsApp\n\n3. Authority Adoption\nChallenge: Government agencies may be slow to adopt new technology.\nMitigations:\n\nStart with progressive authorities (traffic police often tech-savvy)\nProvide clear ROI metrics\nMinimal training required (simple dashboard)\nIntegration with existing systems via API\nPilot program with measurable outcomes\n\n4. Alert Fatigue\nChallenge: Too many notifications = users ignore them.\nMitigations:\n\nSeverity-based filtering\nUser-controlled preferences\nSmart aggregation (one alert for cluster, not each report)\nQuiet hours respect\nRelevance scoring based on user patterns\nEasy unsubscribe\n\n5. Privacy Concerns\nChallenge: Location tracking and message content are sensitive.\nMitigations:\n\nExplicit opt-in for location services\nData minimization (only collect what‚Äôs needed)\nClear privacy policy\nNo location history storage (only current subscriptions)\nAnonymization for analytics\nGDPR/India DPDP compliance\n\n6. Misinformation Risk\nChallenge: Unverified reports could cause panic or misdirection.\nMitigations:\n\nAI verification before broadcasting\nAuthority verification for safety alerts\nClear labeling (citizen report vs verified)\nCommunity confirmation requirements\nRapid correction mechanism\nLegal disclaimer for unverified content\n\n7. System Reliability\nChallenge: System must work during actual emergencies when most needed.\nMitigations:\n\nMulti-region deployment\nGraceful degradation\nOffline capability for web app\nWhatsApp as backup (highly reliable)\nCircuit breakers for external services\nRegular disaster recovery testing\n\n8. Moderation at Scale\nChallenge: Can‚Äôt manually review all reports.\nMitigations:\n\nAI-first moderation (Gemini)\nConfidence thresholds (auto-approve high confidence)\nCommunity moderation (trusted users)\nAuthority override capability\nAutomated escalation for edge cases\n\n\nTech Stack\nAligned with Google AI Ecosystem\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nComponentTechnologyPurposeAI AnalysisGeminiMultimodal verification (images, videos, text)ML ModelsVertex AIEvent classification, clustering, predictionsReal-time DBFirebase/FirestoreReports, subscriptions, live dataAnalyticsBigQueryHistorical patterns, hotspots, insightsDeploymentFirebase StudioRapid iteration, hostingAutomationAgent BuilderAlert generation, escalation workflowsBackendFastAPI (Python)API server, business logicFrontendSvelteKitWeb dashboard, PWAMessagingWhatsApp Business APICitizen communicationMapsGoogle Maps PlatformVisualization, geocodingStorageGoogle Cloud StorageImages, videosAuthFirebase AuthUser authentication\nIntegration Points\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DARSHI CORE                           ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  FastAPI Backend                                         ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Existing: Report, Auth, Admin APIs                 ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ New: WhatsApp webhook, Authority APIs              ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ New: Subscription, Alert APIs                      ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  SvelteKit Frontend                                      ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ Existing: Report submission, Admin dashboard       ‚îÇ\n‚îÇ  ‚îú‚îÄ‚îÄ New: Real-time map, Filters                        ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ New: Authority dashboard                           ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n            ‚îÇ              ‚îÇ              ‚îÇ\n            ‚ñº              ‚ñº              ‚ñº\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ   Gemini     ‚îÇ ‚îÇ Vertex   ‚îÇ ‚îÇ  BigQuery    ‚îÇ\n    ‚îÇ   API        ‚îÇ ‚îÇ AI       ‚îÇ ‚îÇ              ‚îÇ\n    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n    ‚îÇ ‚Ä¢ Image      ‚îÇ ‚îÇ ‚Ä¢ Event  ‚îÇ ‚îÇ ‚Ä¢ Patterns   ‚îÇ\n    ‚îÇ   analysis   ‚îÇ ‚îÇ   class- ‚îÇ ‚îÇ ‚Ä¢ Hotspots   ‚îÇ\n    ‚îÇ ‚Ä¢ Text       ‚îÇ ‚îÇ   ifier  ‚îÇ ‚îÇ ‚Ä¢ Predictions‚îÇ\n    ‚îÇ   processing ‚îÇ ‚îÇ ‚Ä¢ Cluster‚îÇ ‚îÇ ‚Ä¢ Reports    ‚îÇ\n    ‚îÇ ‚Ä¢ Validation ‚îÇ ‚îÇ   models ‚îÇ ‚îÇ              ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n            ‚îÇ              ‚îÇ              ‚îÇ\n            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n            ‚îÇ              ‚îÇ              ‚îÇ\n            ‚ñº              ‚ñº              ‚ñº\n    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n    ‚îÇ  Firestore   ‚îÇ ‚îÇ  GCS     ‚îÇ ‚îÇ WhatsApp     ‚îÇ\n    ‚îÇ              ‚îÇ ‚îÇ          ‚îÇ ‚îÇ Business API ‚îÇ\n    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n    ‚îÇ ‚Ä¢ Reports    ‚îÇ ‚îÇ ‚Ä¢ Images ‚îÇ ‚îÇ ‚Ä¢ Inbound    ‚îÇ\n    ‚îÇ ‚Ä¢ Users      ‚îÇ ‚îÇ ‚Ä¢ Videos ‚îÇ ‚îÇ ‚Ä¢ Outbound   ‚îÇ\n    ‚îÇ ‚Ä¢ Subs       ‚îÇ ‚îÇ ‚Ä¢ Docs   ‚îÇ ‚îÇ ‚Ä¢ Templates  ‚îÇ\n    ‚îÇ ‚Ä¢ Alerts     ‚îÇ ‚îÇ          ‚îÇ ‚îÇ              ‚îÇ\n    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n\nSuccess Metrics\nCitizen Engagement\n\nWhatsApp subscribers per city\nReport submission rate (web + WhatsApp)\nAlert open/read rates\nQuery response satisfaction\nTime to resolution (citizen-reported)\n\nAuthority Adoption\n\nAuthorities onboarded per city\nVerified alerts published\nResponse time to citizen escalations\nResolution rate for escalated issues\n\nPlatform Health\n\nAI verification accuracy\nFalse positive/negative rates\nDuplicate detection accuracy\nPrediction accuracy\nSystem uptime\nMessage delivery rate\n\nCity Impact\n\nAverage time to public awareness (before vs after)\nReduction in misinformation incidents\nCitizen satisfaction surveys\nAuthority efficiency metrics\nMedia coverage / public perception\n\n\nConclusion\nIntegrating Nagar Alert Hub with Darshi creates a comprehensive civic intelligence platform that:\n\nLeverages existing strengths: Darshi‚Äôs AI verification, geospatial capabilities, and robust backend\nAddresses real needs: WhatsApp-based communication for maximum reach in Tier-2/3 cities\nConnects stakeholders: Citizens, authorities, and the platform in a unified ecosystem\nScales intelligently: From reactive reporting to predictive alerts\n\nThe phased migration path ensures we can deliver value incrementally while building toward the full vision.\n\nDocument Version: 1.0\nLast Updated: December 2024\nPart of: Darshi Civic Suite"},"misc/future/official-directory":{"slug":"misc/future/official-directory","filePath":"misc/future/official-directory.md","title":"official-directory","links":[],"tags":[],"content":"Official Directory &amp; Contact Platform\n\nAI-Powered Navigation of India‚Äôs Complex Governance Structure\n\nPart of: Darshi Civic Suite\nThis document outlines the integration strategy for helping citizens identify and contact the right government officials for any civic issue.\n\nTable of Contents\n\nExecutive Summary\nProblem Statement\nSolution Overview\nArchitecture\nData Model\nAI Query Resolution\nMulti-Language Support\nUser Interface\nData Sources &amp; Scraping\nMigration Path\nChallenges &amp; Mitigations\nTech Stack\n\n\nExecutive Summary\nProblem: India‚Äôs governance structure is complex and opaque. Citizens don‚Äôt know which official or agency is responsible for specific problems, creating barriers to effective grievance redressal.\nSolution: An AI-powered directory that:\n\nUnderstands natural language queries (‚ÄúWho handles potholes in Koramangala?‚Äú)\nNavigates the complex governance hierarchy (Municipal ‚Üí Ward ‚Üí Department ‚Üí Official)\nProvides direct contact information with multilingual support\nSuggests escalation paths when initial contact fails\n\nValue Proposition: Every citizen can reach the right official in under 30 seconds, regardless of their knowledge of bureaucratic structure or language proficiency.\n\nProblem Statement\nThe Navigation Challenge\n1. Complexity of Indian Governance\nExample: A pothole in Bangalore\nWho&#039;s responsible?\n‚îú‚îÄ BBMP (Bruhat Bengaluru Mahanagara Palike)\n‚îÇ  ‚îú‚îÄ Roads &amp; Infrastructure Department\n‚îÇ  ‚îÇ  ‚îú‚îÄ Ward 98 (Koramangala)\n‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Ward Engineer\n‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Assistant Executive Engineer (AEE)\n‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ Executive Engineer (EE)\n‚îÇ  ‚îÇ  ‚îî‚îÄ Zonal Engineer (South Zone)\n‚îÇ  ‚îî‚îÄ OR Bangalore Development Authority (BDA)?\n‚îÇ     ‚îî‚îÄ (If it&#039;s a BDA-laid road)\n‚îî‚îÄ OR Karnataka PWD?\n   ‚îî‚îÄ (If it&#039;s a state highway)\n\nMost citizens have no idea where to even start.\n2. Ward/Zone Confusion\n\nMost cities have 50-200 wards\nCitizens don‚Äôt know their ward number\nWard boundaries change periodically\nDifferent agencies use different ward systems\n\nMunicipal wards ‚â† Police station jurisdictions ‚â† Assembly constituencies\n\n\n\n3. Department Maze\nExample: Construction site violations in Mumbai\nPossible agencies:\n\nMunicipal Corporation: Building permissions, illegal construction\nPollution Control Board: Noise, dust, air pollution\nTraffic Police: Vehicle congestion, illegal parking\nLabor Department: Safety violations\nFire Department: Safety compliance\n\nWhich one do you call? Most citizens don‚Äôt know.\n4. Language Barriers\n\nGovernance happens in regional languages\nOfficials‚Äô names, designations often only in local script\nMigrant workers can‚Äôt read Kannada/Marathi/Tamil\nEven Google Translate doesn‚Äôt help if you can‚Äôt find the information\n\n5. Information Staleness\n\nOfficials transfer every 1-2 years\nContact numbers change\nWebsites rarely updated (2-year-old information common)\nNo centralized directory\n\nCurrent Gaps in Darshi\nDarshi users face these challenges:\n\n‚ÄúI want to report a pothole, but who should I address it to?‚Äù\n‚ÄúMy report was ignored. Who should I escalate to?‚Äù\n‚ÄúThis is urgent. Can I call someone directly?‚Äù\n\nCurrent solution: Generic submissions to ‚Äúthe system.‚Äù\nBetter solution: Direct connection to the responsible official.\n\nSolution Overview\nPlatform Capabilities\n1. Natural Language Query Resolution\nUser input (any language):\n&quot;‡§ï‡•ã‡§∞‡§Æ‡§Ç‡§ó‡§≤‡§æ ‡§Æ‡•á‡§Ç ‡§™‡•â‡§ü‡§π‡•ã‡§≤ ‡§ï‡§ø‡§∏‡§ï‡•ã ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç?&quot;\n(Who should I report pothole in Koramangala to?)\n\nAI Response:\n&quot;‡§ï‡•ã‡§∞‡§Æ‡§Ç‡§ó‡§≤‡§æ (‡§µ‡§æ‡§∞‡•ç‡§° 98) ‡§Æ‡•á‡§Ç ‡§™‡•â‡§ü‡§π‡•ã‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞:\n\n1. ‡§µ‡§æ‡§∞‡•ç‡§° ‡§á‡§Ç‡§ú‡•Ä‡§®‡§ø‡§Ø‡§∞ - Mr. Rajesh Kumar\n   üìû +91-80-1234-5678\n   ‚úâÔ∏è ward98.engineer@bbmp.gov.in\n\n2. ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§è‡§ï‡•ç‡§ú‡§º‡§ø‡§ï‡•ç‡§Ø‡•Ç‡§ü‡§ø‡§µ ‡§á‡§Ç‡§ú‡•Ä‡§®‡§ø‡§Ø‡§∞ (AEE) - South Zone\n   üìû +91-80-2345-6789\n\n‡§Ü‡§™ BBMP ‡§ï‡§Ç‡§™‡•ç‡§≤‡•á‡§Ç‡§ü ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤ ‡§™‡§∞ ‡§≠‡•Ä ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç:\nbbmp.gov.in/complaint\n\n2. Smart Search\nQuery types supported:\n‚îú‚îÄ By problem type: &quot;Who handles garbage collection?&quot;\n‚îú‚îÄ By location: &quot;Ward engineer for Indiranagar&quot;\n‚îú‚îÄ By agency: &quot;BBMP South Zone head&quot;\n‚îú‚îÄ By name: &quot;Contact details of Mr. Rajesh Kumar, Ward 98&quot;\n‚îú‚îÄ By designation: &quot;All ward engineers in Bangalore&quot;\n‚îî‚îÄ Complex: &quot;Who handles noise pollution from construction sites in Pune?&quot;\n\n3. Hierarchical Directory\nCity: Bangalore\n‚îî‚îÄ BBMP (Municipal Corporation)\n   ‚îú‚îÄ Roads &amp; Infrastructure\n   ‚îÇ  ‚îú‚îÄ South Zone\n   ‚îÇ  ‚îÇ  ‚îú‚îÄ Ward 98 (Koramangala)\n   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Corporator: Ms. Sneha Reddy\n   ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  üìû +91-98765-43210\n   ‚îÇ  ‚îÇ  ‚îÇ  ‚îú‚îÄ Ward Engineer: Mr. Rajesh Kumar\n   ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  üìû +91-80-1234-5678\n   ‚îÇ  ‚îÇ  ‚îÇ  ‚îÇ  ‚úâÔ∏è ward98@bbmp.gov.in\n   ‚îÇ  ‚îÇ  ‚îÇ  ‚îî‚îÄ AEE (Roads): Mr. Suresh Nair\n   ‚îÇ  ‚îÇ  ‚îÇ     üìû +91-80-2345-6789\n   ‚îÇ  ‚îÇ  ‚îî‚îÄ Ward 99 (HSR Layout)\n   ‚îÇ  ‚îÇ     ‚îî‚îÄ ...\n   ‚îÇ  ‚îî‚îÄ Zonal Engineer: Mr. Venkatesh Rao\n   ‚îú‚îÄ Health &amp; Sanitation\n   ‚îÇ  ‚îî‚îÄ ...\n   ‚îî‚îÄ Revenue\n      ‚îî‚îÄ ...\n\n4. Escalation Pathways\nReport not resolved?\n\nCurrent level: Ward Engineer (Mr. Rajesh Kumar)\n\nEscalate to:\n1. Assistant Executive Engineer - South Zone\n   Mr. Suresh Nair\n   üìû +91-80-2345-6789\n\n   If no response in 7 days ‚Üí\n\n2. Executive Engineer - BBMP Roads\n   Mr. Prakash Iyer\n   üìû +91-80-3456-7890\n\n   If no response in 15 days ‚Üí\n\n3. BBMP Commissioner\n   Commissioner&#039;s Office\n   üìû +91-80-4567-8901\n   ‚úâÔ∏è commissioner@bbmp.gov.in\n\n5. Multilingual Interface\n\nQuery in any of 8+ Indian languages\nResponse in same language\nOfficials‚Äô names in both English and local script\nTransliteration support for names\n\n\nArchitecture\nHigh-Level System Architecture\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                        USER QUERY                                ‚îÇ\n‚îÇ  &quot;Who handles potholes in Koramangala?&quot;                          ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    QUERY UNDERSTANDING (Gemini)                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Extract:                                                        ‚îÇ\n‚îÇ  ‚Ä¢ Issue type: &quot;potholes&quot; ‚Üí category: &quot;roads&quot;                   ‚îÇ\n‚îÇ  ‚Ä¢ Location: &quot;Koramangala&quot; ‚Üí ward: 98, city: Bangalore          ‚îÇ\n‚îÇ  ‚Ä¢ Intent: &quot;who handles&quot; ‚Üí need: contact information            ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    RESOLUTION ENGINE                             ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  1. Identify jurisdiction (city/ward/zone)                       ‚îÇ\n‚îÇ  2. Identify agency (Municipal/State/Central)                    ‚îÇ\n‚îÇ  3. Identify department (Roads, Health, etc.)                    ‚îÇ\n‚îÇ  4. Identify hierarchy level (Ward/Zone/City)                    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    DATA LAYER QUERY                              ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Firestore Query:                                                ‚îÇ\n‚îÇ  officials                                                       ‚îÇ\n‚îÇ    WHERE city = &quot;Bangalore&quot;                                      ‚îÇ\n‚îÇ    WHERE agency = &quot;BBMP&quot;                                         ‚îÇ\n‚îÇ    WHERE department = &quot;Roads &amp; Infrastructure&quot;                   ‚îÇ\n‚îÇ    WHERE ward = 98                                               ‚îÇ\n‚îÇ    WHERE role IN [&quot;Ward Engineer&quot;, &quot;AEE&quot;, &quot;Corporator&quot;]          ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    RESPONSE GENERATION (Gemini)                  ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ  Format response in user&#039;s language:                             ‚îÇ\n‚îÇ  ‚Ä¢ Primary contact (Ward Engineer)                               ‚îÇ\n‚îÇ  ‚Ä¢ Backup contacts (AEE, Corporator)                             ‚îÇ\n‚îÇ  ‚Ä¢ Escalation path                                               ‚îÇ\n‚îÇ  ‚Ä¢ Portal links                                                  ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                           ‚îÇ\n                           ‚ñº\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                    OUTPUT                                        ‚îÇ\n‚îÇ  (Text response + structured contact cards)                      ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n\nData Model\nOfficial Schema\n# Collection: officials\n{\n    &quot;id&quot;: &quot;uuid&quot;,\n \n    # Personal Information\n    &quot;name&quot;: {\n        &quot;en&quot;: &quot;Rajesh Kumar&quot;,\n        &quot;native&quot;: &quot;‡§∞‡§æ‡§ú‡•á‡§∂ ‡§ï‡•Å‡§Æ‡§æ‡§∞&quot;,  # In local script\n        &quot;transliteration&quot;: &quot;Raajesh Kumaar&quot;\n    },\n    &quot;designation&quot;: {\n        &quot;en&quot;: &quot;Ward Engineer&quot;,\n        &quot;native&quot;: &quot;‡§µ‡§æ‡§∞‡•ç‡§° ‡§á‡§Ç‡§ú‡•Ä‡§®‡§ø‡§Ø‡§∞&quot;\n    },\n    &quot;employee_id&quot;: &quot;BBMP/2023/1234&quot;,\n \n    # Contact Information\n    &quot;contact&quot;: {\n        &quot;phone&quot;: &quot;+91-80-1234-5678&quot;,\n        &quot;mobile&quot;: &quot;+91-98765-43210&quot;,\n        &quot;email&quot;: &quot;ward98.engineer@bbmp.gov.in&quot;,\n        &quot;office_address&quot;: &quot;Ward 98 Office, Koramangala, Bangalore - 560034&quot;\n    },\n \n    # Jurisdiction\n    &quot;jurisdiction&quot;: {\n        &quot;country&quot;: &quot;India&quot;,\n        &quot;state&quot;: &quot;Karnataka&quot;,\n        &quot;district&quot;: &quot;Bengaluru Urban&quot;,\n        &quot;city&quot;: &quot;Bangalore&quot;,\n        &quot;zone&quot;: &quot;South Zone&quot;,\n        &quot;ward&quot;: &quot;98&quot;,\n        &quot;ward_name&quot;: &quot;Koramangala&quot;,\n        &quot;geohashes&quot;: [&quot;tdr1h&quot;, &quot;tdr1k&quot;]  # Area coverage\n    },\n \n    # Organizational Hierarchy\n    &quot;agency&quot;: {\n        &quot;name&quot;: &quot;BBMP&quot;,\n        &quot;full_name&quot;: &quot;Bruhat Bengaluru Mahanagara Palike&quot;,\n        &quot;type&quot;: &quot;municipal_corporation&quot;,\n        &quot;department&quot;: &quot;Roads &amp; Infrastructure&quot;,\n        &quot;sub_department&quot;: &quot;Ward Engineering&quot;\n    },\n \n    # Responsibility\n    &quot;responsibilities&quot;: [\n        &quot;road_maintenance&quot;,\n        &quot;pothole_repair&quot;,\n        &quot;street_lights&quot;,\n        &quot;drainage&quot;\n    ],\n    &quot;issue_categories&quot;: [\n        &quot;pothole&quot;,\n        &quot;road_damage&quot;,\n        &quot;streetlight&quot;,\n        &quot;drainage&quot;\n    ],\n \n    # Hierarchy\n    &quot;hierarchy_level&quot;: 3,  # 1=City, 2=Zone, 3=Ward, 4=Section\n    &quot;reports_to&quot;: {\n        &quot;official_id&quot;: &quot;uuid-of-aee&quot;,\n        &quot;designation&quot;: &quot;Assistant Executive Engineer&quot;\n    },\n    &quot;supervises&quot;: [\n        &quot;uuid-of-junior-engineer-1&quot;,\n        &quot;uuid-of-junior-engineer-2&quot;\n    ],\n \n    # Office Hours\n    &quot;office_hours&quot;: {\n        &quot;days&quot;: [&quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;, &quot;Saturday&quot;],\n        &quot;hours&quot;: &quot;10:00-18:00&quot;,\n        &quot;closed&quot;: [&quot;Sunday&quot;, &quot;National Holidays&quot;]\n    },\n \n    # Status\n    &quot;status&quot;: &quot;active|transferred|retired&quot;,\n    &quot;tenure&quot;: {\n        &quot;start_date&quot;: &quot;2023-01-15&quot;,\n        &quot;end_date&quot;: null,  # null if currently serving\n        &quot;previous_posting&quot;: &quot;Ward 45, West Zone&quot;\n    },\n \n    # Verification\n    &quot;verified&quot;: true,\n    &quot;verified_by&quot;: &quot;admin_user_id&quot;,\n    &quot;verified_at&quot;: timestamp,\n    &quot;last_updated&quot;: timestamp,\n \n    # Engagement Metrics\n    &quot;stats&quot;: {\n        &quot;issues_resolved&quot;: 156,\n        &quot;avg_resolution_time_days&quot;: 7,\n        &quot;citizen_rating&quot;: 4.2,  # out of 5\n        &quot;response_rate&quot;: 0.85   # 85% of reports get response\n    }\n}\nAgency Schema\n# Collection: agencies\n{\n    &quot;id&quot;: &quot;uuid&quot;,\n    &quot;name&quot;: &quot;BBMP&quot;,\n    &quot;full_name&quot;: {\n        &quot;en&quot;: &quot;Bruhat Bengaluru Mahanagara Palike&quot;,\n        &quot;kn&quot;: &quot;‡≤¨‡≥É‡≤π‡≤§‡≥ç ‡≤¨‡≥Ü‡≤Ç‡≤ó‡≤≥‡≥Ç‡≤∞‡≥Å ‡≤Æ‡≤π‡≤æ‡≤®‡≤ó‡≤∞ ‡≤™‡≤æ‡≤≤‡≤ø‡≤ï‡≥Ü&quot;\n    },\n    &quot;type&quot;: &quot;municipal_corporation|state_department|central_ministry|autonomous_body&quot;,\n \n    &quot;jurisdiction&quot;: {\n        &quot;state&quot;: &quot;Karnataka&quot;,\n        &quot;district&quot;: &quot;Bengaluru Urban&quot;,\n        &quot;city&quot;: &quot;Bangalore&quot;,\n        &quot;coverage_area_sqkm&quot;: 741\n    },\n \n    &quot;contact&quot;: {\n        &quot;helpline&quot;: &quot;080-22660000&quot;,\n        &quot;email&quot;: &quot;contact@bbmp.gov.in&quot;,\n        &quot;website&quot;: &quot;bbmp.gov.in&quot;,\n        &quot;complaint_portal&quot;: &quot;bbmp.gov.in/complaint&quot;,\n        &quot;address&quot;: &quot;BBMP Head Office, K.H Road, Bangalore - 560002&quot;\n    },\n \n    &quot;departments&quot;: [\n        {\n            &quot;name&quot;: &quot;Roads &amp; Infrastructure&quot;,\n            &quot;head_official_id&quot;: &quot;uuid&quot;,\n            &quot;categories&quot;: [&quot;pothole&quot;, &quot;road_damage&quot;, &quot;streetlight&quot;]\n        },\n        {\n            &quot;name&quot;: &quot;Health &amp; Sanitation&quot;,\n            &quot;head_official_id&quot;: &quot;uuid&quot;,\n            &quot;categories&quot;: [&quot;garbage&quot;, &quot;sanitation&quot;, &quot;health&quot;]\n        }\n        # ... more departments\n    ],\n \n    &quot;zones&quot;: [\n        {\n            &quot;name&quot;: &quot;South Zone&quot;,\n            &quot;wards&quot;: [&quot;94&quot;, &quot;95&quot;, &quot;96&quot;, &quot;97&quot;, &quot;98&quot;, &quot;99&quot;],\n            &quot;head_official_id&quot;: &quot;uuid&quot;\n        }\n        # ... more zones\n    ],\n \n    &quot;created_at&quot;: timestamp,\n    &quot;last_updated&quot;: timestamp\n}\nResponsibility Mapping Schema\n# Collection: responsibility_mappings\n{\n    &quot;id&quot;: &quot;uuid&quot;,\n    &quot;issue_category&quot;: &quot;pothole&quot;,\n    &quot;keywords&quot;: [&quot;pothole&quot;, &quot;road hole&quot;, &quot;‡§∏‡§°‡§º‡§ï ‡§ó‡§°‡•ç‡§¢‡§æ&quot;, &quot;‡≤∞‡≤∏‡≥ç‡≤§‡≥Ü ‡≤π‡≥ä‡≤°‡≥Ü‡≤§&quot;],\n \n    # Jurisdiction rules\n    &quot;jurisdiction_rules&quot;: [\n        {\n            &quot;condition&quot;: {\n                &quot;road_type&quot;: &quot;municipal&quot;,\n                &quot;city&quot;: &quot;Bangalore&quot;\n            },\n            &quot;responsible_agency&quot;: &quot;BBMP&quot;,\n            &quot;department&quot;: &quot;Roads &amp; Infrastructure&quot;,\n            &quot;hierarchy_level&quot;: &quot;ward&quot;,  # Start at ward level\n            &quot;fallback_level&quot;: &quot;zone&quot;    # Escalate to zone if ward doesn&#039;t respond\n        },\n        {\n            &quot;condition&quot;: {\n                &quot;road_type&quot;: &quot;state_highway&quot;,\n                &quot;state&quot;: &quot;Karnataka&quot;\n            },\n            &quot;responsible_agency&quot;: &quot;Karnataka PWD&quot;,\n            &quot;department&quot;: &quot;State Highways&quot;,\n            &quot;hierarchy_level&quot;: &quot;district&quot;\n        },\n        {\n            &quot;condition&quot;: {\n                &quot;road_type&quot;: &quot;national_highway&quot;\n            },\n            &quot;responsible_agency&quot;: &quot;NHAI&quot;,\n            &quot;department&quot;: &quot;Highway Maintenance&quot;,\n            &quot;hierarchy_level&quot;: &quot;regional&quot;\n        }\n    ],\n \n    # Escalation path\n    &quot;escalation_levels&quot;: [\n        {&quot;level&quot;: 1, &quot;designation&quot;: &quot;Ward Engineer&quot;, &quot;timeout_days&quot;: 7},\n        {&quot;level&quot;: 2, &quot;designation&quot;: &quot;AEE&quot;, &quot;timeout_days&quot;: 7},\n        {&quot;level&quot;: 3, &quot;designation&quot;: &quot;Executive Engineer&quot;, &quot;timeout_days&quot;: 15},\n        {&quot;level&quot;: 4, &quot;designation&quot;: &quot;Commissioner&quot;, &quot;timeout_days&quot;: 30}\n    ],\n \n    &quot;created_at&quot;: timestamp\n}\n\nAI Query Resolution\nQuery Understanding Pipeline\nclass QueryResolver:\n    &quot;&quot;&quot;\n    Resolve natural language queries to responsible officials.\n    &quot;&quot;&quot;\n \n    async def resolve_query(self, query: str, user_location: dict = None) -&gt; dict:\n        &quot;&quot;&quot;\n        Main resolution pipeline.\n        &quot;&quot;&quot;\n        # Step 1: Understand the query\n        parsed_query = await self._parse_query(query, user_location)\n \n        # Step 2: Identify responsible officials\n        officials = await self._find_responsible_officials(parsed_query)\n \n        # Step 3: Build escalation path\n        escalation = await self._build_escalation_path(officials[0])\n \n        # Step 4: Generate response\n        response = await self._generate_response(\n            query, parsed_query, officials, escalation\n        )\n \n        return response\n \n    async def _parse_query(self, query: str, user_location: dict) -&gt; dict:\n        &quot;&quot;&quot;\n        Use Gemini to understand the query.\n        &quot;&quot;&quot;\n        prompt = f&quot;&quot;&quot;\n        Parse this civic query from an Indian citizen.\n \n        Query: &quot;{query}&quot;\n        User location (if known): {user_location}\n \n        Extract:\n        1. Issue type/category (pothole, garbage, water, etc.)\n        2. Location mentioned (city, area, ward, landmark)\n        3. Intent (find contact, report issue, escalate, check status)\n        4. Language of query\n \n        Respond in JSON format:\n        {{\n          &quot;issue_category&quot;: &quot;...&quot;,\n          &quot;location&quot;: {{\n            &quot;city&quot;: &quot;...&quot;,\n            &quot;area&quot;: &quot;...&quot;,\n            &quot;ward&quot;: &quot;...&quot; or null\n          }},\n          &quot;intent&quot;: &quot;...&quot;,\n          &quot;language&quot;: &quot;...&quot;\n        }}\n        &quot;&quot;&quot;\n \n        response = await gemini.generate(prompt)\n        return parse_json(response)\n \n    async def _find_responsible_officials(self, parsed_query: dict) -&gt; list:\n        &quot;&quot;&quot;\n        Query Firestore for responsible officials based on parsed query.\n        &quot;&quot;&quot;\n        # Get responsibility mapping for issue category\n        mapping = db.collection(&#039;responsibility_mappings&#039;) \\\n            .where(&#039;issue_category&#039;, &#039;==&#039;, parsed_query[&#039;issue_category&#039;]) \\\n            .get()\n \n        if not mapping:\n            return []\n \n        # Apply jurisdiction rules\n        responsible_agency = self._apply_jurisdiction_rules(\n            mapping[0], parsed_query[&#039;location&#039;]\n        )\n \n        # Query officials\n        officials_query = db.collection(&#039;officials&#039;) \\\n            .where(&#039;agency.name&#039;, &#039;==&#039;, responsible_agency[&#039;agency&#039;]) \\\n            .where(&#039;status&#039;, &#039;==&#039;, &#039;active&#039;)\n \n        # Add location filters\n        if parsed_query[&#039;location&#039;].get(&#039;ward&#039;):\n            officials_query = officials_query.where(\n                &#039;jurisdiction.ward&#039;, &#039;==&#039;, parsed_query[&#039;location&#039;][&#039;ward&#039;]\n            )\n        elif parsed_query[&#039;location&#039;].get(&#039;zone&#039;):\n            officials_query = officials_query.where(\n                &#039;jurisdiction.zone&#039;, &#039;==&#039;, parsed_query[&#039;location&#039;][&#039;zone&#039;]\n            )\n \n        # Add department filter\n        if responsible_agency.get(&#039;department&#039;):\n            officials_query = officials_query.where(\n                &#039;agency.department&#039;, &#039;==&#039;, responsible_agency[&#039;department&#039;]\n            )\n \n        # Order by hierarchy level (lower = more specific)\n        officials_query = officials_query.order_by(&#039;hierarchy_level&#039;, &#039;asc&#039;)\n \n        officials = officials_query.get()\n        return [off.to_dict() for off in officials]\n \n    async def _build_escalation_path(self, primary_official: dict) -&gt; list:\n        &quot;&quot;&quot;\n        Build escalation hierarchy starting from primary official.\n        &quot;&quot;&quot;\n        path = [primary_official]\n \n        current = primary_official\n        while current.get(&#039;reports_to&#039;):\n            supervisor_id = current[&#039;reports_to&#039;][&#039;official_id&#039;]\n            supervisor = db.collection(&#039;officials&#039;).document(supervisor_id).get()\n \n            if supervisor.exists:\n                path.append(supervisor.to_dict())\n                current = supervisor.to_dict()\n            else:\n                break\n \n        return path\n \n    async def _generate_response(\n        self,\n        original_query: str,\n        parsed_query: dict,\n        officials: list,\n        escalation: list\n    ) -&gt; dict:\n        &quot;&quot;&quot;\n        Generate human-readable response in user&#039;s language.\n        &quot;&quot;&quot;\n        prompt = f&quot;&quot;&quot;\n        Generate a helpful response to this citizen query in {parsed_query[&#039;language&#039;]}.\n \n        Original query: &quot;{original_query}&quot;\n \n        Context:\n        - Issue: {parsed_query[&#039;issue_category&#039;]}\n        - Location: {parsed_query[&#039;location&#039;]}\n \n        Responsible officials:\n        {json.dumps(officials, indent=2)}\n \n        Escalation path:\n        {json.dumps(escalation, indent=2)}\n \n        Provide:\n        1. Direct answer to the query\n        2. Primary contact with phone/email\n        3. Backup contacts\n        4. Escalation path (if needed)\n        5. Portal link (if available)\n \n        Format in a friendly, conversational tone.\n        &quot;&quot;&quot;\n \n        response = await gemini.generate(prompt)\n \n        return {\n            &quot;text_response&quot;: response,\n            &quot;structured_data&quot;: {\n                &quot;primary_official&quot;: officials[0] if officials else None,\n                &quot;backup_officials&quot;: officials[1:3] if len(officials) &gt; 1 else [],\n                &quot;escalation_path&quot;: escalation,\n                &quot;portal_link&quot;: officials[0][&#039;agency&#039;].get(&#039;complaint_portal&#039;) if officials else None\n            }\n        }\nExample Query Resolutions\nExample 1: Simple Query\nInput:\nQuery: &quot;Who handles garbage in HSR Layout?&quot;\nLocation: {city: &quot;Bangalore&quot;, area: &quot;HSR Layout&quot;}\n\nOutput:\nHSR Layout (Ward 99) ‡§Æ‡•á‡§Ç ‡§ï‡•Ç‡§°‡§º‡§æ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞:\n\n1. ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§®‡§ø‡§∞‡•Ä‡§ï‡•ç‡§∑‡§ï - Ms. Lakshmi Devi\n   üìû +91-80-2222-3333\n   ‚úâÔ∏è ward99.health@bbmp.gov.in\n   ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§∏‡§Æ‡§Ø: ‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞-‡§∂‡§®‡§ø‡§µ‡§æ‡§∞, 10 AM - 6 PM\n\n2. ‡§µ‡§æ‡§∞‡•ç‡§° ‡§∏‡•ç‡§µ‡§ö‡•ç‡§õ‡§§‡§æ ‡§™‡§∞‡•ç‡§Ø‡§µ‡•á‡§ï‡•ç‡§∑‡§ï - Mr. Kumar Swamy\n   üìû +91-80-3333-4444\n\n‡§Ø‡§¶‡§ø ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§π‡§≤ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•ã‡§§‡•Ä ‡§π‡•à:\n- 7 ‡§¶‡§ø‡§®‡•ã‡§Ç ‡§ï‡•á ‡§¨‡§æ‡§¶: South Zone ‡§∏‡•ç‡§µ‡§æ‡§∏‡•ç‡§•‡•ç‡§Ø ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞‡•Ä\n  Dr. Anand Rao - üìû +91-80-4444-5555\n\nBBMP ‡§ï‡§Ç‡§™‡•ç‡§≤‡•á‡§Ç‡§ü ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤: bbmp.gov.in/complaint\n\nExample 2: Complex Query\nInput:\nQuery: &quot;Construction site near my house in Pune is causing noise pollution.\n        Who should I complain to?&quot;\nLocation: {city: &quot;Pune&quot;, area: &quot;Koregaon Park&quot;}\n\nOutput:\nFor construction noise pollution in Koregaon Park, Pune:\n\nPRIMARY AUTHORITY:\nMaharashtra Pollution Control Board (MPCB)\n- Regional Officer: Mr. Santosh Patil\n  üìû +91-20-1111-2222\n  ‚úâÔ∏è pune.regional@mpcb.gov.in\n- File complaint: mpcb.gov.in/complaint\n\nALTERNATE OPTIONS:\n1. PMC (Pune Municipal Corporation) - Building Dept\n   Ward 8 Building Inspector: Mr. Ravi Kulkarni\n   üìû +91-20-2222-3333\n   (For building permission violations)\n\n2. Police - Local Station (Koregaon Park)\n   üìû 100 (Emergency) / 020-2605-8888\n   (For immediate noise disturbance)\n\nRECOMMENDED APPROACH:\n1. File complaint with MPCB (primary authority for pollution)\n2. Also inform PMC Building Dept (they may find violations)\n3. If issue persists beyond 7 days, escalate to:\n   MPCB Regional Director - üìû +91-20-3333-4444\n\n\nMulti-Language Support\nSupported Languages\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLanguageCodeScriptOfficial Query SupportResponse GenerationEnglishenLatin‚úì‚úìHindihiDevanagari‚úì‚úìMarathimrDevanagari‚úì‚úìTamiltaTamil‚úì‚úìTeluguteTelugu‚úì‚úìKannadaknKannada‚úì‚úìBengalibnBengali‚úì‚úìGujaratiguGujarati‚úì‚úì\nTransliteration for Names\nChallenge: Official names in local script, users can‚Äôt type.\nSolution: Provide transliterated versions.\n# Official: ‡§∞‡§æ‡§ú‡•á‡§∂ ‡§ï‡•Å‡§Æ‡§æ‡§∞ (Devanagari)\n# Transliteration: &quot;Rajesh Kumar&quot; (Latin)\n# Pronunciation guide: &quot;Raajesh Kumaar&quot;\n \ndef transliterate_name(name: str, from_script: str) -&gt; str:\n    &quot;&quot;&quot;\n    Transliterate name from Devanagari/Tamil/etc to Latin script.\n    &quot;&quot;&quot;\n    # Use IndicTrans2 or Google Transliteration API\n    pass\nCode-Mixed Queries\nCommon in urban India:\n&quot;Koramangala mein pothole ka complain kahan karein?&quot;\n(Mix of Hindi and English)\n\n&quot;HSR Layout la garbage collection yaaru handle maadthare?&quot;\n(Mix of Kannada and English)\n\nGemini handles these natively.\n\nUser Interface\nWeb Interface\n1. Search Bar (Prominent)\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ                                                             ‚îÇ\n‚îÇ  üîç  Ask me anything about your city officials...           ‚îÇ\n‚îÇ  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  Examples:                                                  ‚îÇ\n‚îÇ  ‚Ä¢ Who handles potholes in Koramangala?                     ‚îÇ\n‚îÇ  ‚Ä¢ Contact details for Ward 98 engineer                     ‚îÇ\n‚îÇ  ‚Ä¢ ‡§ï‡•ã‡§∞‡§Æ‡§Ç‡§ó‡§≤‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡•Ç‡§°‡§º‡§æ ‡§ï‡•å‡§® ‡§â‡§†‡§æ‡§§‡§æ ‡§π‡•à?                         ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [üé§ Voice Search]  [üåê ‡§π‡§ø‡§Ç‡§¶‡•Ä | ‡§Æ‡§∞‡§æ‡§†‡•Ä | ‡≤ï‡≤®‡≥ç‡≤®‡≤°]              ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n2. Response Display\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  Query: &quot;Who handles potholes in Koramangala?&quot;              ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  PRIMARY CONTACT                                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ üë§ Mr. Rajesh Kumar                                    ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ Ward Engineer, BBMP Ward 98                            ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ                                                        ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ üìû +91-80-1234-5678                                    ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ    [üìû Call] [üí¨ WhatsApp]                             ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ                                                        ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ ‚úâÔ∏è ward98.engineer@bbmp.gov.in                         ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ    [üìß Email]                                          ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ                                                        ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ üïí Office Hours: Mon-Sat, 10 AM - 6 PM                 ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ                                                        ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ üìä Performance: 4.2‚≠ê | 156 issues resolved            ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  BACKUP CONTACTS                                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ ‚Ä¢ AEE (South Zone) - Mr. Suresh Nair                  ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ   üìû +91-80-2345-6789                                  ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ                                                        ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ ‚Ä¢ Corporator (Ward 98) - Ms. Sneha Reddy              ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ   üìû +91-98765-43210                                   ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  IF NO RESPONSE?                                            ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ\n‚îÇ  ‚îÇ 1. Wait 7 days, then escalate to:                     ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ    AEE - Mr. Suresh Nair                              ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ                                                        ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ 2. Still no response after 15 days?                   ‚îÇ ‚îÇ\n‚îÇ  ‚îÇ    Escalate to Executive Engineer                     ‚îÇ ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  ONLINE PORTAL                                              ‚îÇ\n‚îÇ  You can also file a complaint online:                      ‚îÇ\n‚îÇ  üîó bbmp.gov.in/complaint    ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  [üì§ Share this info] [üîñ Bookmark] [üëç Helpful?]         ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\n3. Browse by Location\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ  üìç Browse Officials by Location                            ‚îÇ\n‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§\n‚îÇ                                                             ‚îÇ\n‚îÇ  Select your city: [Bangalore ‚ñº]                            ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  Select your area:                                          ‚îÇ\n‚îÇ  [üîç Search wards, areas, or landmarks...]                  ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îÇ  OR Select from map:                                        ‚îÇ\n‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ\n‚îÇ  ‚îÇ         [Interactive Map of Bangalore]              ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ                                                     ‚îÇ   ‚îÇ\n‚îÇ  ‚îÇ  Click on your area to see officials               ‚îÇ   ‚îÇ\n‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ\n‚îÇ                                                             ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n\nWhatsApp Bot\nUser: &quot;Who handles potholes in Koramangala?&quot;\n\nBot:\n‡§ï‡•ã‡§∞‡§Æ‡§Ç‡§ó‡§≤‡§æ (‡§µ‡§æ‡§∞‡•ç‡§° 98) ‡§Æ‡•á‡§Ç ‡§™‡•â‡§ü‡§π‡•ã‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è:\n\nüë§ Mr. Rajesh Kumar\n   Ward Engineer, BBMP\nüìû +91-80-1234-5678\n‚úâÔ∏è ward98.engineer@bbmp.gov.in\n\nüïí Office: Mon-Sat, 10 AM-6 PM\n\nBackup:\n‚Ä¢ AEE: Mr. Suresh Nair\n  üìû +91-80-2345-6789\n\nReply:\n1 - Call Ward Engineer\n2 - Send WhatsApp message\n3 - Get escalation path\n4 - File online complaint\n\nVoice Search (Mobile)\nPowered by Google Speech-to-Text + Gemini\nUser: [Presses mic button]\n      &quot;‡§ï‡•ã‡§∞‡§Æ‡§Ç‡§ó‡§≤‡§æ ‡§Æ‡•á‡§Ç ‡§™‡•â‡§ü‡§π‡•ã‡§≤ ‡§ï‡§ø‡§∏‡§ï‡•ã ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç?&quot;\n\nApp: [Transcribes ‚Üí Sends to AI ‚Üí Gets response]\n     [Displays response + Reads aloud in Hindi]\n\n\nData Sources &amp; Scraping\nSources of Official Data\n1. Official Websites\nGOVERNMENT_SOURCES = [\n    # Municipal Corporations\n    {\n        &quot;city&quot;: &quot;Bangalore&quot;,\n        &quot;agency&quot;: &quot;BBMP&quot;,\n        &quot;url&quot;: &quot;bbmp.gov.in/officials&quot;,\n        &quot;scraper&quot;: &quot;bbmp_officials_scraper&quot;\n    },\n    {\n        &quot;city&quot;: &quot;Pune&quot;,\n        &quot;agency&quot;: &quot;PMC&quot;,\n        &quot;url&quot;: &quot;pmc.gov.in/en/contact-us&quot;,\n        &quot;scraper&quot;: &quot;pmc_officials_scraper&quot;\n    },\n \n    # State Departments\n    {\n        &quot;state&quot;: &quot;Karnataka&quot;,\n        &quot;agency&quot;: &quot;Karnataka PWD&quot;,\n        &quot;url&quot;: &quot;kpwd.karnataka.gov.in/officials&quot;,\n        &quot;scraper&quot;: &quot;kpwd_officials_scraper&quot;\n    },\n \n    # Central Ministries\n    {\n        &quot;level&quot;: &quot;national&quot;,\n        &quot;agency&quot;: &quot;Ministry of Road Transport&quot;,\n        &quot;url&quot;: &quot;morth.nic.in/contact&quot;,\n        &quot;scraper&quot;: &quot;morth_officials_scraper&quot;\n    }\n]\n2. RTI Responses\n\nFile RTI requests for official directory\nMany municipalities publish in response to RTI\nUpdate database with RTI data\n\n3. Government Orders (Transfer orders)\n# Monitor government gazette for transfer orders\n# Example: &quot;IAS officer X transferred from Y to Z&quot;\n# Auto-update official status and jurisdiction\n4. Crowdsourcing\n# Users can suggest updates:\n# &quot;This official has been transferred&quot;\n# &quot;New ward engineer appointed&quot;\n# Admin reviews and approves updates\nGrivredr-Powered Scraping\nclass OfficialDirectoryScraper:\n    &quot;&quot;&quot;\n    Use Grivredr to scrape official directories from government sites.\n    &quot;&quot;&quot;\n \n    async def scrape_municipal_officials(self, city: str, url: str) -&gt; list:\n        &quot;&quot;&quot;\n        Scrape official directory from municipal website.\n        &quot;&quot;&quot;\n        # Use Grivredr discovery to identify structure\n        structure = await grivredr.discover_structure(url)\n \n        # Extract officials\n        officials = []\n        for entry in structure[&#039;entries&#039;]:\n            official = {\n                &#039;name&#039;: entry[&#039;name&#039;],\n                &#039;designation&#039;: entry[&#039;designation&#039;],\n                &#039;phone&#039;: entry.get(&#039;phone&#039;),\n                &#039;email&#039;: entry.get(&#039;email&#039;),\n                &#039;department&#039;: entry.get(&#039;department&#039;),\n                # ... more fields\n            }\n            officials.append(official)\n \n        return officials\nData Freshness Strategy\nProblem: Officials transfer frequently.\nSolution:\n\nPeriodic rescraping: Monthly for all sources\nTransfer order monitoring: Daily check for gazette notifications\nUser feedback: ‚ÄúIs this information correct?‚Äù button\nStaleness detection: Flag if contact fails repeatedly\n\n# Mark official as potentially stale if:\n# - No response to 10+ citizen complaints\n# - Phone number invalid/disconnected\n# - Email bounces\n# - Last updated &gt; 6 months ago\n \nif official.stats.response_rate &lt; 0.2:\n    official.status = &quot;needs_verification&quot;\n    trigger_rescrape(official.agency.url)\n\nMigration Path\nPhase 1: Foundation (4-5 weeks)\nGoals: Core data model and manual data entry for 1-2 cities\nTasks:\n\n Design data models (officials, agencies, mappings)\n Build admin panel for manual data entry\n Manually populate Bangalore officials (BBMP)\n Manually populate Pune officials (PMC)\n Create responsibility mappings for common issues\n\nDeliverables:\n\nDatabase with 200+ officials (2 cities)\nAdmin interface for data management\n\nPhase 2: AI Query Engine (3-4 weeks)\nGoals: Natural language query resolution\nTasks:\n\n Build query parsing with Gemini\n Implement jurisdiction resolution logic\n Build official lookup engine\n Create escalation path builder\n Implement response generation (multilingual)\n\nDeliverables:\n\nWorking query resolution API\nSupport for 8 Indian languages\n\nPhase 3: User Interfaces (4-5 weeks)\nGoals: Web, WhatsApp, voice interfaces\nTasks:\n\n Build web search interface\n Add location-based browse (map)\n Integrate with WhatsApp bot (from Nagar Alert Hub)\n Add voice search (mobile)\n Create shareable official cards\n\nDeliverables:\n\nWeb portal live\nWhatsApp bot functional\nMobile voice search working\n\nPhase 4: Automated Scraping (5-6 weeks)\nGoals: Auto-populate officials from government sites\nTasks:\n\n Build Grivredr scrapers for top 20 cities\n Implement transfer order monitoring\n Create data validation pipeline\n Build crowdsourced update system\n Add staleness detection\n\nDeliverables:\n\n50+ cities covered\n10,000+ officials in database\nMonthly auto-updates\n\nPhase 5: Integration with Darshi Reports (2-3 weeks)\nGoals: Connect with existing Darshi reporting\nTasks:\n\n Add ‚ÄúFind responsible official‚Äù to report submission\n Auto-suggest official based on report location/category\n Show escalation path if report unresolved\n Add ‚ÄúContact official directly‚Äù option\n\nDeliverables:\n\nSeamless integration with report flow\nUsers can find + contact official in one flow\n\nPhase 6: Scale &amp; Optimize (Ongoing)\nGoals: National coverage, data quality\nTasks:\n\n Expand to 100+ cities\n Improve AI resolution accuracy\n Add official performance tracking\n Build feedback loop for data quality\n\n\nChallenges &amp; Mitigations\n1. Data Availability\nChallenge: Many municipalities don‚Äôt publish official directories online.\nMitigations:\n\nRTI requests for directories\nManual entry for major cities (prioritize)\nCrowdsourced updates (verified by admins)\nPartnerships with civic organizations\n\n2. Data Staleness\nChallenge: Officials transfer every 1-2 years, data quickly outdated.\nMitigations:\n\nAutomated transfer order monitoring\nUser feedback mechanism (‚ÄúIs this correct?‚Äú)\nPeriodic rescraping (monthly)\nStaleness detection (flag unresponsive officials)\n\n3. Jurisdiction Complexity\nChallenge: Overlapping jurisdictions (municipal vs state roads, etc.)\nMitigations:\n\nDetailed responsibility mappings\nAI handles ambiguity (suggests multiple options)\nUser feedback improves mappings over time\nClear explanations (‚ÄúBBMP for municipal roads, PWD for state highways‚Äù)\n\n4. Language Barriers\nChallenge: Official names in local scripts, English speakers can‚Äôt search.\nMitigations:\n\nStore both native script and transliteration\nAI understands queries in any language\nResponse in user‚Äôs language\nVoice search (no typing required)\n\n5. Privacy &amp; Security\nChallenge: Publishing official contact info could lead to harassment.\nMitigations:\n\nOnly publish info already public (government websites)\nRate limiting on contact lookups\nEncourage use of official complaint portals (not direct calls)\n‚ÄúReport misuse‚Äù option\n\n6. Accuracy of AI Resolution\nChallenge: AI might suggest wrong official.\nMitigations:\n\nMultiple contact options (primary + backups)\nUser feedback (‚ÄúWas this helpful?‚Äú)\nContinuous improvement of responsibility mappings\nHuman oversight for complex cases\n\n\nTech Stack\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nComponentTechnologyPurposeQuery UnderstandingGeminiParse natural language queriesDatabaseFirestoreOfficials, agencies, mappingsScrapingGrivredrAuto-extract officials from websitesBackendFastAPIAPI serverFrontendSvelteKitWeb interfaceVoiceGoogle Speech-to-TextVoice searchWhatsAppWhatsApp Business APIBot interfaceMapsGoogle MapsLocation-based browse\n\nSuccess Metrics\nData Coverage\n\nNumber of cities covered (target: 100+)\nNumber of officials in database (target: 50,000+)\nData freshness (target: &lt;10% stale entries)\n\nUser Engagement\n\nDaily queries resolved\nQuery resolution accuracy (user feedback)\nAverage time to find official (target: &lt;30 seconds)\n\nImpact\n\n% of Darshi reports that use official finder\n% of reports sent directly to identified officials\nReduction in ‚ÄúI don‚Äôt know who to contact‚Äù feedback\n\n\nConclusion\nThe Official Directory Platform removes the navigation barrier that prevents citizens from reaching the right official. By combining:\n\nComprehensive data (scraped + curated)\nAI-powered resolution (natural language understanding)\nMultilingual support (8+ Indian languages)\nMultiple interfaces (web, WhatsApp, voice)\n\nWe empower every citizen to navigate India‚Äôs complex governance structure, regardless of their education, language, or technical literacy.\n\nDocument Version: 1.0\nLast Updated: December 2024\nPart of: Darshi Civic Suite"},"reference/CLAUDE":{"slug":"reference/CLAUDE","filePath":"reference/CLAUDE.md","title":"CLAUDE","links":["reference/PHILOSOPHY"],"tags":[],"content":"CLAUDE.md\nThis file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.\nIMPORTANT: Before making any changes, read PHILOSOPHY.md for development workflow, design principles, error handling standards, logging guidelines, and commit conventions.\nProject Overview\nDarshi is a civic grievance platform that allows citizens to report and track civic issues (potholes, garbage, streetlights, etc.) using AI-powered image analysis. The system uses Google Cloud services for storage, database, and AI capabilities.\nProject Structure:\n\n/ - FastAPI backend (Python)\n/frontend - SvelteKit frontend (TypeScript)\n\nCore Architecture\nBackend Stack:\n\nFastAPI web framework with async support\nGoogle Cloud Firestore as the primary database\nGoogle Cloud Storage for image uploads\nGoogle Gemini (gemini-1.5-flash) for AI-powered image analysis\nBigQuery for analytics and hotspot detection\nJWT authentication with bcrypt password hashing\n\nFrontend Stack:\n\nSvelteKit 5 with Runes (reactive programming)\nTypeScript for type safety\nNative CSS (no frameworks - ultra lightweight)\nVite for fast development and building\n\nApplication Flow:\n\nUser submits report with images via /api/v1/report\nSystem calculates SHA256 hash for duplicate detection\nImages uploaded to GCS bucket {PROJECT_ID}-reports\nBackground task processes AI verification:\n\nDownloads image from GCS\nAnalyzes with Gemini to classify civic issues\nChecks for duplicate reports by geohash and category\nUpdates report status (VERIFIED, REJECTED, DUPLICATE)\n\n\nTimeline events tracked for audit trail\nBigQuery analytics identify hotspots (3+ severe issues in 24h)\n\nService Layer Structure:\n\nai_service.py - Gemini image analysis with circuit breaker and retry logic\ndb_service.py - Firestore operations with retry decorators for transient failures\nstorage_service.py - GCS file uploads with validation and retry logic\nanalytics_service.py - BigQuery queries with graceful degradation\ngeo_service.py - Geohashing and geocoding with circuit breaker for Nominatim\nauth_service.py - JWT tokens, password hashing, OAuth integration\n\nError Handling Layer:\n\ncore/exceptions.py - 32 custom exception types (DatabaseError, AIServiceError, etc.)\ncore/error_handling.py - Circuit breakers, retry decorators, error context manager\ncore/validation.py - Input validation (files, coordinates, strings, reports)\n\nData Model:\n\nReports stored in Firestore reports collection with geohash indexing\nComments stored as subcollections under each report\nUsers collection with username-based authentication (migrated from email)\nTimeline events array tracks state changes\nImage hash (SHA256) stored for exact duplicate detection\nGeohash field (precision 5) for proximity queries (~4.9km grid)\n\nDevelopment Commands\nBackend Setup:\n# Create and activate virtual environment\npython3 -m venv venv\nsource venv/bin/activate  # Linux/Mac\n# venv\\Scripts\\activate  # Windows\n \n# Install dependencies\npip install -r requirements.txt\n \n# Configure environment\ncp .env.example .env\n# Edit .env to set:\n# - PROJECT_ID (Google Cloud project)\n# - GOOGLE_APPLICATION_CREDENTIALS (path to service-account.json)\n# - GEMINI_API_KEY (from Google AI Studio)\n# - SECRET_KEY (for JWT - change in production)\nRunning Backend:\n# Development server with auto-reload\nuvicorn app.main:app --reload --host 0.0.0.0 --port 8080\n \n# Production mode\nuvicorn app.main:app --host 0.0.0.0 --port 8080\nFrontend Setup:\ncd frontend\n \n# Install dependencies\nnpm install\n \n# Configure environment\ncp .env.example .env\n# Edit .env to set VITE_API_URL if backend is not on localhost:8080\nRunning Frontend:\ncd frontend\n \n# Development server\nnpm run dev\n \n# Build for production\nnpm run build\n \n# Preview production build\nnpm run preview\nDocker (Backend Only):\n# Build image\ndocker build -t darshi-backend .\n \n# Run container\ndocker run -p 8080:8080 --env-file .env darshi-backend\nTesting:\n# Backend tests (pytest)\npytest                          # Run all tests\npytest -v                       # Verbose output\npytest -k &quot;test_name&quot;          # Run specific test\npytest --cov=app               # With coverage report\n \n# Frontend tests (vitest)\ncd frontend\nnpm run test                   # Run all tests\nnpm run test:watch             # Watch mode\nnpm run test:coverage          # With coverage\n \n# Type checking\ncd frontend\nnpm run check                  # Check TypeScript types\nnpm run check:watch            # Watch mode\n \n# Python syntax validation\npython -m py_compile app/**/*.py\nKey Implementation Details\nReport Status Lifecycle:\n\nPENDING_VERIFICATION ‚Üí AI analysis in background\nVERIFIED ‚Üí Valid civic issue, no duplicates\nREJECTED ‚Üí AI found no valid civic issue\nDUPLICATE ‚Üí Similar issue exists nearby (same category, &lt;55m radius)\nIN_PROGRESS ‚Üí Admin marked as being addressed\nRESOLVED ‚Üí Admin marked as completed\nFLAGGED ‚Üí System error during processing\n\nDuplicate Detection Strategy:\n\nExact duplicates: SHA256 hash comparison of uploaded images\nProximity duplicates: Geohash + category matching within 0.0005 degrees (~55m)\nChecks only VERIFIED and PENDING_VERIFICATION reports from last 24h\n\nAuthentication:\n\nJWT tokens with 30-day expiration (ACCESS_TOKEN_EXPIRE_MINUTES=43200)\nUsername-based authentication (supports phone, email, OAuth, or username login)\nOAuth2 password flow at /api/v1/auth/token\nUsers have roles: ‚Äúcitizen‚Äù or ‚Äúadmin‚Äù\nAdmin endpoints use JWT authentication with get_current_admin() dependency\n\nGeospatial Features:\n\nGeohash encoding at precision 5 (~4.9km √ó 4.9km grid)\nFirestore range queries: geohash &gt;= prefix AND geohash &lt; prefix~\nGeocoding via Nominatim API (limited to India with countrycodes=in)\nKeywords extracted from title+description for basic search\n\nAI Analysis:\n\nGemini model called with image and structured JSON prompt\nReturns: is_valid (bool), category (str), severity (1-10), description (str)\nCircuit breaker prevents cascading failures (5 failures, 120s recovery)\nRetry logic with exponential backoff (3 attempts, 4-60s)\nHandles rate limiting (429) and quota exceeded errors\nFalls back to FLAGGED status on persistent failures\n\nBigQuery Analytics:\n\nTable: darshi_analytics.reports_raw_changelog\nMimics Firestore changelog stream (document_name, timestamp, operation, data)\nHotspot query: severity &gt;7, count &gt;=3, within 24 hours\n\nImportant Configuration Notes\nGoogle Cloud Setup Required:\n\nService account JSON must have permissions for:\n\nFirestore read/write\nCloud Storage bucket creation and object uploads\nBigQuery query execution\n\n\nGCS bucket name format: {PROJECT_ID}-reports\nBucket location: ASIA-SOUTH1 (hardcoded)\nImages made public via blob.make_public() (may fail if IAM restricted)\n\nSecurity Considerations:\n\nSECRET_KEY in production MUST be changed from development default\nRate limiting enforced on all public endpoints (tiered: anonymous 3/hr, registered 10/hr)\nInput sanitization via sanitize_form_data() at router layer\nFile validation (max 10MB, image types only)\nCORS configured per environment (allows localhost in development)\nservice-account.json should NEVER be committed (add to .gitignore)\n\nError Handling &amp; Robustness\nCustom Exception Hierarchy:\nAll services raise specific exceptions instead of returning None/False:\n\nDatabaseError ‚Üí Firestore operations failures\nStorageError ‚Üí GCS upload/download failures\nAIServiceError ‚Üí Gemini API failures\nGeocodingError ‚Üí Geocoding/reverse geocoding failures\nValidationError ‚Üí Input validation failures\n\nRetry &amp; Circuit Breaker Patterns:\n\nDatabase operations: 3 retry attempts with 1-10s exponential backoff\nAI operations: 3 retry attempts with 4-60s backoff\nStorage operations: 2 retry attempts with 2-20s backoff\nCircuit breakers on external APIs (Gemini: 5 failures/120s, Nominatim: 3 failures/60s)\nError context manager tracks operation duration and structured logging\n\nStructured Error Responses:\n{\n  &quot;error&quot;: {\n    &quot;code&quot;: &quot;DATABASE_ERROR&quot;,\n    &quot;message&quot;: &quot;Failed to create report&quot;,\n    &quot;details&quot;: &quot;Connection timeout after 10s&quot;,\n    &quot;timestamp&quot;: &quot;2025-12-19T10:30:00Z&quot;,\n    &quot;request_id&quot;: &quot;uuid&quot;,\n    &quot;path&quot;: &quot;/api/v1/report&quot;,\n    &quot;recoverable&quot;: true\n  }\n}\nAPI Endpoints Reference\nReports:\n\nPOST /api/v1/report - Submit new report (multipart/form-data)\nGET /api/v1/report/{report_id} - Get single report\nGET /api/v1/reports?geohash=&amp;start_after_id= - List reports with pagination\nPOST /api/v1/report/{report_id}/upvote - Upvote (idempotent per user)\nPOST /api/v1/report/{report_id}/comment - Add comment\nGET /api/v1/report/{report_id}/comments - List comments\n\nGeospatial:\n\nGET /api/v1/geocode?q={address} - Search address to coordinates\nGET /api/v1/alerts - Get hotspot alerts from BigQuery\n\nAuthentication:\n\nPOST /api/v1/auth/register - Create user account\nPOST /api/v1/auth/token - Login (returns JWT)\nGET /api/v1/auth/me - Get current user info (requires Bearer token)\n\nAdmin:\n\nPOST /api/v1/admin/login - Admin login (returns JWT)\nPUT /api/v1/admin/report/{report_id}/status - Update report status (requires Bearer token)\nGET /api/v1/admin/analytics/dashboard - Analytics dashboard data\nGET /api/v1/admin/analytics/audit-logs - Audit log events\nPOST /api/v1/admin/create-admin - Create new admin user\n\nHealth:\n\nGET /health - Service health check\n\nFrontend Architecture\nSvelteKit 5 Structure:\n\nUses new Runes system (state, derived, props, effect) for reactivity\nNo external CSS frameworks - all styling is custom and lightweight\nTypeScript for type safety across all components\nCentralized API client in lib/api.ts with structured error handling\nSvelte stores for global state management (user, toast, etc.)\n\nUX Components:\n\nToast.svelte - Non-blocking notifications (success/error/warning/info)\nLoadingButton.svelte - Buttons with integrated loading spinners\nLoadingSpinner.svelte - Reusable loading indicators (3 sizes)\nlib/validation.ts - Client-side form validation utilities\nAll components follow WCAG 2.1 accessibility guidelines\n\nKey Pages:\n\n/ (routes/+page.svelte) - Home page with reports listing and hotspot alerts\n/submit (routes/submit/+page.svelte) - Report submission form with GPS and geocoding\n/report/[id] (routes/report/[id]/+page.svelte) - Detailed report view with comments and timeline\n/signin (routes/signin/+page.svelte) - User sign-in with OAuth, credentials, phone OTP, and email link\n/register (routes/register/+page.svelte) - User registration\n/admin (routes/admin/+page.svelte) - Admin dashboard with report management\n\nState Management:\n\nuser store - Current authenticated user\nisAuthenticated store - Authentication status\nuserLocation store - User‚Äôs GPS coordinates\ntoast store - Toast notification queue with auto-dismiss\nlocalStorage for persistent auth token and user data\n\nAPI Integration:\n\nAll API calls centralized in lib/api.ts\nStructured error handling with getErrorMessage() utility\nParses backend error responses (code, message, details, recoverable flag)\nNetwork error detection for offline scenarios\nFormData for file uploads\nBearer token authentication\nType-safe interfaces for all API responses\n\nUX Patterns:\n\nToast notifications instead of alert() dialogs\nLoading states on all async operations\nOptimistic UI updates with rollback on failure\nClient-side form validation with inline errors\nCharacter counters on text inputs\nARIA labels, semantic HTML, keyboard navigation\n\nResponsive Design:\n\nMobile-first approach\nGrid layouts with CSS Grid\nFlexbox for component layouts\nMedia queries for tablet/desktop\nTouch-friendly buttons and forms\n\nLogging Standards\nBackend Logging Levels:\n\nDEBUG: Internal operations, flow tracking (queries, lookups, coordinate encoding)\nINFO: User-facing operations (report creation, user login, file uploads)\nWARNING: Validation failures, recoverable errors (geocoding failures, rate limit approached)\nERROR: Actual failures with context (database errors, API failures, upload errors)\nCRITICAL: System initialization failures (Firestore connection, Firebase Admin SDK)\n\nLogging Best Practices:\n\nInclude relevant IDs in all log messages (report_id, user_id, request_id)\nUse f-strings for log formatting: logger.info(f&quot;Report {report_id} created by {username}&quot;)\nAdd exc_info=True to ERROR logs for stack traces\nNever log sensitive data (passwords, tokens, PII)\nNo console.log statements in production frontend code\n\nCode Quality Standards\nBackend:\n\nAll services must raise specific exceptions (DatabaseError, AIServiceError, etc.)\nNever return None/False for error conditions - raise exceptions with context\nUse retry decorators for external operations (@retry_database_operation, @retry_ai_operation)\nAdd circuit breakers to external API calls (Gemini, Nominatim)\nValidate all inputs at router layer before passing to services\n\nFrontend:\n\nUse toast notifications, never alert() dialogs\nAdd LoadingButton to all form submissions\nImplement client-side validation with inline error messages\nEnsure accessibility (ARIA labels, semantic HTML, keyboard navigation)\nNo console.log/console.error statements in production code\nUse SvelteKit 5 Runes (state, derived, $effect) for reactivity\n\nDocumentation:\n\nUpdate PHILOSOPHY.md when adding new patterns or standards\nDocument complex business logic with inline comments\nKeep CLAUDE.md synchronized with major architectural changes\n"},"reference/PHILOSOPHY":{"slug":"reference/PHILOSOPHY","filePath":"reference/PHILOSOPHY.md","title":"PHILOSOPHY","links":[],"tags":[],"content":"PHILOSOPHY.md\nDarshi Development Philosophy &amp; Workflow Guide\nThis document defines the consistent workflow, design principles, and best practices for all contributors and AI assistants (LLMs) working on the Darshi codebase. Follow these guidelines to maintain code quality, consistency, and robustness.\n\nTable of Contents\n\nCore Values\nArchitecture Principles\nBackend Development\nFrontend Development\nError Handling Philosophy\nLogging Standards\nTesting &amp; Validation\nGit Workflow\nDocumentation Standards\nAI Assistant Guidelines\n\n\nCore Values\n1. Robustness Above All\n\nPrinciple: The system must handle failures gracefully without crashing\nImplementation:\n\nMultiple layers of error handling (try-catch, circuit breakers, retries)\nGraceful degradation for non-critical features\nNo silent failures - every error must be logged with context\nInput validation at every layer (router, service, database)\n\n\n\n2. User Experience is King\n\nPrinciple: Every user interaction should be delightful, accessible, and informative\nImplementation:\n\nToast notifications for all feedback (never use alert())\nLoading states for every async operation\nClear, actionable error messages\nAccessibility-first (ARIA labels, keyboard navigation, semantic HTML)\nForm validation with helpful hints\n\n\n\n3. Code Quality &amp; Consistency\n\nPrinciple: Code should be self-documenting, consistent, and maintainable\nImplementation:\n\nFollow established patterns (don‚Äôt reinvent the wheel)\nDRY (Don‚Äôt Repeat Yourself) - extract reusable utilities\nConsistent naming conventions across layers\nType safety (TypeScript/Python type hints)\nNo console.log in production code\n\n\n\n4. Security by Design\n\nPrinciple: Security should never be an afterthought\nImplementation:\n\nInput sanitization at router level\nParameterized queries (Firestore prevents SQL injection by design)\nRate limiting on all public endpoints\nSensitive data never logged or exposed in errors\nEnvironment-aware error details (verbose in dev, minimal in prod)\n\n\n\n\nArchitecture Principles\nSeparation of Concerns\nLayer Structure:\nRouter Layer (app/routers/)\n    ‚Üì (validation, sanitization)\nService Layer (app/services/)\n    ‚Üì (business logic, error handling)\nCore Utilities (app/core/)\n    ‚Üì (shared functionality)\nExternal Services (GCP, APIs)\n\nRules:\n\nRouters: Handle HTTP concerns only (validation, request/response formatting, auth)\nServices: Contain business logic, orchestrate operations, raise specific exceptions\nCore: Shared utilities (logging, security, error handling, validation)\nNo layer skipping: Don‚Äôt call external services directly from routers\n\nService Design Patterns\nWhen to use Classes:\n\nStateful services (EmailService, SMSService with config)\nServices requiring initialization (connection pooling, SDK setup)\nServices with multiple related methods sharing state\n\nWhen to use Module-Level Functions:\n\nStateless operations (ai_service, geo_service)\nPure functions without shared state\nSimple CRUD operations (db_service)\n\nConsistency Rule: Similar services should follow similar patterns, but don‚Äôt force classes where functions are clearer.\n\nBackend Development\nFastAPI Router Guidelines\nfrom fastapi import APIRouter, HTTPException, status, Request\nfrom app.services import db_service\nfrom app.core.validation import validate_report_data\nfrom app.core.exceptions import DatabaseError, ValidationError\nfrom app.core.security import limiter, sanitize_form_data\nfrom app.core.logging_config import get_logger\n \nrouter = APIRouter()\nlogger = get_logger(__name__)\n \n@router.post(&quot;/api/v1/resource&quot;, status_code=status.HTTP_201_CREATED)\n@limiter.limit(&quot;10/hour&quot;)\nasync def create_resource(request: Request, data: ResourceSchema):\n    &quot;&quot;&quot;\n    Clear docstring explaining endpoint purpose, parameters, and responses.\n    &quot;&quot;&quot;\n    # 1. Sanitize inputs\n    sanitized = sanitize_form_data(data.dict())\n \n    # 2. Validate\n    try:\n        validated_data = validate_resource(sanitized)\n    except ValidationError as e:\n        logger.warning(f&quot;Validation failed: {e}&quot;)\n        raise HTTPException(status_code=400, detail=str(e))\n \n    # 3. Call service layer\n    try:\n        result = db_service.create_resource(validated_data)\n        logger.info(f&quot;Resource {result.id} created successfully&quot;)\n        return result\n    except DatabaseError as e:\n        logger.error(f&quot;Failed to create resource: {e}&quot;)\n        raise HTTPException(status_code=500, detail=e.message)\nService Layer Guidelines\nfrom app.core.logging_config import get_logger\nfrom app.core.exceptions import DatabaseError\nfrom app.core.error_handling import retry_database_operation, ErrorContext\n \nlogger = get_logger(__name__)\n \n@retry_database_operation\ndef create_resource(data: dict) -&gt; str:\n    &quot;&quot;&quot;\n    Service function with retry decorator for robustness.\n    &quot;&quot;&quot;\n    with ErrorContext(&quot;database&quot;, &quot;create_resource&quot;):\n        try:\n            # Database operation\n            doc_ref = db.collection(&#039;resources&#039;).add(data)\n            logger.info(f&quot;Resource created with ID: {doc_ref.id}&quot;)\n            return doc_ref.id\n        except GoogleCloudError as e:\n            logger.error(f&quot;GCP error creating resource: {e}&quot;)\n            raise DatabaseError(\n                message=&quot;Failed to create resource&quot;,\n                details=str(e),\n                context={&quot;operation&quot;: &quot;create&quot;, &quot;collection&quot;: &quot;resources&quot;}\n            )\nException Handling Rules\n\nAlways raise specific exceptions (never return None/False for errors)\nInclude context in exceptions (IDs, operation type, relevant data)\nNever catch Exception without re-raising (unless it‚Äôs a fallback)\nUse retry decorators for transient failures\nUse circuit breakers for external services (Gemini, Nominatim)\n\n\nFrontend Development\nSvelteKit 5 Component Structure\n&lt;script lang=&quot;ts&quot;&gt;\n  import { toast } from &#039;$lib/stores/toast&#039;;\n  import { getErrorMessage } from &#039;$lib/api&#039;;\n  import LoadingButton from &#039;$lib/components/LoadingButton.svelte&#039;;\n  import { validateField, validationRules } from &#039;$lib/validation&#039;;\n \n  // Props\n  let { data } = $props();\n \n  // State\n  let loading = $state(false);\n  let formData = $state({ title: &#039;&#039;, description: &#039;&#039; });\n  let errors = $state&lt;Record&lt;string, string[]&gt;&gt;({});\n  let touched = $state&lt;Record&lt;string, boolean&gt;&gt;({});\n \n  // Derived state\n  let isValid = $derived(\n    Object.keys(errors).length === 0 &amp;&amp; formData.title.length &gt;= 10\n  );\n \n  // Validation\n  function validateTitle() {\n    const result = validateField(formData.title, [\n      validationRules.required(),\n      validationRules.minLength(10),\n      validationRules.maxLength(200)\n    ]);\n    errors.title = result.errors;\n  }\n \n  // Actions\n  async function handleSubmit() {\n    loading = true;\n    try {\n      const response = await api.post(&#039;/api/v1/resource&#039;, formData);\n      toast.show(&#039;Resource created successfully!&#039;, &#039;success&#039;);\n      goto(&#039;/resources&#039;);\n    } catch (error) {\n      toast.show(getErrorMessage(error), &#039;error&#039;);\n    } finally {\n      loading = false;\n    }\n  }\n&lt;/script&gt;\n \n&lt;main&gt;\n  &lt;h1&gt;Create Resource&lt;/h1&gt;\n \n  &lt;form onsubmit={handleSubmit}&gt;\n    &lt;label for=&quot;title&quot;&gt;\n      Title ({formData.title.length}/200)\n      &lt;span aria-label=&quot;required&quot;&gt;*&lt;/span&gt;\n    &lt;/label&gt;\n    &lt;input\n      id=&quot;title&quot;\n      type=&quot;text&quot;\n      bind:value={formData.title}\n      oninput={validateTitle}\n      onblur={() =&gt; touched.title = true}\n      aria-required=&quot;true&quot;\n      aria-invalid={errors.title &gt; 0}\n      aria-describedby={errors.title &gt; 0 ? &#039;title-error&#039; : undefined}\n    /&gt;\n    {#if touched.title &amp;&amp; errors.title &gt; 0}\n      &lt;span id=&quot;title-error&quot; role=&quot;alert&quot; class=&quot;error&quot;&gt;\n        {errors.title[0]}\n      &lt;/span&gt;\n    {/if}\n \n    &lt;LoadingButton\n      type=&quot;submit&quot;\n      {loading}\n      disabled={!isValid}\n      variant=&quot;primary&quot;\n    &gt;\n      Create Resource\n    &lt;/LoadingButton&gt;\n  &lt;/form&gt;\n&lt;/main&gt;\n \n&lt;style&gt;\n  .error {\n    color: var(--color-error, #dc2626);\n    font-size: 0.875rem;\n    margin-top: 0.25rem;\n  }\n&lt;/style&gt;\nFrontend UX Checklist\nFor EVERY page, ensure:\n\n All alert() calls replaced with toast.show()\n LoadingButton used for all form submissions\n LoadingSpinner shown during initial data fetching\n Form validation with inline error messages\n Character counters for text inputs (if limits exist)\n ARIA labels on all interactive elements\n Semantic HTML (&lt;main&gt;, &lt;section&gt;, &lt;article&gt;, &lt;nav&gt;)\n Keyboard navigation works (Tab, Enter, Space)\n Focus-visible styles for accessibility\n Error states with user-friendly messages\n Empty states for lists/collections\n No console.log statements\n Responsive design (mobile-first)\n Optimistic UI updates where appropriate\n\n\nError Handling Philosophy\nThe Three-Layer Defense\nLayer 1: Prevention\n\nInput validation at router level\nType checking (TypeScript/Pydantic)\nSanitization of user inputs\n\nLayer 2: Recovery\n\nRetry logic with exponential backoff\nCircuit breakers for external services\nGraceful degradation (continue with partial data)\n\nLayer 3: Communication\n\nStructured error responses\nUser-friendly error messages\nDetailed logging for debugging\nRequest IDs for tracing\n\nCustom Exception Hierarchy\nDarshiBaseException\n‚îú‚îÄ‚îÄ DatabaseError\n‚îÇ   ‚îú‚îÄ‚îÄ DatabaseConnectionError\n‚îÇ   ‚îú‚îÄ‚îÄ DatabaseTimeoutError\n‚îÇ   ‚îú‚îÄ‚îÄ DocumentNotFoundError\n‚îÇ   ‚îî‚îÄ‚îÄ TransactionError\n‚îú‚îÄ‚îÄ StorageError\n‚îÇ   ‚îú‚îÄ‚îÄ UploadFailedError\n‚îÇ   ‚îú‚îÄ‚îÄ BucketNotFoundError\n‚îÇ   ‚îî‚îÄ‚îÄ QuotaExceededError\n‚îú‚îÄ‚îÄ AIServiceError\n‚îÇ   ‚îú‚îÄ‚îÄ AIServiceUnavailableError\n‚îÇ   ‚îú‚îÄ‚îÄ AIRateLimitError\n‚îÇ   ‚îî‚îÄ‚îÄ AIInvalidResponseError\n‚îú‚îÄ‚îÄ GeocodingError\n‚îú‚îÄ‚îÄ AnalyticsError\n‚îî‚îÄ‚îÄ ValidationError\n    ‚îú‚îÄ‚îÄ InvalidInputError\n    ‚îú‚îÄ‚îÄ InvalidFileError\n    ‚îî‚îÄ‚îÄ InvalidCoordinatesError\n\nRules:\n\nAlways raise the most specific exception type\nInclude context dict with relevant data\nSet recoverable=True if client can retry\nNever expose sensitive data in error messages\n\nError Response Format\n{\n  &quot;error&quot;: {\n    &quot;code&quot;: &quot;DATABASE_ERROR&quot;,\n    &quot;message&quot;: &quot;Failed to create report&quot;,\n    &quot;details&quot;: &quot;Connection timeout after 10s&quot;,\n    &quot;timestamp&quot;: &quot;2025-12-19T10:30:00Z&quot;,\n    &quot;request_id&quot;: &quot;uuid-here&quot;,\n    &quot;path&quot;: &quot;/api/v1/report&quot;,\n    &quot;recoverable&quot;: true\n  }\n}\n\nLogging Standards\nLogging Levels\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nLevelUse CaseExamplesDEBUGInternal state, flow tracking‚ÄùFetching report by id: {id}‚Äù, ‚ÄúEncoded location to geohash: {hash}‚ÄúINFOSuccessful operations, milestones‚ÄùReport {id} created by {user}‚Äù, ‚ÄúAI analysis completed‚Äù, ‚ÄúUser logged in‚ÄùWARNINGRecoverable errors, validation failures‚ÄùGeocoding failed, using coordinates‚Äù, ‚ÄúRate limit approached‚Äù, ‚ÄúInvalid file type‚ÄùERRORActual errors affecting functionality‚ÄùDatabase query failed‚Äù, ‚ÄúStorage upload failed‚Äù, ‚ÄúAI service unavailable‚ÄùCRITICALSystem-level failures‚ÄùFailed to initialize Firestore‚Äù, ‚ÄúCannot connect to database‚Äù\nLogging Best Practices\n# ‚úÖ GOOD - Structured, contextual logging\nlogger.info(f&quot;Report {report_id} created successfully by user {username}&quot;)\nlogger.error(f&quot;Failed to upload image for report {report_id}: {error}&quot;, exc_info=True)\nlogger.debug(f&quot;Processing {len(reports)} reports with status {status}&quot;)\n \n# ‚ùå BAD - Generic, uninformative logging\nlogger.info(&quot;Report created&quot;)\nlogger.error(&quot;Error occurred&quot;)\nlogger.debug(&quot;Processing&quot;)\nRules:\n\nInclude relevant IDs (report_id, user_id, request_id)\nUse f-strings for formatting\nAdd exc_info=True to ERROR logs for stack traces\nUse structured logging for metrics (extra={‚Ä¶})\nNever log sensitive data (passwords, tokens, PII)\n\n\nTesting &amp; Validation\nInput Validation Layers\nRouter Layer:\n# Validate request format, sanitize inputs\nsanitized = sanitize_form_data(data)\nvalidate_report_data(sanitized)  # Raises ValidationError\nService Layer:\n# Validate business rules\nif not user.is_active:\n    raise ValidationError(&quot;User account is inactive&quot;)\nDatabase Layer:\n# Validate data integrity (handled by Firestore schemas)\nValidation Rules\n\nCoordinates: Latitude [-90, 90], Longitude [-180, 180]\nFiles: Max 10MB, image types only (jpg, jpeg, png, webp)\nStrings: Max lengths enforced, XSS prevention via sanitization\nUsernames: 3-30 chars, alphanumeric + underscore\nPasswords: 8+ chars, mix of upper/lower/numbers (enforced client-side)\nEmails: RFC 5322 compliant (use Pydantic EmailStr)\nPhone: E.164 format preferred (+91xxxxxxxxxx)\n\n\nGit Workflow\nCommit Message Format\nFollow Conventional Commits:\n&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;\n\n&lt;body&gt;\n\n&lt;footer&gt;\n\nTypes:\n\nfeat: New feature\nfix: Bug fix\nrefactor: Code restructuring without behavior change\nperf: Performance improvement\nstyle: Formatting, missing semicolons\ndocs: Documentation only\ntest: Adding/modifying tests\nchore: Build process, tooling, dependencies\n\nExamples:\nfeat(reports): add image hash duplicate detection\n \nImplement SHA256 hashing of uploaded images to detect exact duplicates.\nLinks new reports to existing reports with identical images.\n \nCloses #42\n \n---\n \nfix(auth): resolve undefined user_email variable in delete endpoint\n \nChanged user_email to username in reports.py line 303 to match\nthe migration from email-based to username-based authentication.\n \n---\n \nrefactor(logging): standardize logging levels across all services\n \n- Changed routine CRUD operations from INFO to DEBUG\n- Added WARNING logs for validation failures\n- Enhanced ERROR logs with contextual information\n- Eliminated silent failures in geo_service\n \n---\n \nfeat(frontend): implement toast notification system\n \nReplace all alert() calls with elegant toast notifications.\nIncludes LoadingButton, LoadingSpinner components, and comprehensive\nform validation with accessibility improvements (ARIA labels, keyboard nav).\nBranch Strategy\n\nmain: Production-ready code\ndevelop: Integration branch (if needed)\nFeature branches: feat/feature-name\nFix branches: fix/bug-description\n\nCommit Frequency\n\nCommit after each logical change (not too granular, not too broad)\nPush after completing a feature/fix\nTag releases with semantic versioning (v1.0.0)\n\n\nDocumentation Standards\nWhen to Create Documentation\nYES - Create documentation for:\n\nArchitecture decisions (this file)\nAPI endpoints (OpenAPI/Swagger)\nSetup/deployment guides\nComplex algorithms or business logic\nError handling patterns (ERROR_HANDLING_IMPLEMENTATION.md)\nMigration guides (USERNAME_MIGRATION.md)\n\nNO - Don‚Äôt create documentation for:\n\nSelf-evident code\nStandard patterns (following conventions)\nTemporary/experimental features\nPersonal notes (use code comments instead)\n\nCode Comments\n# ‚úÖ GOOD - Explains WHY, not WHAT\n# Check for duplicates within 55m radius to avoid redundant reports\nduplicates = find_nearby_reports(lat, lng, category, radius=0.0005)\n \n# ‚ùå BAD - States the obvious\n# Create a variable called duplicates\nduplicates = find_nearby_reports(lat, lng, category, radius=0.0005)\nRules:\n\nUse comments to explain why, not what\nDocstrings for all public functions/classes\nTODO comments include issue numbers: # TODO(#123): Implement caching\nRemove commented-out code (use git history instead)\n\nInline Documentation\ndef analyze_image(image_bytes: bytes) -&gt; AIAnalysisResult:\n    &quot;&quot;&quot;\n    Analyze an image using Google Gemini AI to determine if it contains\n    a valid civic grievance.\n \n    Args:\n        image_bytes: Raw image data (JPEG, PNG, or WebP format)\n \n    Returns:\n        AIAnalysisResult with is_valid, category, severity, and description\n \n    Raises:\n        AIServiceError: If the Gemini API is unavailable\n        AIRateLimitError: If rate limit is exceeded\n        AIInvalidResponseError: If the response cannot be parsed\n \n    Example:\n        &gt;&gt;&gt; with open(&#039;pothole.jpg&#039;, &#039;rb&#039;) as f:\n        ...     result = analyze_image(f.read())\n        &gt;&gt;&gt; result.is_valid\n        True\n        &gt;&gt;&gt; result.category\n        &#039;pothole&#039;\n    &quot;&quot;&quot;\n    pass\n\nAI Assistant Guidelines\nFor LLMs Working on This Codebase\n1. Always Read Before Writing\n\nNEVER propose changes to code you haven‚Äôt read\nUse Read tool to understand existing patterns\nUse Grep tool to find similar implementations\nCheck this PHILOSOPHY.md file first\n\n2. Follow Established Patterns\n\nLook for existing examples in the codebase\nMatch the style, structure, and naming conventions\nDon‚Äôt reinvent patterns that already exist\nIf you see inconsistencies, ask before assuming\n\n3. Task Planning\n\nUse TodoWrite tool for multi-step tasks (3+ steps)\nBreak complex tasks into atomic subtasks\nMark tasks as in_progress BEFORE starting\nMark tasks as completed IMMEDIATELY after finishing\nUpdate todos frequently to track progress\n\n4. Error Handling is Non-Negotiable\n\nALWAYS use specific exception types (never generic Exception)\nALWAYS add retry decorators for external calls\nALWAYS log errors with context\nNEVER return None/False for error conditions (raise exceptions)\nNEVER use bare except: blocks\n\n5. Logging Discipline\n\nFollow the logging standards table above\nDEBUG for internal operations\nINFO for user-facing operations\nWARNING for validation failures\nERROR for actual failures\nCRITICAL for system-level issues\n\n6. Frontend Consistency\n\nALWAYS replace alert() with toast.show()\nALWAYS use LoadingButton for async actions\nALWAYS add ARIA labels and semantic HTML\nALWAYS validate forms with inline errors\nNEVER leave console.log statements\n\n7. Testing &amp; Validation\n\nTest changes locally before committing\nVerify syntax with python -m py_compile or tsc --noEmit\nCheck for regressions (did you break existing functionality?)\nValidate that imports work correctly\n\n8. Git Commit Hygiene\n\nUse conventional commit format (feat, fix, refactor, etc.)\nWrite clear, descriptive commit messages\nCommit related changes together (atomic commits)\nPush after completing a feature or fix\n\n9. Ask When Uncertain\n\nUse AskUserQuestion tool for ambiguous requirements\nDon‚Äôt guess at user intent\nClarify before implementing major changes\nPresent options when multiple approaches exist\n\n10. Room for Improvement\n\nThis philosophy is not set in stone\nSuggest improvements if you see better patterns\nBalance consistency with pragmatism\nDon‚Äôt let perfect be the enemy of good\n\nWorkflow for New Features\n1. Read relevant files to understand existing patterns\n2. Create TodoWrite list if task has 3+ steps\n3. Plan implementation (consider error cases, validation, logging)\n4. Implement with proper error handling and logging\n5. Add frontend UX improvements (toast, loading, accessibility)\n6. Test locally (syntax check, basic functionality)\n7. Remove console.log statements\n8. Update documentation if needed\n9. Commit with conventional commit message\n10. Push to repository\n\nWorkflow for Bug Fixes\n1. Read the file with the bug\n2. Understand the root cause (don&#039;t just patch symptoms)\n3. Check if similar bugs exist elsewhere\n4. Fix the bug with proper error handling\n5. Add logging if the bug was silent\n6. Add validation to prevent recurrence\n7. Test the fix\n8. Commit with &quot;fix: &lt;description&gt;&quot;\n9. Push to repository\n\n\nPhilosophy Summary\nDarshi is built on these pillars:\n\nRobustness: Multiple layers of error handling, no silent failures\nUser Experience: Accessible, informative, delightful interactions\nCode Quality: Consistent, maintainable, self-documenting code\nSecurity: Input validation, sanitization, rate limiting, minimal exposure\nObservability: Structured logging, error tracking, request tracing\n\nFor AI Assistants:\n\nRead before writing\nFollow established patterns\nPlan complex tasks with todos\nError handling is mandatory\nLogging must be structured\nFrontend must be accessible\nNo console.log in production\nCommit frequently with clear messages\nAsk when uncertain\nSuggest improvements, but respect consistency\n\nRemember: The goal is not just working code, but robust, maintainable, user-friendly code that can scale and evolve over time.\n\nLast Updated: 2025-12-19\nVersion: 1.0.0\nMaintained By: Darshi Development Team"}}